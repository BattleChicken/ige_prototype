function printStackTrace(e){e=e||{guess:!0};for(var t=e.e||null,i=!!e.guess,r=new printStackTrace.implementation,n=r.run(t),o=i?r.guessAnonymousFunctions(n):n,a=0;4>a;a++)o.shift();return o}printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(e){e=e||this.createException();var t=this.mode(e);return t==="other"?this.other(arguments.callee):this[t](e)},createException:function(){try{return this.undef(),null}catch(e){return e}},mode:function(e){return this._mode=e.arguments&&e.stack?"chrome":e.message&&typeof window!="undefined"&&window.opera?e.stacktrace?"opera10":"opera":e.stack?"firefox":"other"},instrumentFunction:function(e,t,i){e=e||window;var r=e[t];e[t]=function(){return i.call(this,printStackTrace().slice(4)),e[t]._instrumented.apply(this,arguments)},e[t]._instrumented=r},deinstrumentFunction:function(e,t){e[t].constructor===Function&&e[t]._instrumented&&e[t]._instrumented.constructor===Function&&(e[t]=e[t]._instrumented)},chrome:function(e){var t=(e.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return t.pop(),t},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera10:function(e){var t,i,r,n=e.stacktrace,o=n.split("\n"),a="{anonymous}",s=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i;for(t=2,i=0,r=o.length;r-2>t;t++)if(s.test(o[t])){var h=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2,l=RegExp.$3;l=l.replace(/<anonymous function\:?\s?(\S+)?>/g,a),o[i++]=l+"@"+h}return o.splice(i,o.length-i),o},opera:function(e){var t,i,r,n=e.message.split("\n"),o="{anonymous}",a=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i;for(t=4,i=0,r=n.length;r>t;t+=2)a.test(n[t])&&(n[i++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:o+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+n[t+1].replace(/^\s+/,""));return n.splice(i,n.length-i),n},other:function(e){var t,i,r="{anonymous}",n=/function\s*([\w\-$]+)?\s*\(/i,o=[],a=10;while(e&&a>o.length)t=n.test(e+"")?RegExp.$1||r:r,i=Array.prototype.slice.call(e.arguments||[]),o[o.length]=t+"("+this.stringifyArguments(i)+")",e=e.caller;return o},stringifyArguments:function(e){for(var t=Array.prototype.slice,i=0;e.length>i;++i){var r=e[i];r===void 0?e[i]="undefined":r===null?e[i]="null":r.constructor&&(r.constructor===Array?e[i]=3>r.length?"["+this.stringifyArguments(r)+"]":"["+this.stringifyArguments(t.call(r,0,1))+"..."+this.stringifyArguments(t.call(r,-1))+"]":r.constructor===Object?e[i]="#object":r.constructor===Function?e[i]="#function":r.constructor===String&&(e[i]='"'+r+'"'))}return e.join(",")},sourceCache:{},ajax:function(e){var t=this.createXMLHTTPObject();if(t)return t.open("GET",e,!1),t.send(""),t.responseText},createXMLHTTPObject:function(){for(var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],i=0;t.length>i;i++)try{return e=t[i](),this.createXMLHTTPObject=t[i],e}catch(r){}},isSameDomain:function(e){return e.indexOf(location.hostname)!==-1},getSource:function(e){return e in this.sourceCache||(this.sourceCache[e]=this.ajax(e).split("\n")),this.sourceCache[e]},guessAnonymousFunctions:function(e){for(var t=0;e.length>t;++t){var i=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/,r=e[t],n=i.exec(r);if(n){var o=n[1],a=n[4],s=n[7]||0;if(o&&this.isSameDomain(o)&&a){var h=this.guessAnonymousFunction(o,a,s);e[t]=r.replace("{anonymous}",h)}}}return e},guessAnonymousFunction:function(e,t){var i;try{i=this.findFunctionName(this.getSource(e),t)}catch(r){i="getSource failed with url: "+e+", exception: "+(r+"")}return i},findFunctionName:function(e,t){for(var i,r,n=/function\s+([^(]*?)\s*\(([^)]*)\)/,o=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,a=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,s="",h=10,l=0;h>l;++l)if(i=e[t-l]){if(s=i+s,r=o.exec(s),r&&r[1])return r[1];if(r=n.exec(s),r&&r[1])return r[1];if(r=a.exec(s),r&&r[1])return r[1]}return"(?)"}},ige=null,igeVersion="1.1.0",igeClassStore={},igeDebug={node:typeof module!="undefined"&&module.exports!==void 0,level:["log","warning","error"],stacks:!0,throwErrors:!0,timing:!0},igeDebug.node&&(igeDebug.util=require("util")),Object.defineProperty(Object.prototype,"tween",{enumerable:!1,writable:!0,configurable:!0}),Object.prototype.tween=function(e,t,i){var r=(new $i_47).targetObj(this).properties(e).duration(t);return i&&(i.beforeTween&&r.beforeTween(i.beforeTween),i.afterTween&&r.afterTween(i.afterTween),i.easing&&r.easing(i.easing),i.startTime&&r.startTime(i.startTime)),r},Object.defineProperty(Array.prototype,"clone",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.clone=function(){var e,t=[];for(e in this)this.hasOwnProperty(e)&&(t[e]=this[e]instanceof Array?this[e].clone():this[e]);return t},Object.defineProperty(Array.prototype,"pull",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.pull=function(e){var t=this.indexOf(e);return t>-1?(this.splice(t,1),t):-1},Object.defineProperty(Array.prototype,"each",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.each=function(e){var t,i=this.length;for(t=0;i>t;t++)e(this[t])},Object.defineProperty(Array.prototype,"eachReverse",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachReverse=function(e){var t,i=this.length;for(t=i-1;t>=0;t--)e(this[t])},Object.defineProperty(Array.prototype,"eachIsolated",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachIsolated=function(e){var t,i=[],r=i.length;for(t=0;r>t;t++)i[t]=this[t];for(t=0;r>t;t++)e(i[t])},Object.defineProperty(Math,"PI180",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180=Math.PI/180,Object.defineProperty(Math,"PI180R",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180R=180/Math.PI,Object.defineProperty(Math,"radians",{enumerable:!1,writable:!0,configurable:!0}),Math.radians=function(e){return e*Math.PI180},Object.defineProperty(Math,"degrees",{enumerable:!1,writable:!0,configurable:!0}),Math.degrees=function(e){return e*Math.PI180R},Object.defineProperty(Math,"distance",{enumerable:!1,writable:!0,configurable:!0}),Math.distance=function(e,t,i,r){return Math.sqrt((e-i)*(e-i)+(t-r)*(t-r))};var disableContextMenu=function(e){e!==null&&(e.oncontextmenu=function(){return!1})};Array.prototype.indexOf||(Object.defineProperty(Array.prototype,"indexOf",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.indexOf=function(e){var t,i=this.length;for(t=0;i>t;t++)if(this[t]===e)return t;return-1}),requestAnimFrame=typeof window!="undefined"?function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(function(){e((new Date).getTime())},1e3/60)}}():function(){return function(e){setTimeout(function(){e((new Date).getTime())},1e3/60)}}(),typeof console=="object"?typeof console.log=="function"&&(console.info===void 0&&(console.info=console.log),console.warn===void 0&&(console.warn=console.log)):console={log:function(){},warn:function(){},info:function(){},error:function(){}},typeof JSON.decycle!="function"&&(JSON.decycle=function decycle(e){"use strict";var t=[],i=[];return function r(e,n){var o,a,s;switch(typeof e){case"object":if(!e)return null;for(o=0;t.length>o;o+=1)if(t[o]===e)return{$ref:i[o]};if(t.push(e),i.push(n),Object.prototype.toString.apply(e)==="[object Array]")for(s=[],o=0;e.length>o;o+=1)s[o]=r(e[o],n+"["+o+"]");else{s={};for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&(s[a]=r(e[a],n+"["+JSON.stringify(a)+"]"))}return s;case"number":case"string":case"boolean":return e}}(e,"$")}),typeof JSON.retrocycle!="function"&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return function rez(value){var i,item,name,path;if(value&&typeof value=="object")if(Object.prototype.toString.apply(value)==="[object Array]")for(i=0;value.length>i;i+=1)item=value[i],item&&typeof item=="object"&&(path=item.$ref,typeof path=="string"&&px.test(path)?value[i]=eval(path):rez(item));else for(name in value)typeof value[name]=="object"&&(item=value[name],item&&(path=item.$ref,typeof path=="string"&&px.test(path)?value[name]=eval(path):rez(item)))}($),$});var $i_2=function(){var e=!1,t=/xyz/.test(function(){})?/\b_super\b/:/.*/,i=function(){},r=function(e,t,i){var r,n="";if(t=t||"log",i!==void 0&&console.warn(i),(t==="warning"||t==="error")&&igeDebug.stacks&&(igeDebug.node?(r=Error().stack,console.log("Stack:",r)):typeof printStackTrace=="function"&&console.log("Stack:",printStackTrace().join("\n ---- "))),t==="error"){if(igeDebug.throwErrors)throw n+"IGE *"+t+"* ["+(this._classId||this.prototype._classId)+"] : "+e;console.log(n+"IGE *"+t+"* ["+(this._classId||this.prototype._classId)+"] : "+e)}else console.log(n+"IGE *"+t+"* ["+(this._classId||this.prototype._classId)+"] : "+e);return this},n=function(){return this._classId},o=function(e,t){var i=new e(this,t);return this[i.componentId]=i,this._components.push(i),this},a=function(e){return this[e]&&this[e].destroy&&this[e].destroy(),this._components&&this._components.pull(this[e]),delete this[e],this},s=function(e,t){var i,r=e.prototype||e;for(i in r)r.hasOwnProperty(i)&&(t||this[i]===void 0)&&(this[i]=r[i]);return this},h=function(e,t){return e!==void 0?t!==void 0?(this._data[e]=t,this):this._data[e]:void 0};return i.extend=function(){function i(){this._data={},!e&&this.init&&(this._components=[],typeof ige!="undefined"&&(this.ige=ige),this.init.apply(this,arguments))}var l,c,u,d,f,p,m,E=this.prototype,g=arguments[arguments.length-1],v=arguments[0];if(!g.classId)throw console.log(g),"Cannot create a new class without giving the class a classId property!";if(igeClassStore[g.classId])throw'Cannot create class with classId "'+g.classId+'" because a class with that ID has already been created!';e=!0,c=new this,e=!1;for(l in g)typeof g[l]=="function"&&typeof E[l]=="function"&&t.test(g[l])?(c["__"+l]=g[l],c[l]=function(e,t){return function(){var i,r=this._super;return this._super=E[e],i=t["__"+e].apply(this,arguments),this._super=r,i}}(l,c)):c[l]=g[l];if(arguments.length>1&&v&&v.length)for(f=0;v.length>f;f++){u=v[f],m=u.extension.prototype||u.extension,d=u.overwrite;for(p in m)m.hasOwnProperty(p)&&(d||c[p]===void 0)&&(c[p]=m[p])}return i.prototype=c,i.prototype.constructor=i,i.extend=arguments.callee,i.prototype.log=r,i.prototype.data=h,i.prototype.classId=n,i.prototype._classId=g.classId||"$i_2",i.prototype.addComponent=o,i.prototype.removeComponent=a,i.prototype.implement=s,igeClassStore[g.classId]=i,i},i.prototype._classId="$i_2",i}();typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_2);var $i_3=$i_2.extend({classId:"$i_3",on:function(e,t,i,r,n){var o,a,s,h,l,c,u,d,f,p=this;if(this._eventListeners=this._eventListeners||{},typeof t=="function"){if(typeof e=="string")return o={call:t,context:i,oneShot:r,sendEventName:n},h=this._eventListeners[e]=this._eventListeners[e]||[],a=!0,s=h.indexOf(o),s>-1&&(a=!1),a&&h.push(o),o;if(e.length){l=[],l[0]=0,l[1]=0,l[3]=function(){l[1]++,l[0]===l[1]&&t.apply(i||p)};for(c in e)e.hasOwnProperty(c)&&(u=e[c],d=u[0],f=u[1],l[0]++,d.on(f,l[3],null,!0,!0))}}else typeof e!="string"&&(e="*Multi-Event*"),this.log('Cannot register event listener for event "'+e+'" because the passed callback is not a function!',"error")},emit:function(e,t){if(this._eventListeners&&this._eventListeners[e]){var i,r,n,o,a,s,h=this._eventListeners[e].length,l=this._eventListeners[e].length-1;if(h){if(i=[],typeof t=="object"&&t!==null&&t[0]!==null&&t[0]!==void 0)for(r in t)t.hasOwnProperty(r)&&(i[r]=t[r]);else i=[t];n=!1,this._eventListeners._processing=!0;while(h--)o=l-h,a=this._eventListeners[e][o],a.sendEventName&&(i=[e]),s=a.call.apply(a.context||this,i),s===!0&&(n=!0),a.oneShot&&(this.off(e,a),l--);if(this._eventListeners._processing=!1,this._processRemovals(),n)return 1}}},_processRemovals:function(){if(this._eventListeners){var e,t,i,r=this._eventListeners._removeQueue;if(r){e=r.length;while(e--)t=r[e],i=this.off(t[0],t[1]),r[2]&&r[2](i)}delete this._eventListeners._removeQueue}},off:function(e,t,i){if(this._eventListeners){if(this._eventListeners._processing)return this._eventListeners._removeQueue=this._eventListeners._removeQueue||[],this._eventListeners._removeQueue.push([e,t,i]),-1;if(this._eventListeners[e]){var r=this._eventListeners[e].indexOf(t);if(r>-1)return this._eventListeners[e].splice(r,1),i&&i(!0),!0;this.log('Failed to cancel event listener for event named "'+e+'" !',"warning",t)}else this.log("Failed to cancel event listener!")}return i&&i(!1),!1},eventList:function(){return this._eventListeners}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_3);var $i_5=function(e,t,i,r){return r===void 0?this._floor=!0:this.floor(r),this.x=e=e!==void 0?e:0,this.y=t=t!==void 0?t:0,this.z=i=i!==void 0?i:0,this._floor?(this.x2=Math.floor(e/2),this.y2=Math.floor(t/2),this.z2=Math.floor(i/2)):(this.x2=e/2,this.y2=t/2,this.z2=i/2),this};$i_5.prototype.floor=function(e){return e!==void 0?(this._floor=e,this):this._floor},$i_5.prototype.compare=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},$i_5.prototype.toIso=function(){var e=this.x-this.y,t=-this.z*1.2247+(this.x+this.y)*.5;return{x:e,y:t}},$i_5.prototype.thisToIso=function(){var e=this.toIso();return this.x=e.x,this.y=e.y,this.z=0,this},$i_5.prototype.to2d=function(){var e=this.y+this.x/2,t=this.y-this.x/2;return{x:e,y:t}},$i_5.prototype.thisTo2d=function(){var e=this.to2d();return this.x=e.x,this.y=e.y,this.z=0,this},$i_5.prototype.addPoint=function(e){return new $i_5(this.x+e.x,this.y+e.y,this.z+e.z)},$i_5.prototype.thisAddPoint=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},$i_5.prototype.minusPoint=function(e){return new $i_5(this.x-e.x,this.y-e.y,this.z-e.z)},$i_5.prototype.thisMinusPoint=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},$i_5.prototype.multiply=function(e,t,i){return new $i_5(this.x*e,this.y*t,this.z*i)},$i_5.prototype.thisMultiply=function(e,t,i){return this.x*=e,this.y*=t,this.z*=i,this},$i_5.prototype.divide=function(e,t,i){return new $i_5(this.x/e,this.y/t,this.z/i)},$i_5.prototype.thisDivide=function(e,t,i){return this.x/=e,this.y/=t,this.z/=i,this},$i_5.prototype.clone=function(){return new $i_5(this.x,this.y,this.z)},$i_5.prototype.interpolate=function(e,t,i,r){var n=e.x-this.x,o=e.y-this.y,a=e.z-this.z,s=r-t,h=s-(i-t),l=h/s;return new $i_5(e.x-n*l,e.y-o*l,e.z-a*l)},$i_5.prototype.toString=function(e){return e===void 0&&(e=2),this.x.toFixed(e)+","+this.y.toFixed(e)+","+this.z.toFixed(e)},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_5);var $i_6=$i_2.extend({classId:"$i_6",init:function(){this._poly=[],this._scale=new $i_5(1,1,1)},scale:function(e,t){return e!==void 0&&t!==void 0?(this._scale.x=e,this._scale.y=t,this):this._scale},addPoint:function(e,t){return this._poly.push(new $i_5(e,t,0)),this},length:function(){return this._poly.length},pointInPoly:function(e){var t,i=this._poly,r=i.length,n=r-1,o=0;for(t=0;r>t;n=t++)i[t].y>e.y!=i[n].y>e.y&&(i[n].x-i[t].x)*(e.y-i[t].y)/(i[n].y-i[t].y)+i[t].x>e.x&&(o=!o);return o},clone:function(){var e,t=new $i_6,i=this._poly,r=i.length;for(e=0;r>e;e++)t.addPoint(i[e].x,i[e].y);return t.scale(this._scale.x,this._scale.y),t},render:function(e){var t=this._poly,r=t.length,n=this._scale.x,o=this._scale.y;for(e.beginPath(),e.moveTo(t[0].x*n,t[0].y*o),i=1;r>i;i++)e.lineTo(t[i].x*n,t[i].y*o);return e.lineTo(t[0].x*n,t[0].y*o),e.stroke(),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_6);var $i_7=function(e,t,i,r){return this.x=e=e!==void 0?e:0,this.y=t=t!==void 0?t:0,this.width=i=i!==void 0?i:0,this.height=r=r!==void 0?r:0,this};$i_7.prototype.compare=function(e){return e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},$i_7.prototype.xyInside=function(e,t){return e>=this.x&&t>this.y&&this.x+this.width>=e&&this.y+this.height>=t},$i_7.prototype.pointInside=function(e){return x>=this.x&&e.y>this.y&&this.x+this.width>=e.x&&this.y+this.height>=e.y},$i_7.prototype.rectIntersect=function(e){if(e){var t=this.x,i=this.y,r=this.width,n=this.height,o=e.x,a=e.y,s=e.width,h=e.height,l=t+r,c=i+n,u=o+s,d=a+h;if(u>t&&l>o&&d>i&&c>a)return!0}return!1},$i_7.prototype.toString=function(e){return e===void 0&&(e=2),this.x.toFixed(e)+","+this.y.toFixed(e)+","+this.width.toFixed(e)+","+this.height.toFixed(e)},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_7);var $i_8=function(){this.matrix=[1,0,0,0,1,0,0,0,1],this._rotateOrigin=new $i_5(0,0,0),this._scaleOrigin=new $i_5(0,0,0)};$i_8.prototype={matrix:null,transformCoord:function(e){var t=e.x,i=e.y,r=this.matrix;return e.x=t*r[0]+i*r[1]+r[2],e.y=t*r[3]+i*r[4]+r[5],e},transformCoordInverse:function(e){var t=e.x,i=e.y,r=this.matrix;return e.x=t*r[0]-i*r[1]+r[2],e.y=t*r[3]+i*r[4]-r[5],e},transform:function(e){var t,i=e.length;for(t=0;i>t;t++)this.transformCoord(e[t]);return e},_newRotate:function(e){var t=new $i_8;return t.rotateTo(e),t},rotateBy:function(e){var t=new $i_8;return t.translateBy(this._rotateOrigin.x,this._rotateOrigin.y),t.rotateTo(e),t.translateBy(-this._rotateOrigin.x,-this._rotateOrigin.y),this.multiply(t),this},rotateTo:function(e){var t=this.matrix,i=Math.cos(e),r=Math.sin(e);return t[0]=i,t[1]=-r,t[3]=r,t[4]=i,this},_newScale:function(e,t){var i=new $i_8;return i.matrix[0]=e,i.matrix[4]=t,i},scaleBy:function(e,t){var i=new $i_8;return i.matrix[0]=e,i.matrix[4]=t,this.multiply(i),this},scaleTo:function(e,t){return this.matrix[0]=e,this.matrix[4]=t,this},_newTranslate:function(e,t){var i=new $i_8;return i.matrix[2]=e,i.matrix[5]=t,i},translateBy:function(e,t){var i=new $i_8;return i.matrix[2]=e,i.matrix[5]=t,this.multiply(i),this},translateTo:function(e,t){return this.matrix[2]=e,this.matrix[5]=t,this},copy:function(e){e=e.matrix;var t=this.matrix;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},identity:function(){var e=this.matrix;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this},multiply:function(e){var t=this.matrix,i=e.matrix,r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],h=t[5],l=t[6],c=t[7],u=t[8],d=i[0],f=i[1],p=i[2],m=i[3],E=i[4],g=i[5],v=i[6],y=i[7],_=i[8];return t[0]=r*d+n*m+o*v,t[1]=r*f+n*E+o*y,t[2]=r*p+n*g+o*_,t[3]=a*d+s*m+h*v,t[4]=a*f+s*E+h*y,t[5]=a*p+s*g+h*_,t[6]=l*d+c*m+u*v,t[7]=l*f+c*E+u*y,t[8]=l*p+c*g+u*_,this},premultiply:function(e){var t=e.matrix[0]*this.matrix[0]+e.matrix[1]*this.matrix[3]+e.matrix[2]*this.matrix[6],i=e.matrix[0]*this.matrix[1]+e.matrix[1]*this.matrix[4]+e.matrix[2]*this.matrix[7],r=e.matrix[0]*this.matrix[2]+e.matrix[1]*this.matrix[5]+e.matrix[2]*this.matrix[8],n=e.matrix[3]*this.matrix[0]+e.matrix[4]*this.matrix[3]+e.matrix[5]*this.matrix[6],o=e.matrix[3]*this.matrix[1]+e.matrix[4]*this.matrix[4]+e.matrix[5]*this.matrix[7],a=e.matrix[3]*this.matrix[2]+e.matrix[4]*this.matrix[5]+e.matrix[5]*this.matrix[8],s=e.matrix[6]*this.matrix[0]+e.matrix[7]*this.matrix[3]+e.matrix[8]*this.matrix[6],h=e.matrix[6]*this.matrix[1]+e.matrix[7]*this.matrix[4]+e.matrix[8]*this.matrix[7],l=e.matrix[6]*this.matrix[2]+e.matrix[7]*this.matrix[5]+e.matrix[8]*this.matrix[8];return this.matrix[0]=t,this.matrix[1]=i,this.matrix[2]=r,this.matrix[3]=n,this.matrix[4]=o,this.matrix[5]=a,this.matrix[6]=s,this.matrix[7]=h,this.matrix[8]=l,this},getInverse:function(){var e=this.matrix,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],h=e[7],l=e[8],c=new $i_8,u=t*(o*l-h*a)-n*(i*l-h*r)+s*(i*a-o*r);if(u===0)return null;var d=c.matrix;return d[0]=o*l-a*h,d[1]=r*h-i*l,d[2]=i*a-r*o,d[3]=a*s-n*l,d[4]=t*l-r*s,d[5]=r*n-t*a,d[6]=n*h-o*s,d[7]=i*s-t*h,d[8]=t*o-i*n,c.multiplyScalar(1/u),c},multiplyScalar:function(e){var t;for(t=0;9>t;t++)this.matrix[t]*=e;return this},transformRenderingContextSet:function(e){var t=this.matrix;return e.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this},transformRenderingContext:function(e){var t=this.matrix;return e.transform(t[0],t[3],t[1],t[4],t[2],t[5]),this}},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_8);var $i_12=$i_2.extend({classId:"$i_12",componentId:"tween",init:function(e){this._entity=e,this._transform=e.transform,this._tweens=[],e.addBehaviour("tween",this._behaviour)},_behaviour:function(e){this.tween.tick(e)},start:function(e){var t,i=e._targetObj,r=e._propertyObj,n=[];if(i){e._startTime===void 0&&(e._startTime=ige._currentTime),e._durationMs===void 0&&(e._durationMs=0),e._endTime=e._startTime+e._durationMs;for(t in r)r.hasOwnProperty(t)&&n.push({targetObj:i,propName:t,startVal:i[t],endVal:r[t],deltaVal:r[t]-i[t]});return e._targetData=n,e._destTime=e._endTime-e._startTime,this._tweens.push(e),this.enable(),e}return this.log('Cannot start tweening properties of the specified object "'+obj+'" because it does not exist!',"error"),-1},stop:function(e){return this._tweens.pull(e),this._tweens.length||this.disable(),this},stopAll:function(){return this.disable(),delete this._tweens,this._tweens=[],this},enable:function(){return this._tweening||(this._tweening=!0),this},disable:function(){return this._tweening&&(this._tweening=!1),this},tick:function(){if(this._tweens&&this._tweens.length){var e,t,i,r,n,o,a,s=ige.tickStart,h=this._tweens,l=h.length;while(l--)if(e=h[l],e._started||s>=e._startTime)if(e._started||(typeof e._beforeTween=="function"&&(e._beforeTween(e),delete e._beforeTween),e._started=!0),t=s-e._startTime,i=e._destTime,r=e._easing,i>t){o=e._targetData;for(a in o)o.hasOwnProperty(a)&&(n=o[a],n.targetObj[n.propName]=this.easing[r](t,n.startVal,n.deltaVal,i))}else{o=e._targetData;for(a in o)o.hasOwnProperty(a)&&(n=o[a],n.targetObj[n.propName]=n.endVal);e.stop(),typeof e._afterTween=="function"&&(e._afterTween(e),delete e._afterTween)}}},easing:{none:function(e,t,i,r){return i*e/r+t},inQuad:function(e,t,i,r){return i*(e/=r)*e+t},outQuad:function(e,t,i,r){return-i*(e/=r)*(e-2)+t},inOutQuad:function(e,t,i,r){return 1>(e/=r/2)?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},inCubic:function(e,t,i,r){return i*(e/=r)*e*e+t},outCubic:function(e,t,i,r){return i*((e=e/r-1)*e*e+1)+t},inOutCubic:function(e,t,i,r){return 1>(e/=r/2)?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t},outInCubic:function(e,t,i,r){return r/2>e?this.outCubic(e*2,t,i/2,r):this.inCubic(e*2-r,t+i/2,i/2,r)},inQuart:function(e,t,i,r){return i*(e/=r)*e*e*e+t},outQuart:function(e,t,i,r){return-i*((e=e/r-1)*e*e*e-1)+t},inOutQuart:function(e,t,i,r){return 1>(e/=r/2)?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t},outInQuart:function(e,t,i,r){return r/2>e?this.outQuart(e*2,t,i/2,r):this.inQuart(e*2-r,t+i/2,i/2,r)},inQuint:function(e,t,i,r){return i*(e/=r)*e*e*e*e+t},outQuint:function(e,t,i,r){return i*((e=e/r-1)*e*e*e*e+1)+t},inOutQuint:function(e,t,i,r){return 1>(e/=r/2)?i/2*e*e*e*e*e+t:i/2*((e-=2)*e*e*e*e+2)+t},outInQuint:function(e,t,i,r){return r/2>e?this.outQuint(e*2,t,i/2,r):this.inQuint(e*2-r,t+i/2,i/2,r)},inSine:function(e,t,i,r){return-i*Math.cos(e/r*(Math.PI/2))+i+t},outSine:function(e,t,i,r){return i*Math.sin(e/r*(Math.PI/2))+t},inOutSine:function(e,t,i,r){return-i/2*(Math.cos(Math.PI*e/r)-1)+t},outInSine:function(e,t,i,r){return r/2>e?this.outSine(e*2,t,i/2,r):this.inSine(e*2-r,t+i/2,i/2,r)},inExpo:function(e,t,i,r){return e===0?t:i*Math.pow(2,10*(e/r-1))+t-i*.001},outExpo:function(e,t,i,r){return e===r?t+i:i*1.001*(-Math.pow(2,-10*e/r)+1)+t},inOutExpo:function(e,t,i,r){return e===0?t:e===r?t+i:1>(e/=r/2)?i/2*Math.pow(2,10*(e-1))+t-i*5e-4:i/2*1.0005*(-Math.pow(2,-10*--e)+2)+t},outInExpo:function(e,t,i,r){return r/2>e?this.outExpo(e*2,t,i/2,r):this.inExpo(e*2-r,t+i/2,i/2,r)},inCirc:function(e,t,i,r){return-i*(Math.sqrt(1-(e/=r)*e)-1)+t},outCirc:function(e,t,i,r){return i*Math.sqrt(1-(e=e/r-1)*e)+t},inOutCirc:function(e,t,i,r){return 1>(e/=r/2)?-i/2*(Math.sqrt(1-e*e)-1)+t:i/2*(Math.sqrt(1-(e-=2)*e)+1)+t},outInCirc:function(e,t,i,r){return r/2>e?this.outCirc(e*2,t,i/2,r):this.inCirc(e*2-r,t+i/2,i/2,r)},inElastic:function(e,t,i,r,n,o){var a;return e===0?t:(e/=r)===1?t+i:(o||(o=r*.3),!n||Math.abs(i)>n?(n=i,a=o/4):a=o/(2*Math.PI)*Math.asin(i/n),-(n*Math.pow(2,10*(e-=1))*Math.sin((e*r-a)*2*Math.PI/o))+t)},outElastic:function(e,t,i,r,n,o){var a;return e===0?t:(e/=r)===1?t+i:(o||(o=r*.3),!n||Math.abs(i)>n?(n=i,a=o/4):a=o/(2*Math.PI)*Math.asin(i/n),n*Math.pow(2,-10*e)*Math.sin((e*r-a)*2*Math.PI/o)+i+t)},inOutElastic:function(e,t,i,r,n,o){var a;return e===0?t:(e/=r/2)===2?t+i:(o||(o=r*.3*1.5),!n||Math.abs(i)>n?(n=i,a=o/4):a=o/(2*Math.PI)*Math.asin(i/n),1>e?-.5*n*Math.pow(2,10*(e-=1))*Math.sin((e*r-a)*2*Math.PI/o)+t:n*Math.pow(2,-10*(e-=1))*Math.sin((e*r-a)*2*Math.PI/o)*.5+i+t)},outInElastic:function(e,t,i,r,n,o){return r/2>e?this.outElastic(e*2,t,i/2,r,n,o):this.inElastic(e*2-r,t+i/2,i/2,r,n,o)},inBack:function(e,t,i,r,n){return n===void 0&&(n=1.70158),i*(e/=r)*e*((n+1)*e-n)+t},outBack:function(e,t,i,r,n){return n===void 0&&(n=1.70158),i*((e=e/r-1)*e*((n+1)*e+n)+1)+t},inOutBack:function(e,t,i,r,n){return n===void 0&&(n=1.70158),1>(e/=r/2)?i/2*e*e*(((n*=1.525)+1)*e-n)+t:i/2*((e-=2)*e*(((n*=1.525)+1)*e+n)+2)+t},outInBack:function(e,t,i,r,n){return r/2>e?this.outBack(e*2,t,i/2,r,n):this.inBack(e*2-r,t+i/2,i/2,r,n)},inBounce:function(e,t,i,r){return i-this.outBounce(r-e,0,i,r)+t},outBounce:function(e,t,i,r){return 1/2.75>(e/=r)?i*7.5625*e*e+t:2/2.75>e?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t},inOutBounce:function(e,t,i,r){return r/2>e?this.inBounce(e*2,0,i,r)*.5+t:this.outBounce(e*2-r,0,i,r)*.5+i*.5+t},outInBounce:function(e,t,i,r){return r/2>e?this.outBounce(e*2,t,i/2,r):this.inBounce(e*2-r,t+i/2,i/2,r)}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_12);var $i_14=$i_3.extend({classId:"$i_14",componentId:"input",init:function(){this._eventQueue=[],this._eventControl={_cancelled:!1,stopPropagation:function(){this._cancelled=!0}},this.tick(),this.mouse={dblClick:-302,down:-301,up:-300,move:-259,wheel:-258,wheelUp:-257,wheelDown:-256,x:-255,y:-254,button1:-253,button2:-252,button3:-251},this.pad1={button1:-250,button2:-249,button3:-248,button4:-247,button5:-246,button6:-245,button7:-244,button8:-243,button9:-242,button10:-241,button11:-240,button12:-239,button13:-238,button14:-237,button15:-236,button16:-235,button17:-234,button18:-233,button19:-232,button20:-231,stick1:-230,stick2:-229,stick1Up:-228,stick1Down:-227,stick1Left:-226,stick1Right:-225,stick2Up:-224,stick2Down:-223,stick2Left:-222,stick2Right:-221},this.pad2={button1:-220,button2:-219,button3:-218,button4:-217,button5:-216,button6:-215,button7:-214,button8:-213,button9:-212,button10:-211,button11:-210,button12:-209,button13:-208,button14:-207,button15:-206,button16:-205,button17:-204,button18:-203,button19:-202,button20:-201,stick1:-200,stick2:-199,stick1Up:-198,stick1Down:-197,stick1Left:-196,stick1Right:-195,stick2Up:-194,stick2Down:-193,stick2Left:-192,stick2Right:-191},this.key={shift:-3,ctrl:-2,alt:-1,backspace:8,tab:9,enter:13,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90},this._controlMap=[],this._state=[],this._state[this.mouse.x]=0,this._state[this.mouse.y]=0},debug:function(e){return e!==void 0?(this._debug=e,this):this._debug},_rationalise:function(e,t){if(e.igeType==="key"&&e.keyCode===8){var i=e.srcElement||e.target;i.tagName.toLowerCase()==="body"&&e.preventDefault()}e.igeType==="touch"&&e.preventDefault(),t?(e.button=0,e.changedTouches&&e.changedTouches.length&&(e.igePageX=e.changedTouches[0].pageX,e.igePageY=e.changedTouches[0].pageY)):(e.igePageX=e.pageX,e.igePageY=e.pageY),e.igeX=e.igePageX-this._canvas.offsetLeft,e.igeY=e.igePageY-this._canvas.offsetTop},setupListeners:function(e){this.log("Setting up input event listeners..."),this._canvas=e;var t=this;this._evRef={mousedown:function(e){e.igeType="mouse",t._rationalise(e),t._mouseDown(e)},mouseup:function(e){e.igeType="mouse",t._rationalise(e),t._mouseUp(e)},mousemove:function(e){e.igeType="mouse",t._rationalise(e),t._mouseMove(e)},mousewheel:function(e){e.igeType="mouse",t._rationalise(e),t._mouseWheel(e)},touchmove:function(e){e.igeType="touch",t._rationalise(e,!0),t._mouseMove(e)},touchstart:function(e){e.igeType="touch",t._rationalise(e,!0),t._mouseDown(e)},touchend:function(e){e.igeType="touch",t._rationalise(e,!0),t._mouseUp(e)},contextmenu:function(e){e.preventDefault()},keydown:function(e){e.igeType="key",t._rationalise(e),t._keyDown(e)},keyup:function(e){e.igeType="key",t._rationalise(e),t._keyUp(e)}},e.addEventListener("mousedown",this._evRef.mousedown,!1),e.addEventListener("mouseup",this._evRef.mouseup,!1),e.addEventListener("mousemove",this._evRef.mousemove,!1),e.addEventListener("mousewheel",this._evRef.mousewheel,!1),e.addEventListener("touchmove",this._evRef.touchmove,!1),e.addEventListener("touchstart",this._evRef.touchstart,!1),e.addEventListener("touchend",this._evRef.touchend,!1),e.addEventListener("contextmenu",this._evRef.contextmenu,!1),window.addEventListener("keydown",this._evRef.keydown,!1),window.addEventListener("keyup",this._evRef.keyup,!1)},destroyListeners:function(){this.log("Removing input event listeners...");var e=this._canvas;e.removeEventListener("mousedown",this._evRef.mousedown,!1),e.removeEventListener("mouseup",this._evRef.mouseup,!1),e.removeEventListener("mousemove",this._evRef.mousemove,!1),e.removeEventListener("mousewheel",this._evRef.mousewheel,!1),e.removeEventListener("touchmove",this._evRef.touchmove,!1),e.removeEventListener("touchstart",this._evRef.touchstart,!1),e.removeEventListener("touchend",this._evRef.touchend,!1),e.removeEventListener("contextmenu",this._evRef.contextmenu,!1),window.removeEventListener("keydown",this._evRef.keydown,!1),window.removeEventListener("keyup",this._evRef.keyup,!1)},_mouseDown:function(e){this._debug&&console.log("Mouse Down",e),this._updateMouseData(e);var t=e.igeX-ige._geometry.x2,i=e.igeY-ige._geometry.y2,r=this;e.igeBaseX=t,e.igeBaseY=i,e.button===0&&(this._state[this.mouse.button1]=!0),e.button===1&&(this._state[this.mouse.button2]=!0),e.button===2&&(this._state[this.mouse.button3]=!0),this.mouseDown=e,this.queueEvent(this,function(){r.emit("mouseDown",[e,t,i,e.button+1])})},_mouseUp:function(e){this._debug&&console.log("Mouse Up",e),this._updateMouseData(e);var t=e.igeX-ige._geometry.x2,i=e.igeY-ige._geometry.y2,r=this;e.igeBaseX=t,e.igeBaseY=i,e.button===0&&(this._state[this.mouse.button1]=!1),e.button===1&&(this._state[this.mouse.button2]=!1),e.button===2&&(this._state[this.mouse.button3]=!1),this.mouseUp=e,this.queueEvent(this,function(){r.emit("mouseUp",[e,t,i,e.button+1])})},_mouseMove:function(e){ige._mouseOverVp=this._updateMouseData(e);var t=e.igeX-ige._geometry.x2,i=e.igeY-ige._geometry.y2,r=this;e.igeBaseX=t,e.igeBaseY=i,this._state[this.mouse.x]=t,this._state[this.mouse.y]=i,this.mouseMove=e,this.queueEvent(this,function(){r.emit("mouseMove",[e,t,i,e.button+1])})},_mouseWheel:function(e){this._updateMouseData(e);var t=e.igeX-ige._geometry.x2,i=e.igeY-ige._geometry.y2,r=this;e.igeBaseX=t,e.igeBaseY=i,this._state[this.mouse.wheel]=e.wheelDelta,e.wheelDelta>0?this._state[this.mouse.wheelUp]=!0:this._state[this.mouse.wheelDown]=!0,this.mouseWheel=e,this.queueEvent(this,function(){r.emit("mouseWheel",[e,t,i,e.button+1])
})},_keyDown:function(e){var t=this;this._state[e.keyCode]=!0,this.queueEvent(this,function(){t.emit("keyDown",[e,e.keyCode])})},_keyUp:function(e){var t=this;this._state[e.keyCode]=!1,this.queueEvent(this,function(){t.emit("keyUp",[e,e.keyCode])})},_updateMouseData:function(e){var t,i,r=ige._children,n=r.length,o=e.igeX-ige._geometry.x/2,a=e.igeY-ige._geometry.y/2;ige._mousePos.x=o,ige._mousePos.y=a;while(n--)if(t=r[r.length-(n+1)],o>t._translate.x-t._geometry.x/2&&t._translate.x+t._geometry.x/2>o&&a>t._translate.y-t._geometry.y/2&&t._translate.y+t._geometry.y/2>a){t._mousePos=new $i_5(Math.floor((o-t._translate.x)/t.camera._scale.x+t.camera._translate.x),Math.floor((a-t._translate.y)/t.camera._scale.y+t.camera._translate.y),0),i=t,e.igeViewport=t;break}return i},mapAction:function(e,t){this._controlMap[e]=t},actionVal:function(e){return this._state[this._controlMap[e]]},actionState:function(e){var t=this._state[this._controlMap[e]];return!!t},val:function(e){return this._state[e]},state:function(e){return!!this._state[e]},stopPropagation:function(){return this._eventControl._cancelled=!0,this},queueEvent:function(e,t,i){return t!==void 0&&this._eventQueue.push([e,t,i]),this},tick:function(){var e=this._eventQueue,t=e.length,i=this._eventControl;while(t--)if(e[t][1].apply(e[t][0],[i,e[t][2]]),i._cancelled)break;this._eventQueue=[],this._eventControl._cancelled=!1,this.dblClick=!1,this.mouseMove=!1,this.mouseDown=!1,this.mouseUp=!1,this.mouseWheel=!1},emit:function(e,t){if(this._eventListeners&&this._eventListeners[e]){var i,r,n,o,a,s,h=this._eventListeners[e].length,l=this._eventListeners[e].length-1,c=this._eventControl;if(h){if(i=[],typeof t=="object"&&t!==null&&t[0]!==null)for(r in t)t.hasOwnProperty(r)&&(i[r]=t[r]);else i=[t];n=!1,this._eventListeners._processing=!0;while(h--){if(c._cancelled)break;o=l-h,a=this._eventListeners[e][o],a.sendEventName&&(i=[e]),s=a.call.apply(a.context||this,i),(s===!0||this._eventControl._cancelled===!0)&&(n=!0),a.oneShot&&this.off(e,a)}if(this._eventListeners._processing=!1,this._processRemovals(),n)return 1}}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_14);var $i_39=$i_3.extend({classId:"$i_39",componentId:"cocoonJs",init:function(){this.detected=typeof ext!="undefined"&&ext.IDTK_APP!==void 0,this.detected&&this.log("CocoonJS support enabled!")},showInputDialog:function(e,t,i,r,n,o){this.detected?(e=e||"",t=t||"",i=i||"",r=r||"text",n=n||"Cancel",o=o||"OK",ext.IDTK_APP.makeCall("showTextDialog",e,t,i,r,n,o)):this.log("Cannot open CocoonJS input dialog! CocoonJS is not detected!","error")},showWebView:function(e){this.detected&&(ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('loadPath', '"+e+"')"),ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('show');"))},hideWebView:function(){this.detected&&ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('hide');")}}),$i_40={translateBy:function(e,t,i){return e!==void 0&&t!==void 0&&i!==void 0?(this._translate.x+=e,this._translate.y+=t,this._translate.z+=i):this.log("translateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translateTo:function(e,t,i){return e!==void 0&&t!==void 0&&i!==void 0?(this._translate.x=e,this._translate.y=t,this._translate.z=i):this.log("translateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translate:function(){return arguments.length&&this.log("You called translate with arguments, did you mean translateTo or translateBy instead of translate?","warning"),this.x=this._translateAccessorX,this.y=this._translateAccessorY,this.z=this._translateAccessorZ,this._entity||this},_translateAccessorTween:function(e,t,i){return new $i_47(this._translate,e,t,i)},_translateAccessorX:function(e){return e!==void 0?(this._translate.x=e,this._entity||this):this._translate.x},_translateAccessorY:function(e){return e!==void 0?(this._translate.y=e,this._entity||this):this._translate.y},_translateAccessorZ:function(e){return e!==void 0?(this._translate.z=e,this._entity||this):this._translate.z},rotateBy:function(e,t,i){return e!==void 0&&t!==void 0&&i!==void 0?(this._rotate.x+=e,this._rotate.y+=t,this._rotate.z+=i):this.log("rotateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotateTo:function(e,t,i){return e!==void 0&&t!==void 0&&i!==void 0?(this._rotate.x=e,this._rotate.y=t,this._rotate.z=i):this.log("rotateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotate:function(){return arguments.length&&this.log("You called rotate with arguments, did you mean rotateTo or rotateBy instead of rotate?","warning"),this.x=this._rotateAccessorX,this.y=this._rotateAccessorY,this.z=this._rotateAccessorZ,this._entity||this},_rotateAccessorTween:function(e,t,i){return new $i_47(this._rotate,e,t,i)},_rotateAccessorX:function(e){return e!==void 0?(this._rotate.x=e,this._entity||this):this._rotate.x},_rotateAccessorY:function(e){return e!==void 0?(this._rotate.y=e,this._entity||this):this._rotate.y},_rotateAccessorZ:function(e){return e!==void 0?(this._rotate.z=e,this._entity||this):this._rotate.z},scaleBy:function(e,t,i){return e!==void 0&&t!==void 0&&i!==void 0?(this._scale.x+=e,this._scale.y+=t,this._scale.z+=i):this.log("scaleBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scaleTo:function(e,t,i){return e!==void 0&&t!==void 0&&i!==void 0?(this._scale.x=e,this._scale.y=t,this._scale.z=i):this.log("scaleTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scale:function(){return arguments.length&&this.log("You called scale with arguments, did you mean scaleTo or scaleBy instead of scale?","warning"),this.x=this._scaleAccessorX,this.y=this._scaleAccessorY,this.z=this._scaleAccessorZ,this._entity||this},_scaleAccessorTween:function(e,t,i){return new $i_47(this._scale,e,t,i)},_scaleAccessorX:function(e){return e!==void 0?(this._scale.x=e,this._entity||this):this._scale.x},_scaleAccessorY:function(e){return e!==void 0?(this._scale.y=e,this._entity||this):this._scale.y},_scaleAccessorZ:function(e){return e!==void 0?(this._scale.z=e,this._entity||this):this._scale.z},originBy:function(e,t,i){return e!==void 0&&t!==void 0&&i!==void 0?(this._origin.x+=e,this._origin.y+=t,this._origin.z+=i):this.log("originBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},originTo:function(e,t,i){return e!==void 0&&t!==void 0&&i!==void 0?(this._origin.x=e,this._origin.y=t,this._origin.z=i):this.log("originTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},origin:function(){return this.x=this._originAccessorX,this.y=this._originAccessorY,this.z=this._originAccessorZ,this._entity||this},_originAccessorTween:function(e,t,i){return new $i_47(this._origin,e,t,i)},_originAccessorX:function(e){return e!==void 0?(this._origin.x=e,this._entity||this):this._origin.x},_originAccessorY:function(e){return e!==void 0?(this._origin.y=e,this._entity||this):this._origin.y},_originAccessorZ:function(e){return e!==void 0?(this._origin.z=e,this._entity||this):this._origin.z},_rotatePoint:function(e,t,i){var r=Math.cos(t),n=Math.sin(t);return{x:i.x+(e.x-i.x)*r+(e.y-i.y)*n,y:i.y-(e.x-i.x)*n+(e.y-i.y)*r}},updateTransform:function(){if(this._localMatrix.identity(),this._mode===0&&this._localMatrix.multiply(this._localMatrix._newTranslate(this._translate.x,this._translate.y)),this._mode===1){var e=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this._geometry.z/2).toIso();this._parent&&this._parent._geometry.z&&(e.y+=this._parent._geometry.z/1.6),this._localMatrix.multiply(this._localMatrix._newTranslate(e.x,e.y))}this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z)),this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y)),this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_40);var $i_41={left:function(e){return e!==void 0?(this._uiX=e,this._uiXAlign="left",this._updateUiPosition(),this):this._uiX},center:function(e){return e!==void 0?(this._uiX=e,this._uiXAlign="center",this._updateUiPosition(),this):this._uiX},right:function(e){return e!==void 0?(this._uiX=e,this._uiXAlign="right",this._updateUiPosition(),this):this._uiX},top:function(e){return e!==void 0?(this._uiY=e,this._uiYAlign="top",this._updateUiPosition(),this):this._uiY},middle:function(e){return e!==void 0?(this._uiY=e,this._uiYAlign="middle",this._updateUiPosition(),this):this._uiY},bottom:function(e){return e!==void 0?(this._uiY=e,this._uiYAlign="bottom",this._updateUiPosition(),this):this._uiY},width:function(e,t,i){if(e!==void 0){if(this._width=e,this._widthModifier=t!==void 0?t:0,typeof e=="string")if(this._parent){var r=this._parent._geometry.x,n=parseInt(e,10);this._geometry.x=r/100*n+this._widthModifier|0,this._geometry.x2=Math.floor(this._geometry.x/2)}else{var r=ige._geometry.x,n=parseInt(e,10);this._geometry.x=r/100*n+this._widthModifier|0,this._geometry.x2=Math.floor(this._geometry.x/2)}else this._geometry.x=e,this._geometry.x2=Math.floor(this._geometry.x/2);return i||this._updateUiPosition(),this}return this._width},height:function(e,t,i){if(e!==void 0){if(this._height=e,this._heightModifier=t!==void 0?t:0,typeof e=="string")if(this._parent){var r=this._parent._geometry.y,n=parseInt(e,10);this._geometry.y=r/100*n+this._heightModifier|0,this._geometry.y2=Math.floor(this._geometry.y/2)}else{var r=ige._geometry.y,n=parseInt(e,10);this._geometry.y=r/100*n+this._heightModifier|0,this._geometry.y2=Math.floor(this._geometry.y/2)}else this._geometry.y=e,this._geometry.y2=Math.floor(this._geometry.y/2);return i||this._updateUiPosition(),this}return this._height},_updateUiPosition:function(){if(this._parent){var e=this._parent._geometry,t=this._geometry;this._width&&this.width(this._width,this._widthModifier,!0),this._height&&this.height(this._height,this._heightModifier,!0),this._uiXAlign==="right"?this._translate.x=Math.floor(e.x2-t.x2-this._uiX):this._uiXAlign==="center"?this._translate.x=Math.floor(this._uiX):this._uiXAlign==="left"&&(this._translate.x=Math.floor(this._uiX+t.x2-e.x2)),this._uiYAlign==="bottom"?this._translate.y=Math.floor(e.y2-t.y2-this._uiY):this._uiYAlign==="middle"?this._translate.y=Math.floor(this._uiY):this._uiYAlign==="top"&&(this._translate.y=Math.floor(this._uiY+t.y2-e.y2)),this.dirty(!0)}}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_41);var $i_42={backgroundImage:function(e,t){if(e&&e.image){if(t||(t="no-repeat"),this._patternRepeat=t,this._patternTexture=e,this._backgroundSize?(e.resize(this._backgroundSize.x,this._backgroundSize.y),this._patternWidth=this._backgroundSize.x,this._patternHeight=this._backgroundSize.y):(this._patternWidth=e.image.width,this._patternHeight=e.image.height),this._cell>1){var i=document.createElement("canvas"),r=i.getContext("2d"),n=e._cells[this._cell];i.width=n[2],i.height=n[3],r.drawImage(e.image,n[0],n[1],n[2],n[3],0,0,n[2],n[3]),this._patternFill=ige._ctx.createPattern(i,t)}else this._patternFill=ige._ctx.createPattern(e.image,t);return e.restoreOriginal(),this.dirty(!0),this}return this._patternFill},backgroundSize:function(e,t){return e!==void 0&&t!==void 0?(typeof e=="string"&&(e=this._geometry.x/100*parseInt(e,10)),typeof t=="string"&&(t=this._geometry.y/100*parseInt(t,10)),this._backgroundSize={x:e,y:t},this._patternTexture&&this._patternRepeat&&this.backgroundImage(this._patternTexture,this._patternRepeat),this.dirty(!0),this):this._backgroundSize},backgroundColor:function(e){return e!==void 0?(this._backgroundColor=e,this.dirty(!0),this):this._backgroundColor},backgroundPosition:function(e,t){return e!==void 0&&t!==void 0?(this._backgroundPosition={x:e,y:t},this.dirty(!0),this):this._backgroundPosition},borderColor:function(e){return e!==void 0?(this._borderColor=e,this._borderLeftColor=e,this._borderTopColor=e,this._borderRightColor=e,this._borderBottomColor=e,this.dirty(!0),this):this._borderColor},borderLeftColor:function(e){return e!==void 0?(this._borderLeftColor=e,this.dirty(!0),this):this._borderLeftColor},borderTopColor:function(e){return e!==void 0?(this._borderTopColor=e,this.dirty(!0),this):this._borderTopColor},borderRightColor:function(e){return e!==void 0?(this._borderRightColor=e,this.dirty(!0),this):this._borderRightColor},borderBottomColor:function(e){return e!==void 0?(this._borderBottomColor=e,this.dirty(!0),this):this._borderBottomColor},borderWidth:function(e){return e!==void 0?(this._borderWidth=e,this._borderLeftWidth=e,this._borderTopWidth=e,this._borderRightWidth=e,this._borderBottomWidth=e,this.dirty(!0),this):this._borderWidth},borderLeftWidth:function(e){return e!==void 0?(this._borderLeftWidth=e,this.dirty(!0),this):this._borderLeftWidth},borderTopWidth:function(e){return e!==void 0?(this._borderTopWidth=e,this.dirty(!0),this):this._borderTopWidth},borderRightWidth:function(e){return e!==void 0?(this._borderRightWidth=e,this.dirty(!0),this):this._borderRightWidth},borderBottomWidth:function(e){return e!==void 0?(this._borderBottomWidth=e,this.dirty(!0),this):this._borderBottomWidth},borderRadius:function(e){return e!==void 0?(this._borderRadius=e,this._borderTopLeftRadius=e,this._borderTopRightRadius=e,this._borderBottomRightRadius=e,this._borderBottomLeftRadius=e,this.dirty(!0),this):this._borderRadius},padding:function(e,t,i,r){return this._paddingLeft=e,this._paddingTop=t,this._paddingRight=i,this._paddingBottom=r,this.dirty(!0),this},paddingLeft:function(e){return e!==void 0?(this._paddingLeft=e,this.dirty(!0),this):this._paddingLeft},paddingTop:function(e){return e!==void 0?(this._paddingTop=e,this.dirty(!0),this):this._paddingTop},paddingRight:function(e){return e!==void 0?(this._paddingRight=e,this.dirty(!0),this):this._paddingRight},paddingBottom:function(e){return e!==void 0?(this._paddingBottom=e,this.dirty(!0),this):this._paddingBottom}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_42);var $i_43={mouseMove:function(e){return e?(this._mouseMove=e,this._mouseEventsActive=!0,this):this._mouseMove},mouseMoveOff:function(){return delete this._mouseMove,this},mouseOver:function(e){return e?(this._mouseOver=e,this._mouseEventsActive=!0,this):this._mouseOver},mouseOverOff:function(){return delete this._mouseOver,this},mouseOut:function(e){return e?(this._mouseOut=e,this._mouseEventsActive=!0,this):this._mouseOut},mouseOutOff:function(){return delete this._mouseOut,this},mouseUp:function(e){return e?(this._mouseUp=e,this._mouseEventsActive=!0,this):this._mouseUp},mouseUpOff:function(){return delete this._mouseUp,this},mouseDown:function(e){return e?(this._mouseDown=e,this._mouseEventsActive=!0,this):this._mouseDown},mouseDownOff:function(){return delete this._mouseDown,this},_handleMouseIn:function(e,t,i){this._mouseStateOver||(this._mouseStateOver=!0,this._mouseOver&&this._mouseOver(e,t,i)),this._mouseMove&&this._mouseMove(e,t,i)},_handleMouseOut:function(e,t,i){this._mouseStateDown=!1,this._mouseStateOver&&(this._mouseStateOver=!1,this._mouseOut&&this._mouseOut(e,t,i))},_handleMouseUp:function(e,t,i){this._mouseStateDown=!1,this._mouseUp&&this._mouseUp(e,t,i)},_handleMouseDown:function(e,t,i){this._mouseStateDown||(this._mouseStateDown=!0,this._mouseDown&&this._mouseDown(e,t,i))}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_43);var nullMethod=function(){},$i_44={dummy:!0,save:nullMethod,restore:nullMethod,translate:nullMethod,rotate:nullMethod,scale:nullMethod,drawImage:nullMethod,fillRect:nullMethod,strokeRect:nullMethod,stroke:nullMethod,fill:nullMethod,rect:nullMethod,moveTo:nullMethod,lineTo:nullMethod,arc:nullMethod,clearRect:nullMethod,beginPath:nullMethod,clip:nullMethod,transform:nullMethod,setTransform:nullMethod,fillText:nullMethod};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_44);var $i_47=$i_2.extend({classId:"$i_47",init:function(e,t,i,r){this._targetObj=e,this._propertyObj=t!==void 0?t:{},this._durationMs=i!==void 0?i:0,this._started=!1,r&&r.easing?this.easing(r.easing):this.easing("none"),r&&r.startTime!==void 0&&this.startTime(r.startTime),r&&r.beforeTween!==void 0&&this.beforeTween(r.beforeTween),r&&r.afterTween!==void 0&&this.afterTween(r.afterTween)},targetObj:function(e){return e!==void 0&&(this._targetObj=e),this},properties:function(e){return e!==void 0&&(this._propertyObj=e),this},duration:function(e){return e!==void 0&&(this._durationMs=e),this},beforeTween:function(e){return e!==void 0&&(this._beforeTween=e),this},afterTween:function(e){return e!==void 0&&(this._afterTween=e),this},easing:function(e){return e!==void 0&&(this._easing=e),this},startTime:function(e){return e!==void 0&&(this._startTime=e),this},start:function(){return ige.tween.start(this),this._targetObj._tweenArr=this._targetObj._tweenArr||[],this._targetObj._tweenArr.push(this),this},stop:function(){return ige.tween.stop(this),this._targetObj._tweenArr.pull(this),this},startAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(e){e.start()}),this},stopAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(e){e.stop()}),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_47);var $i_48=$i_3.extend({classId:"$i_48",$i_48:!0,init:function(e){this._cells=[],this._smoothing=ige._globalSmoothing,e&&this.url(e)},id:function(e){if(e!==void 0){if(!ige._register[e])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=e,ige.register(this),this;this.log('Cannot set ID of object to "'+e+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=ige.newIdHex(),ige.register(this)),this._id},url:function(e){return e!==void 0?(this._url=e,e.substr(e.length-2,2)==="js"?this._loadScript(e):this._loadImage(e),this):this._url},_loadImage:function(e){var t,i=this;ige.isServer||(ige.textureLoadStart(e,this),ige._textureImageStore[e]?(t=this.image=this._originalImage=ige._textureImageStore[e],t._igeTextures.push(this),t._loaded&&(i._mode=0,i.sizeX(t.width),i.sizeY(t.height),t.width%2&&this.log("This texture's width is not divisible by 2 which will cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: "+this._url,"warning"),t.height%2&&this.log("This texture's height is not divisible by 2 which will cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: "+this._url,"warning"),i._cells[1]=[0,0,i._sizeX,i._sizeY],i._loaded=!0,setTimeout(function(){i.emit("loaded"),ige.textureLoadEnd(e,i)},1))):(t=ige._textureImageStore[e]=this.image=this._originalImage=new Image,t._igeTextures=t._igeTextures||[],t._igeTextures.push(this),t.onload=function(){this._loaded=!0,ige.log('Texture image "'+e+'" loaded successfully'),t.width%2&&i.log("The texture "+e+" width ("+t.width+") is not divisible by 2 to a whole number! This can cause rendering artifacts. It can also cause performance issues on some GPUs. Please make sure your texture width is divisible by 2!","warning"),t.height%2&&i.log("The texture "+e+" height ("+t.height+") is not divisible by 2 to a whole number! This can cause rendering artifacts. It can also cause performance issues on some GPUs. Please make sure your texture height is divisible by 2!","warning");var r,n,o=this._igeTextures,a=o.length;for(r=0;a>r;r++)n=o[r],n._mode=0,n.sizeX(t.width),n.sizeY(t.height),n._cells[1]=[0,0,n._sizeX,n._sizeY],n._loaded=!0,n.emit("loaded"),ige.textureLoadEnd(e,i)},t.src=e))},_loadScript:function(scriptUrl){var textures=ige.textures,rs_sandboxContext,self=this,scriptElem;ige.textureLoadStart(scriptUrl,this),ige.isServer||(scriptElem=document.createElement("script"),scriptElem.onload=function(data){self.log('Texture script "'+scriptUrl+'" loaded successfully'),eval(data),self._mode=1,self.script=image,typeof image.init=="function"&&image.init.apply(image,[self]),self._loaded=!0,self.emit("loaded"),ige.textureLoadEnd(scriptUrl,self)},scriptElem.addEventListener("error",function(){self.log("Error loading smart texture script file: "+scriptUrl,"error")},!0),scriptElem.src=scriptUrl,document.getElementsByTagName("head")[0].appendChild(scriptElem)),ige.isServer&&(rs_sandboxContext={},textures.fs.readFile(scriptUrl,this.bind(function(e,t){try{if(textures.vm.runInNewContext(t,rs_sandboxContext),typeof rs_sandboxContext.image=="object"){this.log('Texture script "'+scriptUrl+'" loaded successfully');var i=rs_sandboxContext.image;typeof i.init=="function"&&i.init.apply(i,[ige,this]),this.sizeX(i.width),this.sizeY(i.height),this._loaded=!0,self.emit("loaded"),ige.textureLoadEnd(scriptUrl,self)}else this.log("Error reading asset render script data. The script does not contain an image variable!","error",[this.url,rs_sandboxContext])}catch(r){this.log("Error executing asset render script: ","error",[r,this.url])}})))},_setImage:function(e){var t;ige.isServer||(t=this.image=this._originalImage=e,t._igeTextures=t._igeTextures||[],t._loaded=!0,this._mode=0,this.sizeX(t.width),this.sizeY(t.height),this._cells[1]=[0,0,this._sizeX,this._sizeY])},textureFromCell:function(e){var t;if(t=typeof e=="string"?this.cellIdToIndex(e):e,this._cells[t]){var i=this._cells[t],r=new $i_48,n=document.createElement("canvas"),o=n.getContext("2d");return n.width=i[2],n.height=i[3],o.drawImage(this._originalImage,i[0],i[1],i[2],i[3],0,0,i[2],i[3]),r._setImage(n),r}return this.log("Unable to create new texture from passed cell index because the cell does not exist!","warning"),!1},sizeX:function(e){this._sizeX=e},sizeY:function(e){this._sizeY=e},resize:function(e,t,i){this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas")),this._textureCanvas.width=e,this._textureCanvas.height=t,this._textureCtx=this._textureCanvas.getContext("2d"),i||this._textureCtx.drawImage(this._originalImage,0,0,this._originalImage.width,this._originalImage.height,0,0,e,t),this.image=this._textureCanvas)},restoreOriginal:function(){this.image=this._originalImage,delete this._textureCtx,delete this._textureCanvas},smoothing:function(e){return e!==void 0?(this._smoothing=e,this):this._smoothing},render:function(e,t){if(t._cell!==null){if(this._smoothing?(ige._ctx.imageSmoothingEnabled=!0,ige._ctx.webkitImageSmoothingEnabled=!0,ige._ctx.mozImageSmoothingEnabled=!0):(ige._ctx.imageSmoothingEnabled=!1,ige._ctx.webkitImageSmoothingEnabled=!1,ige._ctx.mozImageSmoothingEnabled=!1),this._mode===0){var i=this._cells[t._cell],r=t._geometry,n=t._renderPos;i?(this._preFilter&&this._textureCtx&&(this._textureCtx.save(),this._preFilter(this._textureCanvas,this._textureCtx,this._originalImage,this,this._preFilterData),this._textureCtx.restore()),e.drawImage(this.image,i[0],i[1],i[2],i[3],n.x,n.y,r.x,r.y),ige._drawCount++):this.log("Cannot render texture using cell "+t._cell+" because the cell does not exist in the assigned texture!","error")}this._mode===1&&(e.save(),this.script.render(e,t,this),e.restore(),ige._drawCount++)}},preFilter:function(e,t){return e!==void 0?(this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d")),this.image=this._textureCanvas,this._preFilter=e,this._preFilterData=t),this):(this.log("Cannot use pre-filter, no filter method was passed!","warning"),this._preFilter)},applyFilter:function(e,t){return e!==void 0?this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d")),this.image=this._textureCanvas,this._textureCtx.save(),e(this._textureCanvas,this._textureCtx,this._originalImage,this,t),this._textureCtx.restore()):this.log("Cannot apply filter, no filter method was passed!","warning"),this},stringify:function(){var e="new "+this.classId()+"('"+this._url+"')";return e+=".id('"+this.id()+"')",e+=this._stringify()},destroy:function(){delete this._eventListeners,this.image&&this.image._igeTextures&&this.image._igeTextures.pull(this),ige._textureStore.pull(this),delete this.image,delete this.script,delete this._textureCanvas,delete this._textureCtx,this._destroyed=!0}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_48);var $i_50=$i_48.extend({classId:"$i_50",$i_50:!0,init:function(e,t){var i=this;this.on("loaded",function(){if(i.image){i._sheetImage=this.image;var e;for(e=0;t.length>e;e++)i._cells[e+1]=t[e],t[e][2]%2&&this.log("This texture's cell definition defines a cell width is not divisible by 2 which will cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: "+this._url,"warning",t[e]),t[e][3]%2&&this.log("This texture's cell definition defines a cell height is not divisible by 2 which will cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: "+this._url,"warning",t[e])}else i.log("Cannot create cell-sheet because texture has not loaded an image!","error")}),this._super(e)},cellCount:function(){return this._cells.length},cellIdToIndex:function(e){var t,i=this._cells;for(t=1;i.length>t;t++)if(i[t][4]===e)return t;return-1},stringify:function(){var e="new "+this.classId()+"('"+this.url()+"', "+(this._cells+"")+")";return e+=".id('"+this.id()+"');"}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_50);var $i_52=$i_3.extend({classId:"$i_52",init:function(){this._alive=!0,this._mode=0,this._mountMode=0,this._parent=null,this._children=[],this._layer=0,this._depth=0,this._dirty=!0,this._depthSortMode=0,this._timeStream=[],this._inView=!0},alive:function(e){return e!==void 0?(this._alive=e,this):this._alive},id:function(e){if(e!==void 0){if(e===this._id)return this;if(!ige._register[e])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=e,ige.register(this),this;ige._register[e]!==this&&this.log('Cannot set ID of object to "'+e+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=ige.newIdHex(),ige.register(this)),this._id},group:function(e){return e!==void 0?(this._group=e,this):this._group},addBehaviour:function(e,t){if(typeof e=="string"){if(typeof t=="function")return this._behaviours=this._behaviours||[],this._behaviours.push({id:e,method:t}),this;this.log("The behaviour you passed is not a function! The second parameter of the call must be a function!","error")}else this.log("Cannot add behaviour to object because the specified behaviour id is not a string. You must provide two parameters with the addBehaviour() call, an id:String and a behaviour:Function. Adding a behaviour with an id allows you to remove it by it's id at a later stage!","error");return!1},removeBehaviour:function(e){if(e!==void 0){var t,i=this._behaviours;if(i){t=i.length;while(t--)if(i[t].id===e)return i.splice(t,1),this}}return!1},drawBounds:function(e){return e!==void 0?(this._drawBounds=e,this):this._drawBounds},drawBoundsData:function(e){return e!==void 0?(this._drawBoundsData=e,this):this._drawBoundsData},drawMouse:function(e){return e!==void 0?(this._drawMouse=e,this):this._drawMouse},parent:function(){return this._parent},children:function(){return this._children},mount:function(e){if(e){if(e._children){if(this.id(),this._parent){if(this._parent===e)return this;this.unMount()}return this._parent=e,e._children.push(this),this._parent._childMounted(this),this.emit("mounted",this._parent),this}return!1}this.log("Cannot mount non-existent object!","error")},unMount:function(){if(this._parent){var e=this._parent._children,t=e.indexOf(this);return t>-1?(e.splice(t,1),this._parent._childUnMounted(this),this._parent=null,this):!1}return!1},clone:function(){},mode:function(e){return e!==void 0?(this._mode=e,this):this._mode},isometric:function(e){return e===!0?(this._mode=1,this):e===!1?(this._mode=0,this):this._mode===1},isometricMounts:function(e){return e===!0?(this._mountMode=1,this):e===!1?(this._mountMode=0,this):this._mountMode===1},indestructible:function(e){return e!==void 0?(this._indestructible=e,this):this._indestructible},layer:function(e){return e!==void 0?(this._layer=e,this):this._layer},depth:function(e){return e!==void 0?(this._depth=e,this):this._depth},destroyChildren:function(){var e,t=this._children;if(t){e=t.length;while(e--)t[e].destroy()}return delete this._children,this},destroyBehaviours:function(){delete this._behaviours},destroyComponents:function(){var e,t=this._components;if(t){e=t.length;while(e--)t[e].destroy&&t[e].destroy()}return delete this._components,this},dirty:function(e){return e!==void 0?(this._dirty=e,this._parent&&this._parent.dirty(e),this):this._dirty},depthSortMode:function(e){return e!==void 0?(this._depthSortMode=e,this):this._depthSortMode},depthSortChildren:function(){if(this._depthSortMode!==-1){var e,t,i,r,n=this._children;if(n&&(e=n.length,e>1))if(this._mountMode===1){if(this._depthSortMode===0){for(t={adj:[],c:[],p:[],order:[],order_ind:e-1},i=0;e>i;++i)for(t.c[i]=0,t.p[i]=-1,r=i+1;e>r;++r)t.adj[i]=t.adj[i]||[],t.adj[r]=t.adj[r]||[],n[i]._inView&&n[r]._inView&&n[i]._projectionOverlap&&n[r]._projectionOverlap&&n[i]._projectionOverlap(n[r])&&(n[i].isBehind(n[r])?t.adj[r].push(i):t.adj[i].push(r));for(i=0;e>i;++i)t.c[i]===0&&this._depthSortVisit(i,t);for(i=0;t.order.length>i;i++)n[t.order[i]].depth(i);this._children.sort(function(e,t){var i=t._layer-e._layer;return i===0?t._depth-e._depth:i})}if(this._depthSortMode===1&&this._children.sort(function(e,t){var i=t._layer-e._layer;return i===0?e.isBehind(t)?-1:1:i}),this._depthSortMode===2){while(e--)t=n[e],r=t._translate,r&&(t._depth=r.x+r.y+r.z);this._children.sort(function(e,t){var i=t._layer-e._layer;return i===0?t._depth-e._depth:i})}}else this._children.sort(function(e,t){var i=t._layer-e._layer;return i===0?t._depth-e._depth:i})}},viewChecking:function(e){return e!==void 0?(this._viewChecking=e,this):this._viewChecking},viewCheckChildren:function(){var e,t=this._children,i=t.length,r=ige._currentViewport.viewArea();while(i--)e=t[i],e._inView=e._alwaysInView?!0:e.aabb?r.rectIntersect(e.aabb())?!0:!1:!1},tick:function(e){var t,i,r,n,o,a=this._children;if(this._viewChecking&&this.viewCheckChildren(),a)if(t=a.length,n=t,t&&!ige._headless&&(igeDebug.timing?(ige._tslt[this.id()]||(ige._tslt[this.id()]={}),i=(new Date).getTime(),this.depthSortChildren(),r=(new Date).getTime()-i,ige._tslt[this.id()].depthSortChildren=r):this.depthSortChildren()),o=t,igeDebug.timing)while(t--)e.save(),i=(new Date).getTime(),a[t].tick(e),r=(new Date).getTime()-i,a[t]&&(ige._tsit[a[t].id()]||(ige._tsit[a[t].id()]=0),ige._tslt[a[t].id()]||(ige._tslt[a[t].id()]={}),ige._tsit[a[t].id()]+=r,ige._tslt[a[t].id()].tick=r),e.restore();else while(t--)e.save(),a[t].tick(e),e.restore()},_depthSortVisit:function(e,t){var i,r,n=t.adj[e],o=n.length;for(t.c[e]=1,i=0;o>i;++i)r=n[i],t.c[r]===0&&(t.p[r]=e,this._depthSortVisit(r,t));t.c[e]=2,t.order[t.order_ind]=e,--t.order_ind},_resizeEvent:function(e){var t,i=this._children;
if(i){t=i.length;while(t--)i[t]._resizeEvent(e)}},_processBehaviours:function(){var e,t=this._behaviours;if(t){e=t.length;while(e--)t[e].method.apply(this,arguments)}},_childMounted:function(){this._resizeEvent(null)},_childUnMounted:function(){},destroy:function(){return this.unMount(),this._children&&this.destroyChildren(),this.destroyComponents(),this.destroyBehaviours(),ige.unRegister(this),this._alive=!1,delete this._eventListeners,this},stringify:function(){var e="new "+this.classId()+"()";return e+=".id('"+this.id()+"')",this.parent()&&(e+=".mount(ige.$('"+this.parent().id()+"'))"),e+=this._stringify()},_stringify:function(){var e,t="";for(e in this)if(this.hasOwnProperty(e)&&this[e]!==void 0)switch(e){case"_group":t+=".group('"+this.group()+"')";break;case"_drawBounds":t+=".drawBounds('"+this.drawBounds()+"')";break;case"_drawBoundsData":t+=".drawBoundsData('"+this.drawBoundsData()+"')";break;case"_drawMouse":t+=".drawMouse('"+this.drawMouse()+"')";break;case"_mode":t+=".mode('"+this.mode()+"')";break;case"_isometricMounts":t+=".isometricMounts('"+this.isometricMounts()+"')";break;case"_indestructible":t+=".indestructible('"+this.indestructible()+"')";break;case"_layer":t+=".layer('"+this.layer()+"')";break;case"_depth":t+=".depth('"+this.depth()+"')"}return t}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_52);var $i_53=$i_52.extend([{extension:$i_40,overwrite:!1},{extension:$i_43,overwrite:!0}],{classId:"$i_53",init:function(){this._super(),this._width=void 0,this._height=void 0,this._anchor=new $i_5(0,0,0),this._renderPos={x:0,y:0},this._opacity=1,this._cell=1,this._deathTime=void 0,this._oldTranslate=new $i_5(0,0,0),this._translate=new $i_5(0,0,0),this._rotate=new $i_5(0,0,0),this._scale=new $i_5(1,1,1),this._origin=new $i_5(.5,.5,.5),this._geometry=new $i_5(40,40,40),this._highlight=!1,this._mouseEventsActive=!1,this._localMatrix=new $i_8(this),this._worldMatrix=new $i_8(this),this._inView=!0,this._hidden=!1,this.streamSections(["transform"])},show:function(){return this._hidden=!1,this},hide:function(){return this._hidden=!0,this},mousePos:function(e){if(e=e||ige._currentViewport){var t=e._mousePos.clone();return t.x+=e._translate.x,t.y+=e._translate.y,this._transformPoint(t)}return new $i_5(0,0,0)},mousePosAbsolute:function(e){if(e=e||ige._currentViewport){var t=e._mousePos.clone();return this._transformPoint(t)}return new $i_5(0,0,0)},translateToTile:function(e,t,i){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var r;r=i!==void 0?i*this._parent._tileWidth:this._translate.z,this.translateTo(e*this._parent._tileWidth,t*this._parent._tileHeight,r)}else this.log("Cannot translate to tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},widthByTile:function(e,t){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var i,r=this._mode===0?this._parent._tileWidth:this._parent._tileWidth*2;this.width(e*r),t&&(this._texture?(i=this._texture._sizeX/this._geometry.x,this.height(this._texture._sizeY/i)):this.log("Cannot set height based on texture aspect ratio and new width because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set width by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},heightByTile:function(e,t){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var i,r=this._mode===0?this._parent._tileHeight:this._parent._tileHeight*2;this.height(e*r),t&&(this._texture?(i=this._texture._sizeY/this._geometry.y,this.width(this._texture._sizeX/i)):this.log("Cannot set width based on texture aspect ratio and new height because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set height by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},occupyTile:function(){this.log("Cannot occupy a tile because the entity is not currently mounted to a tile sheet.","warning")},overTiles:function(){this.log("Cannot determine which tiles this entity lies over because the entity is not currently mounted to a tile sheet.","warning")},anchor:function(e,t){return e!==void 0&&t!==void 0?(this._anchor=new $i_5(e,t,0),this):this._anchor},width:function(e){return e!==void 0?(this._width=e,this._geometry.x=e,this._geometry.x2=e/2,this):this._width},height:function(e){return e!==void 0?(this._height=e,this._geometry.y=e,this._geometry.y2=e/2,this):this._height},size3d:function(e,t,i){return e!==void 0&&t!==void 0&&i!==void 0?(this._geometry=new $i_5(e,t,i),this):this._geometry},lifeSpan:function(e){return e!==void 0?(this.deathTime(ige._currentTime+e),this):this.deathTime()-ige._currentTime},deathTime:function(e){return e!==void 0?(this._deathTime=e,this):this._deathTime},opacity:function(e){return e!==void 0?(this._opacity=e,this):this._opacity},texture:function(e){return e!==void 0?(this._texture=e,this):this._texture},cell:function(e){return e>0||e===null?(this._cell=e,this):this._cell},cellById:function(e){if(e!==void 0)if(this._texture){var t,i=this._texture,r=i._cells;for(t=1;r.length>t;t++)if(r[t][4]===e)return this.cell(t),this;this.log('Could not find the cell id "'+e+'" in the assigned entity texture '+i.id()+', please check your sprite sheet (texture) cell definition to ensure the cell id "'+e+'" has been assigned to a cell!',"error")}else this.log("Cannot assign cell index from cell ID until an $i_50 has been set as the texture for this entity. Please set the texture before calling cellById().","error");return this._cell},dimensionsFromTexture:function(e){return this._texture&&(e===void 0?(this.width(this._texture._sizeX),this.height(this._texture._sizeY)):(this.width(Math.floor(this._texture._sizeX/100*e)),this.height(Math.floor(this._texture._sizeY/100*e)))),this},dimensionsFromCell:function(){return this._texture&&(this.width(this._texture._cells[this._cell][2]),this.height(this._texture._cells[this._cell][3])),this},highlight:function(e){return e!==void 0?(this._highlight=e,this):this._highlight},localToWorld:function(e){this._worldMatrix.transform(e)},localToWorldPoint:function(e){this._worldMatrix.transform([e])},aabb:function(e){if(e||!this._aabb){var t,i,r,n,o,a,s,h,l,c,u=new $i_6,d=this._anchor,f=this._geometry,p=f.x,m=f.y,E=f.z,g=f.x2,v=f.y2,y=(f.z2,this._origin),_=y.x-.5,T=y.y-.5,x=y.z-.5;this._mode===0&&(a=g+d.x,s=v+d.y,h=p*_,l=m*T,u.addPoint(-a+h,-s+l),u.addPoint(a+h,-s+l),u.addPoint(a+h,s+l),u.addPoint(-a+h,s+l),this._renderPos={x:-a+h,y:-s+l},this.localToWorld(u._poly),t=Math.min(u._poly[0].x,u._poly[1].x,u._poly[2].x,u._poly[3].x),i=Math.min(u._poly[0].y,u._poly[1].y,u._poly[2].y,u._poly[3].y),r=Math.max(u._poly[0].x,u._poly[1].x,u._poly[2].x,u._poly[3].x),n=Math.max(u._poly[0].y,u._poly[1].y,u._poly[2].y,u._poly[3].y),o=new $i_7(t,i,r-t,n-i)),this._mode===1&&(c=new $i_5(-(f.x/2),-(f.y/2),f.z/2).toIso(),a=c.x+f.x+d.x,s=c.y+d.y,h=p*_,l=E*x,u.addPoint(-a+h,-s+l),u.addPoint(a+h,-s+l),u.addPoint(a+h,s+l),u.addPoint(-a+h,s+l),this._renderPos={x:-a+h,y:-s+l},this.localToWorld(u._poly),t=Math.min(u._poly[0].x,u._poly[1].x,u._poly[2].x,u._poly[3].x),i=Math.min(u._poly[0].y,u._poly[1].y,u._poly[2].y,u._poly[3].y),r=Math.max(u._poly[0].x,u._poly[1].x,u._poly[2].x,u._poly[3].x),n=Math.max(u._poly[0].y,u._poly[1].y,u._poly[2].y,u._poly[3].y),o=new $i_7(Math.floor(t),Math.floor(i),Math.floor(r-t),Math.floor(n-i))),this._aabb=o}return this._aabb},localAabb:function(e){if(!this._localAabb||e){var t=this.aabb();this._localAabb=new $i_7(-Math.floor(t.width/2),-Math.floor(t.height/2),Math.floor(t.width),Math.floor(t.height))}return this._localAabb},_swapVars:function(e,t){return[t,e]},_internalsOverlap:function(e,t,i,r){var n;return e>t&&(n=this._swapVars(e,t),e=n[0],t=n[1]),i>r&&(n=this._swapVars(i,r),i=n[0],r=n[1]),e>i&&(n=this._swapVars(e,i),e=n[0],i=n[1],n=this._swapVars(t,r),t=n[0],r=n[1]),t>i},_projectionOverlap:function(e){var t=this._geometry,i=new $i_5(this._translate.x-t.x/2,this._translate.y-t.y/2,this._translate.z-t.z),r=new $i_5(this._translate.x+t.x/2,this._translate.y+t.y/2,this._translate.z+t.z),n=e._geometry,o=new $i_5(e._translate.x-n.x/2,e._translate.y-n.y/2,e._translate.z-n.z),a=new $i_5(e._translate.x+n.x/2,e._translate.y+n.y/2,e._translate.z+n.z);return this._internalsOverlap(i.x-r.y,r.x-i.y,o.x-a.y,a.x-o.y)&&this._internalsOverlap(i.x-r.z,r.x-i.z,o.x-a.z,a.x-o.z)&&this._internalsOverlap(i.z-r.y,r.z-i.y,o.z-a.y,a.z-o.y)},isBehind:function(e){var t=this._geometry,i=new $i_5(this._translate.x-t.x/2,this._translate.y-t.y/2,this._translate.z),r=new $i_5(this._translate.x+t.x/2,this._translate.y+t.y/2,this._translate.z+t.z),n=e._geometry,o=new $i_5(e._translate.x-n.x/2,e._translate.y-n.y/2,e._translate.z),a=new $i_5(e._translate.x+n.x/2,e._translate.y+n.y/2,e._translate.z+n.z);return r.x>o.x?a.x>i.x?r.y>o.y?a.y>i.y?r.z>o.z?a.z>i.z?this._translate.x+this._translate.y+this._translate.z>e._translate.x+e._translate.y+e._translate.z:!0:!1:!0:!1:!0:!1},mouseEventsActive:function(e){return e!==void 0?(this._mouseEventsActive=e,this):this._mouseEventsActive},newFrame:function(){return ige._frameAlternator!==this._frameAlternatorCurrent},tick:function(e,t){if(this._deathTime===void 0||ige.tickStart<this._deathTime){if(this.newFrame()&&(delete this._streamDataCache,this._processBehaviours(e),this._timeStream.length&&this._processInterpolate(ige.tickStart-ige.network.stream._renderLatency)),!this._hidden&&this._inView&&(!this._parent||this._parent._inView)){var i,r,n,o,a=this;this._mouseEventsActive&&ige._currentViewport&&(i=this.mousePos(),i&&(r=this.localAabb(),n=i.x,o=i.y,r.xyInside(n,o)?ige.input.queueEvent(this,this._mouseInAabb):ige.input.mouseMove&&a._handleMouseOut(ige.input.mouseMove))),t||this._transformContext(e),this._renderEntity(e,t),this._streamMode===1&&this.streamSync()}this._super(e),this.newFrame()&&(this._oldTranslate=this._translate.clone()),this._frameAlternatorCurrent=ige._frameAlternator}else this.destroy()},_renderEntity:function(e){var t=this._texture;this._opacity>0&&t&&(t.render(e,this,ige._tickDelta),this._highlight&&(e.globalCompositeOperation="lighter",t.render(e,this)))},_transformContext:function(e){this.updateTransform(),this.aabb(!0),e.globalAlpha=this._parent?this._parent._opacity*this._opacity:this._opacity,this._localMatrix.transformRenderingContext(e)},_transformPoint:function(e){if(this._parent){var t=new $i_8;t.copy(this._parent._worldMatrix),t.multiply(this._localMatrix),t.getInverse().transformCoord(e)}else this._localMatrix.transformCoord(e);return e},_mouseInAabb:function(e,t){ige.input.mouseMove&&this._handleMouseIn(ige.input.mouseMove,e,t),ige.input.mouseDown&&this._handleMouseDown(ige.input.mouseDown,e,t),ige.input.mouseUp&&this._handleMouseUp(ige.input.mouseUp,e,t)},_stringify:function(){var e,t=this._super();for(e in this)if(this.hasOwnProperty(e)&&this[e]!==void 0)switch(e){case"_opacity":t+=".opacity("+this.opacity()+")";break;case"_texture":t+=".texture(ige.$('"+this.texture().id()+"'))";break;case"_cell":t+=".cell("+this.cell()+")";break;case"_translate":t+=".translateTo("+this._translate.x+", "+this._translate.y+", "+this._translate.z+")";break;case"_rotate":t+=".rotateTo("+this._rotate.x+", "+this._rotate.y+", "+this._rotate.z+")";break;case"_scale":t+=".scaleTo("+this._scale.x+", "+this._scale.y+", "+this._scale.z+")";break;case"_origin":t+=".originTo("+this._origin.x+", "+this._origin.y+", "+this._origin.z+")";break;case"_anchor":t+=".anchor("+this._anchor.x+", "+this._anchor.y+")";break;case"_width":t+=typeof this.width()=="string"?".width('"+this.width()+"')":".width("+this.width()+")";break;case"_height":t+=typeof this.height()=="string"?".height('"+this.height()+"')":".height("+this.height()+")";break;case"_geometry":t+=".size3d("+this._geometry.x+", "+this._geometry.y+", "+this._geometry.z+")";break;case"_deathTime":t+=".deathTime('"+this.deathTime()+"')";break;case"_highlight":t+=".highlight('"+this.highlight()+"')"}return t},destroy:function(){this._alive=!1,this.emit("destroyed",this),this._super()},streamSections:function(e){return e!==void 0?(this._streamSections=e,this):this._streamSections},streamSectionData:function(e,t,i){if(e==="transform"){if(!t)return this._translate.toString(this._streamFloatPrecision)+","+this._scale.toString(this._streamFloatPrecision)+","+this._rotate.toString(this._streamFloatPrecision)+",";var r=t.split(",");i?(r[0]&&(this._translate.x=parseFloat(r[0])),r[1]&&(this._translate.y=parseFloat(r[1])),r[2]&&(this._translate.z=parseFloat(r[2])),r[3]&&(this._scale.x=parseFloat(r[3])),r[4]&&(this._scale.y=parseFloat(r[4])),r[5]&&(this._scale.z=parseFloat(r[5])),r[6]&&(this._rotate.x=parseFloat(r[6])),r[7]&&(this._rotate.y=parseFloat(r[7])),r[8]&&(this._rotate.z=parseFloat(r[8]))):(r[0]&&(r[0]=parseFloat(r[0])),r[1]&&(r[1]=parseFloat(r[1])),r[2]&&(r[2]=parseFloat(r[2])),r[3]&&(r[3]=parseFloat(r[3])),r[4]&&(r[4]=parseFloat(r[4])),r[5]&&(r[5]=parseFloat(r[5])),r[6]&&(r[6]=parseFloat(r[6])),r[7]&&(r[7]=parseFloat(r[7])),r[8]&&(r[8]=parseFloat(r[8])),this._timeStream.push([ige.network.stream._streamDataTime+ige.network._latency,r]),this._timeStream.length>10&&this._timeStream.shift())}},interpolateValue:function(e,t,i,r,n){var o=t-e,a=n-i,s=r-i,h=s/a;return 0>h?h=0:h>1&&(h=1),o*h+e},_processInterpolate:function(e,t){t||(t=200);var i,r,n,o,a,s,h,l=this._timeStream,c=[],u=1;while(l[u]){if(l[u][0]>e){i=l[u-1],r=l[u];break}u++}r||i?l.splice(0,u-1):l.length>2&&e>l[l.length-1][0]&&(i=l[l.length-2],r=l[l.length-1],l.shift(),this.emit("interpolationLag")),r&&i&&(this._timeStreamPreviousData=i,this._timeStreamNextData=r,n=r[0]-i[0],o=e-i[0],this._timeStreamDataDelta=Math.floor(n),this._timeStreamOffsetDelta=Math.floor(o),a=o/n,this._timeStreamCurrentInterpolateTime=a,s=i[1],h=r[1],c[0]=this.interpolateValue(s[0],h[0],i[0],e,r[0]),c[1]=this.interpolateValue(s[1],h[1],i[0],e,r[0]),c[2]=this.interpolateValue(s[2],h[2],i[0],e,r[0]),c[3]=this.interpolateValue(s[3],h[3],i[0],e,r[0]),c[4]=this.interpolateValue(s[4],h[4],i[0],e,r[0]),c[5]=this.interpolateValue(s[5],h[5],i[0],e,r[0]),c[6]=this.interpolateValue(s[6],h[6],i[0],e,r[0]),c[7]=this.interpolateValue(s[7],h[7],i[0],e,r[0]),c[8]=this.interpolateValue(s[8],h[8],i[0],e,r[0]),this.translateTo(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])),this.scaleTo(parseFloat(c[3]),parseFloat(c[4]),parseFloat(c[5])),this.rotateTo(parseFloat(c[6]),parseFloat(c[7]),parseFloat(c[8])),this._lastUpdate=(new Date).getTime())}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_53);var $i_62=$i_53.extend({classId:"$i_62",init:function(e){this._super(),this._trackRotateTarget=void 0,this._trackTranslateTarget=void 0,this._trackRotateSmoothing=void 0,this._trackTranslateSmoothing=void 0,this._entity=e},limit:function(e){return e!==void 0?(this._limit=e,this._entity):this._limit},panTo:function(e,t,i){return e!==void 0&&this._translate.tween().properties({x:e.x,y:e.y,z:e.z}).duration(t).easing(i).start(),this._entity},panBy:function(e,t,i){return e!==void 0&&this._translate.tween().properties({x:e.x+this._translate.x,y:e.y+this._translate.y,z:e.z+this._translate.z}).duration(t).easing(i).start(),this._entity},trackTranslate:function(e,t,i){return e!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking translation target "+e.id()),this._trackTranslateRounding=i,this._trackTranslateSmoothing=1>t?0:t,this._trackTranslateTarget=e,this._entity):this._trackTranslateTarget},trackTranslateSmoothing:function(e){return e!==void 0?(this._trackTranslateSmoothing=e,this):this._trackTranslateSmoothing},trackTranslateRounding:function(e){return e!==void 0?(this._trackTranslateRounding=e,this):this._trackTranslateRounding},unTrackTranslate:function(){delete this._trackTranslateTarget},trackRotate:function(e,t){return e!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking rotation of target "+e.id()),this._trackRotateSmoothing=1>t?0:t,this._trackRotateTarget=e,this._entity):this._trackRotateTarget},trackRotateSmoothing:function(e){return e!==void 0?(this._trackRotateSmoothing=e,this):this._trackRotateSmoothing},unTrackRotate:function(){delete this._trackRotateTarget},lookAt:function(e){return e!==void 0&&(e.updateTransform(),this._translate.x=Math.floor(e._worldMatrix.matrix[2]),this._translate.y=Math.floor(e._worldMatrix.matrix[5]),this.updateTransform()),this},tick:function(e){if(this._trackTranslateTarget){var t,i,r,n,o=this._trackTranslateTarget,a=o._worldMatrix.matrix,s=a[2],h=a[5];this._trackTranslateSmoothing?(t=this._translate.x,i=this._translate.y,r=Math.round(s-t),n=Math.round(h-i),this._trackTranslateRounding?(this._translate.x+=Math.round(r/this._trackTranslateSmoothing),this._translate.y+=Math.round(n/this._trackTranslateSmoothing)):(this._translate.x+=r/this._trackTranslateSmoothing,this._translate.y+=n/this._trackTranslateSmoothing)):this.lookAt(this._trackTranslateTarget)}if(this._trackRotateTarget){var l,c,u=this._trackRotateTarget._parent!==void 0?this._trackRotateTarget._parent._rotate.z:0,d=-(u+this._trackRotateTarget._rotate.z);this._trackRotateSmoothing?(l=this._rotate.z,c=d-l,this._rotate.z+=c/this._trackRotateSmoothing):this._rotate.z=d}this.updateTransform(),this._localMatrix.transformRenderingContext(e)},updateTransform:function(){if(this._localMatrix.identity(),this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z)),this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y)),this._mode===0&&this._localMatrix.multiply(this._localMatrix._newTranslate(-this._translate.x,-this._translate.y)),this._mode===1){var e=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this._geometry.z/2).toIso();this._parent&&this._parent._geometry.z&&(e.y+=this._parent._geometry.z/1.6),this._localMatrix.multiply(this._localMatrix._newTranslate(e.x,e.y))}this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix)},_stringify:function(){var e,t=this._super();for(e in this)if(this.hasOwnProperty(e)&&this[e]!==void 0)switch(e){case"_trackTranslateTarget":t+=".trackTranslate(ige.$('"+this._trackTranslateTarget.id()+"'), "+this.trackTranslateSmoothing()+")";break;case"_trackRotateTarget":t+=".trackRotate(ige.$('"+this._trackRotateTarget.id()+"'), "+this.trackRotateSmoothing()+")"}return t}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_62);var $i_63=$i_53.extend([{extension:$i_42,overwrite:!0},{extension:$i_41,overwrite:!0}],{classId:"$i_63",init:function(e){this._alwaysInView=!0,this._super(),this._mousePos=new $i_5(0,0,0),this._overflow="",this._uiX=0,this._uiY=0,e===void 0&&(e={left:0,top:0,width:ige._geometry.x,height:ige._geometry.y,autoSize:!0}),this._geometry=new $i_5(e.width||250,e.height||150,0),this.camera=new $i_62(this),this.camera._entity=this},autoSize:function(e){return e!==void 0?(this._autoSize=e,this):this._autoSize},scene:function(e){return e!==void 0?(this._scene=e,this):this._scene},mousePos:function(){return this._mousePos},viewArea:function(){var e=this.aabb(),t=this.camera._translate;return new $i_7(e.x+t.x,e.y+t.y,e.width,e.height)},tick:function(e){if(this._scene&&(ige._currentCamera=this.camera,ige._currentViewport=this,this._scene._parent=this,this._super(e),e.translate(-(this._geometry.x*this._origin.x)|0,-(this._geometry.y*this._origin.y)|0),e.clearRect(0,0,this._geometry.x,this._geometry.y),(!ige.cocoonJs||ige.cocoonJs&&!ige.cocoonJs.detected)&&(e.beginPath(),e.rect(0,0,this._geometry.x,this._geometry.y),this._borderColor&&(e.strokeStyle=this._borderColor,e.stroke()),e.clip()),e.translate(this._geometry.x/2|0,this._geometry.y/2|0),this.camera.tick(e),e.save(),this._scene.tick(e),e.restore(),this._drawBounds&&e===ige._ctx&&this.drawAABBs(e,this._scene,0),this._drawMouse&&e===ige._ctx)){e.save();var t=this.mousePos();e.scale(1/this.camera._scale.x,1/this.camera._scale.y);var i,r=Math.floor(t.x*this.camera._scale.x),n=Math.floor(t.y*this.camera._scale.y);e.fillStyle="#fc00ff",e.fillRect(r-5,n-5,10,10),i=e.measureText("Viewport "+this.id()+" :: "+r+", "+n),e.fillText("Viewport "+this.id()+" :: "+r+", "+n,r-i.width/2,n-15),e.restore()}},drawAABBs:function(e,t,i){var r,n,o,a,s,h,l,c,u,d,f,p,m,E,g,v,y,_,T,x=t._children;if(x){r=x.length;while(r--)n=x[r],i++,n._shouldRender!==!1&&(typeof n.aabb=="function"&&(o=n.aabb(),o&&((n._drawBounds||n._drawBounds===void 0)&&(e.strokeStyle="#00deff",e.strokeRect(o.x,o.y,o.width,o.height),n._parent&&n._parent._mountMode===1&&(e.save(),e.translate(o.x+o.width/2,o.y+o.height/2),s=n._geometry,h=new $i_5(-(s.x/2),0,0).toIso(),l=new $i_5(+(s.x/2),0,0).toIso(),c=new $i_5(0,-(s.y/2),0).toIso(),u=new $i_5(0,+(s.y/2),0).toIso(),d=new $i_5(0,0,-(s.z/2)).toIso(),f=new $i_5(0,0,+(s.z/2)).toIso(),p=new $i_5(-(s.x/2),-(s.y/2),-(s.z/2)).toIso(),m=new $i_5(+(s.x/2),-(s.y/2),-(s.z/2)).toIso(),E=new $i_5(+(s.x/2),+(s.y/2),-(s.z/2)).toIso(),g=new $i_5(-(s.x/2),+(s.y/2),-(s.z/2)).toIso(),v=new $i_5(-(s.x/2),-(s.y/2),s.z/2).toIso(),y=new $i_5(+(s.x/2),-(s.y/2),s.z/2).toIso(),_=new $i_5(+(s.x/2),+(s.y/2),s.z/2).toIso(),T=new $i_5(-(s.x/2),+(s.y/2),s.z/2).toIso(),a=e.globalAlpha,e.globalAlpha=1,e.strokeStyle="#ff0000",e.beginPath(),e.moveTo(h.x,h.y),e.lineTo(l.x,l.y),e.stroke(),e.strokeStyle="#00ff00",e.beginPath(),e.moveTo(c.x,c.y),e.lineTo(u.x,u.y),e.stroke(),e.strokeStyle="#fffc00",e.beginPath(),e.moveTo(d.x,d.y),e.lineTo(f.x,f.y),e.stroke(),e.strokeStyle="#a200ff",e.globalAlpha=.6,e.fillStyle="#545454",e.beginPath(),e.moveTo(E.x,E.y),e.lineTo(g.x,g.y),e.lineTo(T.x,T.y),e.lineTo(_.x,_.y),e.lineTo(E.x,E.y),e.fill(),e.stroke(),e.fillStyle="#282828",e.beginPath(),e.moveTo(E.x,E.y),e.lineTo(m.x,m.y),e.lineTo(y.x,y.y),e.lineTo(_.x,_.y),e.lineTo(E.x,E.y),e.fill(),e.stroke(),e.fillStyle="#676767",e.beginPath(),e.moveTo(v.x,v.y),e.lineTo(y.x,y.y),e.lineTo(_.x,_.y),e.lineTo(T.x,T.y),e.lineTo(v.x,v.y),e.fill(),e.stroke(),e.globalAlpha=a,e.restore())),this._drawBoundsData&&(n._drawBounds||n._drawBoundsData===void 0)&&(e.globalAlpha=1,e.fillStyle="#f6ff00",e.fillText("ID: "+n.id()+" "+"("+n.classId()+") "+n.layer()+":"+n.depth().toFixed(0),o.x+o.width+3,o.y+10),e.fillText("X: "+n._translate.x.toFixed(2)+", "+"Y: "+n._translate.y.toFixed(2)+", "+"Z: "+n._translate.z.toFixed(2),o.x+o.width+3,o.y+20)))),this.drawAABBs(e,n,i))}},_resizeEvent:function(e){this._autoSize&&this._parent&&(this._geometry=this._parent._geometry.clone()),this._updateUiPosition(),this._scene&&this._scene._resizeEvent(e)},_stringify:function(){var e,t=this._super();for(e in this)if(this.hasOwnProperty(e)&&this[e]!==void 0)switch(e){case"_autoSize":t+=".autoSize("+this._autoSize+")";break;case"_scene":t+=".scene(ige.$('"+this.scene().id()+"'))"}return t}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_63);var $i_64=$i_53.extend({classId:"$i_64",init:function(){this._alwaysInView=!0,this._super(),this._shouldRender=!0,this._autoSize=!0,this._geometry.x=ige._geometry.x,this._geometry.y=ige._geometry.y},autoSize:function(e){return e!==void 0?(this._autoSize=e,this):this._autoSize},shouldRender:function(e){return e!==void 0?(this._shouldRender=e,this):this._shouldRender},ignoreCamera:function(e){return e!==void 0?(this._ignoreCamera=e,this):this._ignoreCamera},tick:function(e){if(this._shouldRender){if(this._ignoreCamera){var t=ige._currentCamera;this.translateTo(t._translate.x,t._translate.y,t._translate.z)}this._super(e)}},_resizeEvent:function(e){this._autoSize&&(this._geometry=ige._geometry.clone());var t=this._children,i=t.length;while(i--)t[i]._resizeEvent(e)},_stringify:function(){var e,t=this._super();for(e in this)if(this.hasOwnProperty(e)&&this[e]!==void 0)switch(e){case"_shouldRender":t+=".shouldRender("+this.shouldRender()+")";break;case"_autoSize":t+=".autoSize("+this.autoSize()+")"}return t}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_64);var $i_90=$i_90||{REVISION:"52"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.startsWith=String.prototype.startsWith||function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=String.prototype.endsWith||function(e){var e=e+"",t=this.lastIndexOf(e);return(t>-1&&t)===this.length-e.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;t.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(t){var i=Date.now(),r=Math.max(0,16-(i-e)),n=window.setTimeout(function(){t(i+r)},r);return e=i+r,n}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),$i_90.FrontSide=0,$i_90.BackSide=1,$i_90.DoubleSide=2,$i_90.NoShading=0,$i_90.FlatShading=1,$i_90.SmoothShading=2,$i_90.NoColors=0,$i_90.FaceColors=1,$i_90.VertexColors=2,$i_90.NoBlending=0,$i_90.NormalBlending=1,$i_90.AdditiveBlending=2,$i_90.SubtractiveBlending=3,$i_90.MultiplyBlending=4,$i_90.CustomBlending=5,$i_90.AddEquation=100,$i_90.SubtractEquation=101,$i_90.ReverseSubtractEquation=102,$i_90.ZeroFactor=200,$i_90.OneFactor=201,$i_90.SrcColorFactor=202,$i_90.OneMinusSrcColorFactor=203,$i_90.SrcAlphaFactor=204,$i_90.OneMinusSrcAlphaFactor=205,$i_90.DstAlphaFactor=206,$i_90.OneMinusDstAlphaFactor=207,$i_90.DstColorFactor=208,$i_90.OneMinusDstColorFactor=209,$i_90.SrcAlphaSaturateFactor=210,$i_90.MultiplyOperation=0,$i_90.MixOperation=1,$i_90.UVMapping=function(){},$i_90.CubeReflectionMapping=function(){},$i_90.CubeRefractionMapping=function(){},$i_90.SphericalReflectionMapping=function(){},$i_90.SphericalRefractionMapping=function(){},$i_90.RepeatWrapping=1e3,$i_90.ClampToEdgeWrapping=1001,$i_90.MirroredRepeatWrapping=1002,$i_90.NearestFilter=1003,$i_90.NearestMipMapNearestFilter=1004,$i_90.NearestMipMapLinearFilter=1005,$i_90.LinearFilter=1006,$i_90.LinearMipMapNearestFilter=1007,$i_90.LinearMipMapLinearFilter=1008,$i_90.UnsignedByteType=1009,$i_90.ByteType=1010,$i_90.ShortType=1011,$i_90.UnsignedShortType=1012,$i_90.IntType=1013,$i_90.UnsignedIntType=1014,$i_90.FloatType=1015,$i_90.UnsignedShort4444Type=1016,$i_90.UnsignedShort5551Type=1017,$i_90.UnsignedShort565Type=1018,$i_90.AlphaFormat=1019,$i_90.RGBFormat=1020,$i_90.RGBAFormat=1021,$i_90.LuminanceFormat=1022,$i_90.LuminanceAlphaFormat=1023,$i_90.RGB_S3TC_DXT1_Format=2001,$i_90.RGBA_S3TC_DXT1_Format=2002,$i_90.RGBA_S3TC_DXT3_Format=2003,$i_90.RGBA_S3TC_DXT5_Format=2004,$i_90.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},$i_90.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now(),this.running=!0},$i_90.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},$i_90.Clock.prototype.getElapsedTime=function(){return this.elapsedTime+=this.getDelta()},$i_90.Clock.prototype.getDelta=function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e},$i_90.Color=function(e){return void 0!==e&&this.setHex(e),this},$i_90.Color.prototype={constructor:$i_90.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSV:function(e,t,i){var r,n,o;return 0===i?this.r=this.g=this.b=0:(r=Math.floor(6*e),n=6*e-r,e=i*(1-t),o=i*(1-t*n),t=i*(1-t*(1-n)),0===r?(this.r=i,this.g=t,this.b=e):1===r?(this.r=o,this.g=i,this.b=e):2===r?(this.r=e,this.g=i,this.b=t):3===r?(this.r=e,this.g=o,this.b=i):4===r?(this.r=t,this.g=e,this.b=i):5===r&&(this.r=i,this.g=e,this.b=o)),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},lerpSelf:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getContextStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},clone:function(){return(new $i_90.Color).setRGB(this.r,this.g,this.b)}},$i_90.Vector2=function(e,t){this.x=e||0,this.y=t||0},$i_90.Vector2.prototype={constructor:$i_90.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},isZero:function(e){return(void 0!==e?e:1e-4)>this.lengthSq()},clone:function(){return new $i_90.Vector2(this.x,this.y)}},$i_90.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},$i_90.Vector3.prototype={constructor:$i_90.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},divideSelf:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z
},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){var t=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-i*e.x,this},angleTo:function(e){return Math.acos(this.dot(e)/this.length()/e.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new $i_90.Vector3).sub(this,e).lengthSq()},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,n=r[0],o=r[4],a=r[8],s=r[1],h=r[5],l=r[9],c=r[2],u=r[6],r=r[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(i(a)),.99999>Math.abs(a)?(this.x=Math.atan2(-l,r),this.z=Math.atan2(-o,n)):(this.x=Math.atan2(u,h),this.z=0)):"YXZ"===t?(this.x=Math.asin(-i(l)),.99999>Math.abs(l)?(this.y=Math.atan2(a,r),this.z=Math.atan2(s,h)):(this.y=Math.atan2(-c,n),this.z=0)):"ZXY"===t?(this.x=Math.asin(i(u)),.99999>Math.abs(u)?(this.y=Math.atan2(-c,r),this.z=Math.atan2(-o,h)):(this.y=0,this.z=Math.atan2(s,n))):"ZYX"===t?(this.y=Math.asin(-i(c)),.99999>Math.abs(c)?(this.x=Math.atan2(u,r),this.z=Math.atan2(s,n)):(this.x=0,this.z=Math.atan2(-o,h))):"YZX"===t?(this.z=Math.asin(i(s)),.99999>Math.abs(s)?(this.x=Math.atan2(-l,h),this.y=Math.atan2(-c,n)):(this.x=0,this.y=Math.atan2(a,r))):"XZY"===t&&(this.z=Math.asin(-i(o)),.99999>Math.abs(o)?(this.x=Math.atan2(u,h),this.y=Math.atan2(a,n)):(this.x=Math.atan2(-l,r),this.y=0)),this},setEulerFromQuaternion:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,n=e.y*e.y,o=e.z*e.z,a=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),a-r-n+o),this.y=Math.asin(i(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a+r-n-o)):"YXZ"===t?(this.x=Math.asin(i(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a-r-n+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a-r+n-o)):"ZXY"===t?(this.x=Math.asin(i(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),a-r-n+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a-r+n-o)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),a-r-n+o),this.y=Math.asin(i(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a+r-n-o)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),a-r+n-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),a+r-n-o),this.z=Math.asin(i(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),a-r+n-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a+r-n-o),this.z=Math.asin(i(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=e,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},isZero:function(e){return(void 0!==e?e:1e-4)>this.lengthSq()},clone:function(){return new $i_90.Vector3(this.x,this.y,this.z)}},$i_90.Vector4=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},$i_90.Vector4.prototype={constructor:$i_90.Vector4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},clone:function(){return new $i_90.Vector4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,e=e.elements,n=e[0];r=e[4];var o=e[8],a=e[1],s=e[5],h=e[9];i=e[2],t=e[6];var l=e[10];return.01>Math.abs(r-a)&&.01>Math.abs(o-i)&&.01>Math.abs(h-t)?.1>Math.abs(r+a)&&.1>Math.abs(o+i)&&.1>Math.abs(h+t)&&.1>Math.abs(n+s+l-3)?(this.set(1,0,0,0),this):(e=Math.PI,n=(n+1)/2,s=(s+1)/2,l=(l+1)/2,r=(r+a)/4,o=(o+i)/4,h=(h+t)/4,n>s&&n>l?.01>n?(t=0,r=i=.707106781):(t=Math.sqrt(n),i=r/t,r=o/t):s>l?.01>s?(t=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),t=r/i,r=h/i):.01>l?(i=t=.707106781,r=0):(r=Math.sqrt(l),t=o/r,i=h/r),this.set(t,i,r,e),this):(e=Math.sqrt((t-h)*(t-h)+(o-i)*(o-i)+(a-r)*(a-r)),.001>Math.abs(e)&&(e=1),this.x=(t-h)/e,this.y=(o-i)/e,this.z=(a-r)/e,this.w=Math.acos((n+s+l-1)/2),this)}},$i_90.Matrix3=function(){this.elements=new Float32Array(9)},$i_90.Matrix3.prototype={constructor:$i_90.Matrix3,getInverse:function(e){var t=e.elements,e=t[10]*t[5]-t[6]*t[9],i=-t[10]*t[1]+t[2]*t[9],r=t[6]*t[1]-t[2]*t[5],n=-t[10]*t[4]+t[6]*t[8],o=t[10]*t[0]-t[2]*t[8],a=-t[6]*t[0]+t[2]*t[4],s=t[9]*t[4]-t[5]*t[8],h=-t[9]*t[0]+t[1]*t[8],l=t[5]*t[0]-t[1]*t[4],t=t[0]*e+t[1]*n+t[2]*s;0===t&&console.warn("Matrix3.getInverse(): determinant == 0");var t=1/t,c=this.elements;return c[0]=t*e,c[1]=t*i,c[2]=t*r,c[3]=t*n,c[4]=t*o,c[5]=t*a,c[6]=t*s,c[7]=t*h,c[8]=t*l,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},$i_90.Matrix4=function(e,t,i,r,n,o,a,s,h,l,c,u,d,f,p,m){this.elements=new Float32Array(16),this.set(void 0!==e?e:1,t||0,i||0,r||0,n||0,void 0!==o?o:1,a||0,s||0,h||0,l||0,void 0!==c?c:1,u||0,d||0,f||0,p||0,void 0!==m?m:1)},$i_90.Matrix4.prototype={constructor:$i_90.Matrix4,set:function(e,t,i,r,n,o,a,s,h,l,c,u,d,f,p,m){var E=this.elements;return E[0]=e,E[4]=t,E[8]=i,E[12]=r,E[1]=n,E[5]=o,E[9]=a,E[13]=s,E[2]=h,E[6]=l,E[10]=c,E[14]=u,E[3]=d,E[7]=f,E[11]=p,E[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},lookAt:function(e,t,i){var r=this.elements,n=$i_90.Matrix4.__v1,o=$i_90.Matrix4.__v2,a=$i_90.Matrix4.__v3;return a.sub(e,t).normalize(),0===a.length()&&(a.z=1),n.cross(i,a).normalize(),0===n.length()&&(a.x+=1e-4,n.cross(i,a).normalize()),o.cross(a,n),r[0]=n.x,r[4]=o.x,r[8]=a.x,r[1]=n.y,r[5]=o.y,r[9]=a.y,r[2]=n.z,r[6]=o.z,r[10]=a.z,this},multiply:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[4],s=i[8],h=i[12],l=i[1],c=i[5],u=i[9],d=i[13],f=i[2],p=i[6],m=i[10],E=i[14],g=i[3],v=i[7],y=i[11],i=i[15],_=r[0],T=r[4],x=r[8],R=r[12],b=r[1],w=r[5],H=r[9],S=r[13],M=r[2],C=r[6],A=r[10],P=r[14],L=r[3],I=r[7],U=r[11],r=r[15];return n[0]=o*_+a*b+s*M+h*L,n[4]=o*T+a*w+s*C+h*I,n[8]=o*x+a*H+s*A+h*U,n[12]=o*R+a*S+s*P+h*r,n[1]=l*_+c*b+u*M+d*L,n[5]=l*T+c*w+u*C+d*I,n[9]=l*x+c*H+u*A+d*U,n[13]=l*R+c*S+u*P+d*r,n[2]=f*_+p*b+m*M+E*L,n[6]=f*T+p*w+m*C+E*I,n[10]=f*x+p*H+m*A+E*U,n[14]=f*R+p*S+m*P+E*r,n[3]=g*_+v*b+y*M+i*L,n[7]=g*T+v*w+y*C+i*I,n[11]=g*x+v*H+y*A+i*U,n[15]=g*R+v*S+y*P+i*r,this},multiplySelf:function(e){return this.multiply(this,e)},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiply(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=1/(t[3]*i+t[7]*r+t[11]*n+t[15]);return e.x=(t[0]*i+t[4]*r+t[8]*n+t[12])*o,e.y=(t[1]*i+t[5]*r+t[9]*n+t[13])*o,e.z=(t[2]*i+t[6]*r+t[10]*n+t[14])*o,e},multiplyVector4:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=e.w;return e.x=t[0]*i+t[4]*r+t[8]*n+t[12]*o,e.y=t[1]*i+t[5]*r+t[9]*n+t[13]*o,e.z=t[2]*i+t[6]*r+t[10]*n+t[14]*o,e.w=t[3]*i+t[7]*r+t[11]*n+t[15]*o,e},multiplyVector3Array:function(e){for(var t=$i_90.Matrix4.__v1,i=0,r=e.length;r>i;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],this.multiplyVector3(t),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e},rotateAxis:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return e.x=i*t[0]+r*t[4]+n*t[8],e.y=i*t[1]+r*t[5]+n*t[9],e.z=i*t[2]+r*t[6]+n*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,i=new $i_90.Vector4;return i.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,i.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,i.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,i.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,i},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],a=e[5],s=e[9],h=e[13],l=e[2],c=e[6],u=e[10],d=e[14],f=e[3],p=e[7],m=e[11],e=e[15];return n*s*c*f-r*h*c*f-n*a*u*f+i*h*u*f+r*a*d*f-i*s*d*f-n*s*l*p+r*h*l*p+n*o*u*p-t*h*u*p-r*o*d*p+t*s*d*p+n*a*l*m-i*h*l*m-n*o*c*m+t*h*c*m+i*o*d*m-t*a*d*m-r*a*l*e+i*s*l*e+r*o*c*e-t*s*c*e-i*o*u*e+t*a*u*e},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=this.elements;return $i_90.Matrix4.__v1.set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return $i_90.Matrix4.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return $i_90.Matrix4.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return $i_90.Matrix4.__v1.set(e[8],e[9],e[10])},getInverse:function(e){var t=this.elements,i=e.elements,r=i[0],n=i[4],o=i[8],a=i[12],s=i[1],h=i[5],l=i[9],c=i[13],u=i[2],d=i[6],f=i[10],p=i[14],m=i[3],E=i[7],g=i[11],i=i[15];return t[0]=l*p*E-c*f*E+c*d*g-h*p*g-l*d*i+h*f*i,t[4]=a*f*E-o*p*E-a*d*g+n*p*g+o*d*i-n*f*i,t[8]=o*c*E-a*l*E+a*h*g-n*c*g-o*h*i+n*l*i,t[12]=a*l*d-o*c*d-a*h*f+n*c*f+o*h*p-n*l*p,t[1]=c*f*m-l*p*m-c*u*g+s*p*g+l*u*i-s*f*i,t[5]=o*p*m-a*f*m+a*u*g-r*p*g-o*u*i+r*f*i,t[9]=a*l*m-o*c*m-a*s*g+r*c*g+o*s*i-r*l*i,t[13]=o*c*u-a*l*u+a*s*f-r*c*f-o*s*p+r*l*p,t[2]=h*p*m-c*d*m+c*u*E-s*p*E-h*u*i+s*d*i,t[6]=a*d*m-n*p*m-a*u*E+r*p*E+n*u*i-r*d*i,t[10]=n*c*m-a*h*m+a*s*E-r*c*E-n*s*i+r*h*i,t[14]=a*h*u-n*c*u-a*s*d+r*c*d+n*s*p-r*h*p,t[3]=l*d*m-h*f*m-l*u*E+s*f*E+h*u*g-s*d*g,t[7]=n*f*m-o*d*m+o*u*E-r*f*E-n*u*g+r*d*g,t[11]=o*h*m-n*l*m-o*s*E+r*l*E+n*s*g-r*h*g,t[15]=n*l*u-o*h*u+o*s*d-r*l*d-n*s*f+r*h*f,this.multiplyScalar(1/e.determinant()),this},setRotationFromEuler:function(e,t){var i=this.elements,r=e.x,n=e.y,o=e.z,a=Math.cos(r),r=Math.sin(r),s=Math.cos(n),n=Math.sin(n),h=Math.cos(o),o=Math.sin(o);if(void 0===t||"XYZ"===t){var l=a*h,c=a*o,u=r*h,d=r*o;i[0]=s*h,i[4]=-s*o,i[8]=n,i[1]=c+u*n,i[5]=l-d*n,i[9]=-r*s,i[2]=d-l*n,i[6]=u+c*n,i[10]=a*s}else"YXZ"===t?(l=s*h,c=s*o,u=n*h,d=n*o,i[0]=l+d*r,i[4]=u*r-c,i[8]=a*n,i[1]=a*o,i[5]=a*h,i[9]=-r,i[2]=c*r-u,i[6]=d+l*r,i[10]=a*s):"ZXY"===t?(l=s*h,c=s*o,u=n*h,d=n*o,i[0]=l-d*r,i[4]=-a*o,i[8]=u+c*r,i[1]=c+u*r,i[5]=a*h,i[9]=d-l*r,i[2]=-a*n,i[6]=r,i[10]=a*s):"ZYX"===t?(l=a*h,c=a*o,u=r*h,d=r*o,i[0]=s*h,i[4]=u*n-c,i[8]=l*n+d,i[1]=s*o,i[5]=d*n+l,i[9]=c*n-u,i[2]=-n,i[6]=r*s,i[10]=a*s):"YZX"===t?(l=a*s,c=a*n,u=r*s,d=r*n,i[0]=s*h,i[4]=d-l*o,i[8]=u*o+c,i[1]=o,i[5]=a*h,i[9]=-r*h,i[2]=-n*h,i[6]=c*o+u,i[10]=l-d*o):"XZY"===t&&(l=a*s,c=a*n,u=r*s,d=r*n,i[0]=s*h,i[4]=-o,i[8]=n*h,i[1]=l*o+d,i[5]=a*h,i[9]=c*o-u,i[2]=u*o-c,i[6]=r*h,i[10]=d*o+l);return this},setRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=e.w,a=i+i,s=r+r,h=n+n,e=i*a,l=i*s,i=i*h,c=r*s,r=r*h,n=n*h,a=o*a,s=o*s,o=o*h;return t[0]=1-(c+n),t[4]=l-o,t[8]=i+s,t[1]=l+o,t[5]=1-(e+n),t[9]=r-a,t[2]=i-s,t[6]=r+a,t[10]=1-(e+c),this},compose:function(e,t,i){var r=this.elements,n=$i_90.Matrix4.__m1,o=$i_90.Matrix4.__m2;return n.identity(),n.setRotationFromQuaternion(t),o.makeScale(i.x,i.y,i.z),this.multiply(n,o),r[12]=e.x,r[13]=e.y,r[14]=e.z,this},decompose:function(e,t,i){var r=this.elements,n=$i_90.Matrix4.__v1,o=$i_90.Matrix4.__v2,a=$i_90.Matrix4.__v3;return n.set(r[0],r[1],r[2]),o.set(r[4],r[5],r[6]),a.set(r[8],r[9],r[10]),e=e instanceof $i_90.Vector3?e:new $i_90.Vector3,t=t instanceof $i_90.Quaternion?t:new $i_90.Quaternion,i=i instanceof $i_90.Vector3?i:new $i_90.Vector3,i.x=n.length(),i.y=o.length(),i.z=a.length(),e.x=r[12],e.y=r[13],e.z=r[14],r=$i_90.Matrix4.__m1,r.copy(this),r.elements[0]/=i.x,r.elements[1]/=i.x,r.elements[2]/=i.x,r.elements[4]/=i.y,r.elements[5]/=i.y,r.elements[6]/=i.y,r.elements[8]/=i.z,r.elements[9]/=i.z,r.elements[10]/=i.z,t.setFromRotationMatrix(r),[e,t,i]},extractPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(e){var t=this.elements,e=e.elements,i=$i_90.Matrix4.__v1,r=1/i.set(e[0],e[1],e[2]).length(),n=1/i.set(e[4],e[5],e[6]).length(),i=1/i.set(e[8],e[9],e[10]).length();return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,this},translate:function(e){var t=this.elements,i=e.x,r=e.y,e=e.z;return t[12]=t[0]*i+t[4]*r+t[8]*e+t[12],t[13]=t[1]*i+t[5]*r+t[9]*e+t[13],t[14]=t[2]*i+t[6]*r+t[10]*e+t[14],t[15]=t[3]*i+t[7]*r+t[11]*e+t[15],this},rotateX:function(e){var t=this.elements,i=t[4],r=t[5],n=t[6],o=t[7],a=t[8],s=t[9],h=t[10],l=t[11],c=Math.cos(e),e=Math.sin(e);return t[4]=c*i+e*a,t[5]=c*r+e*s,t[6]=c*n+e*h,t[7]=c*o+e*l,t[8]=c*a-e*i,t[9]=c*s-e*r,t[10]=c*h-e*n,t[11]=c*l-e*o,this},rotateY:function(e){var t=this.elements,i=t[0],r=t[1],n=t[2],o=t[3],a=t[8],s=t[9],h=t[10],l=t[11],c=Math.cos(e),e=Math.sin(e);return t[0]=c*i-e*a,t[1]=c*r-e*s,t[2]=c*n-e*h,t[3]=c*o-e*l,t[8]=c*a+e*i,t[9]=c*s+e*r,t[10]=c*h+e*n,t[11]=c*l+e*o,this},rotateZ:function(e){var t=this.elements,i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],s=t[5],h=t[6],l=t[7],c=Math.cos(e),e=Math.sin(e);return t[0]=c*i+e*a,t[1]=c*r+e*s,t[2]=c*n+e*h,t[3]=c*o+e*l,t[4]=c*a-e*i,t[5]=c*s-e*r,t[6]=c*h-e*n,t[7]=c*l-e*o,this},rotateByAxis:function(e,t){var i=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var r=e.x,n=e.y,o=e.z,a=Math.sqrt(r*r+n*n+o*o),r=r/a,n=n/a,o=o/a,a=r*r,s=n*n,h=o*o,l=Math.cos(t),c=Math.sin(t),u=1-l,d=r*n*u,f=r*o*u,u=n*o*u,r=r*c,p=n*c,c=o*c,o=a+(1-a)*l,a=d+c,n=f-p,d=d-c,s=s+(1-s)*l,c=u+r,f=f+p,u=u-r,h=h+(1-h)*l,l=i[0],r=i[1],p=i[2],m=i[3],E=i[4],g=i[5],v=i[6],y=i[7],_=i[8],T=i[9],x=i[10],R=i[11];return i[0]=o*l+a*E+n*_,i[1]=o*r+a*g+n*T,i[2]=o*p+a*v+n*x,i[3]=o*m+a*y+n*R,i[4]=d*l+s*E+c*_,i[5]=d*r+s*g+c*T,i[6]=d*p+s*v+c*x,i[7]=d*m+s*y+c*R,i[8]=f*l+u*E+h*_,i[9]=f*r+u*g+h*T,i[10]=f*p+u*v+h*x,i[11]=f*m+u*y+h*R,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,e=e.z;return t[0]*=i,t[4]*=r,t[8]*=e,t[1]*=i,t[5]*=r,t[9]*=e,t[2]*=i,t[6]*=r,t[10]*=e,t[3]*=i,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,h=n*o,l=n*a;return this.set(h*o+i,h*a-r*s,h*s+r*a,0,h*a+r*s,l*a+i,l*s-r*o,0,h*s-r*a,l*s+r*o,n*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeFrustum:function(e,t,i,r,n,o){var a=this.elements;return a[0]=2*n/(t-e),a[4]=0,a[8]=(t+e)/(t-e),a[12]=0,a[1]=0,a[5]=2*n/(r-i),a[9]=(r+i)/(r-i),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+n)/(o-n),a[14]=-2*o*n/(o-n),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,i,r){var e=i*Math.tan(e*Math.PI/360),n=-e;return this.makeFrustum(n*t,e*t,n,e,i,r)},makeOrthographic:function(e,t,i,r,n,o){var a=this.elements,s=t-e,h=i-r,l=o-n;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-((t+e)/s),a[1]=0,a[5]=2/h,a[9]=0,a[13]=-((i+r)/h),a[2]=0,a[6]=0,a[10]=-2/l,a[14]=-((o+n)/l),a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},clone:function(){var e=this.elements;return new $i_90.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},$i_90.Matrix4.__v1=new $i_90.Vector3,$i_90.Matrix4.__v2=new $i_90.Vector3,$i_90.Matrix4.__v3=new $i_90.Vector3,$i_90.Matrix4.__m1=new $i_90.Matrix4,$i_90.Matrix4.__m2=new $i_90.Matrix4,$i_90.EventTarget=function(){var e={};this.addEventListener=function(t,i){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(i)&&e[t].push(i)},this.dispatchEvent=function(t){for(var i in e[t.type])e[t.type][i](t)},this.removeEventListener=function(t,i){var r=e[t].indexOf(i);-1!==r&&e[t].splice(r,1)}},$i_90.Frustum=function(){this.planes=[new $i_90.Vector4,new $i_90.Vector4,new $i_90.Vector4,new $i_90.Vector4,new $i_90.Vector4,new $i_90.Vector4]},$i_90.Frustum.prototype.setFromMatrix=function(e){var t=this.planes,i=e.elements,e=i[0],r=i[1],n=i[2],o=i[3],a=i[4],s=i[5],h=i[6],l=i[7],c=i[8],u=i[9],d=i[10],f=i[11],p=i[12],m=i[13],E=i[14],i=i[15];for(t[0].set(o-e,l-a,f-c,i-p),t[1].set(o+e,l+a,f+c,i+p),t[2].set(o+r,l+s,f+u,i+m),t[3].set(o-r,l-s,f-u,i-m),t[4].set(o-n,l-h,f-d,i-E),t[5].set(o+n,l+h,f+d,i+E),r=0;6>r;r++)e=t[r],e.divideScalar(Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z))},$i_90.Frustum.prototype.contains=function(e){for(var t=0,i=this.planes,t=e.matrixWorld,r=t.elements,e=-e.geometry.boundingSphere.radius*t.getMaxScaleOnAxis(),n=0;6>n;n++)if(t=i[n].x*r[12]+i[n].y*r[13]+i[n].z*r[14]+i[n].w,e>=t)return!1;return!0},$i_90.Frustum.__v1=new $i_90.Vector3,function(e){e.Ray=function(t,i,r,n){this.origin=t||new e.Vector3,this.direction=i||new e.Vector3,this.near=r||0,this.far=n||1/0};var t=new e.Vector3,i=new e.Vector3,r=new e.Vector3,n=new e.Vector3,o=new e.Vector3,a=new e.Vector3,s=new e.Matrix4,h=function(e,t){return e.distance-t.distance},l=new e.Vector3,c=new e.Vector3,u=new e.Vector3,d=function(e,t,i){l.sub(i,e);var r=l.dot(t),e=c.add(e,u.copy(t).multiplyScalar(r));return i.distanceTo(e)},f=function(e,t,i,r){l.sub(r,t),c.sub(i,t),u.sub(e,t);var e=l.dot(l),t=l.dot(c),i=l.dot(u),n=c.dot(c),r=c.dot(u),o=1/(e*n-t*t),n=(n*i-t*r)*o,e=(e*r-t*i)*o;return n>=0&&e>=0&&1>n+e},p=function(h,l,c){var u,p;if(h instanceof e.Particle){if(u=d(l.origin,l.direction,h.matrixWorld.getPosition()),u>h.scale.x)return c;p={distance:u,point:h.position,face:null,object:h},c.push(p)}else if(h instanceof e.Mesh){var m=h.geometry.boundingSphere.radius*h.matrixWorld.getMaxScaleOnAxis();if(u=d(l.origin,l.direction,h.matrixWorld.getPosition()),u>m)return c;var E,g,v,y,_,T=h.geometry,x=T.vertices;v=h.geometry.materials,y=h.material instanceof e.MeshFaceMaterial;var R,b=l.precision;for(h.matrixRotationWorld.extractRotation(h.matrixWorld),t.copy(l.origin),s.getInverse(h.matrixWorld),i.copy(t),s.multiplyVector3(i),r.copy(l.direction),s.rotateAxis(r).normalize(),m=0,E=T.faces.length;E>m;m++)p=T.faces[m],u=!0===y?v[p.materialIndex]:h.material,void 0===u||(_=u.side,n.sub(p.centroid,i),o=p.normal,u=r.dot(o),b>Math.abs(u)||(g=o.dot(n)/u,0>g||_!==e.DoubleSide&&(_===e.FrontSide?u>=0:0>=u)))||(a.add(i,r.multiplyScalar(g)),p instanceof e.Face3?(u=x[p.a],g=x[p.b],_=x[p.c],f(a,u,g,_)&&(g=h.matrixWorld.multiplyVector3(a.clone()),u=t.distanceTo(g),l.near>u||u>l.far||(p={distance:u,point:g,face:p,faceIndex:m,object:h},c.push(p)))):p instanceof e.Face4&&(u=x[p.a],g=x[p.b],_=x[p.c],R=x[p.d],f(a,u,g,R)||f(a,g,_,R))&&(g=h.matrixWorld.multiplyVector3(a.clone()),u=t.distanceTo(g),l.near>u||u>l.far||(p={distance:u,point:g,face:p,faceIndex:m,object:h},c.push(p))))}},m=function(e,t,i){for(var e=e.getDescendants(),r=0,n=e.length;n>r;r++)p(e[r],t,i)};e.Ray.prototype.precision=1e-4,e.Ray.prototype.set=function(e,t){this.origin=e,this.direction=t},e.Ray.prototype.intersectObject=function(e,t){var i=[];return!0===t&&m(e,this,i),p(e,this,i),i.sort(h),i},e.Ray.prototype.intersectObjects=function(e,t){for(var i=[],r=0,n=e.length;n>r;r++)p(e[r],this,i),!0===t&&m(e[r],this,i);return i.sort(h),i}}($i_90),$i_90.Rectangle=function(){function e(){o=r-t,a=n-i}var t=0,i=0,r=0,n=0,o=0,a=0,s=!0;this.getX=function(){return t},this.getY=function(){return i},this.getWidth=function(){return o},this.getHeight=function(){return a},this.getLeft=function(){return t},this.getTop=function(){return i},this.getRight=function(){return r},this.getBottom=function(){return n},this.set=function(o,a,h,l){s=!1,t=o,i=a,r=h,n=l,e()},this.addPoint=function(o,a){!0===s?(s=!1,t=o,i=a,r=o,n=a):(t=o>t?t:o,i=a>i?i:a,r=r>o?r:o,n=n>a?n:a),e()},this.add3Points=function(o,a,h,l,c,u){!0===s?(s=!1,t=h>o?c>o?o:c:c>h?h:c,i=l>a?u>a?a:u:u>l?l:u,r=o>h?o>c?o:c:h>c?h:c,n=a>l?a>u?a:u:l>u?l:u):(t=h>o?c>o?t>o?o:t:t>c?c:t:c>h?t>h?h:t:t>c?c:t,i=l>a?u>a?i>a?a:i:i>u?u:i:u>l?i>l?l:i:i>u?u:i,r=o>h?o>c?o>r?o:r:c>r?c:r:h>c?h>r?h:r:c>r?c:r,n=a>l?a>u?a>n?a:n:u>n?u:n:l>u?l>n?l:n:u>n?u:n),e()},this.addRectangle=function(o){!0===s?(s=!1,t=o.getLeft(),i=o.getTop(),r=o.getRight(),n=o.getBottom()):(t=o.getLeft()>t?t:o.getLeft(),i=o.getTop()>i?i:o.getTop(),r=r>o.getRight()?r:o.getRight(),n=n>o.getBottom()?n:o.getBottom()),e()},this.inflate=function(o){t-=o,i-=o,r+=o,n+=o,e()},this.minSelf=function(o){t=t>o.getLeft()?t:o.getLeft(),i=i>o.getTop()?i:o.getTop(),r=o.getRight()>r?r:o.getRight(),n=o.getBottom()>n?n:o.getBottom(),e()},this.intersects=function(e){return e.getLeft()>r||t>e.getRight()||e.getTop()>n||i>e.getBottom()?!1:!0},this.empty=function(){s=!0,n=r=i=t=0,e()},this.isEmpty=function(){return s}},$i_90.Math={clamp:function(e,t,i){return t>e?t:e>i?i:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0}},$i_90.Object3D=function(){$i_90.Object3DLibrary.push(this),this.id=$i_90.Object3DIdCount++,this.name="",this.properties={},this.parent=void 0,this.children=[],this.up=new $i_90.Vector3(0,1,0),this.position=new $i_90.Vector3,this.rotation=new $i_90.Vector3,this.eulerOrder=$i_90.Object3D.defaultEulerOrder,this.scale=new $i_90.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new $i_90.Matrix4,this.matrixWorld=new $i_90.Matrix4,this.matrixRotationWorld=new $i_90.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new $i_90.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new $i_90.Vector3},$i_90.Object3D.prototype={constructor:$i_90.Object3D,applyMatrix:function(e){this.matrix.multiply(e,this.matrix),this.scale.getScaleFromMatrix(this.matrix),e=(new $i_90.Matrix4).extractRotation(this.matrix),this.rotation.setEulerFromRotationMatrix(e,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},localToWorld:function(e){return this.matrixWorld.multiplyVector3(e)},worldToLocal:function(e){return $i_90.Object3D.__m1.getInverse(this.matrixWorld).multiplyVector3(e)},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},add:function(e){if(e===this)console.warn("$i_90.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof $i_90.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof $i_90.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){for(e.parent=void 0,this.children.splice(t,1),t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof $i_90.Scene&&t.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,i=this.children.length;i>t;t++)this.children[t].traverse(e)},getChildByName:function(e,t){for(var i=0,r=this.children.length;r>i;i++){var n=this.children[i];if(n.name===e||!0===t&&(n=n.getChildByName(e,t),void 0!==n))return n}},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;i>t;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.setPosition(this.position),!1===this.useQuaternion?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===e)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(e){return void 0===e&&(e=new $i_90.Object3D),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof $i_90.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixRotationWorld.copy(this.matrixRotationWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.boundRadius=this.boundRadius,e.boundRadiusScale=this.boundRadiusScale,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e},deallocate:function(){var e=$i_90.Object3DLibrary.indexOf(this);-1!==e&&$i_90.Object3DLibrary.splice(e,1)}},$i_90.Object3D.__m1=new $i_90.Matrix4,$i_90.Object3D.defaultEulerOrder="XYZ",$i_90.Object3DIdCount=0,$i_90.Object3DLibrary=[],$i_90.Projector=function(){function e(){if(o===E){var e=new $i_90.RenderableObject;return m.push(e),E++,o++,e}return m[o++]}function t(){if(s===v){var e=new $i_90.RenderableVertex;return g.push(e),v++,s++,e}return g[s++]}function i(e,t){return t.z-e.z}function r(e,t){var i=0,r=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return 0>n||0>o||0>a||0>s?0>n&&0>o||0>a&&0>s?!1:(0>n?i=Math.max(i,n/(n-o)):0>o&&(r=Math.min(r,n/(n-o))),0>a?i=Math.max(i,a/(a-s)):0>s&&(r=Math.min(r,a/(a-s))),i>r?!1:(e.lerpSelf(t,i),t.lerpSelf(e,1-r),!0)):!0}var n,o,a,s,h,l,c,u,d,f,p,m=[],E=0,g=[],v=0,y=[],_=0,T=[],x=0,R=[],b=0,w=[],H=0,S={objects:[],sprites:[],lights:[],elements:[]},M=new $i_90.Vector3,C=new $i_90.Vector4,A=new $i_90.Matrix4,P=new $i_90.Matrix4,L=new $i_90.Frustum,I=new $i_90.Vector4,U=new $i_90.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),A.multiply(t.projectionMatrix,t.matrixWorldInverse),A.multiplyVector3(e),e},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),A.multiply(t.matrixWorld,t.projectionMatrixInverse),A.multiplyVector3(e),e},this.pickingRay=function(e,t){var i;return e.z=-1,i=new $i_90.Vector3(e.x,e.y,1),this.unprojectVector(e,t),this.unprojectVector(i,t),i.subSelf(e).normalize(),new $i_90.Ray(e,i)},this.projectScene=function(m,E,v,D){var F,z,B,V,N,O,k,W,G,j,X,Y,q,K,Z,Q,J=E.near,$=E.far,et=!1;p=d=c=l=0,S.elements.length=0,m.updateMatrixWorld(),void 0===E.parent&&E.updateMatrixWorld(),E.matrixWorldInverse.getInverse(E.matrixWorld),A.multiply(E.projectionMatrix,E.matrixWorldInverse),L.setFromMatrix(A),o=0,S.objects.length=0,S.sprites.length=0,S.lights.length=0;var tt=function(t){for(var i=0,r=t.children.length;r>i;i++){var o=t.children[i];!1!==o.visible&&(o instanceof $i_90.Light?S.lights.push(o):o instanceof $i_90.Mesh||o instanceof $i_90.Line?(!1===o.frustumCulled||!0===L.contains(o))&&(n=e(),n.object=o,null!==o.renderDepth?n.z=o.renderDepth:(M.copy(o.matrixWorld.getPosition()),A.multiplyVector3(M),n.z=M.z),S.objects.push(n)):o instanceof $i_90.Sprite||o instanceof $i_90.Particle?(n=e(),n.object=o,null!==o.renderDepth?n.z=o.renderDepth:(M.copy(o.matrixWorld.getPosition()),A.multiplyVector3(M),n.z=M.z),S.sprites.push(n)):(n=e(),n.object=o,null!==o.renderDepth?n.z=o.renderDepth:(M.copy(o.matrixWorld.getPosition()),A.multiplyVector3(M),n.z=M.z),S.objects.push(n)),tt(o))}};for(tt(m),!0===v&&S.objects.sort(i),m=0,v=S.objects.length;v>m;m++)if(W=S.objects[m].object,G=W.matrixWorld,s=0,W instanceof $i_90.Mesh){for(j=W.geometry,X=W.geometry.materials,B=j.vertices,Y=j.faces,K=j.faceVertexUvs,j=W.matrixRotationWorld.extractRotation(G),Z=W.material instanceof $i_90.MeshFaceMaterial,F=0,z=B.length;z>F;F++)a=t(),a.positionWorld.copy(B[F]),G.multiplyVector3(a.positionWorld),a.positionScreen.copy(a.positionWorld),A.multiplyVector4(a.positionScreen),a.positionScreen.x/=a.positionScreen.w,a.positionScreen.y/=a.positionScreen.w,a.visible=a.positionScreen.z>J&&$>a.positionScreen.z;for(B=0,F=Y.length;F>B;B++)if(z=Y[B],Q=!0===Z?X[z.materialIndex]:W.material,void 0!==Q){if(O=Q.side,z instanceof $i_90.Face3){if(V=g[z.a],N=g[z.b],k=g[z.c],!0!==V.visible||!0!==N.visible||!0!==k.visible)continue;if(et=0>(k.positionScreen.x-V.positionScreen.x)*(N.positionScreen.y-V.positionScreen.y)-(k.positionScreen.y-V.positionScreen.y)*(N.positionScreen.x-V.positionScreen.x),O!==$i_90.DoubleSide&&et!==(O===$i_90.FrontSide))continue;l===_?(q=new $i_90.RenderableFace3,y.push(q),_++,l++,h=q):h=y[l++],h.v1.copy(V),h.v2.copy(N),h.v3.copy(k)
}else if(z instanceof $i_90.Face4){if(V=g[z.a],N=g[z.b],k=g[z.c],q=g[z.d],!0!==V.visible||!0!==N.visible||!0!==k.visible||!0!==q.visible)continue;if(et=0>(q.positionScreen.x-V.positionScreen.x)*(N.positionScreen.y-V.positionScreen.y)-(q.positionScreen.y-V.positionScreen.y)*(N.positionScreen.x-V.positionScreen.x)||0>(N.positionScreen.x-k.positionScreen.x)*(q.positionScreen.y-k.positionScreen.y)-(N.positionScreen.y-k.positionScreen.y)*(q.positionScreen.x-k.positionScreen.x),O!==$i_90.DoubleSide&&et!==(O===$i_90.FrontSide))continue;if(c===x){var it=new $i_90.RenderableFace4;T.push(it),x++,c++,h=it}else h=T[c++];h.v1.copy(V),h.v2.copy(N),h.v3.copy(k),h.v4.copy(q)}for(h.normalWorld.copy(z.normal),!1===et&&(O===$i_90.BackSide||O===$i_90.DoubleSide)&&h.normalWorld.negate(),j.multiplyVector3(h.normalWorld),h.centroidWorld.copy(z.centroid),G.multiplyVector3(h.centroidWorld),h.centroidScreen.copy(h.centroidWorld),A.multiplyVector3(h.centroidScreen),k=z.vertexNormals,V=0,N=k.length;N>V;V++)q=h.vertexNormalsWorld[V],q.copy(k[V]),!1===et&&(O===$i_90.BackSide||O===$i_90.DoubleSide)&&q.negate(),j.multiplyVector3(q);for(h.vertexNormalsLength=k.length,V=0,N=K.length;N>V;V++)if(q=K[V][B],void 0!==q)for(O=0,k=q.length;k>O;O++)h.uvs[V][O]=q[O];h.color=z.color,h.material=Q,h.z=h.centroidScreen.z,S.elements.push(h)}}else if(W instanceof $i_90.Line)for(P.multiply(A,G),B=W.geometry.vertices,V=t(),V.positionScreen.copy(B[0]),P.multiplyVector4(V.positionScreen),G=W.type===$i_90.LinePieces?2:1,F=1,z=B.length;z>F;F++)V=t(),V.positionScreen.copy(B[F]),P.multiplyVector4(V.positionScreen),(F+1)%G>0||(N=g[s-2],I.copy(V.positionScreen),U.copy(N.positionScreen),!0===r(I,U)&&(I.multiplyScalar(1/I.w),U.multiplyScalar(1/U.w),d===b?(X=new $i_90.RenderableLine,R.push(X),b++,d++,u=X):u=R[d++],u.v1.positionScreen.copy(I),u.v2.positionScreen.copy(U),u.z=Math.max(I.z,U.z),u.material=W.material,S.elements.push(u)));for(m=0,v=S.sprites.length;v>m;m++)W=S.sprites[m].object,G=W.matrixWorld,W instanceof $i_90.Particle&&(C.set(G.elements[12],G.elements[13],G.elements[14],1),A.multiplyVector4(C),C.z/=C.w,C.z>0&&1>C.z&&(p===H?(J=new $i_90.RenderableParticle,w.push(J),H++,p++,f=J):f=w[p++],f.object=W,f.x=C.x/C.w,f.y=C.y/C.w,f.z=C.z,f.rotation=W.rotation.z,f.scale.x=W.scale.x*Math.abs(f.x-(C.x+E.projectionMatrix.elements[0])/(C.w+E.projectionMatrix.elements[12])),f.scale.y=W.scale.y*Math.abs(f.y-(C.y+E.projectionMatrix.elements[5])/(C.w+E.projectionMatrix.elements[13])),f.material=W.material,S.elements.push(f)));return!0===D&&S.elements.sort(i),S}},$i_90.Quaternion=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},$i_90.Quaternion.prototype={constructor:$i_90.Quaternion,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var i=Math.cos(e.x/2),r=Math.cos(e.y/2),n=Math.cos(e.z/2),o=Math.sin(e.x/2),a=Math.sin(e.y/2),s=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=o*r*n+i*a*s,this.y=i*a*n-o*r*s,this.z=i*r*s+o*a*n,this.w=i*r*n-o*a*s):"YXZ"===t?(this.x=o*r*n+i*a*s,this.y=i*a*n-o*r*s,this.z=i*r*s-o*a*n,this.w=i*r*n+o*a*s):"ZXY"===t?(this.x=o*r*n-i*a*s,this.y=i*a*n+o*r*s,this.z=i*r*s+o*a*n,this.w=i*r*n-o*a*s):"ZYX"===t?(this.x=o*r*n-i*a*s,this.y=i*a*n+o*r*s,this.z=i*r*s-o*a*n,this.w=i*r*n+o*a*s):"YZX"===t?(this.x=o*r*n+i*a*s,this.y=i*a*n+o*r*s,this.z=i*r*s-o*a*n,this.w=i*r*n-o*a*s):"XZY"===t&&(this.x=o*r*n-i*a*s,this.y=i*a*n-o*r*s,this.z=i*r*s+o*a*n,this.w=i*r*n+o*a*s),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0],e=t[4],r=t[8],n=t[1],o=t[5],a=t[9],s=t[2],h=t[6],t=t[10],l=i+o+t;return l>0?(i=.5/Math.sqrt(l+1),this.w=.25/i,this.x=(h-a)*i,this.y=(r-s)*i,this.z=(n-e)*i):i>o&&i>t?(i=2*Math.sqrt(1+i-o-t),this.w=(h-a)/i,this.x=.25*i,this.y=(e+n)/i,this.z=(r+s)/i):o>t?(i=2*Math.sqrt(1+o-i-t),this.w=(r-s)/i,this.x=(e+n)/i,this.y=.25*i,this.z=(a+h)/i):(i=2*Math.sqrt(1+t-i-o),this.w=(n-e)/i,this.x=(r+s)/i,this.y=(a+h)/i,this.z=.25*i),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?this.w=this.z=this.y=this.x=0:(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiply:function(e,t){var i=e.x,r=e.y,n=e.z,o=e.w,a=t.x,s=t.y,h=t.z,l=t.w;return this.x=i*l+r*h-n*s+o*a,this.y=-i*h+r*l+n*a+o*s,this.z=i*s-r*a+n*l+o*h,this.w=-i*a-r*s-n*h+o*l,this},multiplySelf:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.x,a=e.y,s=e.z,e=e.w;return this.x=t*e+n*o+i*s-r*a,this.y=i*e+n*a+r*o-t*s,this.z=r*e+n*s+t*a-i*o,this.w=n*e-t*o-i*a-r*s,this},multiplyVector3:function(e,t){t||(t=e);var i=e.x,r=e.y,n=e.z,o=this.x,a=this.y,s=this.z,h=this.w,l=h*i+a*n-s*r,c=h*r+s*i-o*n,u=h*n+o*r-a*i,i=-o*i-a*r-s*n;return t.x=l*h+i*-o+c*-s-u*-a,t.y=c*h+i*-a+u*-o-l*-s,t.z=u*h+i*-s+l*-a-c*-o,t},slerpSelf:function(e,t){var i=this.x,r=this.y,n=this.z,o=this.w,a=o*e.w+i*e.x+r*e.y+n*e.z;if(0>a?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=o,this.x=i,this.y=r,this.z=n,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);return.001>Math.abs(h)?(this.w=.5*(o+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(n+this.z),this):(a=Math.sin((1-t)*s)/h,s=Math.sin(t*s)/h,this.w=o*a+this.w*s,this.x=i*a+this.x*s,this.y=r*a+this.y*s,this.z=n*a+this.z*s,this)},clone:function(){return new $i_90.Quaternion(this.x,this.y,this.z,this.w)}},$i_90.Quaternion.slerp=function(e,t,i,r){var n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(0>n?(i.w=-t.w,i.x=-t.x,i.y=-t.y,i.z=-t.z,n=-n):i.copy(t),Math.abs(n)>=1)return i.w=e.w,i.x=e.x,i.y=e.y,i.z=e.z,i;var t=Math.acos(n),o=Math.sqrt(1-n*n);return.001>Math.abs(o)?(i.w=.5*(e.w+i.w),i.x=.5*(e.x+i.x),i.y=.5*(e.y+i.y),i.z=.5*(e.z+i.z),i):(n=Math.sin((1-r)*t)/o,r=Math.sin(r*t)/o,i.w=e.w*n+i.w*r,i.x=e.x*n+i.x*r,i.y=e.y*n+i.y*r,i.z=e.z*n+i.z*r,i)},$i_90.Vertex=function(e){return console.warn("$i_90.Vertex has been DEPRECATED. Use $i_90.Vector3 instead."),e},$i_90.Face3=function(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r instanceof $i_90.Vector3?r:new $i_90.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=n instanceof $i_90.Color?n:new $i_90.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materialIndex=o,this.centroid=new $i_90.Vector3},$i_90.Face3.prototype={constructor:$i_90.Face3,clone:function(){var e=new $i_90.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;i>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;i>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;i>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},$i_90.Face4=function(e,t,i,r,n,o,a){this.a=e,this.b=t,this.c=i,this.d=r,this.normal=n instanceof $i_90.Vector3?n:new $i_90.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=o instanceof $i_90.Color?o:new $i_90.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=a,this.centroid=new $i_90.Vector3},$i_90.Face4.prototype={constructor:$i_90.Face4,clone:function(){var e=new $i_90.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;i>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;i>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;i>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},$i_90.UV=function(e,t){this.u=e||0,this.v=t||0},$i_90.UV.prototype={constructor:$i_90.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.u=e.u,this.v=e.v,this},lerpSelf:function(e,t){return this.u+=(e.u-this.u)*t,this.v+=(e.v-this.v)*t,this},clone:function(){return new $i_90.UV(this.u,this.v)}},$i_90.Geometry=function(){$i_90.GeometryLibrary.push(this),this.id=$i_90.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},$i_90.Geometry.prototype={constructor:$i_90.Geometry,applyMatrix:function(e){var t=new $i_90.Matrix4;t.extractRotation(e);for(var i=0,r=this.vertices.length;r>i;i++)e.multiplyVector3(this.vertices[i]);for(i=0,r=this.faces.length;r>i;i++){var n=this.faces[i];t.multiplyVector3(n.normal);for(var o=0,a=n.vertexNormals.length;a>o;o++)t.multiplyVector3(n.vertexNormals[o]);e.multiplyVector3(n.centroid)}},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i.centroid.set(0,0,0),i instanceof $i_90.Face3?(i.centroid.addSelf(this.vertices[i.a]),i.centroid.addSelf(this.vertices[i.b]),i.centroid.addSelf(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof $i_90.Face4&&(i.centroid.addSelf(this.vertices[i.a]),i.centroid.addSelf(this.vertices[i.b]),i.centroid.addSelf(this.vertices[i.c]),i.centroid.addSelf(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,i,r,n,o,a=new $i_90.Vector3,s=new $i_90.Vector3;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],r=this.vertices[i.a],n=this.vertices[i.b],o=this.vertices[i.c],a.sub(o,n),s.sub(r,n),a.crossSelf(s),a.isZero()||a.normalize(),i.normal.copy(a)},computeVertexNormals:function(){var e,t,i,r;if(void 0===this.__tmpVertices){for(r=this.__tmpVertices=Array(this.vertices.length),e=0,t=this.vertices.length;t>e;e++)r[e]=new $i_90.Vector3;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i instanceof $i_90.Face3?i.vertexNormals=[new $i_90.Vector3,new $i_90.Vector3,new $i_90.Vector3]:i instanceof $i_90.Face4&&(i.vertexNormals=[new $i_90.Vector3,new $i_90.Vector3,new $i_90.Vector3,new $i_90.Vector3])}else for(r=this.__tmpVertices,e=0,t=this.vertices.length;t>e;e++)r[e].set(0,0,0);for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i instanceof $i_90.Face3?(r[i.a].addSelf(i.normal),r[i.b].addSelf(i.normal),r[i.c].addSelf(i.normal)):i instanceof $i_90.Face4&&(r[i.a].addSelf(i.normal),r[i.b].addSelf(i.normal),r[i.c].addSelf(i.normal),r[i.d].addSelf(i.normal));for(e=0,t=this.vertices.length;t>e;e++)r[e].normalize();for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i instanceof $i_90.Face3?(i.vertexNormals[0].copy(r[i.a]),i.vertexNormals[1].copy(r[i.b]),i.vertexNormals[2].copy(r[i.c])):i instanceof $i_90.Face4&&(i.vertexNormals[0].copy(r[i.a]),i.vertexNormals[1].copy(r[i.b]),i.vertexNormals[2].copy(r[i.c]),i.vertexNormals[3].copy(r[i.d]))},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;r>i;i++)for(n=this.faces[i],n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;t>e;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new $i_90.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a,s,h=this.morphNormals[e].faceNormals,l=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;r>i;i++)n=this.faces[i],a=new $i_90.Vector3,s=n instanceof $i_90.Face3?{a:new $i_90.Vector3,b:new $i_90.Vector3,c:new $i_90.Vector3}:{a:new $i_90.Vector3,b:new $i_90.Vector3,c:new $i_90.Vector3,d:new $i_90.Vector3},h.push(a),l.push(s)}for(h=this.morphNormals[e],o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,r=this.faces.length;r>i;i++)n=this.faces[i],a=h.faceNormals[i],s=h.vertexNormals[i],a.copy(n.normal),n instanceof $i_90.Face3?(s.a.copy(n.vertexNormals[0]),s.b.copy(n.vertexNormals[1]),s.c.copy(n.vertexNormals[2])):(s.a.copy(n.vertexNormals[0]),s.b.copy(n.vertexNormals[1]),s.c.copy(n.vertexNormals[2]),s.d.copy(n.vertexNormals[3]))}for(i=0,r=this.faces.length;r>i;i++)n=this.faces[i],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){function e(e,t,i,r,n,o,b){s=e.vertices[t],h=e.vertices[i],l=e.vertices[r],c=a[n],u=a[o],d=a[b],f=h.x-s.x,p=l.x-s.x,m=h.y-s.y,E=l.y-s.y,g=h.z-s.z,v=l.z-s.z,y=u.u-c.u,_=d.u-c.u,T=u.v-c.v,x=d.v-c.v,R=1/(y*x-_*T),S.set((x*f-T*p)*R,(x*m-T*E)*R,(x*g-T*v)*R),M.set((y*p-_*f)*R,(y*E-_*m)*R,(y*v-_*g)*R),w[t].addSelf(S),w[i].addSelf(S),w[r].addSelf(S),H[t].addSelf(M),H[i].addSelf(M),H[r].addSelf(M)}var t,i,r,n,o,a,s,h,l,c,u,d,f,p,m,E,g,v,y,_,T,x,R,b,w=[],H=[],S=new $i_90.Vector3,M=new $i_90.Vector3,C=new $i_90.Vector3,A=new $i_90.Vector3,P=new $i_90.Vector3;for(t=0,i=this.vertices.length;i>t;t++)w[t]=new $i_90.Vector3,H[t]=new $i_90.Vector3;for(t=0,i=this.faces.length;i>t;t++)o=this.faces[t],a=this.faceVertexUvs[0][t],o instanceof $i_90.Face3?e(this,o.a,o.b,o.c,0,1,2):o instanceof $i_90.Face4&&(e(this,o.a,o.b,o.d,0,1,3),e(this,o.b,o.c,o.d,1,2,3));var L=["a","b","c","d"];for(t=0,i=this.faces.length;i>t;t++)for(o=this.faces[t],r=0;o.vertexNormals.length>r;r++)P.copy(o.vertexNormals[r]),n=o[L[r]],b=w[n],C.copy(b),C.subSelf(P.multiplyScalar(P.dot(b))).normalize(),A.cross(o.vertexNormals[r],b),n=A.dot(H[n]),n=0>n?-1:1,o.vertexTangents[r]=new $i_90.Vector4(C.x,C.y,C.z,n);this.hasTangents=!0},computeBoundingBox:function(){if(this.boundingBox||(this.boundingBox={min:new $i_90.Vector3,max:new $i_90.Vector3}),this.vertices.length>0){var e;e=this.vertices[0],this.boundingBox.min.copy(e),this.boundingBox.max.copy(e);for(var t=this.boundingBox.min,i=this.boundingBox.max,r=1,n=this.vertices.length;n>r;r++)e=this.vertices[r],t.x>e.x?t.x=e.x:e.x>i.x&&(i.x=e.x),t.y>e.y?t.y=e.y:e.y>i.y&&(i.y=e.y),t.z>e.z?t.z=e.z:e.z>i.z&&(i.z=e.z)}else this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var e=0;null===this.boundingSphere&&(this.boundingSphere={radius:0});for(var t=0,i=this.vertices.length;i>t;t++){var r=this.vertices[t].lengthSq();r>e&&(e=r)}this.boundingSphere.radius=Math.sqrt(e)},mergeVertices:function(){var e,t,i,r,n,o={},a=[],s=[],h=Math.pow(10,4);for(t=0,i=this.vertices.length;i>t;t++)e=this.vertices[t],e=[Math.round(e.x*h),Math.round(e.y*h),Math.round(e.z*h)].join("_"),void 0===o[e]?(o[e]=t,a.push(this.vertices[t]),s[t]=a.length-1):s[t]=s[o[e]];for(t=0,i=this.faces.length;i>t;t++)if(o=this.faces[t],o instanceof $i_90.Face3)o.a=s[o.a],o.b=s[o.b],o.c=s[o.c];else if(o instanceof $i_90.Face4)for(o.a=s[o.a],o.b=s[o.b],o.c=s[o.c],o.d=s[o.d],e=[o.a,o.b,o.c,o.d],h=3;h>0;h--)if(e.indexOf(o["abcd"[h]])!==h){for(e.splice(h,1),this.faces[t]=new $i_90.Face3(e[0],e[1],e[2],o.normal,o.color,o.materialIndex),e=0,r=this.faceVertexUvs.length;r>e;e++)(n=this.faceVertexUvs[e][t])&&n.splice(h,1);this.faces[t].vertexColors=o.vertexColors;break}return s=this.vertices.length-a.length,this.vertices=a,s},clone:function(){},deallocate:function(){var e=$i_90.GeometryLibrary.indexOf(this);-1!==e&&$i_90.GeometryLibrary.splice(e,1)}},$i_90.GeometryIdCount=0,$i_90.GeometryLibrary=[],$i_90.BufferGeometry=function(){this.id=$i_90.GeometryCount++,this.attributes={},this.dynamic=!1,this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.morphTargets=[]},$i_90.BufferGeometry.prototype={constructor:$i_90.BufferGeometry,applyMatrix:function(e){var t,i;this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(i=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==i&&(t=new $i_90.Matrix4,t.extractRotation(e),t.multiplyVector3Array(i),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){this.boundingBox||(this.boundingBox={min:new $i_90.Vector3(1/0,1/0,1/0),max:new $i_90.Vector3(-1/0,-1/0,-1/0)});var e=this.attributes.position.array;if(e)for(var t,i,r,n=this.boundingBox,o=0,a=e.length;a>o;o+=3)t=e[o],i=e[o+1],r=e[o+2],n.min.x>t?n.min.x=t:t>n.max.x&&(n.max.x=t),n.min.y>i?n.min.y=i:i>n.max.y&&(n.max.y=i),n.min.z>r?n.min.z=r:r>n.max.z&&(n.max.z=r);(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){this.boundingSphere||(this.boundingSphere={radius:0});var e=this.attributes.position.array;if(e){for(var t,i,r,n=0,o=0,a=e.length;a>o;o+=3)t=e[o],i=e[o+1],r=e[o+2],t=t*t+i*i+r*r,t>n&&(n=t);this.boundingSphere.radius=Math.sqrt(n)}},computeVertexNormals:function(){if(this.attributes.position&&this.attributes.index){var e,t,i,r;if(e=this.attributes.position.array.length,void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(e),numItems:e};else for(e=0,t=this.attributes.normal.array.length;t>e;e++)this.attributes.normal.array[e]=0;var n,o,a,s,h,l,c=this.offsets,u=this.attributes.index.array,d=this.attributes.position.array,f=this.attributes.normal.array,p=new $i_90.Vector3,m=new $i_90.Vector3,E=new $i_90.Vector3,g=new $i_90.Vector3,v=new $i_90.Vector3;for(i=0,r=c.length;r>i;++i){t=c[i].start,n=c[i].count;var y=c[i].index;for(e=t,t+=n;t>e;e+=3)n=y+u[e],o=y+u[e+1],a=y+u[e+2],s=d[3*n],h=d[3*n+1],l=d[3*n+2],p.set(s,h,l),s=d[3*o],h=d[3*o+1],l=d[3*o+2],m.set(s,h,l),s=d[3*a],h=d[3*a+1],l=d[3*a+2],E.set(s,h,l),g.sub(E,m),v.sub(p,m),g.crossSelf(v),f[3*n]+=g.x,f[3*n+1]+=g.y,f[3*n+2]+=g.z,f[3*o]+=g.x,f[3*o+1]+=g.y,f[3*o+2]+=g.z,f[3*a]+=g.x,f[3*a+1]+=g.y,f[3*a+2]+=g.z}for(e=0,t=f.length;t>e;e+=3)s=f[e],h=f[e+1],l=f[e+2],i=1/Math.sqrt(s*s+h*h+l*l),f[e]*=i,f[e+1]*=i,f[e+2]*=i;this.normalsNeedUpdate=!0}},computeTangents:function(){function e(e){V.x=r[3*e],V.y=r[3*e+1],V.z=r[3*e+2],N.copy(V),D=h[e],z.copy(D),z.subSelf(V.multiplyScalar(V.dot(D))).normalize(),B.cross(N,D),F=B.dot(l[e]),U=0>F?-1:1,s[4*e]=z.x,s[4*e+1]=z.y,s[4*e+2]=z.z,s[4*e+3]=U}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var t=this.attributes.index.array,i=this.attributes.position.array,r=this.attributes.normal.array,n=this.attributes.uv.array,o=i.length/3;if(void 0===this.attributes.tangent){var a=4*o;this.attributes.tangent={itemSize:4,array:new Float32Array(a),numItems:a}}for(var s=this.attributes.tangent.array,h=[],l=[],a=0;o>a;a++)h[a]=new $i_90.Vector3,l[a]=new $i_90.Vector3;var c,u,d,f,p,m,E,g,v,y,_,T,x,R,b,w,H,S,M,C,A,P,o=new $i_90.Vector3,a=new $i_90.Vector3,L=this.offsets;for(S=0,M=L.length;M>S;++S){H=L[S].start,C=L[S].count;var I=L[S].index;for(w=H,H+=C;H>w;w+=3)C=I+t[w],A=I+t[w+1],P=I+t[w+2],c=i[3*C],u=i[3*C+1],d=i[3*C+2],f=i[3*A],p=i[3*A+1],m=i[3*A+2],E=i[3*P],g=i[3*P+1],v=i[3*P+2],y=n[2*C],_=n[2*C+1],T=n[2*A],x=n[2*A+1],R=n[2*P],b=n[2*P+1],f-=c,c=E-c,p-=u,u=g-u,m-=d,d=v-d,T-=y,y=R-y,x-=_,_=b-_,b=1/(T*_-y*x),o.set((_*f-x*c)*b,(_*p-x*u)*b,(_*m-x*d)*b),a.set((T*c-y*f)*b,(T*u-y*p)*b,(T*d-y*m)*b),h[C].addSelf(o),h[A].addSelf(o),h[P].addSelf(o),l[C].addSelf(a),l[A].addSelf(a),l[P].addSelf(a)}var U,D,F,z=new $i_90.Vector3,B=new $i_90.Vector3,V=new $i_90.Vector3,N=new $i_90.Vector3;for(S=0,M=L.length;M>S;++S)for(H=L[S].start,C=L[S].count,I=L[S].index,w=H,H+=C;H>w;w+=3)C=I+t[w],A=I+t[w+1],P=I+t[w+2],e(C),e(A),e(P);this.tangentsNeedUpdate=this.hasTangents=!0}}},$i_90.Spline=function(e){function t(e,t,i,r,n,o,a){return e=.5*(i-e),r=.5*(r-t),(2*(t-i)+e+r)*a+(-3*(t-i)-2*e-r)*o+e*n+t}this.points=e;var i,r,n,o,a,s,h,l,c,u=[],d={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;e.length>t;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,r=Math.floor(i),n=i-r,u[0]=0===r?r:r-1,u[1]=r,u[2]=r>this.points.length-2?this.points.length-1:r+1,u[3]=r>this.points.length-3?this.points.length-1:r+2,s=this.points[u[0]],h=this.points[u[1]],l=this.points[u[2]],c=this.points[u[3]],o=n*n,a=n*o,d.x=t(s.x,h.x,l.x,c.x,n,o,a),d.y=t(s.y,h.y,l.y,c.y,n,o,a),d.z=t(s.z,h.z,l.z,c.z,n,o,a),d},this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;i>e;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,i,r,n=t=t=0,o=new $i_90.Vector3,a=new $i_90.Vector3,s=[],h=0;for(s[0]=0,e||(e=100),i=this.points.length*e,o.copy(this.points[0]),e=1;i>e;e++)t=e/i,r=this.getPoint(t),a.copy(r),h+=a.distanceTo(o),o.copy(r),t*=this.points.length-1,t=Math.floor(t),t!=n&&(s[t]=h,n=t);return s[s.length]=h,{chunks:s,total:h}},this.reparametrizeByArcLength=function(e){var t,i,r,n,o,a,s=[],h=new $i_90.Vector3,l=this.getLength();for(s.push(h.copy(this.points[0]).clone()),t=1;this.points.length>t;t++){for(i=l.chunks[t]-l.chunks[t-1],a=Math.ceil(e*i/l.total),n=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;a-1>i;i++)r=n+i*(1/a)*(o-n),r=this.getPoint(r),s.push(h.copy(r).clone());s.push(h.copy(this.points[t]).clone())}this.points=s}},$i_90.Camera=function(){$i_90.Object3D.call(this),this.matrixWorldInverse=new $i_90.Matrix4,this.projectionMatrix=new $i_90.Matrix4,this.projectionMatrixInverse=new $i_90.Matrix4},$i_90.Camera.prototype=Object.create($i_90.Object3D.prototype),$i_90.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),!0===this.rotationAutoUpdate&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},$i_90.OrthographicCamera=function(e,t,i,r,n,o){$i_90.Camera.call(this),this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},$i_90.OrthographicCamera.prototype=Object.create($i_90.Camera.prototype),$i_90.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},$i_90.PerspectiveCamera=function(e,t,i,r){$i_90.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},$i_90.PerspectiveCamera.prototype=Object.create($i_90.Camera.prototype),$i_90.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*Math.atan(t/(2*e))*(180/Math.PI),this.updateProjectionMatrix()},$i_90.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,n,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=r,this.width=n,this.height=o,this.updateProjectionMatrix()},$i_90.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,i=-t,r=e*i,e=Math.abs(e*t-r),i=Math.abs(t-i);this.projectionMatrix.makeFrustum(r+this.x*e/this.fullWidth,r+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*i/this.fullHeight,t-this.y*i/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},$i_90.Light=function(e){$i_90.Object3D.call(this),this.color=new $i_90.Color(e)},$i_90.Light.prototype=Object.create($i_90.Object3D.prototype),$i_90.AmbientLight=function(e){$i_90.Light.call(this,e)},$i_90.AmbientLight.prototype=Object.create($i_90.Light.prototype),$i_90.DirectionalLight=function(e,t,i){$i_90.Light.call(this,e),this.position=new $i_90.Vector3(0,1,0),this.target=new $i_90.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new $i_90.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},$i_90.DirectionalLight.prototype=Object.create($i_90.Light.prototype),$i_90.HemisphereLight=function(e,t,i){$i_90.Light.call(this,e),this.groundColor=new $i_90.Color(t),this.position=new $i_90.Vector3(0,100,0),this.intensity=void 0!==i?i:1},$i_90.HemisphereLight.prototype=Object.create($i_90.Light.prototype),$i_90.PointLight=function(e,t,i){$i_90.Light.call(this,e),this.position=new $i_90.Vector3(0,0,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},$i_90.PointLight.prototype=Object.create($i_90.Light.prototype),$i_90.SpotLight=function(e,t,i,r,n){$i_90.Light.call(this,e),this.position=new $i_90.Vector3(0,1,0),this.target=new $i_90.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/2,this.exponent=void 0!==n?n:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},$i_90.SpotLight.prototype=Object.create($i_90.Light.prototype),$i_90.Loader=function(e){this.statusDomElement=(this.showStatus=e)?$i_90.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},$i_90.Loader.prototype={constructor:$i_90.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(1>e.length?".":e.join("/"))+"/"},initMaterials:function(e,t,i){e.materials=[];for(var r=0;t.length>r;++r)e.materials[r]=$i_90.Loader.prototype.createMaterial(t[r],i)},hasNormals:function(e){var t,i,r=e.materials.length;for(i=0;r>i;i++)if(t=e.materials[i],t instanceof $i_90.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){function i(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function r(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function n(e,n,o,s,h,l,c){var u=o.toLowerCase().endsWith(".dds"),d=t+"/"+o;if(u){var f=$i_90.ImageUtils.loadCompressedTexture(d);e[n]=f}else f=document.createElement("canvas"),e[n]=new $i_90.Texture(f);if(e[n].sourceFile=o,s&&(e[n].repeat.set(s[0],s[1]),1!==s[0]&&(e[n].wrapS=$i_90.RepeatWrapping),1!==s[1])&&(e[n].wrapT=$i_90.RepeatWrapping),h&&e[n].offset.set(h[0],h[1]),l&&(o={repeat:$i_90.RepeatWrapping,mirror:$i_90.MirroredRepeatWrapping},void 0!==o[l[0]]&&(e[n].wrapS=o[l[0]]),void 0!==o[l[1]])&&(e[n].wrapT=o[l[1]]),c&&(e[n].anisotropy=c),!u){var p=e[n],e=new Image;e.onload=function(){if(i(this.width)&&i(this.height))p.image=this;else{var e=r(this.width),t=r(this.height);p.image.width=e,p.image.height=t,p.image.getContext("2d").drawImage(this,0,0,e,t)}p.needsUpdate=!0},e.crossOrigin=a.crossOrigin,e.src=d}}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var a=this,s="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?s="MeshPhongMaterial":"basic"===l&&(s="MeshBasicMaterial")}return void 0!==e.blending&&void 0!==$i_90[e.blending]&&(h.blending=$i_90[e.blending]),(void 0!==e.transparent||1>e.opacity)&&(h.transparent=e.transparent),void 0!==e.depthTest&&(h.depthTest=e.depthTest),void 0!==e.depthWrite&&(h.depthWrite=e.depthWrite),void 0!==e.visible&&(h.visible=e.visible),void 0!==e.flipSided&&(h.side=$i_90.BackSide),void 0!==e.doubleSided&&(h.side=$i_90.DoubleSide),void 0!==e.wireframe&&(h.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?h.vertexColors=$i_90.FaceColors:e.vertexColors&&(h.vertexColors=$i_90.VertexColors)),e.colorDiffuse?h.color=o(e.colorDiffuse):e.DbgColor&&(h.color=e.DbgColor),e.colorSpecular&&(h.specular=o(e.colorSpecular)),e.colorAmbient&&(h.ambient=o(e.colorAmbient)),e.transparency&&(h.opacity=e.transparency),e.specularCoef&&(h.shininess=e.specularCoef),e.mapDiffuse&&t&&n(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&n(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&n(h,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&n(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&n(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(h.bumpScale=e.mapBumpScale),e.mapNormal?(s=$i_90.ShaderUtils.lib.normal,l=$i_90.UniformsUtils.clone(s.uniforms),l.tNormal.value=h.normalMap,e.mapNormalFactor&&l.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),h.map&&(l.tDiffuse.value=h.map,l.enableDiffuse.value=!0),h.specularMap&&(l.tSpecular.value=h.specularMap,l.enableSpecular.value=!0),h.lightMap&&(l.tAO.value=h.lightMap,l.enableAO.value=!0),l.uDiffuseColor.value.setHex(h.color),l.uSpecularColor.value.setHex(h.specular),l.uAmbientColor.value.setHex(h.ambient),l.uShininess.value=h.shininess,void 0!==h.opacity&&(l.uOpacity.value=h.opacity),h=new $i_90.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,lights:!0,fog:!0})):h=new $i_90[s](h),void 0!==e.DbgName&&(h.name=e.DbgName),h}},$i_90.BinaryLoader=function(e){$i_90.Loader.call(this,e)},$i_90.BinaryLoader.prototype=Object.create($i_90.Loader.prototype),$i_90.BinaryLoader.prototype.load=function(e,t,i,r){var i=i?i:this.extractUrlBase(e),r=r?r:this.extractUrlBase(e),n=this.showProgress?$i_90.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,e,t,i,r,n)},$i_90.BinaryLoader.prototype.loadAjaxJSON=function(e,t,i,r,n,o){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status||0==a.status){var s=JSON.parse(a.responseText);e.loadAjaxBuffers(s,i,n,r,o)}else console.error("$i_90.BinaryLoader: Couldn't load ["+t+"] ["+a.status+"]")},a.open("GET",t,!0),a.send(null)},$i_90.BinaryLoader.prototype.loadAjaxBuffers=function(e,t,i,r,n){var o=new XMLHttpRequest,a=i+"/"+e.buffers,s=0;o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||0==o.status){var i=o.response;void 0===i&&(i=new Uint8Array(o.responseBody).buffer),$i_90.BinaryLoader.prototype.createBinModel(i,t,r,e.materials)}else console.error("$i_90.BinaryLoader: Couldn't load ["+a+"] ["+o.status+"]");else 3==o.readyState?n&&(0==s&&(s=o.getResponseHeader("Content-Length")),n({total:s,loaded:o.responseText.length})):2==o.readyState&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",a,!0),o.responseType="arraybuffer",o.send(null)},$i_90.BinaryLoader.prototype.createBinModel=function(e,t,i,r){var n=function(t){function i(e){return e%4?4-e%4:0
}function n(e,t){return new Uint8Array(e,t,1)[0]}function o(e,t){return new Uint32Array(e,t,1)[0]}function a(t,i){var r,n,o,a,s,h,l,c,u=new Uint32Array(e,i,3*t);for(r=0;t>r;r++){n=u[3*r],o=u[3*r+1],a=u[3*r+2],s=I[2*n],n=I[2*n+1],h=I[2*o],l=I[2*o+1],o=I[2*a],c=I[2*a+1],a=A.faceVertexUvs[0];var d=[];d.push(new $i_90.UV(s,n)),d.push(new $i_90.UV(h,l)),d.push(new $i_90.UV(o,c)),a.push(d)}}function s(t,i){var r,n,o,a,s,h,l,c,u,d,f=new Uint32Array(e,i,4*t);for(r=0;t>r;r++){n=f[4*r],o=f[4*r+1],a=f[4*r+2],s=f[4*r+3],h=I[2*n],n=I[2*n+1],l=I[2*o],u=I[2*o+1],c=I[2*a],d=I[2*a+1],a=I[2*s],o=I[2*s+1],s=A.faceVertexUvs[0];var p=[];p.push(new $i_90.UV(h,n)),p.push(new $i_90.UV(l,u)),p.push(new $i_90.UV(c,d)),p.push(new $i_90.UV(a,o)),s.push(p)}}function h(t,i,r){for(var n,o,a,s,i=new Uint32Array(e,i,3*t),h=new Uint16Array(e,r,t),r=0;t>r;r++)n=i[3*r],o=i[3*r+1],a=i[3*r+2],s=h[r],A.faces.push(new $i_90.Face3(n,o,a,null,null,s))}function l(t,i,r){for(var n,o,a,s,h,i=new Uint32Array(e,i,4*t),l=new Uint16Array(e,r,t),r=0;t>r;r++)n=i[4*r],o=i[4*r+1],a=i[4*r+2],s=i[4*r+3],h=l[r],A.faces.push(new $i_90.Face4(n,o,a,s,null,null,h))}function c(t,i,r,n){for(var o,a,s,h,l,c,u,i=new Uint32Array(e,i,3*t),r=new Uint32Array(e,r,3*t),d=new Uint16Array(e,n,t),n=0;t>n;n++){o=i[3*n],a=i[3*n+1],s=i[3*n+2],l=r[3*n],c=r[3*n+1],u=r[3*n+2],h=d[n];var f=L[3*c],p=L[3*c+1];c=L[3*c+2];var m=L[3*u],E=L[3*u+1];u=L[3*u+2],A.faces.push(new $i_90.Face3(o,a,s,[new $i_90.Vector3(L[3*l],L[3*l+1],L[3*l+2]),new $i_90.Vector3(f,p,c),new $i_90.Vector3(m,E,u)],null,h))}}function u(t,i,r,n){for(var o,a,s,h,l,c,u,d,f,i=new Uint32Array(e,i,4*t),r=new Uint32Array(e,r,4*t),p=new Uint16Array(e,n,t),n=0;t>n;n++){o=i[4*n],a=i[4*n+1],s=i[4*n+2],h=i[4*n+3],c=r[4*n],u=r[4*n+1],d=r[4*n+2],f=r[4*n+3],l=p[n];var m=L[3*u],E=L[3*u+1];u=L[3*u+2];var g=L[3*d],v=L[3*d+1];d=L[3*d+2];var y=L[3*f],_=L[3*f+1];f=L[3*f+2],A.faces.push(new $i_90.Face4(o,a,s,h,[new $i_90.Vector3(L[3*c],L[3*c+1],L[3*c+2]),new $i_90.Vector3(m,E,u),new $i_90.Vector3(g,v,d),new $i_90.Vector3(y,_,f)],null,l))}}var d,f,p,m,E,g,v,y,_,T,x,R,b,w,H,S,M,C,A=this,P=0,L=[],I=[];for($i_90.Geometry.call(this),$i_90.Loader.prototype.initMaterials(A,r,t),H=e,M=P,t=new Uint8Array(H,M,12),T="",b=0;12>b;b++)T+=String.fromCharCode(t[M+b]);d=n(H,M+12),n(H,M+13),n(H,M+14),n(H,M+15),f=n(H,M+16),p=n(H,M+17),m=n(H,M+18),E=n(H,M+19),g=o(H,M+20),v=o(H,M+20+4),y=o(H,M+20+8),_=o(H,M+20+12),T=o(H,M+20+16),x=o(H,M+20+20),R=o(H,M+20+24),b=o(H,M+20+28),t=o(H,M+20+32),w=o(H,M+20+36),H=o(H,M+20+40),P+=d,M=3*f+E,C=4*f+E,S=_*M,d=T*(M+3*p),f=x*(M+3*m),E=R*(M+3*p+3*m),M=b*C,p=t*(C+4*p),m=w*(C+4*m),C=P;var U,D,F,z,P=new Float32Array(e,P,3*g);for(U=0;g>U;U++)D=P[3*U],F=P[3*U+1],z=P[3*U+2],A.vertices.push(new $i_90.Vector3(D,F,z));if(g=P=C+3*g*Float32Array.BYTES_PER_ELEMENT,v)for(P=new Int8Array(e,P,3*v),C=0;v>C;C++)U=P[3*C],D=P[3*C+1],F=P[3*C+2],L.push(U/127,D/127,F/127);if(P=g+3*v*Int8Array.BYTES_PER_ELEMENT,v=P+=i(3*v),y)for(P=new Float32Array(e,P,2*y),g=0;y>g;g++)C=P[2*g],U=P[2*g+1],I.push(C,U);y=P=v+2*y*Float32Array.BYTES_PER_ELEMENT,S=y+S+i(2*_),v=S+d+i(2*T),d=v+f+i(2*x),f=d+E+i(2*R),M=f+M+i(2*b),E=M+p+i(2*t),p=E+m+i(2*w),x&&(m=v+3*x*Uint32Array.BYTES_PER_ELEMENT,h(x,v,m+3*x*Uint32Array.BYTES_PER_ELEMENT),a(x,m)),R&&(x=d+3*R*Uint32Array.BYTES_PER_ELEMENT,m=x+3*R*Uint32Array.BYTES_PER_ELEMENT,c(R,d,x,m+3*R*Uint32Array.BYTES_PER_ELEMENT),a(R,m)),w&&(R=E+4*w*Uint32Array.BYTES_PER_ELEMENT,l(w,E,R+4*w*Uint32Array.BYTES_PER_ELEMENT),s(w,R)),H&&(w=p+4*H*Uint32Array.BYTES_PER_ELEMENT,R=w+4*H*Uint32Array.BYTES_PER_ELEMENT,u(H,p,w,R+4*H*Uint32Array.BYTES_PER_ELEMENT),s(H,R)),_&&h(_,y,y+3*_*Uint32Array.BYTES_PER_ELEMENT),T&&(_=S+3*T*Uint32Array.BYTES_PER_ELEMENT,c(T,S,_,_+3*T*Uint32Array.BYTES_PER_ELEMENT)),b&&l(b,f,f+4*b*Uint32Array.BYTES_PER_ELEMENT),t&&(T=M+4*t*Uint32Array.BYTES_PER_ELEMENT,u(t,M,T,T+4*t*Uint32Array.BYTES_PER_ELEMENT)),this.computeCentroids(),this.computeFaceNormals(),$i_90.Loader.prototype.hasNormals(this)&&this.computeTangents()};n.prototype=Object.create($i_90.Geometry.prototype),t(new n(i))},$i_90.ImageLoader=function(){$i_90.EventTarget.call(this),this.crossOrigin=null},$i_90.ImageLoader.prototype={constructor:$i_90.ImageLoader,load:function(e,t){var i=this;void 0===t&&(t=new Image),t.addEventListener("load",function(){i.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.crossOrigin&&(t.crossOrigin=i.crossOrigin),t.src=e}},$i_90.JSONLoader=function(e){$i_90.Loader.call(this,e)},$i_90.JSONLoader.prototype=Object.create($i_90.Loader.prototype),$i_90.JSONLoader.prototype.load=function(e,t,i){i=i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},$i_90.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,r,n){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);e.createModel(s,i,r)}else console.warn("$i_90.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("$i_90.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?n&&(0===a&&(a=o.getResponseHeader("Content-Length")),n({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.send(null)},$i_90.JSONLoader.prototype.createModel=function(e,t,i){var r=new $i_90.Geometry,n=void 0!==e.scale?1/e.scale:1;this.initMaterials(r,e.materials,i);var o,a,s,h,l,c,u,d,f,p,m,E,g,v,y=e.faces;f=e.vertices;var _=e.normals,T=e.colors,x=0;for(o=0;e.uvs.length>o;o++)e.uvs[o].length&&x++;for(o=0;x>o;o++)r.faceUvs[o]=[],r.faceVertexUvs[o]=[];for(i=0,h=f.length;h>i;)l=new $i_90.Vector3,l.x=f[i++]*n,l.y=f[i++]*n,l.z=f[i++]*n,r.vertices.push(l);for(i=0,h=y.length;h>i;){if(f=y[i++],l=f&1,s=f&2,o=f&4,a=f&8,u=f&16,c=f&32,p=f&64,f&=128,l?(m=new $i_90.Face4,m.a=y[i++],m.b=y[i++],m.c=y[i++],m.d=y[i++],l=4):(m=new $i_90.Face3,m.a=y[i++],m.b=y[i++],m.c=y[i++],l=3),s&&(s=y[i++],m.materialIndex=s),s=r.faces.length,o)for(o=0;x>o;o++)E=e.uvs[o],d=y[i++],v=E[2*d],d=E[2*d+1],r.faceUvs[o][s]=new $i_90.UV(v,d);if(a)for(o=0;x>o;o++){for(E=e.uvs[o],g=[],a=0;l>a;a++)d=y[i++],v=E[2*d],d=E[2*d+1],g[a]=new $i_90.UV(v,d);r.faceVertexUvs[o][s]=g}if(u&&(u=3*y[i++],a=new $i_90.Vector3,a.x=_[u++],a.y=_[u++],a.z=_[u],m.normal=a),c)for(o=0;l>o;o++)u=3*y[i++],a=new $i_90.Vector3,a.x=_[u++],a.y=_[u++],a.z=_[u],m.vertexNormals.push(a);if(p&&(c=y[i++],c=new $i_90.Color(T[c]),m.color=c),f)for(o=0;l>o;o++)c=y[i++],c=new $i_90.Color(T[c]),m.vertexColors.push(c);r.faces.push(m)}if(e.skinWeights)for(i=0,h=e.skinWeights.length;h>i;i+=2)y=e.skinWeights[i],_=e.skinWeights[i+1],r.skinWeights.push(new $i_90.Vector4(y,_,0,0));if(e.skinIndices)for(i=0,h=e.skinIndices.length;h>i;i+=2)y=e.skinIndices[i],_=e.skinIndices[i+1],r.skinIndices.push(new $i_90.Vector4(y,_,0,0));if(r.bones=e.bones,r.animation=e.animation,void 0!==e.morphTargets)for(i=0,h=e.morphTargets.length;h>i;i++)for(r.morphTargets[i]={},r.morphTargets[i].name=e.morphTargets[i].name,r.morphTargets[i].vertices=[],T=r.morphTargets[i].vertices,x=e.morphTargets[i].vertices,y=0,_=x.length;_>y;y+=3)f=new $i_90.Vector3,f.x=x[y]*n,f.y=x[y+1]*n,f.z=x[y+2]*n,T.push(f);if(void 0!==e.morphColors)for(i=0,h=e.morphColors.length;h>i;i++)for(r.morphColors[i]={},r.morphColors[i].name=e.morphColors[i].name,r.morphColors[i].colors=[],_=r.morphColors[i].colors,T=e.morphColors[i].colors,n=0,y=T.length;y>n;n+=3)x=new $i_90.Color(16755200),x.setRGB(T[n],T[n+1],T[n+2]),_.push(x);r.computeCentroids(),r.computeFaceNormals(),this.hasNormals(r)&&r.computeTangents(),t(r)},$i_90.LoadingMonitor=function(){$i_90.EventTarget.call(this);var e=this,t=0,i=0,r=function(){t++,e.dispatchEvent({type:"progress",loaded:t,total:i}),t===i&&e.dispatchEvent({type:"load"})};this.add=function(e){i++,e.addEventListener("load",r,!1)}},$i_90.GeometryLoader=function(){$i_90.EventTarget.call(this),this.path=this.crossOrigin=null},$i_90.GeometryLoader.prototype={constructor:$i_90.GeometryLoader,load:function(e){var t=this,i=null;if(null===t.path){var r=e.split("/");r.pop(),t.path=1>r.length?".":r.join("/")}r=new XMLHttpRequest,r.addEventListener("load",function(r){r.target.responseText?i=t.parse(JSON.parse(r.target.responseText),n):t.dispatchEvent({type:"error",message:"Invalid file ["+e+"]"})},!1),r.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),r.open("GET",e,!0),r.send(null);var n=new $i_90.LoadingMonitor;n.addEventListener("load",function(){t.dispatchEvent({type:"load",content:i})}),n.add(r)},parse:function(e,t){var i=this,r=new $i_90.Geometry,n=void 0!==e.scale?1/e.scale:1;if(e.materials){r.materials=[];for(var o=0;e.materials.length>o;++o){var a=e.materials[o],s=function(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e},h=function(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))},l=function(e,r,n,o,a,l){e[r]=new $i_90.Texture,e[r].sourceFile=n,o&&(e[r].repeat.set(o[0],o[1]),1!==o[0]&&(e[r].wrapS=$i_90.RepeatWrapping),1!==o[1])&&(e[r].wrapT=$i_90.RepeatWrapping),a&&e[r].offset.set(a[0],a[1]),l&&(o={repeat:$i_90.RepeatWrapping,mirror:$i_90.MirroredRepeatWrapping},void 0!==o[l[0]]&&(e[r].wrapS=o[l[0]]),void 0!==o[l[1]])&&(e[r].wrapT=o[l[1]]);var c=e[r],e=new $i_90.ImageLoader;e.addEventListener("load",function(e){if(e=e.content,s(e.width)&&s(e.height))c.image=e;else{var t=h(e.width),i=h(e.height);c.image=document.createElement("canvas"),c.image.width=t,c.image.height=i,c.image.getContext("2d").drawImage(e,0,0,t,i)}c.needsUpdate=!0}),e.crossOrigin=i.crossOrigin,e.load(i.path+"/"+n),t&&t.add(e)},c=function(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]},u="MeshLambertMaterial",d={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(a.shading){var f=a.shading.toLowerCase();"phong"===f?u="MeshPhongMaterial":"basic"===f&&(u="MeshBasicMaterial")}void 0!==a.blending&&void 0!==$i_90[a.blending]&&(d.blending=$i_90[a.blending]),(void 0!==a.transparent||1>a.opacity)&&(d.transparent=a.transparent),void 0!==a.depthTest&&(d.depthTest=a.depthTest),void 0!==a.depthWrite&&(d.depthWrite=a.depthWrite),void 0!==a.vertexColors&&("face"==a.vertexColors?d.vertexColors=$i_90.FaceColors:a.vertexColors&&(d.vertexColors=$i_90.VertexColors)),a.colorDiffuse?d.color=c(a.colorDiffuse):a.DbgColor&&(d.color=a.DbgColor),a.colorSpecular&&(d.specular=c(a.colorSpecular)),a.colorAmbient&&(d.ambient=c(a.colorAmbient)),a.transparency&&(d.opacity=a.transparency),a.specularCoef&&(d.shininess=a.specularCoef),void 0!==a.visible&&(d.visible=a.visible),void 0!==a.flipSided&&(d.side=$i_90.BackSide),void 0!==a.doubleSided&&(d.side=$i_90.DoubleSide),void 0!==a.wireframe&&(d.wireframe=a.wireframe),a.mapDiffuse&&l(d,"map",a.mapDiffuse,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap),a.mapLight&&l(d,"lightMap",a.mapLight,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap),a.mapBump&&l(d,"bumpMap",a.mapBump,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap),a.mapNormal&&l(d,"normalMap",a.mapNormal,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap),a.mapSpecular&&l(d,"specularMap",a.mapSpecular,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap),a.mapNormal?(l=$i_90.ShaderUtils.lib.normal,c=$i_90.UniformsUtils.clone(l.uniforms),c.tNormal.value=d.normalMap,a.mapNormalFactor&&c.uNormalScale.value.set(a.mapNormalFactor,a.mapNormalFactor),d.map&&(c.tDiffuse.value=d.map,c.enableDiffuse.value=!0),d.specularMap&&(c.tSpecular.value=d.specularMap,c.enableSpecular.value=!0),d.lightMap&&(c.tAO.value=d.lightMap,c.enableAO.value=!0),c.uDiffuseColor.value.setHex(d.color),c.uSpecularColor.value.setHex(d.specular),c.uAmbientColor.value.setHex(d.ambient),c.uShininess.value=d.shininess,void 0!==d.opacity&&(c.uOpacity.value=d.opacity),d=new $i_90.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:c,lights:!0,fog:!0})):d=new $i_90[u](d),void 0!==a.DbgName&&(d.name=a.DbgName),r.materials[o]=d}}var a=e.faces,p=e.vertices,d=e.normals,l=e.colors,c=0;if(e.uvs)for(o=0;e.uvs.length>o;o++)e.uvs[o].length&&c++;for(o=0;c>o;o++)r.faceUvs[o]=[],r.faceVertexUvs[o]=[];for(u=0,f=p.length;f>u;){var m=new $i_90.Vector3;m.x=p[u++]*n,m.y=p[u++]*n,m.z=p[u++]*n,r.vertices.push(m)}for(u=0,f=a.length;f>u;){var E=a[u++],g=E&2,o=E&4,v=E&8,y=E&16,p=E&32,_=E&64,m=E&128;if(E&1){E=new $i_90.Face4,E.a=a[u++],E.b=a[u++],E.c=a[u++],E.d=a[u++];var T=4}else E=new $i_90.Face3,E.a=a[u++],E.b=a[u++],E.c=a[u++],T=3;g&&(g=a[u++],E.materialIndex=g);var x=r.faces.length;if(o)for(o=0;c>o;o++){var R=e.uvs[o],g=a[u++],b=R[2*g],g=R[2*g+1];r.faceUvs[o][x]=new $i_90.UV(b,g)}if(v)for(o=0;c>o;o++){for(var R=e.uvs[o],v=[],w=0;T>w;w++)g=a[u++],b=R[2*g],g=R[2*g+1],v[w]=new $i_90.UV(b,g);r.faceVertexUvs[o][x]=v}if(y&&(y=3*a[u++],g=new $i_90.Vector3,g.x=d[y++],g.y=d[y++],g.z=d[y],E.normal=g),p)for(o=0;T>o;o++)y=3*a[u++],g=new $i_90.Vector3,g.x=d[y++],g.y=d[y++],g.z=d[y],E.vertexNormals.push(g);if(_&&(p=a[u++],E.color=new $i_90.Color(l[p])),m)for(o=0;T>o;o++)p=a[u++],E.vertexColors.push(new $i_90.Color(l[p]));r.faces.push(E)}if(e.skinWeights)for(o=0,a=e.skinWeights.length;a>o;o+=2)r.skinWeights.push(new $i_90.Vector4(e.skinWeights[o],e.skinWeights[o+1],0,0));if(e.skinIndices)for(o=0,a=e.skinIndices.length;a>o;o+=2)d=0,r.skinIndices.push(new $i_90.Vector4(e.skinIndices[o],e.skinIndices[o+1],d,0));if(r.bones=e.bones,r.animation=e.animation,e.morphTargets)for(o=0,a=e.morphTargets.length;a>o;o++)for(r.morphTargets[o]={},r.morphTargets[o].name=e.morphTargets[o].name,r.morphTargets[o].vertices=[],d=r.morphTargets[o].vertices,l=e.morphTargets[o].vertices,g=0,c=l.length;c>g;g+=3)m=new $i_90.Vector3,m.x=l[g]*n,m.y=l[g+1]*n,m.z=l[g+2]*n,d.push(m);if(e.morphColors)for(o=0,a=e.morphColors.length;a>o;o++)for(r.morphColors[o]={},r.morphColors[o].name=e.morphColors[o].name,r.morphColors[o].colors=[],n=r.morphColors[o].colors,l=e.morphColors[o].colors,d=0,c=l.length;c>d;d+=3)u=new $i_90.Color(16755200),u.setRGB(l[d],l[d+1],l[d+2]),n.push(u);return r.computeCentroids(),r.computeFaceNormals(),r}},$i_90.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.addGeometryHandler("ascii",$i_90.JSONLoader),this.addGeometryHandler("binary",$i_90.BinaryLoader)},$i_90.SceneLoader.prototype.constructor=$i_90.SceneLoader,$i_90.SceneLoader.prototype.load=function(e,t){var i=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status){var n=JSON.parse(r.responseText);i.parse(n,t,e)}else console.error("$i_90.SceneLoader: Couldn't load ["+e+"] ["+r.status+"]")},r.open("GET",e,!0),r.send(null)},$i_90.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},$i_90.SceneLoader.prototype.parse=function(e,t,i){function r(e,t){return"relativeToHTML"==t?e:I+"/"+e}function n(e,t){for(var i in t)if(void 0===P.objects[i]){var r=t[i],o=null;if(void 0!==r.geometry?(x=P.geometries[r.geometry])&&(o=!1,R=P.materials[r.materials[0]],(o=R instanceof $i_90.ShaderMaterial)&&x.computeTangents(),E=r.position,g=r.rotation,v=r.quaternion,y=r.scale,p=r.matrix,v=0,0===r.materials.length&&(R=new $i_90.MeshFaceMaterial),r.materials.length>1&&(R=new $i_90.MeshFaceMaterial),r.morph?(o=new $i_90.MorphAnimMesh(x,R),void 0!==r.duration&&(o.duration=r.duration),void 0!==r.time&&(o.time=r.time),void 0!==r.mirroredLoop&&(o.mirroredLoop=r.mirroredLoop),R.morphNormals&&x.computeMorphNormals()):o=new $i_90.Mesh(x,R),o.name=i,p?(o.matrixAutoUpdate=!1,o.matrix.set(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15])):(o.position.set(E[0],E[1],E[2]),v?(o.quaternion.set(v[0],v[1],v[2],v[3]),o.useQuaternion=!0):o.rotation.set(g[0],g[1],g[2]),o.scale.set(y[0],y[1],y[2])),o.visible=r.visible,o.castShadow=r.castShadow,o.receiveShadow=r.receiveShadow,e.add(o),P.objects[i]=o):(E=r.position,g=r.rotation,v=r.quaternion,y=r.scale,v=0,o=new $i_90.Object3D,o.name=i,o.position.set(E[0],E[1],E[2]),v?(o.quaternion.set(v[0],v[1],v[2],v[3]),o.useQuaternion=!0):o.rotation.set(g[0],g[1],g[2]),o.scale.set(y[0],y[1],y[2]),o.visible=void 0!==r.visible?r.visible:!1,e.add(o),P.objects[i]=o,P.empties[i]=o),o){if(void 0!==r.properties)for(var a in r.properties)o.properties[a]=r.properties[a];void 0!==r.children&&n(o,r.children)}}}function o(e){return function(t){P.geometries[e]=t,n(P.scene,U.objects),S-=1,L.onLoadComplete(),s()}}function a(e){return function(t){P.geometries[e]=t}}function s(){L.callbackProgress({totalModels:C,totalTextures:A,loadedModels:C-S,loadedTextures:A-M},P),L.onLoadProgress(),0===S&&0===M&&t(P)}var h,l,c,u,d,f,p,m,E,g,v,y,_,T,x,R,b,w,H,S,M,C,A,P,L=this,I=$i_90.Loader.prototype.extractUrlBase(i),U=e;for(_ in this.geometryHandlerMap)this.geometryHandlerMap[_].loaderObject=new this.geometryHandlerMap[_].loaderClass;M=S=0,P={scene:new $i_90.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}},U.transform&&(e=U.transform.position,i=U.transform.rotation,_=U.transform.scale,e&&P.scene.position.set(e[0],e[1],e[2]),i&&P.scene.rotation.set(i[0],i[1],i[2]),_&&P.scene.scale.set(_[0],_[1],_[2]),e||i||_)&&(P.scene.updateMatrix(),P.scene.updateMatrixWorld()),e=function(e){return function(){M-=e,s(),L.onLoadComplete()}};for(u in U.cameras)_=U.cameras[u],"perspective"===_.type?b=new $i_90.PerspectiveCamera(_.fov,_.aspect,_.near,_.far):"ortho"===_.type&&(b=new $i_90.OrthographicCamera(_.left,_.right,_.top,_.bottom,_.near,_.far)),E=_.position,i=_.target,_=_.up,b.position.set(E[0],E[1],E[2]),b.target=new $i_90.Vector3(i[0],i[1],i[2]),_&&b.up.set(_[0],_[1],_[2]),P.cameras[u]=b;for(c in U.lights)i=U.lights[c],u=void 0!==i.color?i.color:16777215,b=void 0!==i.intensity?i.intensity:1,"directional"===i.type?(E=i.direction,m=new $i_90.DirectionalLight(u,b),m.position.set(E[0],E[1],E[2]),m.position.normalize()):"point"===i.type?(E=i.position,m=i.distance,m=new $i_90.PointLight(u,b,m),m.position.set(E[0],E[1],E[2])):"ambient"===i.type&&(m=new $i_90.AmbientLight(u)),P.scene.add(m),P.lights[c]=m;for(d in U.fogs)c=U.fogs[d],"linear"===c.type?w=new $i_90.Fog(0,c.near,c.far):"exp2"===c.type&&(w=new $i_90.FogExp2(0,c.density)),_=c.color,w.color.setRGB(_[0],_[1],_[2]),P.fogs[d]=w;P.cameras&&U.defaults.camera&&(P.currentCamera=P.cameras[U.defaults.camera]),P.fogs&&U.defaults.fog&&(P.scene.fog=P.fogs[U.defaults.fog]),_=U.defaults.bgcolor,P.bgColor=new $i_90.Color,P.bgColor.setRGB(_[0],_[1],_[2]),P.bgColorAlpha=U.defaults.bgalpha;for(h in U.geometries)d=U.geometries[h],d.type in this.geometryHandlerMap&&(S+=1,L.onLoadStart());C=S;for(h in U.geometries)if(d=U.geometries[h],"cube"===d.type)x=new $i_90.CubeGeometry(d.width,d.height,d.depth,d.segmentsWidth,d.segmentsHeight,d.segmentsDepth,null,d.flipped,d.sides),P.geometries[h]=x;else if("plane"===d.type)x=new $i_90.PlaneGeometry(d.width,d.height,d.segmentsWidth,d.segmentsHeight),P.geometries[h]=x;else if("sphere"===d.type)x=new $i_90.SphereGeometry(d.radius,d.segmentsWidth,d.segmentsHeight),P.geometries[h]=x;else if("cylinder"===d.type)x=new $i_90.CylinderGeometry(d.topRad,d.botRad,d.height,d.radSegs,d.heightSegs),P.geometries[h]=x;else if("torus"===d.type)x=new $i_90.TorusGeometry(d.radius,d.tube,d.segmentsR,d.segmentsT),P.geometries[h]=x;else if("icosahedron"===d.type)x=new $i_90.IcosahedronGeometry(d.radius,d.subdivisions),P.geometries[h]=x;else if(d.type in this.geometryHandlerMap){w={};for(H in d)"type"!==H&&"url"!==H&&(w[H]=d[H]);this.geometryHandlerMap[d.type].loaderObject.load(r(d.url,U.urlBaseType),o(h),w)}else"embedded"===d.type&&(d=U.embeds[d.id],d.metadata=U.metadata,d&&this.geometryHandlerMap.ascii.loaderObject.createModel(d,a(h),""));for(f in U.textures)if(h=U.textures[f],h.url instanceof Array)for(M+=h.url.length,H=0;h.url.length>H;H++)L.onLoadStart();else M+=1,L.onLoadStart();A=M;for(f in U.textures){if(h=U.textures[f],void 0!==h.mapping&&void 0!==$i_90[h.mapping]&&(h.mapping=new $i_90[h.mapping]),h.url instanceof Array){for(d=h.url.length,w=[],H=0;d>H;H++)w[H]=r(h.url[H],U.urlBaseType);H=(H=w[0].endsWith(".dds"))?$i_90.ImageUtils.loadCompressedTextureCube(w,h.mapping,e(d)):$i_90.ImageUtils.loadTextureCube(w,h.mapping,e(d))}else H=h.url.toLowerCase().endsWith(".dds"),d=r(h.url,U.urlBaseType),w=e(1),H=H?$i_90.ImageUtils.loadCompressedTexture(d,h.mapping,w):$i_90.ImageUtils.loadTexture(d,h.mapping,w),void 0!==$i_90[h.minFilter]&&(H.minFilter=$i_90[h.minFilter]),void 0!==$i_90[h.magFilter]&&(H.magFilter=$i_90[h.magFilter]),h.anisotropy&&(H.anisotropy=h.anisotropy),h.repeat&&(H.repeat.set(h.repeat[0],h.repeat[1]),1!==h.repeat[0]&&(H.wrapS=$i_90.RepeatWrapping),1!==h.repeat[1])&&(H.wrapT=$i_90.RepeatWrapping),h.offset&&H.offset.set(h.offset[0],h.offset[1]),h.wrap&&(d={repeat:$i_90.RepeatWrapping,mirror:$i_90.MirroredRepeatWrapping},void 0!==d[h.wrap[0]]&&(H.wrapS=d[h.wrap[0]]),void 0!==d[h.wrap[1]])&&(H.wrapT=d[h.wrap[1]]);P.textures[f]=H}for(l in U.materials){p=U.materials[l];for(T in p.parameters)"envMap"===T||"map"===T||"lightMap"===T||"bumpMap"===T?p.parameters[T]=P.textures[p.parameters[T]]:"shading"===T?p.parameters[T]="flat"===p.parameters[T]?$i_90.FlatShading:$i_90.SmoothShading:"side"===T?p.parameters[T]="double"==p.parameters[T]?$i_90.DoubleSide:"back"==p.parameters[T]?$i_90.BackSide:$i_90.FrontSide:"blending"===T?p.parameters[T]=p.parameters[T]in $i_90?$i_90[p.parameters[T]]:$i_90.NormalBlending:"combine"===T?p.parameters[T]="MixOperation"==p.parameters[T]?$i_90.MixOperation:$i_90.MultiplyOperation:"vertexColors"===T?"face"==p.parameters[T]?p.parameters[T]=$i_90.FaceColors:p.parameters[T]&&(p.parameters[T]=$i_90.VertexColors):"wrapRGB"===T&&(f=p.parameters[T],p.parameters[T]=new $i_90.Vector3(f[0],f[1],f[2]));void 0!==p.parameters.opacity&&1>p.parameters.opacity&&(p.parameters.transparent=!0),p.parameters.normalMap?(f=$i_90.ShaderUtils.lib.normal,e=$i_90.UniformsUtils.clone(f.uniforms),h=p.parameters.color,H=p.parameters.specular,d=p.parameters.ambient,w=p.parameters.shininess,e.tNormal.value=P.textures[p.parameters.normalMap],p.parameters.normalScale&&e.uNormalScale.value.set(p.parameters.normalScale[0],p.parameters.normalScale[1]),p.parameters.map&&(e.tDiffuse.value=p.parameters.map,e.enableDiffuse.value=!0),p.parameters.envMap&&(e.tCube.value=p.parameters.envMap,e.enableReflection.value=!0,e.uReflectivity.value=p.parameters.reflectivity),p.parameters.lightMap&&(e.tAO.value=p.parameters.lightMap,e.enableAO.value=!0),p.parameters.specularMap&&(e.tSpecular.value=P.textures[p.parameters.specularMap],e.enableSpecular.value=!0),p.parameters.displacementMap&&(e.tDisplacement.value=P.textures[p.parameters.displacementMap],e.enableDisplacement.value=!0,e.uDisplacementBias.value=p.parameters.displacementBias,e.uDisplacementScale.value=p.parameters.displacementScale),e.uDiffuseColor.value.setHex(h),e.uSpecularColor.value.setHex(H),e.uAmbientColor.value.setHex(d),e.uShininess.value=w,p.parameters.opacity&&(e.uOpacity.value=p.parameters.opacity),R=new $i_90.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:e,lights:!0,fog:!0})):R=new $i_90[p.type](p.parameters),P.materials[l]=R}n(P.scene,U.objects),L.callbackSync(P),s()},$i_90.TextureLoader=function(){$i_90.EventTarget.call(this),this.crossOrigin=null},$i_90.TextureLoader.prototype={constructor:$i_90.TextureLoader,load:function(e){var t=this,i=new Image;i.addEventListener("load",function(){var e=new $i_90.Texture(i);e.needsUpdate=!0,t.dispatchEvent({type:"load",content:e})},!1),i.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),t.crossOrigin&&(i.crossOrigin=t.crossOrigin),i.src=e}},$i_90.Material=function(){$i_90.MaterialLibrary.push(this),this.id=$i_90.MaterialIdCount++,this.name="",this.side=$i_90.FrontSide,this.opacity=1,this.transparent=!1,this.blending=$i_90.NormalBlending,this.blendSrc=$i_90.SrcAlphaFactor,this.blendDst=$i_90.OneMinusSrcAlphaFactor,this.blendEquation=$i_90.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.overdraw=!1,this.needsUpdate=this.visible=!0},$i_90.Material.prototype.setValues=function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0===i)console.warn("$i_90.Material: '"+t+"' parameter is undefined.");else if(t in this){var r=this[t];r instanceof $i_90.Color&&i instanceof $i_90.Color?r.copy(i):r instanceof $i_90.Color&&"number"==typeof i?r.setHex(i):r instanceof $i_90.Vector3&&i instanceof $i_90.Vector3?r.copy(i):this[t]=i}}},$i_90.Material.prototype.clone=function(e){return void 0===e&&(e=new $i_90.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},$i_90.Material.prototype.deallocate=function(){var e=$i_90.MaterialLibrary.indexOf(this);-1!==e&&$i_90.MaterialLibrary.splice(e,1)},$i_90.MaterialIdCount=0,$i_90.MaterialLibrary=[],$i_90.LineBasicMaterial=function(e){$i_90.Material.call(this),this.color=new $i_90.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},$i_90.LineBasicMaterial.prototype=Object.create($i_90.Material.prototype),$i_90.LineBasicMaterial.prototype.clone=function(){var e=new $i_90.LineBasicMaterial;return $i_90.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},$i_90.MeshBasicMaterial=function(e){$i_90.Material.call(this),this.color=new $i_90.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=$i_90.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=$i_90.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=$i_90.NoColors,this.morphTargets=this.skinning=!1,this.setValues(e)},$i_90.MeshBasicMaterial.prototype=Object.create($i_90.Material.prototype),$i_90.MeshBasicMaterial.prototype.clone=function(){var e=new $i_90.MeshBasicMaterial;return $i_90.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},$i_90.MeshLambertMaterial=function(e){$i_90.Material.call(this),this.color=new $i_90.Color(16777215),this.ambient=new $i_90.Color(16777215),this.emissive=new $i_90.Color(0),this.wrapAround=!1,this.wrapRGB=new $i_90.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=$i_90.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=$i_90.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=$i_90.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},$i_90.MeshLambertMaterial.prototype=Object.create($i_90.Material.prototype),$i_90.MeshLambertMaterial.prototype.clone=function(){var e=new $i_90.MeshLambertMaterial;return $i_90.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},$i_90.MeshPhongMaterial=function(e){$i_90.Material.call(this),this.color=new $i_90.Color(16777215),this.ambient=new $i_90.Color(16777215),this.emissive=new $i_90.Color(0),this.specular=new $i_90.Color(1118481),this.shininess=30,this.wrapAround=this.perPixel=this.metal=!1,this.wrapRGB=new $i_90.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new $i_90.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=$i_90.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=$i_90.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=$i_90.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},$i_90.MeshPhongMaterial.prototype=Object.create($i_90.Material.prototype),$i_90.MeshPhongMaterial.prototype.clone=function(){var e=new $i_90.MeshPhongMaterial;return $i_90.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},$i_90.MeshDepthMaterial=function(e){$i_90.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},$i_90.MeshDepthMaterial.prototype=Object.create($i_90.Material.prototype),$i_90.MeshDepthMaterial.prototype.clone=function(){var e=new $i_90.LineBasicMaterial;return $i_90.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},$i_90.MeshNormalMaterial=function(e){$i_90.Material.call(this,e),this.shading=$i_90.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},$i_90.MeshNormalMaterial.prototype=Object.create($i_90.Material.prototype),$i_90.MeshNormalMaterial.prototype.clone=function(){var e=new $i_90.MeshNormalMaterial;return $i_90.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},$i_90.MeshFaceMaterial=function(){},$i_90.MeshFaceMaterial.prototype.clone=function(){return new $i_90.MeshFaceMaterial},$i_90.ParticleBasicMaterial=function(e){$i_90.Material.call(this),this.color=new $i_90.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},$i_90.ParticleBasicMaterial.prototype=Object.create($i_90.Material.prototype),$i_90.ParticleBasicMaterial.prototype.clone=function(){var e=new $i_90.ParticleBasicMaterial;return $i_90.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e
},$i_90.ParticleCanvasMaterial=function(e){$i_90.Material.call(this),this.color=new $i_90.Color(16777215),this.program=function(){},this.setValues(e)},$i_90.ParticleCanvasMaterial.prototype=Object.create($i_90.Material.prototype),$i_90.ParticleCanvasMaterial.prototype.clone=function(){var e=new $i_90.ParticleCanvasMaterial;return $i_90.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},$i_90.ParticleDOMMaterial=function(e){this.element=e},$i_90.ParticleDOMMaterial.prototype.clone=function(){return new $i_90.ParticleDOMMaterial(this.element)},$i_90.ShaderMaterial=function(e){$i_90.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=$i_90.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=$i_90.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},$i_90.ShaderMaterial.prototype=Object.create($i_90.Material.prototype),$i_90.ShaderMaterial.prototype.clone=function(){var e=new $i_90.ShaderMaterial;return $i_90.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=this.uniforms,e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},$i_90.Texture=function(e,t,i,r,n,o,a,s,h){$i_90.TextureLibrary.push(this),this.id=$i_90.TextureIdCount++,this.image=e,this.mapping=void 0!==t?t:new $i_90.UVMapping,this.wrapS=void 0!==i?i:$i_90.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:$i_90.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:$i_90.LinearFilter,this.minFilter=void 0!==o?o:$i_90.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==a?a:$i_90.RGBAFormat,this.type=void 0!==s?s:$i_90.UnsignedByteType,this.offset=new $i_90.Vector2(0,0),this.repeat=new $i_90.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.needsUpdate=!1,this.onUpdate=null},$i_90.Texture.prototype={constructor:$i_90.Texture,clone:function(){var e=new $i_90.Texture;return e.image=this.image,e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e},deallocate:function(){var e=$i_90.TextureLibrary.indexOf(this);-1!==e&&$i_90.TextureLibrary.splice(e,1)}},$i_90.TextureIdCount=0,$i_90.TextureLibrary=[],$i_90.CompressedTexture=function(e,t,i,r,n,o,a,s,h,l){$i_90.Texture.call(this,null,o,a,s,h,l,r,n),this.image={width:t,height:i},this.mipmaps=e},$i_90.CompressedTexture.prototype=Object.create($i_90.Texture.prototype),$i_90.CompressedTexture.prototype.clone=function(){var e=new $i_90.CompressedTexture;return e.image=this.image,e.mipmaps=this.mipmaps,e.format=this.format,e.type=this.type,e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},$i_90.DataTexture=function(e,t,i,r,n,o,a,s,h,l){$i_90.Texture.call(this,null,o,a,s,h,l,r,n),this.image={data:e,width:t,height:i}},$i_90.DataTexture.prototype=Object.create($i_90.Texture.prototype),$i_90.DataTexture.prototype.clone=function(){var e=new $i_90.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},$i_90.Particle=function(e){$i_90.Object3D.call(this),this.material=e},$i_90.Particle.prototype=Object.create($i_90.Object3D.prototype),$i_90.Particle.prototype.clone=function(e){return void 0===e&&(e=new $i_90.Particle(this.material)),$i_90.Object3D.prototype.clone.call(this,e),e},$i_90.ParticleSystem=function(e,t){$i_90.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new $i_90.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&(null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius),this.frustumCulled=!1},$i_90.ParticleSystem.prototype=Object.create($i_90.Object3D.prototype),$i_90.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new $i_90.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,$i_90.Object3D.prototype.clone.call(this,e),e},$i_90.Line=function(e,t,i){$i_90.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new $i_90.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==i?i:$i_90.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},$i_90.LineStrip=0,$i_90.LinePieces=1,$i_90.Line.prototype=Object.create($i_90.Object3D.prototype),$i_90.Line.prototype.clone=function(e){return void 0===e&&(e=new $i_90.Line(this.geometry,this.material,this.type)),$i_90.Object3D.prototype.clone.call(this,e),e},$i_90.Mesh=function(e,t){if($i_90.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new $i_90.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}),this.geometry&&(null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0;this.geometry.morphTargets.length>i;i++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[i].name]=i}},$i_90.Mesh.prototype=Object.create($i_90.Object3D.prototype),$i_90.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("$i_90.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},$i_90.Mesh.prototype.clone=function(e){return void 0===e&&(e=new $i_90.Mesh(this.geometry,this.material)),$i_90.Object3D.prototype.clone.call(this,e),e},$i_90.Bone=function(e){$i_90.Object3D.call(this),this.skin=e,this.skinMatrix=new $i_90.Matrix4},$i_90.Bone.prototype=Object.create($i_90.Object3D.prototype),$i_90.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,r=this.children.length;for(i=0;r>i;i++)this.children[i].update(this.skinMatrix,t)},$i_90.SkinnedMesh=function(e,t,i){$i_90.Mesh.call(this,e,t),this.useVertexTexture=void 0!==i?i:!0,this.identityMatrix=new $i_90.Matrix4,this.bones=[],this.boneMatrices=[];var r,n,o;if(void 0!==this.geometry.bones){for(e=0;this.geometry.bones.length>e;e++)i=this.geometry.bones[e],r=i.pos,n=i.rotq,o=i.scl,t=this.addBone(),t.name=i.name,t.position.set(r[0],r[1],r[2]),t.quaternion.set(n[0],n[1],n[2],n[3]),t.useQuaternion=!0,void 0!==o?t.scale.set(o[0],o[1],o[2]):t.scale.set(1,1,1);for(e=0;this.bones.length>e;e++)i=this.geometry.bones[e],t=this.bones[e],-1===i.parent?this.add(t):this.bones[i.parent].add(t);e=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=e=e>256?64:e>64?32:e>16?16:8,this.boneMatrices=new Float32Array(4*this.boneTextureWidth*this.boneTextureHeight),this.boneTexture=new $i_90.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,$i_90.RGBAFormat,$i_90.FloatType),this.boneTexture.minFilter=$i_90.NearestFilter,this.boneTexture.magFilter=$i_90.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*e),this.pose()}},$i_90.SkinnedMesh.prototype=Object.create($i_90.Mesh.prototype),$i_90.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new $i_90.Bone(this)),this.bones.push(e),e},$i_90.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1);for(var e=0,t=this.children.length;t>e;e++){var i=this.children[e];i instanceof $i_90.Bone?i.update(this.identityMatrix,!1):i.updateMatrixWorld(!0)}if(void 0==this.boneInverses)for(this.boneInverses=[],e=0,t=this.bones.length;t>e;e++)i=new $i_90.Matrix4,i.getInverse(this.bones[e].skinMatrix),this.boneInverses.push(i);for(e=0,t=this.bones.length;t>e;e++)$i_90.SkinnedMesh.offsetMatrix.multiply(this.bones[e].skinMatrix,this.boneInverses[e]),$i_90.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*e);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},$i_90.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;this.geometry.skinIndices.length>e;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();1/0!==i?t.multiplyScalar(i):t.set(1)}},$i_90.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new $i_90.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),$i_90.Mesh.prototype.clone.call(this,e),e},$i_90.SkinnedMesh.offsetMatrix=new $i_90.Matrix4,$i_90.MorphAnimMesh=function(e,t){$i_90.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},$i_90.MorphAnimMesh.prototype=Object.create($i_90.Mesh.prototype),$i_90.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},$i_90.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},$i_90.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},$i_90.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,r=/([a-z]+)(\d+)/,n=0,o=e.morphTargets.length;o>n;n++){var a=e.morphTargets[n].name.match(r);if(a&&a.length>1){a=a[1],i[a]||(i[a]={start:1/0,end:-1/0});var s=i[a];s.start>n&&(s.start=n),n>s.end&&(s.end=n),t||(t=a)}}e.firstAnimation=t},$i_90.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},$i_90.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=1e3*((i.end-i.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},$i_90.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||0>this.time)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)):(this.time%=this.duration,0>this.time&&(this.time+=this.duration)),e=this.startKeyframe+$i_90.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},$i_90.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new $i_90.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,$i_90.Mesh.prototype.clone.call(this,e),e},$i_90.Ribbon=function(e,t){$i_90.Object3D.call(this),this.geometry=e,this.material=t},$i_90.Ribbon.prototype=Object.create($i_90.Object3D.prototype),$i_90.Ribbon.prototype.clone=function(e){return void 0===e&&(e=new $i_90.Ribbon(this.geometry,this.material)),$i_90.Object3D.prototype.clone.call(this,e),e},$i_90.LOD=function(){$i_90.Object3D.call(this),this.LODs=[]},$i_90.LOD.prototype=Object.create($i_90.Object3D.prototype),$i_90.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),i=0;this.LODs.length>i&&this.LODs[i].visibleAtDistance<=t;i++);this.LODs.splice(i,0,{visibleAtDistance:t,object3D:e}),this.add(e)},$i_90.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld),e=e.matrixWorldInverse,e=-(e.elements[2]*this.matrixWorld.elements[12]+e.elements[6]*this.matrixWorld.elements[13]+e.elements[10]*this.matrixWorld.elements[14]+e.elements[14]),this.LODs[0].object3D.visible=!0;for(var t=1;this.LODs.length>t;t++){if(this.LODs[t].visibleAtDistance>e)break;this.LODs[t-1].object3D.visible=!1,this.LODs[t].object3D.visible=!0}for(;this.LODs.length>t;t++)this.LODs[t].object3D.visible=!1}},$i_90.LOD.prototype.clone=function(){},$i_90.Sprite=function(e){$i_90.Object3D.call(this),this.color=void 0!==e.color?new $i_90.Color(e.color):new $i_90.Color(16777215),this.map=void 0!==e.map?e.map:new $i_90.Texture,this.blending=void 0!==e.blending?e.blending:$i_90.NormalBlending,this.blendSrc=void 0!==e.blendSrc?e.blendSrc:$i_90.SrcAlphaFactor,this.blendDst=void 0!==e.blendDst?e.blendDst:$i_90.OneMinusSrcAlphaFactor,this.blendEquation=void 0!==e.blendEquation?e.blendEquation:$i_90.AddEquation,this.useScreenCoordinates=void 0!==e.useScreenCoordinates?e.useScreenCoordinates:!0,this.mergeWith3D=void 0!==e.mergeWith3D?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==e.affectedByDistance?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==e.scaleByViewport?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof $i_90.Vector2?e.alignment:$i_90.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new $i_90.Vector2(0,0),this.uvScale=new $i_90.Vector2(1,1)},$i_90.Sprite.prototype=Object.create($i_90.Object3D.prototype),$i_90.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},$i_90.Sprite.prototype.clone=function(e){return void 0===e&&(e=new $i_90.Sprite({})),e.color.copy(this.color),e.map=this.map,e.blending=this.blending,e.useScreenCoordinates=this.useScreenCoordinates,e.mergeWith3D=this.mergeWith3D,e.affectedByDistance=this.affectedByDistance,e.scaleByViewport=this.scaleByViewport,e.alignment=this.alignment,e.rotation3d.copy(this.rotation3d),e.rotation=this.rotation,e.opacity=this.opacity,e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),$i_90.Object3D.prototype.clone.call(this,e),e},$i_90.SpriteAlignment={},$i_90.SpriteAlignment.topLeft=new $i_90.Vector2(1,-1),$i_90.SpriteAlignment.topCenter=new $i_90.Vector2(0,-1),$i_90.SpriteAlignment.topRight=new $i_90.Vector2(-1,-1),$i_90.SpriteAlignment.centerLeft=new $i_90.Vector2(1,0),$i_90.SpriteAlignment.center=new $i_90.Vector2(0,0),$i_90.SpriteAlignment.centerRight=new $i_90.Vector2(-1,0),$i_90.SpriteAlignment.bottomLeft=new $i_90.Vector2(1,1),$i_90.SpriteAlignment.bottomCenter=new $i_90.Vector2(0,1),$i_90.SpriteAlignment.bottomRight=new $i_90.Vector2(-1,1),$i_90.Scene=function(){$i_90.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},$i_90.Scene.prototype=Object.create($i_90.Object3D.prototype),$i_90.Scene.prototype.__addObject=function(e){if(e instanceof $i_90.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof $i_90.Camera||e instanceof $i_90.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(t=0;e.children.length>t;t++)this.__addObject(e.children[t])},$i_90.Scene.prototype.__removeObject=function(e){if(e instanceof $i_90.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1)}else e instanceof $i_90.Camera||(t=this.__objects.indexOf(e),-1!==t&&(this.__objects.splice(t,1),this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),-1!==t&&this.__objectsAdded.splice(t,1)));for(t=0;e.children.length>t;t++)this.__removeObject(e.children[t])},$i_90.Fog=function(e,t,i){this.color=new $i_90.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},$i_90.FogExp2=function(e,t){this.color=new $i_90.Color(e),this.density=void 0!==t?t:25e-5},$i_90.CanvasRenderer=function(e){function t(e){Z!==e&&(Z=Y.globalAlpha=e)}function i(e){Q!==e&&(e===$i_90.NormalBlending?Y.globalCompositeOperation="source-over":e===$i_90.AdditiveBlending?Y.globalCompositeOperation="lighter":e===$i_90.SubtractiveBlending&&(Y.globalCompositeOperation="darker"),Q=e)}function r(e){J!==e&&(J=Y.strokeStyle=e)}function n(e){$!==e&&($=Y.fillStyle=e)}console.log("$i_90.CanvasRenderer",$i_90.REVISION);var o,a,s,h,l,c,u,d,f,p,m,E,g,v,y,_,T,x,R,b,w,H,S,M,C,A,P,L,I,U,D,F,z,B,V,N,O,k,W,e=e||{},G=this,j=new $i_90.Projector,X=void 0!==e.canvas?e.canvas:document.createElement("canvas"),Y=X.getContext("2d"),q=new $i_90.Color(0),K=0,Z=1,Q=0,J=null,$=null,et=null,tt=null,it=null,rt=new $i_90.RenderableVertex,nt=new $i_90.RenderableVertex,ot=new $i_90.Color,at=new $i_90.Color,st=new $i_90.Color,ht=new $i_90.Color,lt=new $i_90.Color,ct=new $i_90.Color,ut=new $i_90.Color,dt={},ft={},pt=new $i_90.Rectangle,mt=new $i_90.Rectangle,Et=new $i_90.Rectangle,gt=!1,vt=new $i_90.Color,yt=new $i_90.Color,_t=new $i_90.Color,Tt=new $i_90.Vector3,e=16;B=document.createElement("canvas"),B.width=B.height=2,V=B.getContext("2d"),V.fillStyle="rgba(0,0,0,1)",V.fillRect(0,0,2,2),N=V.getImageData(0,0,2,2),O=N.data,k=document.createElement("canvas"),k.width=k.height=e,W=k.getContext("2d"),W.translate(-e/2,-e/2),W.scale(e,e),e--,this.domElement=X,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(e,t){h=e,l=t,c=Math.floor(h/2),u=Math.floor(l/2),X.width=h,X.height=l,pt.set(-c,-u,c,u),mt.set(-c,-u,c,u),Z=1,Q=0,it=tt=et=$=J=null},this.setClearColor=function(e,t){q.copy(e),K=void 0!==t?t:1,mt.set(-c,-u,c,u)},this.setClearColorHex=function(e,t){q.setHex(e),K=void 0!==t?t:1,mt.set(-c,-u,c,u)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){Y.setTransform(1,0,0,-1,c,u),!1===mt.isEmpty()&&(mt.minSelf(pt),mt.inflate(2),1>K&&Y.clearRect(Math.floor(mt.getX()),Math.floor(mt.getY()),Math.floor(mt.getWidth()),Math.floor(mt.getHeight())),K>0&&(i($i_90.NormalBlending),t(1),n("rgba("+Math.floor(255*q.r)+","+Math.floor(255*q.g)+","+Math.floor(255*q.b)+","+K+")"),Y.fillRect(Math.floor(mt.getX()),Math.floor(mt.getY()),Math.floor(mt.getWidth()),Math.floor(mt.getHeight()))),mt.empty())},this.render=function(e,h){function l(e,t,i){for(var r=0,n=s.length;n>r;r++){var o=s[r],a=o.color;if(o instanceof $i_90.DirectionalLight){var h=o.matrixWorld.getPosition().normalize(),l=t.dot(h);0>=l||(l*=o.intensity,i.r+=a.r*l,i.g+=a.g*l,i.b+=a.b*l)}else o instanceof $i_90.PointLight&&(h=o.matrixWorld.getPosition(),l=t.dot(Tt.sub(h,e).normalize()),0>=l||(l*=0==o.distance?1:1-Math.min(e.distanceTo(h)/o.distance,1),0!=l&&(l*=o.intensity,i.r+=a.r*l,i.g+=a.g*l,i.b+=a.b*l)))}}function X(e,r,n,o,a,s,c,u){G.info.render.vertices+=3,G.info.render.faces++,t(u.opacity),i(u.blending),E=e.positionScreen.x,g=e.positionScreen.y,v=r.positionScreen.x,y=r.positionScreen.y,_=n.positionScreen.x,T=n.positionScreen.y,q(E,g,v,y,_,T),(u instanceof $i_90.MeshLambertMaterial||u instanceof $i_90.MeshPhongMaterial)&&null===u.map&&null===u.map?(ct.copy(u.color),ut.copy(u.emissive),u.vertexColors===$i_90.FaceColors&&(ct.r*=c.color.r,ct.g*=c.color.g,ct.b*=c.color.b),!0===gt?!1===u.wireframe&&u.shading==$i_90.SmoothShading&&3==c.vertexNormalsLength?(at.r=st.r=ht.r=vt.r,at.g=st.g=ht.g=vt.g,at.b=st.b=ht.b=vt.b,l(c.v1.positionWorld,c.vertexNormalsWorld[0],at),l(c.v2.positionWorld,c.vertexNormalsWorld[1],st),l(c.v3.positionWorld,c.vertexNormalsWorld[2],ht),at.r=at.r*ct.r+ut.r,at.g=at.g*ct.g+ut.g,at.b=at.b*ct.b+ut.b,st.r=st.r*ct.r+ut.r,st.g=st.g*ct.g+ut.g,st.b=st.b*ct.b+ut.b,ht.r=ht.r*ct.r+ut.r,ht.g=ht.g*ct.g+ut.g,ht.b=ht.b*ct.b+ut.b,lt.r=.5*(st.r+ht.r),lt.g=.5*(st.g+ht.g),lt.b=.5*(st.b+ht.b),A=xt(at,st,ht,lt),$(E,g,v,y,_,T,0,0,1,0,0,1,A)):(ot.r=vt.r,ot.g=vt.g,ot.b=vt.b,l(c.centroidWorld,c.normalWorld,ot),ot.r=ot.r*ct.r+ut.r,ot.g=ot.g*ct.g+ut.g,ot.b=ot.b*ct.b+ut.b,!0===u.wireframe?Z(ot,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Q(ot)):!0===u.wireframe?Z(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Q(u.color)):u instanceof $i_90.MeshBasicMaterial||u instanceof $i_90.MeshLambertMaterial||u instanceof $i_90.MeshPhongMaterial?null!==u.map?u.map.mapping instanceof $i_90.UVMapping&&(P=c.uvs[0],J(E,g,v,y,_,T,P[o].u,P[o].v,P[a].u,P[a].v,P[s].u,P[s].v,u.map)):null!==u.envMap?u.envMap.mapping instanceof $i_90.SphericalReflectionMapping&&(e=h.matrixWorldInverse,Tt.copy(c.vertexNormalsWorld[o]),L=.5*(Tt.x*e.elements[0]+Tt.y*e.elements[4]+Tt.z*e.elements[8])+.5,I=.5*(Tt.x*e.elements[1]+Tt.y*e.elements[5]+Tt.z*e.elements[9])+.5,Tt.copy(c.vertexNormalsWorld[a]),U=.5*(Tt.x*e.elements[0]+Tt.y*e.elements[4]+Tt.z*e.elements[8])+.5,D=.5*(Tt.x*e.elements[1]+Tt.y*e.elements[5]+Tt.z*e.elements[9])+.5,Tt.copy(c.vertexNormalsWorld[s]),F=.5*(Tt.x*e.elements[0]+Tt.y*e.elements[4]+Tt.z*e.elements[8])+.5,z=.5*(Tt.x*e.elements[1]+Tt.y*e.elements[5]+Tt.z*e.elements[9])+.5,J(E,g,v,y,_,T,L,I,U,D,F,z,u.envMap)):(ot.copy(u.color),u.vertexColors===$i_90.FaceColors&&(ot.r*=c.color.r,ot.g*=c.color.g,ot.b*=c.color.b),!0===u.wireframe?Z(ot,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Q(ot)):u instanceof $i_90.MeshDepthMaterial?(M=h.near,C=h.far,at.r=at.g=at.b=1-Rt(e.positionScreen.z,M,C),st.r=st.g=st.b=1-Rt(r.positionScreen.z,M,C),ht.r=ht.g=ht.b=1-Rt(n.positionScreen.z,M,C),lt.r=.5*(st.r+ht.r),lt.g=.5*(st.g+ht.g),lt.b=.5*(st.b+ht.b),A=xt(at,st,ht,lt),$(E,g,v,y,_,T,0,0,1,0,0,1,A)):u instanceof $i_90.MeshNormalMaterial&&(ot.r=bt(c.normalWorld.x),ot.g=bt(c.normalWorld.y),ot.b=bt(c.normalWorld.z),!0===u.wireframe?Z(ot,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Q(ot))}function q(e,t,i,r,n,o){Y.beginPath(),Y.moveTo(e,t),Y.lineTo(i,r),Y.lineTo(n,o),Y.closePath()}function K(e,t,i,r,n,o,a,s){Y.beginPath(),Y.moveTo(e,t),Y.lineTo(i,r),Y.lineTo(n,o),Y.lineTo(a,s),Y.closePath()}function Z(e,t,i,n){et!==t&&(et=Y.lineWidth=t),tt!==i&&(tt=Y.lineCap=i),it!==n&&(it=Y.lineJoin=n),r(e.getContextStyle()),Y.stroke(),Et.inflate(2*t)}function Q(e){n(e.getContextStyle()),Y.fill()}function J(e,t,i,r,o,a,s,h,l,c,u,d,f){if(!(f instanceof $i_90.DataTexture||void 0===f.image||0==f.image.width)){if(!0===f.needsUpdate){var p=f.wrapS==$i_90.RepeatWrapping,m=f.wrapT==$i_90.RepeatWrapping;dt[f.id]=Y.createPattern(f.image,!0===p&&!0===m?"repeat":!0===p&&!1===m?"repeat-x":!1===p&&!0===m?"repeat-y":"no-repeat"),f.needsUpdate=!1}void 0===dt[f.id]?n("rgba(0,0,0,1)"):n(dt[f.id]);var p=f.offset.x/f.repeat.x,m=f.offset.y/f.repeat.y,E=f.image.width*f.repeat.x,g=f.image.height*f.repeat.y,s=(s+p)*E,h=(1-h+m)*g,i=i-e,r=r-t,o=o-e,a=a-t,l=(l+p)*E-s,c=(1-c+m)*g-h,u=(u+p)*E-s,d=(1-d+m)*g-h,p=l*d-u*c;0===p?(void 0===ft[f.id]&&(t=document.createElement("canvas"),t.width=f.image.width,t.height=f.image.height,t=t.getContext("2d"),t.drawImage(f.image,0,0),ft[f.id]=t.getImageData(0,0,f.image.width,f.image.height).data),t=ft[f.id],s=4*(Math.floor(s)+Math.floor(h)*f.image.width),ot.setRGB(t[s]/255,t[s+1]/255,t[s+2]/255),Q(ot)):(p=1/p,f=(d*i-c*o)*p,c=(d*r-c*a)*p,i=(l*o-u*i)*p,r=(l*a-u*r)*p,e=e-f*s-i*h,s=t-c*s-r*h,Y.save(),Y.transform(f,c,i,r,e,s),Y.fill(),Y.restore())}}function $(e,t,i,r,n,o,a,s,h,l,c,u,d){var f,p;f=d.width-1,p=d.height-1,a*=f,s*=p,i-=e,r-=t,n-=e,o-=t,h=h*f-a,l=l*p-s,c=c*f-a,u=u*p-s,p=1/(h*u-c*l),f=(u*i-l*n)*p,l=(u*r-l*o)*p,i=(h*n-c*i)*p,r=(h*o-c*r)*p,e=e-f*a-i*s,t=t-l*a-r*s,Y.save(),Y.transform(f,l,i,r,e,t),Y.clip(),Y.drawImage(d,0,0),Y.restore()}function xt(e,t,i,r){return O[0]=255*e.r|0,O[1]=255*e.g|0,O[2]=255*e.b|0,O[4]=255*t.r|0,O[5]=255*t.g|0,O[6]=255*t.b|0,O[8]=255*i.r|0,O[9]=255*i.g|0,O[10]=255*i.b|0,O[12]=255*r.r|0,O[13]=255*r.g|0,O[14]=255*r.b|0,V.putImageData(N,0,0),W.drawImage(B,0,0),k}function Rt(e,t,i){return e=(e-t)/(i-t),e*e*(3-2*e)}function bt(e){return e=.5*(e+1),0>e?0:e>1?1:e}function wt(e,t){var i=t.x-e.x,r=t.y-e.y,n=i*i+r*r;0!==n&&(n=1/Math.sqrt(n),i*=n,r*=n,t.x+=i,t.y+=r,e.x-=i,e.y-=r)}if(!1==h instanceof $i_90.Camera)console.error("$i_90.CanvasRenderer.render: camera is not an instance of $i_90.Camera.");else{var Ht,St,Mt,Ct;if(!0===this.autoClear?this.clear():Y.setTransform(1,0,0,-1,c,u),G.info.render.vertices=0,G.info.render.faces=0,o=j.projectScene(e,h,this.sortObjects,this.sortElements),a=o.elements,s=o.lights,gt=s.length>0,!0===gt)for(vt.setRGB(0,0,0),yt.setRGB(0,0,0),_t.setRGB(0,0,0),Ht=0,St=s.length;St>Ht;Ht++){Ct=s[Ht];var At=Ct.color;Ct instanceof $i_90.AmbientLight?(vt.r+=At.r,vt.g+=At.g,vt.b+=At.b):Ct instanceof $i_90.DirectionalLight?(yt.r+=At.r,yt.g+=At.g,yt.b+=At.b):Ct instanceof $i_90.PointLight&&(_t.r+=At.r,_t.g+=At.g,_t.b+=At.b)}for(Ht=0,St=a.length;St>Ht;Ht++)if(Mt=a[Ht],Ct=Mt.material,void 0!==Ct&&!1!==Ct.visible){if(Et.empty(),Mt instanceof $i_90.RenderableParticle){d=Mt,d.x*=c,d.y*=u;var At=d,Pt=Mt;t(Ct.opacity),i(Ct.blending);var Lt=void 0,It=void 0,Ut=void 0,Dt=void 0,Ft=Mt=void 0,zt=void 0;Ct instanceof $i_90.ParticleBasicMaterial?null===Ct.map?(Ut=Pt.object.scale.x,Dt=Pt.object.scale.y,Ut*=Pt.scale.x*c,Dt*=Pt.scale.y*u,Et.set(At.x-Ut,At.y-Dt,At.x+Ut,At.y+Dt),!1!==pt.intersects(Et)&&(n(Ct.color.getContextStyle()),Y.save(),Y.translate(At.x,At.y),Y.rotate(-Pt.rotation),Y.scale(Ut,Dt),Y.fillRect(-1,-1,2,2),Y.restore())):(Mt=Ct.map.image,Ft=Mt.width>>1,zt=Mt.height>>1,Ut=Pt.scale.x*c,Dt=Pt.scale.y*u,Lt=Ut*Ft,It=Dt*zt,Et.set(At.x-Lt,At.y-It,At.x+Lt,At.y+It),!1!==pt.intersects(Et)&&(Y.save(),Y.translate(At.x,At.y),Y.rotate(-Pt.rotation),Y.scale(Ut,-Dt),Y.translate(-Ft,-zt),Y.drawImage(Mt,0,0),Y.restore())):Ct instanceof $i_90.ParticleCanvasMaterial&&(Lt=Pt.scale.x*c,It=Pt.scale.y*u,Et.set(At.x-Lt,At.y-It,At.x+Lt,At.y+It),!1!==pt.intersects(Et)&&(r(Ct.color.getContextStyle()),n(Ct.color.getContextStyle()),Y.save(),Y.translate(At.x,At.y),Y.rotate(-Pt.rotation),Y.scale(Lt,It),Ct.program(Y),Y.restore()))}else Mt instanceof $i_90.RenderableLine?(d=Mt.v1,f=Mt.v2,d.positionScreen.x*=c,d.positionScreen.y*=u,f.positionScreen.x*=c,f.positionScreen.y*=u,Et.addPoint(d.positionScreen.x,d.positionScreen.y),Et.addPoint(f.positionScreen.x,f.positionScreen.y),!0===pt.intersects(Et)&&(At=d,Pt=f,t(Ct.opacity),i(Ct.blending),Y.beginPath(),Y.moveTo(At.positionScreen.x,At.positionScreen.y),Y.lineTo(Pt.positionScreen.x,Pt.positionScreen.y),Ct instanceof $i_90.LineBasicMaterial)&&(At=Ct.linewidth,et!==At&&(et=Y.lineWidth=At),At=Ct.linecap,tt!==At&&(tt=Y.lineCap=At),At=Ct.linejoin,it!==At&&(it=Y.lineJoin=At),r(Ct.color.getContextStyle()),Y.stroke(),Et.inflate(2*Ct.linewidth))):Mt instanceof $i_90.RenderableFace3?(d=Mt.v1,f=Mt.v2,p=Mt.v3,d.positionScreen.x*=c,d.positionScreen.y*=u,f.positionScreen.x*=c,f.positionScreen.y*=u,p.positionScreen.x*=c,p.positionScreen.y*=u,!0===Ct.overdraw&&(wt(d.positionScreen,f.positionScreen),wt(f.positionScreen,p.positionScreen),wt(p.positionScreen,d.positionScreen)),Et.add3Points(d.positionScreen.x,d.positionScreen.y,f.positionScreen.x,f.positionScreen.y,p.positionScreen.x,p.positionScreen.y),!0===pt.intersects(Et)&&X(d,f,p,0,1,2,Mt,Ct,e)):Mt instanceof $i_90.RenderableFace4&&(d=Mt.v1,f=Mt.v2,p=Mt.v3,m=Mt.v4,d.positionScreen.x*=c,d.positionScreen.y*=u,f.positionScreen.x*=c,f.positionScreen.y*=u,p.positionScreen.x*=c,p.positionScreen.y*=u,m.positionScreen.x*=c,m.positionScreen.y*=u,rt.positionScreen.copy(f.positionScreen),nt.positionScreen.copy(m.positionScreen),!0===Ct.overdraw&&(wt(d.positionScreen,f.positionScreen),wt(f.positionScreen,m.positionScreen),wt(m.positionScreen,d.positionScreen),wt(p.positionScreen,rt.positionScreen),wt(p.positionScreen,nt.positionScreen)),Et.addPoint(d.positionScreen.x,d.positionScreen.y),Et.addPoint(f.positionScreen.x,f.positionScreen.y),Et.addPoint(p.positionScreen.x,p.positionScreen.y),Et.addPoint(m.positionScreen.x,m.positionScreen.y),!0===pt.intersects(Et))&&(At=d,Pt=f,Lt=p,It=m,Ut=rt,Dt=nt,Ft=e,G.info.render.vertices+=4,G.info.render.faces++,t(Ct.opacity),i(Ct.blending),void 0!==Ct.map&&null!==Ct.map||void 0!==Ct.envMap&&null!==Ct.envMap?(X(At,Pt,It,0,1,3,Mt,Ct,Ft),X(Ut,Lt,Dt,1,2,3,Mt,Ct,Ft)):(E=At.positionScreen.x,g=At.positionScreen.y,v=Pt.positionScreen.x,y=Pt.positionScreen.y,_=Lt.positionScreen.x,T=Lt.positionScreen.y,x=It.positionScreen.x,R=It.positionScreen.y,b=Ut.positionScreen.x,w=Ut.positionScreen.y,H=Dt.positionScreen.x,S=Dt.positionScreen.y,Ct instanceof $i_90.MeshLambertMaterial||Ct instanceof $i_90.MeshPhongMaterial?(ct.copy(Ct.color),ut.copy(Ct.emissive),Ct.vertexColors===$i_90.FaceColors&&(ct.r*=Mt.color.r,ct.g*=Mt.color.g,ct.b*=Mt.color.b),!0===gt?!1===Ct.wireframe&&Ct.shading==$i_90.SmoothShading&&4==Mt.vertexNormalsLength?(at.r=st.r=ht.r=lt.r=vt.r,at.g=st.g=ht.g=lt.g=vt.g,at.b=st.b=ht.b=lt.b=vt.b,l(Mt.v1.positionWorld,Mt.vertexNormalsWorld[0],at),l(Mt.v2.positionWorld,Mt.vertexNormalsWorld[1],st),l(Mt.v4.positionWorld,Mt.vertexNormalsWorld[3],ht),l(Mt.v3.positionWorld,Mt.vertexNormalsWorld[2],lt),at.r=at.r*ct.r+ut.r,at.g=at.g*ct.g+ut.g,at.b=at.b*ct.b+ut.b,st.r=st.r*ct.r+ut.r,st.g=st.g*ct.g+ut.g,st.b=st.b*ct.b+ut.b,ht.r=ht.r*ct.r+ut.r,ht.g=ht.g*ct.g+ut.g,ht.b=ht.b*ct.b+ut.b,lt.r=lt.r*ct.r+ut.r,lt.g=lt.g*ct.g+ut.g,lt.b=lt.b*ct.b+ut.b,A=xt(at,st,ht,lt),q(E,g,v,y,x,R),$(E,g,v,y,x,R,0,0,1,0,0,1,A),q(b,w,_,T,H,S),$(b,w,_,T,H,S,1,0,1,1,0,1,A)):(ot.r=vt.r,ot.g=vt.g,ot.b=vt.b,l(Mt.centroidWorld,Mt.normalWorld,ot),ot.r=ot.r*ct.r+ut.r,ot.g=ot.g*ct.g+ut.g,ot.b=ot.b*ct.b+ut.b,K(E,g,v,y,_,T,x,R),!0===Ct.wireframe?Z(ot,Ct.wireframeLinewidth,Ct.wireframeLinecap,Ct.wireframeLinejoin):Q(ot)):(ot.r=ct.r+ut.r,ot.g=ct.g+ut.g,ot.b=ct.b+ut.b,K(E,g,v,y,_,T,x,R),!0===Ct.wireframe?Z(ot,Ct.wireframeLinewidth,Ct.wireframeLinecap,Ct.wireframeLinejoin):Q(ot))):Ct instanceof $i_90.MeshBasicMaterial?(ot.copy(Ct.color),Ct.vertexColors===$i_90.FaceColors&&(ot.r*=Mt.color.r,ot.g*=Mt.color.g,ot.b*=Mt.color.b),K(E,g,v,y,_,T,x,R),!0===Ct.wireframe?Z(ot,Ct.wireframeLinewidth,Ct.wireframeLinecap,Ct.wireframeLinejoin):Q(ot)):Ct instanceof $i_90.MeshNormalMaterial?(ot.r=bt(Mt.normalWorld.x),ot.g=bt(Mt.normalWorld.y),ot.b=bt(Mt.normalWorld.z),K(E,g,v,y,_,T,x,R),!0===Ct.wireframe?Z(ot,Ct.wireframeLinewidth,Ct.wireframeLinecap,Ct.wireframeLinejoin):Q(ot)):Ct instanceof $i_90.MeshDepthMaterial&&(M=h.near,C=h.far,at.r=at.g=at.b=1-Rt(At.positionScreen.z,M,C),st.r=st.g=st.b=1-Rt(Pt.positionScreen.z,M,C),ht.r=ht.g=ht.b=1-Rt(It.positionScreen.z,M,C),lt.r=lt.g=lt.b=1-Rt(Lt.positionScreen.z,M,C),A=xt(at,st,ht,lt),q(E,g,v,y,x,R),$(E,g,v,y,x,R,0,0,1,0,0,1,A),q(b,w,_,T,H,S),$(b,w,_,T,H,S,1,0,1,1,0,1,A))));mt.addRectangle(Et)}Y.setTransform(1,0,0,1,0,0)}}},$i_90.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n#ifdef USE_SKINNING\nvec4 mPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 mPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 mPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 nWorld = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = mPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -viewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );\nvec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, N_BONE_PIXEL_X );\nfloat y = floor( j / N_BONE_PIXEL_X );\nconst float dx = 1.0 / N_BONE_PIXEL_X;\nconst float dy = 1.0 / N_BONE_PIXEL_Y;\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix 	+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},$i_90.UniformsUtils={merge:function(e){var t,i,r,n={};
for(t=0;e.length>t;t++)for(i in r=this.clone(e[t]))n[i]=r[i];return n},clone:function(e){var t,i,r,n={};for(t in e)for(i in n[t]={},e[t])r=e[t][i],n[t][i]=r instanceof $i_90.Color||r instanceof $i_90.Vector2||r instanceof $i_90.Vector3||r instanceof $i_90.Vector4||r instanceof $i_90.Matrix4||r instanceof $i_90.Texture?r.clone():r instanceof Array?r.slice():r;return n}},$i_90.UniformsLib={common:{diffuse:{type:"c",value:new $i_90.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new $i_90.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new $i_90.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new $i_90.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightPosition:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new $i_90.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new $i_90.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},$i_90.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:$i_90.UniformsUtils.merge([$i_90.UniformsLib.common,$i_90.UniformsLib.fog,$i_90.UniformsLib.shadowmap]),vertexShader:[$i_90.ShaderChunk.map_pars_vertex,$i_90.ShaderChunk.lightmap_pars_vertex,$i_90.ShaderChunk.envmap_pars_vertex,$i_90.ShaderChunk.color_pars_vertex,$i_90.ShaderChunk.morphtarget_pars_vertex,$i_90.ShaderChunk.skinning_pars_vertex,$i_90.ShaderChunk.shadowmap_pars_vertex,"void main() {",$i_90.ShaderChunk.map_vertex,$i_90.ShaderChunk.lightmap_vertex,$i_90.ShaderChunk.color_vertex,"#ifdef USE_ENVMAP",$i_90.ShaderChunk.morphnormal_vertex,$i_90.ShaderChunk.skinbase_vertex,$i_90.ShaderChunk.skinnormal_vertex,$i_90.ShaderChunk.defaultnormal_vertex,"#endif",$i_90.ShaderChunk.morphtarget_vertex,$i_90.ShaderChunk.skinning_vertex,$i_90.ShaderChunk.default_vertex,$i_90.ShaderChunk.worldpos_vertex,$i_90.ShaderChunk.envmap_vertex,$i_90.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",$i_90.ShaderChunk.color_pars_fragment,$i_90.ShaderChunk.map_pars_fragment,$i_90.ShaderChunk.lightmap_pars_fragment,$i_90.ShaderChunk.envmap_pars_fragment,$i_90.ShaderChunk.fog_pars_fragment,$i_90.ShaderChunk.shadowmap_pars_fragment,$i_90.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",$i_90.ShaderChunk.map_fragment,$i_90.ShaderChunk.alphatest_fragment,$i_90.ShaderChunk.specularmap_fragment,$i_90.ShaderChunk.lightmap_fragment,$i_90.ShaderChunk.color_fragment,$i_90.ShaderChunk.envmap_fragment,$i_90.ShaderChunk.shadowmap_fragment,$i_90.ShaderChunk.linear_to_gamma_fragment,$i_90.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:$i_90.UniformsUtils.merge([$i_90.UniformsLib.common,$i_90.UniformsLib.fog,$i_90.UniformsLib.lights,$i_90.UniformsLib.shadowmap,{ambient:{type:"c",value:new $i_90.Color(16777215)},emissive:{type:"c",value:new $i_90.Color(0)},wrapRGB:{type:"v3",value:new $i_90.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",$i_90.ShaderChunk.map_pars_vertex,$i_90.ShaderChunk.lightmap_pars_vertex,$i_90.ShaderChunk.envmap_pars_vertex,$i_90.ShaderChunk.lights_lambert_pars_vertex,$i_90.ShaderChunk.color_pars_vertex,$i_90.ShaderChunk.morphtarget_pars_vertex,$i_90.ShaderChunk.skinning_pars_vertex,$i_90.ShaderChunk.shadowmap_pars_vertex,"void main() {",$i_90.ShaderChunk.map_vertex,$i_90.ShaderChunk.lightmap_vertex,$i_90.ShaderChunk.color_vertex,$i_90.ShaderChunk.morphnormal_vertex,$i_90.ShaderChunk.skinbase_vertex,$i_90.ShaderChunk.skinnormal_vertex,$i_90.ShaderChunk.defaultnormal_vertex,$i_90.ShaderChunk.morphtarget_vertex,$i_90.ShaderChunk.skinning_vertex,$i_90.ShaderChunk.default_vertex,$i_90.ShaderChunk.worldpos_vertex,$i_90.ShaderChunk.envmap_vertex,$i_90.ShaderChunk.lights_lambert_vertex,$i_90.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",$i_90.ShaderChunk.color_pars_fragment,$i_90.ShaderChunk.map_pars_fragment,$i_90.ShaderChunk.lightmap_pars_fragment,$i_90.ShaderChunk.envmap_pars_fragment,$i_90.ShaderChunk.fog_pars_fragment,$i_90.ShaderChunk.shadowmap_pars_fragment,$i_90.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",$i_90.ShaderChunk.map_fragment,$i_90.ShaderChunk.alphatest_fragment,$i_90.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",$i_90.ShaderChunk.lightmap_fragment,$i_90.ShaderChunk.color_fragment,$i_90.ShaderChunk.envmap_fragment,$i_90.ShaderChunk.shadowmap_fragment,$i_90.ShaderChunk.linear_to_gamma_fragment,$i_90.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:$i_90.UniformsUtils.merge([$i_90.UniformsLib.common,$i_90.UniformsLib.bump,$i_90.UniformsLib.normalmap,$i_90.UniformsLib.fog,$i_90.UniformsLib.lights,$i_90.UniformsLib.shadowmap,{ambient:{type:"c",value:new $i_90.Color(16777215)},emissive:{type:"c",value:new $i_90.Color(0)},specular:{type:"c",value:new $i_90.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new $i_90.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",$i_90.ShaderChunk.map_pars_vertex,$i_90.ShaderChunk.lightmap_pars_vertex,$i_90.ShaderChunk.envmap_pars_vertex,$i_90.ShaderChunk.lights_phong_pars_vertex,$i_90.ShaderChunk.color_pars_vertex,$i_90.ShaderChunk.morphtarget_pars_vertex,$i_90.ShaderChunk.skinning_pars_vertex,$i_90.ShaderChunk.shadowmap_pars_vertex,"void main() {",$i_90.ShaderChunk.map_vertex,$i_90.ShaderChunk.lightmap_vertex,$i_90.ShaderChunk.color_vertex,$i_90.ShaderChunk.morphnormal_vertex,$i_90.ShaderChunk.skinbase_vertex,$i_90.ShaderChunk.skinnormal_vertex,$i_90.ShaderChunk.defaultnormal_vertex,"vNormal = transformedNormal;",$i_90.ShaderChunk.morphtarget_vertex,$i_90.ShaderChunk.skinning_vertex,$i_90.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",$i_90.ShaderChunk.worldpos_vertex,$i_90.ShaderChunk.envmap_vertex,$i_90.ShaderChunk.lights_phong_vertex,$i_90.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",$i_90.ShaderChunk.color_pars_fragment,$i_90.ShaderChunk.map_pars_fragment,$i_90.ShaderChunk.lightmap_pars_fragment,$i_90.ShaderChunk.envmap_pars_fragment,$i_90.ShaderChunk.fog_pars_fragment,$i_90.ShaderChunk.lights_phong_pars_fragment,$i_90.ShaderChunk.shadowmap_pars_fragment,$i_90.ShaderChunk.bumpmap_pars_fragment,$i_90.ShaderChunk.normalmap_pars_fragment,$i_90.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",$i_90.ShaderChunk.map_fragment,$i_90.ShaderChunk.alphatest_fragment,$i_90.ShaderChunk.specularmap_fragment,$i_90.ShaderChunk.lights_phong_fragment,$i_90.ShaderChunk.lightmap_fragment,$i_90.ShaderChunk.color_fragment,$i_90.ShaderChunk.envmap_fragment,$i_90.ShaderChunk.shadowmap_fragment,$i_90.ShaderChunk.linear_to_gamma_fragment,$i_90.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:$i_90.UniformsUtils.merge([$i_90.UniformsLib.particle,$i_90.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",$i_90.ShaderChunk.color_pars_vertex,$i_90.ShaderChunk.shadowmap_pars_vertex,"void main() {",$i_90.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",$i_90.ShaderChunk.worldpos_vertex,$i_90.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",$i_90.ShaderChunk.color_pars_fragment,$i_90.ShaderChunk.map_particle_pars_fragment,$i_90.ShaderChunk.fog_pars_fragment,$i_90.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",$i_90.ShaderChunk.map_particle_fragment,$i_90.ShaderChunk.alphatest_fragment,$i_90.ShaderChunk.color_fragment,$i_90.ShaderChunk.shadowmap_fragment,$i_90.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[$i_90.ShaderChunk.morphtarget_pars_vertex,$i_90.ShaderChunk.skinning_pars_vertex,"void main() {",$i_90.ShaderChunk.skinbase_vertex,$i_90.ShaderChunk.morphtarget_vertex,$i_90.ShaderChunk.skinning_vertex,$i_90.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},$i_90.WebGLRenderer=function(e){function t(e,t){var i=e.vertices.length,r=t.material;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var n in r.attributes){var o=r.attributes[n];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=N.createBuffer(),o.buffer.belongsToAttribute=n,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function i(e,t){return!e.material||e.material instanceof $i_90.MeshFaceMaterial?0>t.materialIndex?void 0:e.geometry.materials[t.materialIndex]:e.material}function r(e){return e instanceof $i_90.MeshBasicMaterial&&!e.envMap||e instanceof $i_90.MeshDepthMaterial?!1:e&&void 0!==e.shading&&e.shading===$i_90.SmoothShading?$i_90.SmoothShading:$i_90.FlatShading}function n(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof $i_90.ShaderMaterial?!0:!1}function o(e){var t,i,r;for(t in e.attributes)r="index"===t?N.ELEMENT_ARRAY_BUFFER:N.ARRAY_BUFFER,i=e.attributes[t],i.buffer=N.createBuffer(),N.bindBuffer(r,i.buffer),N.bufferData(r,i.array,N.STATIC_DRAW)}function a(e,t,i){var r,n,o,a,s=e.vertices;a=s.length;var h=e.colors,l=h.length,c=e.__vertexArray,u=e.__colorArray,d=e.__sortArray,f=e.verticesNeedUpdate,p=e.colorsNeedUpdate,m=e.__webglCustomAttributesList;if(i.sortParticles){for(yt.copy(vt),yt.multiplySelf(i.matrixWorld),r=0;a>r;r++)n=s[r],_t.copy(n),yt.multiplyVector3(_t),d[r]=[_t.z,r];for(d.sort(function(e,t){return t[0]-e[0]}),r=0;a>r;r++)n=s[d[r][1]],o=3*r,c[o]=n.x,c[o+1]=n.y,c[o+2]=n.z;for(r=0;l>r;r++)o=3*r,n=h[d[r][1]],u[o]=n.r,u[o+1]=n.g,u[o+2]=n.b;if(m)for(h=0,l=m.length;l>h;h++)if(s=m[h],void 0===s.boundTo||"vertices"===s.boundTo)if(o=0,n=s.value.length,1===s.size)for(r=0;n>r;r++)a=d[r][1],s.array[r]=s.value[a];else if(2===s.size)for(r=0;n>r;r++)a=d[r][1],a=s.value[a],s.array[o]=a.x,s.array[o+1]=a.y,o+=2;else if(3===s.size)if("c"===s.type)for(r=0;n>r;r++)a=d[r][1],a=s.value[a],s.array[o]=a.r,s.array[o+1]=a.g,s.array[o+2]=a.b,o+=3;else for(r=0;n>r;r++)a=d[r][1],a=s.value[a],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,o+=3;else if(4===s.size)for(r=0;n>r;r++)a=d[r][1],a=s.value[a],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,s.array[o+3]=a.w,o+=4}else{if(f)for(r=0;a>r;r++)n=s[r],o=3*r,c[o]=n.x,c[o+1]=n.y,c[o+2]=n.z;if(p)for(r=0;l>r;r++)n=h[r],o=3*r,u[o]=n.r,u[o+1]=n.g,u[o+2]=n.b;if(m)for(h=0,l=m.length;l>h;h++)if(s=m[h],s.needsUpdate&&(void 0===s.boundTo||"vertices"===s.boundTo))if(n=s.value.length,o=0,1===s.size)for(r=0;n>r;r++)s.array[r]=s.value[r];else if(2===s.size)for(r=0;n>r;r++)a=s.value[r],s.array[o]=a.x,s.array[o+1]=a.y,o+=2;else if(3===s.size)if("c"===s.type)for(r=0;n>r;r++)a=s.value[r],s.array[o]=a.r,s.array[o+1]=a.g,s.array[o+2]=a.b,o+=3;else for(r=0;n>r;r++)a=s.value[r],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,o+=3;else if(4===s.size)for(r=0;n>r;r++)a=s.value[r],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,s.array[o+3]=a.w,o+=4}if((f||i.sortParticles)&&(N.bindBuffer(N.ARRAY_BUFFER,e.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,c,t)),(p||i.sortParticles)&&(N.bindBuffer(N.ARRAY_BUFFER,e.__webglColorBuffer),N.bufferData(N.ARRAY_BUFFER,u,t)),m)for(h=0,l=m.length;l>h;h++)s=m[h],(s.needsUpdate||i.sortParticles)&&(N.bindBuffer(N.ARRAY_BUFFER,s.buffer),N.bufferData(N.ARRAY_BUFFER,s.array,t))}function s(e,t,i){var r=e.attributes,n=r.index,o=r.position,a=r.normal,s=r.uv,h=r.color,r=r.tangent;if(e.elementsNeedUpdate&&void 0!==n&&(N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,n.buffer),N.bufferData(N.ELEMENT_ARRAY_BUFFER,n.array,t)),e.verticesNeedUpdate&&void 0!==o&&(N.bindBuffer(N.ARRAY_BUFFER,o.buffer),N.bufferData(N.ARRAY_BUFFER,o.array,t)),e.normalsNeedUpdate&&void 0!==a&&(N.bindBuffer(N.ARRAY_BUFFER,a.buffer),N.bufferData(N.ARRAY_BUFFER,a.array,t)),e.uvsNeedUpdate&&void 0!==s&&(N.bindBuffer(N.ARRAY_BUFFER,s.buffer),N.bufferData(N.ARRAY_BUFFER,s.array,t)),e.colorsNeedUpdate&&void 0!==h&&(N.bindBuffer(N.ARRAY_BUFFER,h.buffer),N.bufferData(N.ARRAY_BUFFER,h.array,t)),e.tangentsNeedUpdate&&void 0!==r&&(N.bindBuffer(N.ARRAY_BUFFER,r.buffer),N.bufferData(N.ARRAY_BUFFER,r.array,t)),i)for(var l in e.attributes)delete e.attributes[l].array}function h(e,t){return t.z-e.z}function l(e,t){return t[1]-e[1]}function c(e,t,i){if(e.length)for(var r=0,n=e.length;n>r;r++)Z=X=null,q=K=et=$=at=ot=tt=-1,xt=!0,e[r].render(t,i,mt,Et),Z=X=null,q=K=et=$=at=ot=tt=-1,xt=!0}function u(e,t,i,r,n,o,a,s){var h,l,c,u;t?(l=e.length-1,u=t=-1):(l=0,t=e.length,u=1);for(var d=l;d!==t;d+=u)if(h=e[d],h.render){if(l=h.object,c=h.buffer,s)h=s;else{if(h=h[i],!h)continue;a&&W.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),W.setDepthTest(h.depthTest),W.setDepthWrite(h.depthWrite),R(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}W.setMaterialFaces(h),c instanceof $i_90.BufferGeometry?W.renderBufferDirect(r,n,o,h,c,l):W.renderBuffer(r,n,o,h,c,l)}}function d(e,t,i,r,n,o,a){for(var s,h,l=0,c=e.length;c>l;l++)if(s=e[l],h=s.object,h.visible){if(a)s=a;else{if(s=s[t],!s)continue;o&&W.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),W.setDepthTest(s.depthTest),W.setDepthWrite(s.depthWrite),R(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}W.renderImmediateObject(i,r,n,s,h)}}function f(e,t,i){e.push({buffer:t,object:i,opaque:null,transparent:null})}function p(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function m(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function E(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function g(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function v(e,t,i,r,n){J=0,r.needsUpdate&&(r.program&&W.deallocateMaterial(r),W.initMaterial(r,t,i,n),r.needsUpdate=!1),r.morphTargets&&!n.__webglMorphTargetInfluences&&(n.__webglMorphTargetInfluences=new Float32Array(W.maxMorphTargets));var o=!1,a=r.program,s=a.uniforms,h=r.uniforms;if(a!==X&&(N.useProgram(a),X=a,o=!0),r.id!==q&&(q=r.id,o=!0),(o||e!==Z)&&(N.uniformMatrix4fv(s.projectionMatrix,!1,e._projectionMatrixArray),e!==Z&&(Z=e)),r.skinning)if(Ct&&n.useVertexTexture){if(null!==s.boneTexture){var l=y();N.uniform1i(s.boneTexture,l),W.setTexture(n.boneTexture,l)}}else null!==s.boneGlobalMatrices&&N.uniformMatrix4fv(s.boneGlobalMatrices,!1,n.boneMatrices);if(o){if(i&&r.fog&&(h.fogColor.value=i.color,i instanceof $i_90.Fog?(h.fogNear.value=i.near,h.fogFar.value=i.far):i instanceof $i_90.FogExp2&&(h.fogDensity.value=i.density)),r instanceof $i_90.MeshPhongMaterial||r instanceof $i_90.MeshLambertMaterial||r.lights){if(xt){for(var c,u,d,f,p=0,m=0,E=0,g=Rt,v=g.directional.colors,_=g.directional.positions,R=g.point.colors,b=g.point.positions,w=g.point.distances,S=g.spot.colors,M=g.spot.positions,P=g.spot.distances,L=g.spot.directions,I=g.spot.angles,U=g.spot.exponents,D=g.hemi.skyColors,F=g.hemi.groundColors,z=g.hemi.positions,B=0,V=0,O=0,k=0,i=c=d=d=u=0,o=t.length;o>i;i++)l=t[i],!l.onlyShadow&&l.visible&&(c=l.color,f=l.intensity,u=l.distance,l instanceof $i_90.AmbientLight?W.gammaInput?(p+=c.r*c.r,m+=c.g*c.g,E+=c.b*c.b):(p+=c.r,m+=c.g,E+=c.b):l instanceof $i_90.DirectionalLight?(u=3*B,W.gammaInput?T(v,u,c,f*f):x(v,u,c,f),Tt.copy(l.matrixWorld.getPosition()),Tt.subSelf(l.target.matrixWorld.getPosition()),Tt.normalize(),_[u]=Tt.x,_[u+1]=Tt.y,_[u+2]=Tt.z,B+=1):l instanceof $i_90.PointLight?(d=3*V,W.gammaInput?T(R,d,c,f*f):x(R,d,c,f),f=l.matrixWorld.getPosition(),b[d]=f.x,b[d+1]=f.y,b[d+2]=f.z,w[V]=u,V+=1):l instanceof $i_90.SpotLight?(d=3*O,W.gammaInput?T(S,d,c,f*f):x(S,d,c,f),f=l.matrixWorld.getPosition(),M[d]=f.x,M[d+1]=f.y,M[d+2]=f.z,P[O]=u,Tt.copy(f),Tt.subSelf(l.target.matrixWorld.getPosition()),Tt.normalize(),L[d]=Tt.x,L[d+1]=Tt.y,L[d+2]=Tt.z,I[O]=Math.cos(l.angle),U[O]=l.exponent,O+=1):l instanceof $i_90.HemisphereLight&&(u=l.color,d=l.groundColor,c=3*k,W.gammaInput?(f*=f,T(D,c,u,f),T(F,c,d,f)):(x(D,c,u,f),x(F,c,d,f)),f=l.matrixWorld.getPosition(),z[c]=f.x,z[c+1]=f.y,z[c+2]=f.z,k+=1));for(i=3*B,o=v.length;o>i;i++)v[i]=0;for(i=3*V,o=R.length;o>i;i++)R[i]=0;for(i=3*O,o=S.length;o>i;i++)S[i]=0;for(i=3*k,o=D.length;o>i;i++)D[i]=0;for(i=3*k,o=F.length;o>i;i++)F[i]=0;g.directional.length=B,g.point.length=V,g.spot.length=O,g.hemi.length=k,g.ambient[0]=p,g.ambient[1]=m,g.ambient[2]=E,xt=!1}i=Rt,h.ambientLightColor.value=i.ambient,h.directionalLightColor.value=i.directional.colors,h.directionalLightDirection.value=i.directional.positions,h.pointLightColor.value=i.point.colors,h.pointLightPosition.value=i.point.positions,h.pointLightDistance.value=i.point.distances,h.spotLightColor.value=i.spot.colors,h.spotLightPosition.value=i.spot.positions,h.spotLightDistance.value=i.spot.distances,h.spotLightDirection.value=i.spot.directions,h.spotLightAngle.value=i.spot.angles,h.spotLightExponent.value=i.spot.exponents,h.hemisphereLightSkyColor.value=i.hemi.skyColors,h.hemisphereLightGroundColor.value=i.hemi.groundColors,h.hemisphereLightPosition.value=i.hemi.positions}if(r instanceof $i_90.MeshBasicMaterial||r instanceof $i_90.MeshLambertMaterial||r instanceof $i_90.MeshPhongMaterial){h.opacity.value=r.opacity,W.gammaInput?h.diffuse.value.copyGammaToLinear(r.color):h.diffuse.value=r.color,h.map.value=r.map,h.lightMap.value=r.lightMap,h.specularMap.value=r.specularMap,r.bumpMap&&(h.bumpMap.value=r.bumpMap,h.bumpScale.value=r.bumpScale),r.normalMap&&(h.normalMap.value=r.normalMap,h.normalScale.value.copy(r.normalScale));var G;r.map?G=r.map:r.specularMap?G=r.specularMap:r.normalMap?G=r.normalMap:r.bumpMap&&(G=r.bumpMap),void 0!==G&&(i=G.offset,G=G.repeat,h.offsetRepeat.value.set(i.x,i.y,G.x,G.y)),h.envMap.value=r.envMap,h.flipEnvMap.value=r.envMap instanceof $i_90.WebGLRenderTargetCube?1:-1,h.reflectivity.value=r.reflectivity,h.refractionRatio.value=r.refractionRatio,h.combine.value=r.combine,h.useRefract.value=r.envMap&&r.envMap.mapping instanceof $i_90.CubeRefractionMapping}if(r instanceof $i_90.LineBasicMaterial?(h.diffuse.value=r.color,h.opacity.value=r.opacity):r instanceof $i_90.ParticleBasicMaterial?(h.psColor.value=r.color,h.opacity.value=r.opacity,h.size.value=r.size,h.scale.value=A.height/2,h.map.value=r.map):r instanceof $i_90.MeshPhongMaterial?(h.shininess.value=r.shininess,W.gammaInput?(h.ambient.value.copyGammaToLinear(r.ambient),h.emissive.value.copyGammaToLinear(r.emissive),h.specular.value.copyGammaToLinear(r.specular)):(h.ambient.value=r.ambient,h.emissive.value=r.emissive,h.specular.value=r.specular),r.wrapAround&&h.wrapRGB.value.copy(r.wrapRGB)):r instanceof $i_90.MeshLambertMaterial?(W.gammaInput?(h.ambient.value.copyGammaToLinear(r.ambient),h.emissive.value.copyGammaToLinear(r.emissive)):(h.ambient.value=r.ambient,h.emissive.value=r.emissive),r.wrapAround&&h.wrapRGB.value.copy(r.wrapRGB)):r instanceof $i_90.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=r.opacity):r instanceof $i_90.MeshNormalMaterial&&(h.opacity.value=r.opacity),n.receiveShadow&&!r._shadowPass&&h.shadowMatrix)for(i=G=0,o=t.length;o>i;i++)l=t[i],l.castShadow&&(l instanceof $i_90.SpotLight||l instanceof $i_90.DirectionalLight&&!l.shadowCascade)&&(h.shadowMap.value[G]=l.shadowMap,h.shadowMapSize.value[G]=l.shadowMapSize,h.shadowMatrix.value[G]=l.shadowMatrix,h.shadowDarkness.value[G]=l.shadowDarkness,h.shadowBias.value[G]=l.shadowBias,G++);for(t=r.uniformsList,h=0,G=t.length;G>h;h++)if(o=a.uniforms[t[h][1]])if(i=t[h][0],p=i.type,l=i.value,"i"===p)N.uniform1i(o,l);else if("f"===p)N.uniform1f(o,l);else if("v2"===p)N.uniform2f(o,l.x,l.y);else if("v3"===p)N.uniform3f(o,l.x,l.y,l.z);else if("v4"===p)N.uniform4f(o,l.x,l.y,l.z,l.w);else if("c"===p)N.uniform3f(o,l.r,l.g,l.b);else if("iv1"===p)N.uniform1iv(o,l);else if("iv"===p)N.uniform3iv(o,l);else if("fv1"===p)N.uniform1fv(o,l);else if("fv"===p)N.uniform3fv(o,l);else if("v2v"===p){for(void 0===i._array&&(i._array=new Float32Array(2*l.length)),p=0,m=l.length;m>p;p++)E=2*p,i._array[E]=l[p].x,i._array[E+1]=l[p].y;N.uniform2fv(o,i._array)}else if("v3v"===p){for(void 0===i._array&&(i._array=new Float32Array(3*l.length)),p=0,m=l.length;m>p;p++)E=3*p,i._array[E]=l[p].x,i._array[E+1]=l[p].y,i._array[E+2]=l[p].z;N.uniform3fv(o,i._array)}else if("v4v"===p){for(void 0===i._array&&(i._array=new Float32Array(4*l.length)),p=0,m=l.length;m>p;p++)E=4*p,i._array[E]=l[p].x,i._array[E+1]=l[p].y,i._array[E+2]=l[p].z,i._array[E+3]=l[p].w;N.uniform4fv(o,i._array)}else if("m4"===p)void 0===i._array&&(i._array=new Float32Array(16)),l.flattenToArray(i._array),N.uniformMatrix4fv(o,!1,i._array);else if("m4v"===p){for(void 0===i._array&&(i._array=new Float32Array(16*l.length)),p=0,m=l.length;m>p;p++)l[p].flattenToArrayOffset(i._array,16*p);N.uniformMatrix4fv(o,!1,i._array)}else if("t"===p){if(E=l,l=y(),N.uniform1i(o,l),E)if(E.image instanceof Array&&6===E.image.length){if(i=E,o=l,6===i.image.length)if(i.needsUpdate){for(i.image.__webglTextureCube||(i.image.__webglTextureCube=N.createTexture()),N.activeTexture(N.TEXTURE0+o),N.bindTexture(N.TEXTURE_CUBE_MAP,i.image.__webglTextureCube),N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,i.flipY),o=i instanceof $i_90.CompressedTexture,l=[],p=0;6>p;p++)W.autoScaleCubemaps&&!o?(m=l,E=p,g=i.image[p],_=Ht,_>=g.width&&_>=g.height||(R=Math.max(g.width,g.height),v=Math.floor(g.width*_/R),_=Math.floor(g.height*_/R),R=document.createElement("canvas"),R.width=v,R.height=_,R.getContext("2d").drawImage(g,0,0,g.width,g.height,0,0,v,_),g=R),m[E]=g):l[p]=i.image[p];for(p=l[0],m=0===(p.width&p.width-1)&&0===(p.height&p.height-1),E=C(i.format),g=C(i.type),H(N.TEXTURE_CUBE_MAP,i,m),p=0;6>p;p++)if(o)for(_=l[p].mipmaps,R=0,b=_.length;b>R;R++)v=_[R],N.compressedTexImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+p,R,E,v.width,v.height,0,v.data);else N.texImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,E,E,g,l[p]);i.generateMipmaps&&m&&N.generateMipmap(N.TEXTURE_CUBE_MAP),i.needsUpdate=!1,i.onUpdate&&i.onUpdate()}else N.activeTexture(N.TEXTURE0+o),N.bindTexture(N.TEXTURE_CUBE_MAP,i.image.__webglTextureCube)}else E instanceof $i_90.WebGLRenderTargetCube?(i=E,N.activeTexture(N.TEXTURE0+l),N.bindTexture(N.TEXTURE_CUBE_MAP,i.__webglTexture)):W.setTexture(E,l)}else if("tv"===p){for(void 0===i._array&&(i._array=[]),p=0,m=i.value.length;m>p;p++)i._array[p]=y();for(N.uniform1iv(o,i._array),p=0,m=i.value.length;m>p;p++)E=i.value[p],l=i._array[p],E&&W.setTexture(E,l)}(r instanceof $i_90.ShaderMaterial||r instanceof $i_90.MeshPhongMaterial||r.envMap)&&null!==s.cameraPosition&&(t=e.matrixWorld.getPosition(),N.uniform3f(s.cameraPosition,t.x,t.y,t.z)),(r instanceof $i_90.MeshPhongMaterial||r instanceof $i_90.MeshLambertMaterial||r instanceof $i_90.ShaderMaterial||r.skinning)&&null!==s.viewMatrix&&N.uniformMatrix4fv(s.viewMatrix,!1,e._viewMatrixArray)}return N.uniformMatrix4fv(s.modelViewMatrix,!1,n._modelViewMatrix.elements),s.normalMatrix&&N.uniformMatrix3fv(s.normalMatrix,!1,n._normalMatrix.elements),null!==s.modelMatrix&&N.uniformMatrix4fv(s.modelMatrix,!1,n.matrixWorld.elements),a}function y(){var e=J;return e>=wt&&console.warn("Trying to use "+e+" texture units while this GPU supports only "+wt),J+=1,e}function _(e,t){e._modelViewMatrix.multiply(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function T(e,t,i,r){e[t]=i.r*i.r*r,e[t+1]=i.g*i.g*r,e[t+2]=i.b*i.b*r}function x(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function R(e,t,i){st!==e&&(e?N.enable(N.POLYGON_OFFSET_FILL):N.disable(N.POLYGON_OFFSET_FILL),st=e),!e||ht===t&&lt===i||(N.polygonOffset(t,i),ht=t,lt=i)}function b(e){for(var e=e.split("\n"),t=0,i=e.length;i>t;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function w(e,t){var i;return"fragment"===e?i=N.createShader(N.FRAGMENT_SHADER):"vertex"===e&&(i=N.createShader(N.VERTEX_SHADER)),N.shaderSource(i,t),N.compileShader(i),N.getShaderParameter(i,N.COMPILE_STATUS)?i:(console.error(N.getShaderInfoLog(i)),console.error(b(t)),null)}function H(e,t,i){i?(N.texParameteri(e,N.TEXTURE_WRAP_S,C(t.wrapS)),N.texParameteri(e,N.TEXTURE_WRAP_T,C(t.wrapT)),N.texParameteri(e,N.TEXTURE_MAG_FILTER,C(t.magFilter)),N.texParameteri(e,N.TEXTURE_MIN_FILTER,C(t.minFilter))):(N.texParameteri(e,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(e,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(e,N.TEXTURE_MAG_FILTER,M(t.magFilter)),N.texParameteri(e,N.TEXTURE_MIN_FILTER,M(t.minFilter))),O&&t.type!==$i_90.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(N.texParameterf(e,O.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,St)),t.__oldAnisotropy=t.anisotropy)}function S(e,t){N.bindRenderbuffer(N.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(N.renderbufferStorage(N.RENDERBUFFER,N.DEPTH_COMPONENT16,t.width,t.height),N.framebufferRenderbuffer(N.FRAMEBUFFER,N.DEPTH_ATTACHMENT,N.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(N.renderbufferStorage(N.RENDERBUFFER,N.DEPTH_STENCIL,t.width,t.height),N.framebufferRenderbuffer(N.FRAMEBUFFER,N.DEPTH_STENCIL_ATTACHMENT,N.RENDERBUFFER,e)):N.renderbufferStorage(N.RENDERBUFFER,N.RGBA4,t.width,t.height)}function M(e){return e===$i_90.NearestFilter||e===$i_90.NearestMipMapNearestFilter||e===$i_90.NearestMipMapLinearFilter?N.NEAREST:N.LINEAR}function C(e){if(e===$i_90.RepeatWrapping)return N.REPEAT;if(e===$i_90.ClampToEdgeWrapping)return N.CLAMP_TO_EDGE;if(e===$i_90.MirroredRepeatWrapping)return N.MIRRORED_REPEAT;if(e===$i_90.NearestFilter)return N.NEAREST;if(e===$i_90.NearestMipMapNearestFilter)return N.NEAREST_MIPMAP_NEAREST;if(e===$i_90.NearestMipMapLinearFilter)return N.NEAREST_MIPMAP_LINEAR;if(e===$i_90.LinearFilter)return N.LINEAR;if(e===$i_90.LinearMipMapNearestFilter)return N.LINEAR_MIPMAP_NEAREST;if(e===$i_90.LinearMipMapLinearFilter)return N.LINEAR_MIPMAP_LINEAR;if(e===$i_90.UnsignedByteType)return N.UNSIGNED_BYTE;if(e===$i_90.UnsignedShort4444Type)return N.UNSIGNED_SHORT_4_4_4_4;if(e===$i_90.UnsignedShort5551Type)return N.UNSIGNED_SHORT_5_5_5_1;if(e===$i_90.UnsignedShort565Type)return N.UNSIGNED_SHORT_5_6_5;if(e===$i_90.ByteType)return N.BYTE;if(e===$i_90.ShortType)return N.SHORT;if(e===$i_90.UnsignedShortType)return N.UNSIGNED_SHORT;if(e===$i_90.IntType)return N.INT;if(e===$i_90.UnsignedIntType)return N.UNSIGNED_INT;if(e===$i_90.FloatType)return N.FLOAT;if(e===$i_90.AlphaFormat)return N.ALPHA;if(e===$i_90.RGBFormat)return N.RGB;if(e===$i_90.RGBAFormat)return N.RGBA;if(e===$i_90.LuminanceFormat)return N.LUMINANCE;if(e===$i_90.LuminanceAlphaFormat)return N.LUMINANCE_ALPHA;if(e===$i_90.AddEquation)return N.FUNC_ADD;if(e===$i_90.SubtractEquation)return N.FUNC_SUBTRACT;if(e===$i_90.ReverseSubtractEquation)return N.FUNC_REVERSE_SUBTRACT;if(e===$i_90.ZeroFactor)return N.ZERO;if(e===$i_90.OneFactor)return N.ONE;if(e===$i_90.SrcColorFactor)return N.SRC_COLOR;if(e===$i_90.OneMinusSrcColorFactor)return N.ONE_MINUS_SRC_COLOR;if(e===$i_90.SrcAlphaFactor)return N.SRC_ALPHA;if(e===$i_90.OneMinusSrcAlphaFactor)return N.ONE_MINUS_SRC_ALPHA;if(e===$i_90.DstAlphaFactor)return N.DST_ALPHA;if(e===$i_90.OneMinusDstAlphaFactor)return N.ONE_MINUS_DST_ALPHA;if(e===$i_90.DstColorFactor)return N.DST_COLOR;if(e===$i_90.OneMinusDstColorFactor)return N.ONE_MINUS_DST_COLOR;if(e===$i_90.SrcAlphaSaturateFactor)return N.SRC_ALPHA_SATURATE;if(void 0!==k){if(e===$i_90.RGB_S3TC_DXT1_Format)return k.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===$i_90.RGBA_S3TC_DXT1_Format)return k.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===$i_90.RGBA_S3TC_DXT3_Format)return k.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===$i_90.RGBA_S3TC_DXT5_Format)return k.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("$i_90.WebGLRenderer",$i_90.REVISION);var e=e||{},A=void 0!==e.canvas?e.canvas:document.createElement("canvas"),P=void 0!==e.precision?e.precision:"highp",L=void 0!==e.alpha?e.alpha:!0,I=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,U=void 0!==e.antialias?e.antialias:!1,D=void 0!==e.stencil?e.stencil:!0,F=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,z=void 0!==e.clearColor?new $i_90.Color(e.clearColor):new $i_90.Color(0),B=void 0!==e.clearAlpha?e.clearAlpha:0,V=void 0!==e.maxLights?e.maxLights:4;this.domElement=A,this.context=null,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=!0,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var N,O,k,W=this,G=[],j=0,X=null,Y=null,q=-1,K=null,Z=null,Q=0,J=0,$=-1,et=-1,tt=-1,it=-1,rt=-1,nt=-1,ot=-1,at=-1,st=null,ht=null,lt=null,ct=null,ut=0,dt=0,ft=0,pt=0,mt=0,Et=0,gt=new $i_90.Frustum,vt=new $i_90.Matrix4,yt=new $i_90.Matrix4,_t=new $i_90.Vector4,Tt=new $i_90.Vector3,xt=!0,Rt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};
try{if(!(N=A.getContext("experimental-webgl",{alpha:L,premultipliedAlpha:I,antialias:U,stencil:D,preserveDrawingBuffer:F})))throw"Error creating WebGL context."}catch(bt){console.error(bt)}e=N.getExtension("OES_texture_float"),L=N.getExtension("OES_standard_derivatives"),O=N.getExtension("EXT_texture_filter_anisotropic")||N.getExtension("MOZ_EXT_texture_filter_anisotropic")||N.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),k=N.getExtension("WEBGL_compressed_texture_s3tc")||N.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||N.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),e||console.log("$i_90.WebGLRenderer: Float textures not supported."),L||console.log("$i_90.WebGLRenderer: Standard derivatives not supported."),O||console.log("$i_90.WebGLRenderer: Anisotropic texture filtering not supported."),k||console.log("$i_90.WebGLRenderer: S3TC compressed textures not supported."),N.clearColor(0,0,0,1),N.clearDepth(1),N.clearStencil(0),N.enable(N.DEPTH_TEST),N.depthFunc(N.LEQUAL),N.frontFace(N.CCW),N.cullFace(N.BACK),N.enable(N.CULL_FACE),N.enable(N.BLEND),N.blendEquation(N.FUNC_ADD),N.blendFunc(N.SRC_ALPHA,N.ONE_MINUS_SRC_ALPHA),N.clearColor(z.r,z.g,z.b,B),this.context=N;var wt=N.getParameter(N.MAX_TEXTURE_IMAGE_UNITS),L=N.getParameter(N.MAX_VERTEX_TEXTURE_IMAGE_UNITS);N.getParameter(N.MAX_TEXTURE_SIZE);var Ht=N.getParameter(N.MAX_CUBE_MAP_TEXTURE_SIZE),St=O?N.getParameter(O.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Mt=L>0,Ct=Mt&&e;k&&N.getParameter(N.COMPRESSED_TEXTURE_FORMATS),this.getContext=function(){return N},this.supportsVertexTextures=function(){return Mt},this.getMaxAnisotropy=function(){return St},this.setSize=function(e,t){A.width=e,A.height=t,this.setViewport(0,0,A.width,A.height)},this.setViewport=function(e,t,i,r){ut=void 0!==e?e:0,dt=void 0!==t?t:0,ft=void 0!==i?i:A.width,pt=void 0!==r?r:A.height,N.viewport(ut,dt,ft,pt)},this.setScissor=function(e,t,i,r){N.scissor(e,t,i,r)},this.enableScissorTest=function(e){e?N.enable(N.SCISSOR_TEST):N.disable(N.SCISSOR_TEST)},this.setClearColorHex=function(e,t){z.setHex(e),B=t,N.clearColor(z.r,z.g,z.b,B)},this.setClearColor=function(e,t){z.copy(e),B=t,N.clearColor(z.r,z.g,z.b,B)},this.getClearColor=function(){return z},this.getClearAlpha=function(){return B},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=N.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=N.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=N.STENCIL_BUFFER_BIT),N.clear(r)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.deallocateObject=function(e){if(e.__webglInit)if(e.__webglInit=!1,delete e._modelViewMatrix,delete e._normalMatrix,delete e._normalMatrixArray,delete e._modelViewMatrixArray,delete e._modelMatrixArray,e instanceof $i_90.Mesh)for(var t in e.geometry.geometryGroups){var i=e.geometry.geometryGroups[t];N.deleteBuffer(i.__webglVertexBuffer),N.deleteBuffer(i.__webglNormalBuffer),N.deleteBuffer(i.__webglTangentBuffer),N.deleteBuffer(i.__webglColorBuffer),N.deleteBuffer(i.__webglUVBuffer),N.deleteBuffer(i.__webglUV2Buffer),N.deleteBuffer(i.__webglSkinIndicesBuffer),N.deleteBuffer(i.__webglSkinWeightsBuffer),N.deleteBuffer(i.__webglFaceBuffer),N.deleteBuffer(i.__webglLineBuffer);var r=void 0,n=void 0;if(i.numMorphTargets)for(r=0,n=i.numMorphTargets;n>r;r++)N.deleteBuffer(i.__webglMorphTargetsBuffers[r]);if(i.numMorphNormals)for(r=0,n=i.numMorphNormals;n>r;r++)N.deleteBuffer(i.__webglMorphNormalsBuffers[r]);if(i.__webglCustomAttributesList)for(r in r=void 0,i.__webglCustomAttributesList)N.deleteBuffer(i.__webglCustomAttributesList[r].buffer);W.info.memory.geometries--}else e instanceof $i_90.Ribbon?(e=e.geometry,N.deleteBuffer(e.__webglVertexBuffer),N.deleteBuffer(e.__webglColorBuffer),W.info.memory.geometries--):e instanceof $i_90.Line?(e=e.geometry,N.deleteBuffer(e.__webglVertexBuffer),N.deleteBuffer(e.__webglColorBuffer),W.info.memory.geometries--):e instanceof $i_90.ParticleSystem&&(e=e.geometry,N.deleteBuffer(e.__webglVertexBuffer),N.deleteBuffer(e.__webglColorBuffer),W.info.memory.geometries--)},this.deallocateTexture=function(e){e.__webglInit&&(e.__webglInit=!1,N.deleteTexture(e.__webglTexture),W.info.memory.textures--)},this.deallocateRenderTarget=function(e){if(e&&e.__webglTexture)if(N.deleteTexture(e.__webglTexture),e instanceof $i_90.WebGLRenderTargetCube)for(var t=0;6>t;t++)N.deleteFramebuffer(e.__webglFramebuffer[t]),N.deleteRenderbuffer(e.__webglRenderbuffer[t]);else N.deleteFramebuffer(e.__webglFramebuffer),N.deleteRenderbuffer(e.__webglRenderbuffer)},this.deallocateMaterial=function(e){var t=e.program;if(t){e.program=void 0;var i,r,n=!1,e=0;for(i=G.length;i>e;e++)if(r=G[e],r.program===t){r.usedTimes--,0===r.usedTimes&&(n=!0);break}if(n){for(n=[],e=0,i=G.length;i>e;e++)r=G[e],r.program!==t&&n.push(r);G=n,N.deleteProgram(t),W.info.memory.programs--}}},this.updateShadowMap=function(e,t){X=null,q=K=at=ot=tt=-1,xt=!0,et=$=-1,this.shadowMapPlugin.update(e,t)},this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=N.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=N.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=N.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=N.createBuffer()),e.hasPositions&&(N.bindBuffer(N.ARRAY_BUFFER,e.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,e.positionArray,N.DYNAMIC_DRAW),N.enableVertexAttribArray(t.attributes.position),N.vertexAttribPointer(t.attributes.position,3,N.FLOAT,!1,0,0)),e.hasNormals){if(N.bindBuffer(N.ARRAY_BUFFER,e.__webglNormalBuffer),i.shading===$i_90.FlatShading){var r,n,o,a,s,h,l,c,u,d,f,p=3*e.count;for(f=0;p>f;f+=9)d=e.normalArray,r=d[f],n=d[f+1],o=d[f+2],a=d[f+3],h=d[f+4],c=d[f+5],s=d[f+6],l=d[f+7],u=d[f+8],r=(r+a+s)/3,n=(n+h+l)/3,o=(o+c+u)/3,d[f]=r,d[f+1]=n,d[f+2]=o,d[f+3]=r,d[f+4]=n,d[f+5]=o,d[f+6]=r,d[f+7]=n,d[f+8]=o}N.bufferData(N.ARRAY_BUFFER,e.normalArray,N.DYNAMIC_DRAW),N.enableVertexAttribArray(t.attributes.normal),N.vertexAttribPointer(t.attributes.normal,3,N.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(N.bindBuffer(N.ARRAY_BUFFER,e.__webglUvBuffer),N.bufferData(N.ARRAY_BUFFER,e.uvArray,N.DYNAMIC_DRAW),N.enableVertexAttribArray(t.attributes.uv),N.vertexAttribPointer(t.attributes.uv,2,N.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==$i_90.NoColors&&(N.bindBuffer(N.ARRAY_BUFFER,e.__webglColorBuffer),N.bufferData(N.ARRAY_BUFFER,e.colorArray,N.DYNAMIC_DRAW),N.enableVertexAttribArray(t.attributes.color),N.vertexAttribPointer(t.attributes.color,3,N.FLOAT,!1,0,0)),N.drawArrays(N.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,o){if(!1!==r.visible)if(i=v(e,t,i,r,o),e=i.attributes,t=!1,r=16777215*n.id+2*i.id+(r.wireframe?1:0),r!==K&&(K=r,t=!0),o instanceof $i_90.Mesh)for(o=n.offsets,o.length>1&&(t=!0),r=0,i=o.length;i>r;++r){var a=o[r].index;if(t){var s=n.attributes.position,h=s.itemSize;if(N.bindBuffer(N.ARRAY_BUFFER,s.buffer),N.vertexAttribPointer(e.position,h,N.FLOAT,!1,0,4*a*h),s=n.attributes.normal,e.normal>=0&&s&&(h=s.itemSize,N.bindBuffer(N.ARRAY_BUFFER,s.buffer),N.vertexAttribPointer(e.normal,h,N.FLOAT,!1,0,4*a*h)),s=n.attributes.uv,e.uv>=0&&s&&(s.buffer?(h=s.itemSize,N.bindBuffer(N.ARRAY_BUFFER,s.buffer),N.vertexAttribPointer(e.uv,h,N.FLOAT,!1,0,4*a*h),N.enableVertexAttribArray(e.uv)):N.disableVertexAttribArray(e.uv)),h=n.attributes.color,e.color>=0&&h){var l=h.itemSize;N.bindBuffer(N.ARRAY_BUFFER,h.buffer),N.vertexAttribPointer(e.color,l,N.FLOAT,!1,0,4*a*l)}s=n.attributes.tangent,e.tangent>=0&&s&&(h=s.itemSize,N.bindBuffer(N.ARRAY_BUFFER,s.buffer),N.vertexAttribPointer(e.tangent,h,N.FLOAT,!1,0,4*a*h)),N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,n.attributes.index.buffer)}N.drawElements(N.TRIANGLES,o[r].count,N.UNSIGNED_SHORT,2*o[r].start),W.info.render.calls++,W.info.render.vertices+=o[r].count,W.info.render.faces+=o[r].count/3}else o instanceof $i_90.ParticleSystem&&t&&(s=n.attributes.position,h=s.itemSize,N.bindBuffer(N.ARRAY_BUFFER,s.buffer),N.vertexAttribPointer(e.position,h,N.FLOAT,!1,0,0),h=n.attributes.color,e.color>=0&&h&&(l=h.itemSize,N.bindBuffer(N.ARRAY_BUFFER,h.buffer),N.vertexAttribPointer(e.color,l,N.FLOAT,!1,0,0)),N.drawArrays(N.POINTS,0,s.numItems/3),W.info.render.calls++,W.info.render.points+=s.numItems/3)},this.renderBuffer=function(e,t,i,r,n,o){if(!1!==r.visible){var a,s,i=v(e,t,i,r,o),t=i.attributes,e=!1,i=16777215*n.id+2*i.id+(r.wireframe?1:0);if(i!==K&&(K=i,e=!0),r.morphTargets||0>t.position){if(o.morphTargetBase){if(i=r.program.attributes,-1!==o.morphTargetBase?(N.bindBuffer(N.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[o.morphTargetBase]),N.vertexAttribPointer(i.position,3,N.FLOAT,!1,0,0)):i.position>=0&&(N.bindBuffer(N.ARRAY_BUFFER,n.__webglVertexBuffer),N.vertexAttribPointer(i.position,3,N.FLOAT,!1,0,0)),o.morphTargetForcedOrder.length){var h=0;for(s=o.morphTargetForcedOrder,a=o.morphTargetInfluences;r.numSupportedMorphTargets>h&&s.length>h;)N.bindBuffer(N.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[s[h]]),N.vertexAttribPointer(i["morphTarget"+h],3,N.FLOAT,!1,0,0),r.morphNormals&&(N.bindBuffer(N.ARRAY_BUFFER,n.__webglMorphNormalsBuffers[s[h]]),N.vertexAttribPointer(i["morphNormal"+h],3,N.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[h]=a[s[h]],h++}else{s=[],a=o.morphTargetInfluences;var c,u=a.length;for(c=0;u>c;c++)h=a[c],h>0&&s.push([c,h]);for(s.length>r.numSupportedMorphTargets?(s.sort(l),s.length=r.numSupportedMorphTargets):s.length>r.numSupportedMorphNormals?s.sort(l):0===s.length&&s.push([0,0]),h=0;r.numSupportedMorphTargets>h;)s[h]?(c=s[h][0],N.bindBuffer(N.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[c]),N.vertexAttribPointer(i["morphTarget"+h],3,N.FLOAT,!1,0,0),r.morphNormals&&(N.bindBuffer(N.ARRAY_BUFFER,n.__webglMorphNormalsBuffers[c]),N.vertexAttribPointer(i["morphNormal"+h],3,N.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[h]=a[c]):(N.vertexAttribPointer(i["morphTarget"+h],3,N.FLOAT,!1,0,0),r.morphNormals&&N.vertexAttribPointer(i["morphNormal"+h],3,N.FLOAT,!1,0,0),o.__webglMorphTargetInfluences[h]=0),h++}null!==r.program.uniforms.morphTargetInfluences&&N.uniform1fv(r.program.uniforms.morphTargetInfluences,o.__webglMorphTargetInfluences)}}else e&&(N.bindBuffer(N.ARRAY_BUFFER,n.__webglVertexBuffer),N.vertexAttribPointer(t.position,3,N.FLOAT,!1,0,0));if(e){if(n.__webglCustomAttributesList)for(a=0,s=n.__webglCustomAttributesList.length;s>a;a++)i=n.__webglCustomAttributesList[a],t[i.buffer.belongsToAttribute]>=0&&(N.bindBuffer(N.ARRAY_BUFFER,i.buffer),N.vertexAttribPointer(t[i.buffer.belongsToAttribute],i.size,N.FLOAT,!1,0,0));t.color>=0&&(N.bindBuffer(N.ARRAY_BUFFER,n.__webglColorBuffer),N.vertexAttribPointer(t.color,3,N.FLOAT,!1,0,0)),t.normal>=0&&(N.bindBuffer(N.ARRAY_BUFFER,n.__webglNormalBuffer),N.vertexAttribPointer(t.normal,3,N.FLOAT,!1,0,0)),t.tangent>=0&&(N.bindBuffer(N.ARRAY_BUFFER,n.__webglTangentBuffer),N.vertexAttribPointer(t.tangent,4,N.FLOAT,!1,0,0)),t.uv>=0&&(n.__webglUVBuffer?(N.bindBuffer(N.ARRAY_BUFFER,n.__webglUVBuffer),N.vertexAttribPointer(t.uv,2,N.FLOAT,!1,0,0),N.enableVertexAttribArray(t.uv)):N.disableVertexAttribArray(t.uv)),t.uv2>=0&&(n.__webglUV2Buffer?(N.bindBuffer(N.ARRAY_BUFFER,n.__webglUV2Buffer),N.vertexAttribPointer(t.uv2,2,N.FLOAT,!1,0,0),N.enableVertexAttribArray(t.uv2)):N.disableVertexAttribArray(t.uv2)),r.skinning&&t.skinIndex>=0&&t.skinWeight>=0&&(N.bindBuffer(N.ARRAY_BUFFER,n.__webglSkinIndicesBuffer),N.vertexAttribPointer(t.skinIndex,4,N.FLOAT,!1,0,0),N.bindBuffer(N.ARRAY_BUFFER,n.__webglSkinWeightsBuffer),N.vertexAttribPointer(t.skinWeight,4,N.FLOAT,!1,0,0))}o instanceof $i_90.Mesh?(r.wireframe?(r=r.wireframeLinewidth,r!==ct&&(N.lineWidth(r),ct=r),e&&N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),N.drawElements(N.LINES,n.__webglLineCount,N.UNSIGNED_SHORT,0)):(e&&N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),N.drawElements(N.TRIANGLES,n.__webglFaceCount,N.UNSIGNED_SHORT,0)),W.info.render.calls++,W.info.render.vertices+=n.__webglFaceCount,W.info.render.faces+=n.__webglFaceCount/3):o instanceof $i_90.Line?(o=o.type===$i_90.LineStrip?N.LINE_STRIP:N.LINES,r=r.linewidth,r!==ct&&(N.lineWidth(r),ct=r),N.drawArrays(o,0,n.__webglLineCount),W.info.render.calls++):o instanceof $i_90.ParticleSystem?(N.drawArrays(N.POINTS,0,n.__webglParticleCount),W.info.render.calls++,W.info.render.points+=n.__webglParticleCount):o instanceof $i_90.Ribbon&&(N.drawArrays(N.TRIANGLE_STRIP,0,n.__webglVertexCount),W.info.render.calls++)}},this.render=function(e,t,i,r){if(!1==t instanceof $i_90.Camera)console.error("$i_90.WebGLRenderer.render: camera is not an instance of $i_90.Camera.");else{var n,o,a,s,l=e.__lights,f=e.fog;for(q=-1,xt=!0,this.autoUpdateScene&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t._viewMatrixArray||(t._viewMatrixArray=new Float32Array(16)),t._projectionMatrixArray||(t._projectionMatrixArray=new Float32Array(16)),t.matrixWorldInverse.getInverse(t.matrixWorld),t.matrixWorldInverse.flattenToArray(t._viewMatrixArray),t.projectionMatrix.flattenToArray(t._projectionMatrixArray),vt.multiply(t.projectionMatrix,t.matrixWorldInverse),gt.setFromMatrix(vt),this.autoUpdateObjects&&this.initWebGLObjects(e),c(this.renderPluginsPre,e,t),W.info.render.calls=0,W.info.render.vertices=0,W.info.render.faces=0,W.info.render.points=0,this.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),s=e.__webglObjects,r=0,n=s.length;n>r;r++)if(o=s[r],a=o.object,o.render=!1,a.visible&&(!(a instanceof $i_90.Mesh||a instanceof $i_90.ParticleSystem)||!a.frustumCulled||gt.contains(a))){_(a,t);var p=o,m=p.object,E=p.buffer,g=void 0,g=g=void 0,g=m.material;g instanceof $i_90.MeshFaceMaterial?(g=E.materialIndex,g>=0&&(g=m.geometry.materials[g],g.transparent?(p.transparent=g,p.opaque=null):(p.opaque=g,p.transparent=null))):g&&(g.transparent?(p.transparent=g,p.opaque=null):(p.opaque=g,p.transparent=null)),o.render=!0,!0===this.sortObjects&&(null!==a.renderDepth?o.z=a.renderDepth:(_t.copy(a.matrixWorld.getPosition()),vt.multiplyVector3(_t),o.z=_t.z))}for(this.sortObjects&&s.sort(h),s=e.__webglObjectsImmediate,r=0,n=s.length;n>r;r++)o=s[r],a=o.object,a.visible&&(_(a,t),a=o.object.material,a.transparent?(o.transparent=a,o.opaque=null):(o.opaque=a,o.transparent=null));e.overrideMaterial?(r=e.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),R(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),u(e.__webglObjects,!1,"",t,l,f,!0,r),d(e.__webglObjectsImmediate,"",t,l,f,!1,r)):(this.setBlending($i_90.NormalBlending),u(e.__webglObjects,!0,"opaque",t,l,f,!1),d(e.__webglObjectsImmediate,"opaque",t,l,f,!1),u(e.__webglObjects,!1,"transparent",t,l,f,!0),d(e.__webglObjectsImmediate,"transparent",t,l,f,!0)),c(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==$i_90.NearestFilter&&i.minFilter!==$i_90.LinearFilter&&(i instanceof $i_90.WebGLRenderTargetCube?(N.bindTexture(N.TEXTURE_CUBE_MAP,i.__webglTexture),N.generateMipmap(N.TEXTURE_CUBE_MAP),N.bindTexture(N.TEXTURE_CUBE_MAP,null)):(N.bindTexture(N.TEXTURE_2D,i.__webglTexture),N.generateMipmap(N.TEXTURE_2D),N.bindTexture(N.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,i,r,n){var o=v(e,t,i,r,n);K=-1,W.setMaterialFaces(r),n.immediateRenderCallback?n.immediateRenderCallback(o,N,gt):n.render(function(e){W.renderBufferImmediate(e,o,r)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;){var h=e.__objectsAdded[0],l=e,c=void 0,u=void 0,d=void 0;if(!h.__webglInit)if(h.__webglInit=!0,h._modelViewMatrix=new $i_90.Matrix4,h._normalMatrix=new $i_90.Matrix3,h instanceof $i_90.Mesh)if(u=h.geometry,u instanceof $i_90.Geometry){if(void 0===u.geometryGroups){var v=u,y=void 0,_=void 0,T=void 0,x=void 0,R=void 0,b=void 0,w=void 0,H={},S=v.morphTargets.length,M=v.morphNormals.length;for(v.geometryGroups={},y=0,_=v.faces.length;_>y;y++)T=v.faces[y],x=T.materialIndex,b=void 0!==x?x:-1,void 0===H[b]&&(H[b]={hash:b,counter:0}),w=H[b].hash+"_"+H[b].counter,void 0===v.geometryGroups[w]&&(v.geometryGroups[w]={faces3:[],faces4:[],materialIndex:x,vertices:0,numMorphTargets:S,numMorphNormals:M}),R=T instanceof $i_90.Face3?3:4,v.geometryGroups[w].vertices+R>65535&&(H[b].counter+=1,w=H[b].hash+"_"+H[b].counter,void 0===v.geometryGroups[w]&&(v.geometryGroups[w]={faces3:[],faces4:[],materialIndex:x,vertices:0,numMorphTargets:S,numMorphNormals:M})),T instanceof $i_90.Face3?v.geometryGroups[w].faces3.push(y):v.geometryGroups[w].faces4.push(y),v.geometryGroups[w].vertices+=R;v.geometryGroupsList=[];var C=void 0;for(C in v.geometryGroups)v.geometryGroups[C].id=Q++,v.geometryGroupsList.push(v.geometryGroups[C])}for(c in u.geometryGroups)if(d=u.geometryGroups[c],!d.__webglVertexBuffer){var A=d;A.__webglVertexBuffer=N.createBuffer(),A.__webglNormalBuffer=N.createBuffer(),A.__webglTangentBuffer=N.createBuffer(),A.__webglColorBuffer=N.createBuffer(),A.__webglUVBuffer=N.createBuffer(),A.__webglUV2Buffer=N.createBuffer(),A.__webglSkinIndicesBuffer=N.createBuffer(),A.__webglSkinWeightsBuffer=N.createBuffer(),A.__webglFaceBuffer=N.createBuffer(),A.__webglLineBuffer=N.createBuffer();var P=void 0,L=void 0;if(A.numMorphTargets)for(A.__webglMorphTargetsBuffers=[],P=0,L=A.numMorphTargets;L>P;P++)A.__webglMorphTargetsBuffers.push(N.createBuffer());if(A.numMorphNormals)for(A.__webglMorphNormalsBuffers=[],P=0,L=A.numMorphNormals;L>P;P++)A.__webglMorphNormalsBuffers.push(N.createBuffer());W.info.memory.geometries++;var I=d,U=h,D=U.geometry,F=I.faces3,z=I.faces4,B=3*F.length+4*z.length,V=1*F.length+2*z.length,O=3*F.length+4*z.length,k=i(U,I),G=n(k),j=r(k),X=k.vertexColors?k.vertexColors:!1;I.__vertexArray=new Float32Array(3*B),j&&(I.__normalArray=new Float32Array(3*B)),D.hasTangents&&(I.__tangentArray=new Float32Array(4*B)),X&&(I.__colorArray=new Float32Array(3*B)),G&&((D.faceUvs.length>0||D.faceVertexUvs.length>0)&&(I.__uvArray=new Float32Array(2*B)),(D.faceUvs.length>1||D.faceVertexUvs.length>1)&&(I.__uv2Array=new Float32Array(2*B))),U.geometry.skinWeights.length&&U.geometry.skinIndices.length&&(I.__skinIndexArray=new Float32Array(4*B),I.__skinWeightArray=new Float32Array(4*B)),I.__faceArray=new Uint16Array(3*V),I.__lineArray=new Uint16Array(2*O);var Y=void 0,q=void 0;if(I.numMorphTargets)for(I.__morphTargetsArrays=[],Y=0,q=I.numMorphTargets;q>Y;Y++)I.__morphTargetsArrays.push(new Float32Array(3*B));if(I.numMorphNormals)for(I.__morphNormalsArrays=[],Y=0,q=I.numMorphNormals;q>Y;Y++)I.__morphNormalsArrays.push(new Float32Array(3*B));if(I.__webglFaceCount=3*V,I.__webglLineCount=2*O,k.attributes){void 0===I.__webglCustomAttributesList&&(I.__webglCustomAttributesList=[]);var K=void 0;for(K in k.attributes){var Z,J=k.attributes[K],$={};for(Z in J)$[Z]=J[Z];if(!$.__webglInitialized||$.createUniqueBuffers){$.__webglInitialized=!0;var et=1;"v2"===$.type?et=2:"v3"===$.type?et=3:"v4"===$.type?et=4:"c"===$.type&&(et=3),$.size=et,$.array=new Float32Array(B*et),$.buffer=N.createBuffer(),$.buffer.belongsToAttribute=K,J.needsUpdate=!0,$.__original=J}I.__webglCustomAttributesList.push($)}}I.__inittedArrays=!0,u.verticesNeedUpdate=!0,u.morphTargetsNeedUpdate=!0,u.elementsNeedUpdate=!0,u.uvsNeedUpdate=!0,u.normalsNeedUpdate=!0,u.tangentsNeedUpdate=!0,u.colorsNeedUpdate=!0}}else u instanceof $i_90.BufferGeometry&&o(u);else if(h instanceof $i_90.Ribbon){if(u=h.geometry,!u.__webglVertexBuffer){var tt=u;tt.__webglVertexBuffer=N.createBuffer(),tt.__webglColorBuffer=N.createBuffer(),W.info.memory.geometries++;var it=u,rt=it.vertices.length;it.__vertexArray=new Float32Array(3*rt),it.__colorArray=new Float32Array(3*rt),it.__webglVertexCount=rt,u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0}}else if(h instanceof $i_90.Line){if(u=h.geometry,!u.__webglVertexBuffer){var nt=u;nt.__webglVertexBuffer=N.createBuffer(),nt.__webglColorBuffer=N.createBuffer(),W.info.memory.geometries++;var ot=u,at=h,st=ot.vertices.length;ot.__vertexArray=new Float32Array(3*st),ot.__colorArray=new Float32Array(3*st),ot.__webglLineCount=st,t(ot,at),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0}}else if(h instanceof $i_90.ParticleSystem&&(u=h.geometry,!u.__webglVertexBuffer))if(u instanceof $i_90.Geometry){var ht=u;ht.__webglVertexBuffer=N.createBuffer(),ht.__webglColorBuffer=N.createBuffer(),W.info.memory.geometries++;var lt=u,ct=h,ut=lt.vertices.length;lt.__vertexArray=new Float32Array(3*ut),lt.__colorArray=new Float32Array(3*ut),lt.__sortArray=[],lt.__webglParticleCount=ut,t(lt,ct),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0}else u instanceof $i_90.BufferGeometry&&o(u);if(!h.__webglActive){if(h instanceof $i_90.Mesh)if(u=h.geometry,u instanceof $i_90.BufferGeometry)f(l.__webglObjects,u,h);else for(c in u.geometryGroups)d=u.geometryGroups[c],f(l.__webglObjects,d,h);else h instanceof $i_90.Ribbon||h instanceof $i_90.Line||h instanceof $i_90.ParticleSystem?(u=h.geometry,f(l.__webglObjects,u,h)):h instanceof $i_90.ImmediateRenderObject||h.immediateRenderCallback?l.__webglObjectsImmediate.push({object:h,opaque:null,transparent:null}):h instanceof $i_90.Sprite?l.__webglSprites.push(h):h instanceof $i_90.LensFlare&&l.__webglFlares.push(h);h.__webglActive=!0}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){var dt=e.__objectsRemoved[0],ft=e;dt instanceof $i_90.Mesh||dt instanceof $i_90.ParticleSystem||dt instanceof $i_90.Ribbon||dt instanceof $i_90.Line?E(ft.__webglObjects,dt):dt instanceof $i_90.Sprite?g(ft.__webglSprites,dt):dt instanceof $i_90.LensFlare?g(ft.__webglFlares,dt):(dt instanceof $i_90.ImmediateRenderObject||dt.immediateRenderCallback)&&E(ft.__webglObjectsImmediate,dt),dt.__webglActive=!1,e.__objectsRemoved.splice(0,1)}for(var pt=0,mt=e.__webglObjects.length;mt>pt;pt++){var Et=e.__webglObjects[pt].object,gt=Et.geometry,vt=void 0,yt=void 0,_t=void 0;if(Et instanceof $i_90.Mesh)if(gt instanceof $i_90.BufferGeometry)(gt.verticesNeedUpdate||gt.elementsNeedUpdate||gt.uvsNeedUpdate||gt.normalsNeedUpdate||gt.colorsNeedUpdate||gt.tangentsNeedUpdate)&&s(gt,N.DYNAMIC_DRAW,!gt.dynamic),gt.verticesNeedUpdate=!1,gt.elementsNeedUpdate=!1,gt.uvsNeedUpdate=!1,gt.normalsNeedUpdate=!1,gt.colorsNeedUpdate=!1,gt.tangentsNeedUpdate=!1;else{for(var Tt=0,xt=gt.geometryGroupsList.length;xt>Tt;Tt++)if(vt=gt.geometryGroupsList[Tt],_t=i(Et,vt),yt=_t.attributes&&p(_t),gt.verticesNeedUpdate||gt.morphTargetsNeedUpdate||gt.elementsNeedUpdate||gt.uvsNeedUpdate||gt.normalsNeedUpdate||gt.colorsNeedUpdate||gt.tangentsNeedUpdate||yt){var Rt=vt,bt=Et,wt=N.DYNAMIC_DRAW,Ht=!gt.dynamic,St=_t;if(Rt.__inittedArrays){var Mt=r(St),Ct=St.vertexColors?St.vertexColors:!1,At=n(St),Pt=Mt===$i_90.SmoothShading,Lt=void 0,It=void 0,Ut=void 0,Dt=void 0,Ft=void 0,zt=void 0,Bt=void 0,Vt=void 0,Nt=void 0,Ot=void 0,kt=void 0,Wt=void 0,Gt=void 0,jt=void 0,Xt=void 0,Yt=void 0,qt=void 0,Kt=void 0,Zt=void 0,Qt=void 0,Jt=void 0,$t=void 0,ei=void 0,ti=void 0,ii=void 0,ri=void 0,ni=void 0,oi=void 0,ai=void 0,si=void 0,hi=void 0,li=void 0,ci=void 0,ui=void 0,di=void 0,fi=void 0,pi=void 0,mi=void 0,Ei=void 0,gi=void 0,vi=void 0,yi=void 0,_i=void 0,Ti=void 0,xi=void 0,Ri=void 0,bi=0,wi=0,Hi=0,Si=0,Mi=0,Ci=0,Ai=0,Pi=0,Li=0,Ii=0,Ui=0,Di=0,Fi=void 0,zi=Rt.__vertexArray,Bi=Rt.__uvArray,Vi=Rt.__uv2Array,Ni=Rt.__normalArray,Oi=Rt.__tangentArray,ki=Rt.__colorArray,Wi=Rt.__skinIndexArray,Gi=Rt.__skinWeightArray,ji=Rt.__morphTargetsArrays,Xi=Rt.__morphNormalsArrays,Yi=Rt.__webglCustomAttributesList,qi=void 0,Ki=Rt.__faceArray,Zi=Rt.__lineArray,Qi=bt.geometry,Ji=Qi.elementsNeedUpdate,$i=Qi.uvsNeedUpdate,er=Qi.normalsNeedUpdate,tr=Qi.tangentsNeedUpdate,ir=Qi.colorsNeedUpdate,rr=Qi.morphTargetsNeedUpdate,nr=Qi.vertices,or=Rt.faces3,ar=Rt.faces4,sr=Qi.faces,hr=Qi.faceVertexUvs[0],lr=Qi.faceVertexUvs[1],cr=Qi.skinIndices,ur=Qi.skinWeights,dr=Qi.morphTargets,fr=Qi.morphNormals;if(Qi.verticesNeedUpdate){for(Lt=0,It=or.length;It>Lt;Lt++)Dt=sr[or[Lt]],Wt=nr[Dt.a],Gt=nr[Dt.b],jt=nr[Dt.c],zi[wi]=Wt.x,zi[wi+1]=Wt.y,zi[wi+2]=Wt.z,zi[wi+3]=Gt.x,zi[wi+4]=Gt.y,zi[wi+5]=Gt.z,zi[wi+6]=jt.x,zi[wi+7]=jt.y,zi[wi+8]=jt.z,wi+=9;for(Lt=0,It=ar.length;It>Lt;Lt++)Dt=sr[ar[Lt]],Wt=nr[Dt.a],Gt=nr[Dt.b],jt=nr[Dt.c],Xt=nr[Dt.d],zi[wi]=Wt.x,zi[wi+1]=Wt.y,zi[wi+2]=Wt.z,zi[wi+3]=Gt.x,zi[wi+4]=Gt.y,zi[wi+5]=Gt.z,zi[wi+6]=jt.x,zi[wi+7]=jt.y,zi[wi+8]=jt.z,zi[wi+9]=Xt.x,zi[wi+10]=Xt.y,zi[wi+11]=Xt.z,wi+=12;N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,zi,wt)}if(rr)for(vi=0,yi=dr.length;yi>vi;vi++){for(Lt=Ui=0,It=or.length;It>Lt;Lt++)xi=or[Lt],Dt=sr[xi],Wt=dr[vi].vertices[Dt.a],Gt=dr[vi].vertices[Dt.b],jt=dr[vi].vertices[Dt.c],_i=ji[vi],_i[Ui]=Wt.x,_i[Ui+1]=Wt.y,_i[Ui+2]=Wt.z,_i[Ui+3]=Gt.x,_i[Ui+4]=Gt.y,_i[Ui+5]=Gt.z,_i[Ui+6]=jt.x,_i[Ui+7]=jt.y,_i[Ui+8]=jt.z,St.morphNormals&&(Pt?(Ri=fr[vi].vertexNormals[xi],Qt=Ri.a,Jt=Ri.b,$t=Ri.c):$t=Jt=Qt=fr[vi].faceNormals[xi],Ti=Xi[vi],Ti[Ui]=Qt.x,Ti[Ui+1]=Qt.y,Ti[Ui+2]=Qt.z,Ti[Ui+3]=Jt.x,Ti[Ui+4]=Jt.y,Ti[Ui+5]=Jt.z,Ti[Ui+6]=$t.x,Ti[Ui+7]=$t.y,Ti[Ui+8]=$t.z),Ui+=9;for(Lt=0,It=ar.length;It>Lt;Lt++)xi=ar[Lt],Dt=sr[xi],Wt=dr[vi].vertices[Dt.a],Gt=dr[vi].vertices[Dt.b],jt=dr[vi].vertices[Dt.c],Xt=dr[vi].vertices[Dt.d],_i=ji[vi],_i[Ui]=Wt.x,_i[Ui+1]=Wt.y,_i[Ui+2]=Wt.z,_i[Ui+3]=Gt.x,_i[Ui+4]=Gt.y,_i[Ui+5]=Gt.z,_i[Ui+6]=jt.x,_i[Ui+7]=jt.y,_i[Ui+8]=jt.z,_i[Ui+9]=Xt.x,_i[Ui+10]=Xt.y,_i[Ui+11]=Xt.z,St.morphNormals&&(Pt?(Ri=fr[vi].vertexNormals[xi],Qt=Ri.a,Jt=Ri.b,$t=Ri.c,ei=Ri.d):ei=$t=Jt=Qt=fr[vi].faceNormals[xi],Ti=Xi[vi],Ti[Ui]=Qt.x,Ti[Ui+1]=Qt.y,Ti[Ui+2]=Qt.z,Ti[Ui+3]=Jt.x,Ti[Ui+4]=Jt.y,Ti[Ui+5]=Jt.z,Ti[Ui+6]=$t.x,Ti[Ui+7]=$t.y,Ti[Ui+8]=$t.z,Ti[Ui+9]=ei.x,Ti[Ui+10]=ei.y,Ti[Ui+11]=ei.z),Ui+=12;N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglMorphTargetsBuffers[vi]),N.bufferData(N.ARRAY_BUFFER,ji[vi],wt),St.morphNormals&&(N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglMorphNormalsBuffers[vi]),N.bufferData(N.ARRAY_BUFFER,Xi[vi],wt))}if(ur.length){for(Lt=0,It=or.length;It>Lt;Lt++)Dt=sr[or[Lt]],oi=ur[Dt.a],ai=ur[Dt.b],si=ur[Dt.c],Gi[Ii]=oi.x,Gi[Ii+1]=oi.y,Gi[Ii+2]=oi.z,Gi[Ii+3]=oi.w,Gi[Ii+4]=ai.x,Gi[Ii+5]=ai.y,Gi[Ii+6]=ai.z,Gi[Ii+7]=ai.w,Gi[Ii+8]=si.x,Gi[Ii+9]=si.y,Gi[Ii+10]=si.z,Gi[Ii+11]=si.w,li=cr[Dt.a],ci=cr[Dt.b],ui=cr[Dt.c],Wi[Ii]=li.x,Wi[Ii+1]=li.y,Wi[Ii+2]=li.z,Wi[Ii+3]=li.w,Wi[Ii+4]=ci.x,Wi[Ii+5]=ci.y,Wi[Ii+6]=ci.z,Wi[Ii+7]=ci.w,Wi[Ii+8]=ui.x,Wi[Ii+9]=ui.y,Wi[Ii+10]=ui.z,Wi[Ii+11]=ui.w,Ii+=12;for(Lt=0,It=ar.length;It>Lt;Lt++)Dt=sr[ar[Lt]],oi=ur[Dt.a],ai=ur[Dt.b],si=ur[Dt.c],hi=ur[Dt.d],Gi[Ii]=oi.x,Gi[Ii+1]=oi.y,Gi[Ii+2]=oi.z,Gi[Ii+3]=oi.w,Gi[Ii+4]=ai.x,Gi[Ii+5]=ai.y,Gi[Ii+6]=ai.z,Gi[Ii+7]=ai.w,Gi[Ii+8]=si.x,Gi[Ii+9]=si.y,Gi[Ii+10]=si.z,Gi[Ii+11]=si.w,Gi[Ii+12]=hi.x,Gi[Ii+13]=hi.y,Gi[Ii+14]=hi.z,Gi[Ii+15]=hi.w,li=cr[Dt.a],ci=cr[Dt.b],ui=cr[Dt.c],di=cr[Dt.d],Wi[Ii]=li.x,Wi[Ii+1]=li.y,Wi[Ii+2]=li.z,Wi[Ii+3]=li.w,Wi[Ii+4]=ci.x,Wi[Ii+5]=ci.y,Wi[Ii+6]=ci.z,Wi[Ii+7]=ci.w,Wi[Ii+8]=ui.x,Wi[Ii+9]=ui.y,Wi[Ii+10]=ui.z,Wi[Ii+11]=ui.w,Wi[Ii+12]=di.x,Wi[Ii+13]=di.y,Wi[Ii+14]=di.z,Wi[Ii+15]=di.w,Ii+=16;Ii>0&&(N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglSkinIndicesBuffer),N.bufferData(N.ARRAY_BUFFER,Wi,wt),N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglSkinWeightsBuffer),N.bufferData(N.ARRAY_BUFFER,Gi,wt))}if(ir&&Ct){for(Lt=0,It=or.length;It>Lt;Lt++)Dt=sr[or[Lt]],Bt=Dt.vertexColors,Vt=Dt.color,3===Bt.length&&Ct===$i_90.VertexColors?(ti=Bt[0],ii=Bt[1],ri=Bt[2]):ri=ii=ti=Vt,ki[Li]=ti.r,ki[Li+1]=ti.g,ki[Li+2]=ti.b,ki[Li+3]=ii.r,ki[Li+4]=ii.g,ki[Li+5]=ii.b,ki[Li+6]=ri.r,ki[Li+7]=ri.g,ki[Li+8]=ri.b,Li+=9;for(Lt=0,It=ar.length;It>Lt;Lt++)Dt=sr[ar[Lt]],Bt=Dt.vertexColors,Vt=Dt.color,4===Bt.length&&Ct===$i_90.VertexColors?(ti=Bt[0],ii=Bt[1],ri=Bt[2],ni=Bt[3]):ni=ri=ii=ti=Vt,ki[Li]=ti.r,ki[Li+1]=ti.g,ki[Li+2]=ti.b,ki[Li+3]=ii.r,ki[Li+4]=ii.g,ki[Li+5]=ii.b,ki[Li+6]=ri.r,ki[Li+7]=ri.g,ki[Li+8]=ri.b,ki[Li+9]=ni.r,ki[Li+10]=ni.g,ki[Li+11]=ni.b,Li+=12;Li>0&&(N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglColorBuffer),N.bufferData(N.ARRAY_BUFFER,ki,wt))}if(tr&&Qi.hasTangents){for(Lt=0,It=or.length;It>Lt;Lt++)Dt=sr[or[Lt]],Nt=Dt.vertexTangents,Yt=Nt[0],qt=Nt[1],Kt=Nt[2],Oi[Ai]=Yt.x,Oi[Ai+1]=Yt.y,Oi[Ai+2]=Yt.z,Oi[Ai+3]=Yt.w,Oi[Ai+4]=qt.x,Oi[Ai+5]=qt.y,Oi[Ai+6]=qt.z,Oi[Ai+7]=qt.w,Oi[Ai+8]=Kt.x,Oi[Ai+9]=Kt.y,Oi[Ai+10]=Kt.z,Oi[Ai+11]=Kt.w,Ai+=12;for(Lt=0,It=ar.length;It>Lt;Lt++)Dt=sr[ar[Lt]],Nt=Dt.vertexTangents,Yt=Nt[0],qt=Nt[1],Kt=Nt[2],Zt=Nt[3],Oi[Ai]=Yt.x,Oi[Ai+1]=Yt.y,Oi[Ai+2]=Yt.z,Oi[Ai+3]=Yt.w,Oi[Ai+4]=qt.x,Oi[Ai+5]=qt.y,Oi[Ai+6]=qt.z,Oi[Ai+7]=qt.w,Oi[Ai+8]=Kt.x,Oi[Ai+9]=Kt.y,Oi[Ai+10]=Kt.z,Oi[Ai+11]=Kt.w,Oi[Ai+12]=Zt.x,Oi[Ai+13]=Zt.y,Oi[Ai+14]=Zt.z,Oi[Ai+15]=Zt.w,Ai+=16;N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglTangentBuffer),N.bufferData(N.ARRAY_BUFFER,Oi,wt)}if(er&&Mt){for(Lt=0,It=or.length;It>Lt;Lt++)if(Dt=sr[or[Lt]],Ft=Dt.vertexNormals,zt=Dt.normal,3===Ft.length&&Pt)for(fi=0;3>fi;fi++)mi=Ft[fi],Ni[Ci]=mi.x,Ni[Ci+1]=mi.y,Ni[Ci+2]=mi.z,Ci+=3;else for(fi=0;3>fi;fi++)Ni[Ci]=zt.x,Ni[Ci+1]=zt.y,Ni[Ci+2]=zt.z,Ci+=3;for(Lt=0,It=ar.length;It>Lt;Lt++)if(Dt=sr[ar[Lt]],Ft=Dt.vertexNormals,zt=Dt.normal,4===Ft.length&&Pt)for(fi=0;4>fi;fi++)mi=Ft[fi],Ni[Ci]=mi.x,Ni[Ci+1]=mi.y,Ni[Ci+2]=mi.z,Ci+=3;else for(fi=0;4>fi;fi++)Ni[Ci]=zt.x,Ni[Ci+1]=zt.y,Ni[Ci+2]=zt.z,Ci+=3;N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglNormalBuffer),N.bufferData(N.ARRAY_BUFFER,Ni,wt)}if($i&&hr&&At){for(Lt=0,It=or.length;It>Lt;Lt++)if(Ut=or[Lt],Ot=hr[Ut],void 0!==Ot)for(fi=0;3>fi;fi++)Ei=Ot[fi],Bi[Hi]=Ei.u,Bi[Hi+1]=Ei.v,Hi+=2;for(Lt=0,It=ar.length;It>Lt;Lt++)if(Ut=ar[Lt],Ot=hr[Ut],void 0!==Ot)for(fi=0;4>fi;fi++)Ei=Ot[fi],Bi[Hi]=Ei.u,Bi[Hi+1]=Ei.v,Hi+=2;Hi>0&&(N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglUVBuffer),N.bufferData(N.ARRAY_BUFFER,Bi,wt))}if($i&&lr&&At){for(Lt=0,It=or.length;It>Lt;Lt++)if(Ut=or[Lt],kt=lr[Ut],void 0!==kt)for(fi=0;3>fi;fi++)gi=kt[fi],Vi[Si]=gi.u,Vi[Si+1]=gi.v,Si+=2;for(Lt=0,It=ar.length;It>Lt;Lt++)if(Ut=ar[Lt],kt=lr[Ut],void 0!==kt)for(fi=0;4>fi;fi++)gi=kt[fi],Vi[Si]=gi.u,Vi[Si+1]=gi.v,Si+=2;Si>0&&(N.bindBuffer(N.ARRAY_BUFFER,Rt.__webglUV2Buffer),N.bufferData(N.ARRAY_BUFFER,Vi,wt))}if(Ji){for(Lt=0,It=or.length;It>Lt;Lt++)Ki[Mi]=bi,Ki[Mi+1]=bi+1,Ki[Mi+2]=bi+2,Mi+=3,Zi[Pi]=bi,Zi[Pi+1]=bi+1,Zi[Pi+2]=bi,Zi[Pi+3]=bi+2,Zi[Pi+4]=bi+1,Zi[Pi+5]=bi+2,Pi+=6,bi+=3;for(Lt=0,It=ar.length;It>Lt;Lt++)Ki[Mi]=bi,Ki[Mi+1]=bi+1,Ki[Mi+2]=bi+3,Ki[Mi+3]=bi+1,Ki[Mi+4]=bi+2,Ki[Mi+5]=bi+3,Mi+=6,Zi[Pi]=bi,Zi[Pi+1]=bi+1,Zi[Pi+2]=bi,Zi[Pi+3]=bi+3,Zi[Pi+4]=bi+1,Zi[Pi+5]=bi+2,Zi[Pi+6]=bi+2,Zi[Pi+7]=bi+3,Pi+=8,bi+=4;N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,Rt.__webglFaceBuffer),N.bufferData(N.ELEMENT_ARRAY_BUFFER,Ki,wt),N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,Rt.__webglLineBuffer),N.bufferData(N.ELEMENT_ARRAY_BUFFER,Zi,wt)}if(Yi)for(fi=0,pi=Yi.length;pi>fi;fi++)if(qi=Yi[fi],qi.__original.needsUpdate){if(Di=0,1===qi.size){if(void 0===qi.boundTo||"vertices"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)Dt=sr[or[Lt]],qi.array[Di]=qi.value[Dt.a],qi.array[Di+1]=qi.value[Dt.b],qi.array[Di+2]=qi.value[Dt.c],Di+=3;for(Lt=0,It=ar.length;It>Lt;Lt++)Dt=sr[ar[Lt]],qi.array[Di]=qi.value[Dt.a],qi.array[Di+1]=qi.value[Dt.b],qi.array[Di+2]=qi.value[Dt.c],qi.array[Di+3]=qi.value[Dt.d],Di+=4}else if("faces"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)Fi=qi.value[or[Lt]],qi.array[Di]=Fi,qi.array[Di+1]=Fi,qi.array[Di+2]=Fi,Di+=3;for(Lt=0,It=ar.length;It>Lt;Lt++)Fi=qi.value[ar[Lt]],qi.array[Di]=Fi,qi.array[Di+1]=Fi,qi.array[Di+2]=Fi,qi.array[Di+3]=Fi,Di+=4}}else if(2===qi.size){if(void 0===qi.boundTo||"vertices"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)Dt=sr[or[Lt]],Wt=qi.value[Dt.a],Gt=qi.value[Dt.b],jt=qi.value[Dt.c],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Gt.x,qi.array[Di+3]=Gt.y,qi.array[Di+4]=jt.x,qi.array[Di+5]=jt.y,Di+=6;for(Lt=0,It=ar.length;It>Lt;Lt++)Dt=sr[ar[Lt]],Wt=qi.value[Dt.a],Gt=qi.value[Dt.b],jt=qi.value[Dt.c],Xt=qi.value[Dt.d],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Gt.x,qi.array[Di+3]=Gt.y,qi.array[Di+4]=jt.x,qi.array[Di+5]=jt.y,qi.array[Di+6]=Xt.x,qi.array[Di+7]=Xt.y,Di+=8}else if("faces"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)jt=Gt=Wt=Fi=qi.value[or[Lt]],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Gt.x,qi.array[Di+3]=Gt.y,qi.array[Di+4]=jt.x,qi.array[Di+5]=jt.y,Di+=6;
for(Lt=0,It=ar.length;It>Lt;Lt++)Xt=jt=Gt=Wt=Fi=qi.value[ar[Lt]],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Gt.x,qi.array[Di+3]=Gt.y,qi.array[Di+4]=jt.x,qi.array[Di+5]=jt.y,qi.array[Di+6]=Xt.x,qi.array[Di+7]=Xt.y,Di+=8}}else if(3===qi.size){var pr;if(pr="c"===qi.type?["r","g","b"]:["x","y","z"],void 0===qi.boundTo||"vertices"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)Dt=sr[or[Lt]],Wt=qi.value[Dt.a],Gt=qi.value[Dt.b],jt=qi.value[Dt.c],qi.array[Di]=Wt[pr[0]],qi.array[Di+1]=Wt[pr[1]],qi.array[Di+2]=Wt[pr[2]],qi.array[Di+3]=Gt[pr[0]],qi.array[Di+4]=Gt[pr[1]],qi.array[Di+5]=Gt[pr[2]],qi.array[Di+6]=jt[pr[0]],qi.array[Di+7]=jt[pr[1]],qi.array[Di+8]=jt[pr[2]],Di+=9;for(Lt=0,It=ar.length;It>Lt;Lt++)Dt=sr[ar[Lt]],Wt=qi.value[Dt.a],Gt=qi.value[Dt.b],jt=qi.value[Dt.c],Xt=qi.value[Dt.d],qi.array[Di]=Wt[pr[0]],qi.array[Di+1]=Wt[pr[1]],qi.array[Di+2]=Wt[pr[2]],qi.array[Di+3]=Gt[pr[0]],qi.array[Di+4]=Gt[pr[1]],qi.array[Di+5]=Gt[pr[2]],qi.array[Di+6]=jt[pr[0]],qi.array[Di+7]=jt[pr[1]],qi.array[Di+8]=jt[pr[2]],qi.array[Di+9]=Xt[pr[0]],qi.array[Di+10]=Xt[pr[1]],qi.array[Di+11]=Xt[pr[2]],Di+=12}else if("faces"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)jt=Gt=Wt=Fi=qi.value[or[Lt]],qi.array[Di]=Wt[pr[0]],qi.array[Di+1]=Wt[pr[1]],qi.array[Di+2]=Wt[pr[2]],qi.array[Di+3]=Gt[pr[0]],qi.array[Di+4]=Gt[pr[1]],qi.array[Di+5]=Gt[pr[2]],qi.array[Di+6]=jt[pr[0]],qi.array[Di+7]=jt[pr[1]],qi.array[Di+8]=jt[pr[2]],Di+=9;for(Lt=0,It=ar.length;It>Lt;Lt++)Xt=jt=Gt=Wt=Fi=qi.value[ar[Lt]],qi.array[Di]=Wt[pr[0]],qi.array[Di+1]=Wt[pr[1]],qi.array[Di+2]=Wt[pr[2]],qi.array[Di+3]=Gt[pr[0]],qi.array[Di+4]=Gt[pr[1]],qi.array[Di+5]=Gt[pr[2]],qi.array[Di+6]=jt[pr[0]],qi.array[Di+7]=jt[pr[1]],qi.array[Di+8]=jt[pr[2]],qi.array[Di+9]=Xt[pr[0]],qi.array[Di+10]=Xt[pr[1]],qi.array[Di+11]=Xt[pr[2]],Di+=12}else if("faceVertices"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)Fi=qi.value[or[Lt]],Wt=Fi[0],Gt=Fi[1],jt=Fi[2],qi.array[Di]=Wt[pr[0]],qi.array[Di+1]=Wt[pr[1]],qi.array[Di+2]=Wt[pr[2]],qi.array[Di+3]=Gt[pr[0]],qi.array[Di+4]=Gt[pr[1]],qi.array[Di+5]=Gt[pr[2]],qi.array[Di+6]=jt[pr[0]],qi.array[Di+7]=jt[pr[1]],qi.array[Di+8]=jt[pr[2]],Di+=9;for(Lt=0,It=ar.length;It>Lt;Lt++)Fi=qi.value[ar[Lt]],Wt=Fi[0],Gt=Fi[1],jt=Fi[2],Xt=Fi[3],qi.array[Di]=Wt[pr[0]],qi.array[Di+1]=Wt[pr[1]],qi.array[Di+2]=Wt[pr[2]],qi.array[Di+3]=Gt[pr[0]],qi.array[Di+4]=Gt[pr[1]],qi.array[Di+5]=Gt[pr[2]],qi.array[Di+6]=jt[pr[0]],qi.array[Di+7]=jt[pr[1]],qi.array[Di+8]=jt[pr[2]],qi.array[Di+9]=Xt[pr[0]],qi.array[Di+10]=Xt[pr[1]],qi.array[Di+11]=Xt[pr[2]],Di+=12}}else if(4===qi.size)if(void 0===qi.boundTo||"vertices"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)Dt=sr[or[Lt]],Wt=qi.value[Dt.a],Gt=qi.value[Dt.b],jt=qi.value[Dt.c],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Wt.z,qi.array[Di+3]=Wt.w,qi.array[Di+4]=Gt.x,qi.array[Di+5]=Gt.y,qi.array[Di+6]=Gt.z,qi.array[Di+7]=Gt.w,qi.array[Di+8]=jt.x,qi.array[Di+9]=jt.y,qi.array[Di+10]=jt.z,qi.array[Di+11]=jt.w,Di+=12;for(Lt=0,It=ar.length;It>Lt;Lt++)Dt=sr[ar[Lt]],Wt=qi.value[Dt.a],Gt=qi.value[Dt.b],jt=qi.value[Dt.c],Xt=qi.value[Dt.d],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Wt.z,qi.array[Di+3]=Wt.w,qi.array[Di+4]=Gt.x,qi.array[Di+5]=Gt.y,qi.array[Di+6]=Gt.z,qi.array[Di+7]=Gt.w,qi.array[Di+8]=jt.x,qi.array[Di+9]=jt.y,qi.array[Di+10]=jt.z,qi.array[Di+11]=jt.w,qi.array[Di+12]=Xt.x,qi.array[Di+13]=Xt.y,qi.array[Di+14]=Xt.z,qi.array[Di+15]=Xt.w,Di+=16}else if("faces"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)jt=Gt=Wt=Fi=qi.value[or[Lt]],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Wt.z,qi.array[Di+3]=Wt.w,qi.array[Di+4]=Gt.x,qi.array[Di+5]=Gt.y,qi.array[Di+6]=Gt.z,qi.array[Di+7]=Gt.w,qi.array[Di+8]=jt.x,qi.array[Di+9]=jt.y,qi.array[Di+10]=jt.z,qi.array[Di+11]=jt.w,Di+=12;for(Lt=0,It=ar.length;It>Lt;Lt++)Xt=jt=Gt=Wt=Fi=qi.value[ar[Lt]],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Wt.z,qi.array[Di+3]=Wt.w,qi.array[Di+4]=Gt.x,qi.array[Di+5]=Gt.y,qi.array[Di+6]=Gt.z,qi.array[Di+7]=Gt.w,qi.array[Di+8]=jt.x,qi.array[Di+9]=jt.y,qi.array[Di+10]=jt.z,qi.array[Di+11]=jt.w,qi.array[Di+12]=Xt.x,qi.array[Di+13]=Xt.y,qi.array[Di+14]=Xt.z,qi.array[Di+15]=Xt.w,Di+=16}else if("faceVertices"===qi.boundTo){for(Lt=0,It=or.length;It>Lt;Lt++)Fi=qi.value[or[Lt]],Wt=Fi[0],Gt=Fi[1],jt=Fi[2],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Wt.z,qi.array[Di+3]=Wt.w,qi.array[Di+4]=Gt.x,qi.array[Di+5]=Gt.y,qi.array[Di+6]=Gt.z,qi.array[Di+7]=Gt.w,qi.array[Di+8]=jt.x,qi.array[Di+9]=jt.y,qi.array[Di+10]=jt.z,qi.array[Di+11]=jt.w,Di+=12;for(Lt=0,It=ar.length;It>Lt;Lt++)Fi=qi.value[ar[Lt]],Wt=Fi[0],Gt=Fi[1],jt=Fi[2],Xt=Fi[3],qi.array[Di]=Wt.x,qi.array[Di+1]=Wt.y,qi.array[Di+2]=Wt.z,qi.array[Di+3]=Wt.w,qi.array[Di+4]=Gt.x,qi.array[Di+5]=Gt.y,qi.array[Di+6]=Gt.z,qi.array[Di+7]=Gt.w,qi.array[Di+8]=jt.x,qi.array[Di+9]=jt.y,qi.array[Di+10]=jt.z,qi.array[Di+11]=jt.w,qi.array[Di+12]=Xt.x,qi.array[Di+13]=Xt.y,qi.array[Di+14]=Xt.z,qi.array[Di+15]=Xt.w,Di+=16}N.bindBuffer(N.ARRAY_BUFFER,qi.buffer),N.bufferData(N.ARRAY_BUFFER,qi.array,wt)}Ht&&(delete Rt.__inittedArrays,delete Rt.__colorArray,delete Rt.__normalArray,delete Rt.__tangentArray,delete Rt.__uvArray,delete Rt.__uv2Array,delete Rt.__faceArray,delete Rt.__vertexArray,delete Rt.__lineArray,delete Rt.__skinIndexArray,delete Rt.__skinWeightArray)}}gt.verticesNeedUpdate=!1,gt.morphTargetsNeedUpdate=!1,gt.elementsNeedUpdate=!1,gt.uvsNeedUpdate=!1,gt.normalsNeedUpdate=!1,gt.colorsNeedUpdate=!1,gt.tangentsNeedUpdate=!1,_t.attributes&&m(_t)}else if(Et instanceof $i_90.Ribbon){if(gt.verticesNeedUpdate||gt.colorsNeedUpdate){var mr=gt,Er=N.DYNAMIC_DRAW,gr=void 0,vr=void 0,yr=void 0,_r=void 0,Tr=void 0,xr=mr.vertices,Rr=mr.colors,br=xr.length,wr=Rr.length,Hr=mr.__vertexArray,Sr=mr.__colorArray,Mr=mr.colorsNeedUpdate;if(mr.verticesNeedUpdate){for(gr=0;br>gr;gr++)yr=xr[gr],_r=3*gr,Hr[_r]=yr.x,Hr[_r+1]=yr.y,Hr[_r+2]=yr.z;N.bindBuffer(N.ARRAY_BUFFER,mr.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,Hr,Er)}if(Mr){for(vr=0;wr>vr;vr++)Tr=Rr[vr],_r=3*vr,Sr[_r]=Tr.r,Sr[_r+1]=Tr.g,Sr[_r+2]=Tr.b;N.bindBuffer(N.ARRAY_BUFFER,mr.__webglColorBuffer),N.bufferData(N.ARRAY_BUFFER,Sr,Er)}}gt.verticesNeedUpdate=!1,gt.colorsNeedUpdate=!1}else if(Et instanceof $i_90.Line){if(_t=i(Et,vt),yt=_t.attributes&&p(_t),gt.verticesNeedUpdate||gt.colorsNeedUpdate||yt){var Cr=gt,Ar=N.DYNAMIC_DRAW,Pr=void 0,Lr=void 0,Ir=void 0,Ur=void 0,Dr=void 0,Fr=Cr.vertices,zr=Cr.colors,Br=Fr.length,Vr=zr.length,Nr=Cr.__vertexArray,Or=Cr.__colorArray,kr=Cr.colorsNeedUpdate,Wr=Cr.__webglCustomAttributesList,Gr=void 0,jr=void 0,Xr=void 0,Yr=void 0,qr=void 0,Kr=void 0;if(Cr.verticesNeedUpdate){for(Pr=0;Br>Pr;Pr++)Ir=Fr[Pr],Ur=3*Pr,Nr[Ur]=Ir.x,Nr[Ur+1]=Ir.y,Nr[Ur+2]=Ir.z;N.bindBuffer(N.ARRAY_BUFFER,Cr.__webglVertexBuffer),N.bufferData(N.ARRAY_BUFFER,Nr,Ar)}if(kr){for(Lr=0;Vr>Lr;Lr++)Dr=zr[Lr],Ur=3*Lr,Or[Ur]=Dr.r,Or[Ur+1]=Dr.g,Or[Ur+2]=Dr.b;N.bindBuffer(N.ARRAY_BUFFER,Cr.__webglColorBuffer),N.bufferData(N.ARRAY_BUFFER,Or,Ar)}if(Wr)for(Gr=0,jr=Wr.length;jr>Gr;Gr++)if(Kr=Wr[Gr],Kr.needsUpdate&&(void 0===Kr.boundTo||"vertices"===Kr.boundTo)){if(Ur=0,Yr=Kr.value.length,1===Kr.size)for(Xr=0;Yr>Xr;Xr++)Kr.array[Xr]=Kr.value[Xr];else if(2===Kr.size)for(Xr=0;Yr>Xr;Xr++)qr=Kr.value[Xr],Kr.array[Ur]=qr.x,Kr.array[Ur+1]=qr.y,Ur+=2;else if(3===Kr.size)if("c"===Kr.type)for(Xr=0;Yr>Xr;Xr++)qr=Kr.value[Xr],Kr.array[Ur]=qr.r,Kr.array[Ur+1]=qr.g,Kr.array[Ur+2]=qr.b,Ur+=3;else for(Xr=0;Yr>Xr;Xr++)qr=Kr.value[Xr],Kr.array[Ur]=qr.x,Kr.array[Ur+1]=qr.y,Kr.array[Ur+2]=qr.z,Ur+=3;else if(4===Kr.size)for(Xr=0;Yr>Xr;Xr++)qr=Kr.value[Xr],Kr.array[Ur]=qr.x,Kr.array[Ur+1]=qr.y,Kr.array[Ur+2]=qr.z,Kr.array[Ur+3]=qr.w,Ur+=4;N.bindBuffer(N.ARRAY_BUFFER,Kr.buffer),N.bufferData(N.ARRAY_BUFFER,Kr.array,Ar)}}gt.verticesNeedUpdate=!1,gt.colorsNeedUpdate=!1,_t.attributes&&m(_t)}else Et instanceof $i_90.ParticleSystem&&(gt instanceof $i_90.BufferGeometry?((gt.verticesNeedUpdate||gt.colorsNeedUpdate)&&s(gt,N.DYNAMIC_DRAW,!gt.dynamic),gt.verticesNeedUpdate=!1,gt.colorsNeedUpdate=!1):(_t=i(Et,vt),yt=_t.attributes&&p(_t),(gt.verticesNeedUpdate||gt.colorsNeedUpdate||Et.sortParticles||yt)&&a(gt,N.DYNAMIC_DRAW,Et),gt.verticesNeedUpdate=!1,gt.colorsNeedUpdate=!1,_t.attributes&&m(_t)))}},this.initMaterial=function(e,t,i,r){var n,o,a,s,h,l,c,u,d;if(e instanceof $i_90.MeshDepthMaterial?d="depth":e instanceof $i_90.MeshNormalMaterial?d="normal":e instanceof $i_90.MeshBasicMaterial?d="basic":e instanceof $i_90.MeshLambertMaterial?d="lambert":e instanceof $i_90.MeshPhongMaterial?d="phong":e instanceof $i_90.LineBasicMaterial?d="basic":e instanceof $i_90.ParticleBasicMaterial&&(d="particle_basic"),d){var f=$i_90.ShaderLib[d];e.uniforms=$i_90.UniformsUtils.clone(f.uniforms),e.vertexShader=f.vertexShader,e.fragmentShader=f.fragmentShader}var p,m,E;for(n=p=m=E=f=0,o=t.length;o>n;n++)a=t[n],a.onlyShadow||(a instanceof $i_90.DirectionalLight&&p++,a instanceof $i_90.PointLight&&m++,a instanceof $i_90.SpotLight&&E++,a instanceof $i_90.HemisphereLight&&f++);for(m+E+p+f>V?(n=Math.ceil(V*p/(m+p)),E=m=V-n,f=n):n=p,o=m,a=E,s=f,f=p=0,E=t.length;E>f;f++)m=t[f],m.castShadow&&(m instanceof $i_90.SpotLight&&p++,m instanceof $i_90.DirectionalLight&&!m.shadowCascade&&p++);u=p,Ct&&r&&r.useVertexTexture?c=1024:(t=N.getParameter(N.MAX_VERTEX_UNIFORM_VECTORS),t=Math.floor((t-20)/4),void 0!==r&&r instanceof $i_90.SkinnedMesh&&(t=Math.min(r.bones.length,t),r.bones.length>t&&console.warn("WebGLRenderer: too many bones - "+r.bones.length+", this GPU supports just "+t+" (try OpenGL instead of ANGLE)")),c=t);var g;e:{m=e.fragmentShader,E=e.vertexShader,f=e.uniforms,t=e.attributes,p=e.defines;var v,y,_,i={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:c,useVertexTexture:Ct&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:n,maxPointLights:o,maxSpotLights:a,maxHemiLights:s,maxShadows:u,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===$i_90.DoubleSide,flipSided:e.side===$i_90.BackSide},r=[];d?r.push(d):(r.push(m),r.push(E));for(y in p)r.push(y),r.push(p[y]);for(v in i)r.push(v),r.push(i[v]);for(d=r.join(),v=0,y=G.length;y>v;v++)if(r=G[v],r.code===d){r.usedTimes++,g=r.program;break e}v=[];for(_ in p)y=p[_],!1!==y&&(y="#define "+_+" "+y,v.push(y));y=v.join("\n"),_=N.createProgram(),v=["precision "+P+" float;",y,Mt?"#define VERTEX_TEXTURES":"",W.gammaInput?"#define GAMMA_INPUT":"",W.gammaOutput?"#define GAMMA_OUTPUT":"",W.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.boneTextureWidth?"#define N_BONE_PIXEL_X "+i.boneTextureWidth.toFixed(1):"",i.boneTextureHeight?"#define N_BONE_PIXEL_Y "+i.boneTextureHeight.toFixed(1):"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),y=["precision "+P+" float;",i.bumpMap||i.normalMap?"#extension GL_OES_standard_derivatives : enable":"",y,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",W.gammaInput?"#define GAMMA_INPUT":"",W.gammaOutput?"#define GAMMA_OUTPUT":"",W.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fog instanceof $i_90.FogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),y=w("fragment",y+m),v=w("vertex",v+E),N.attachShader(_,v),N.attachShader(_,y),N.linkProgram(_),N.getProgramParameter(_,N.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+N.getProgramParameter(_,N.VALIDATE_STATUS)+", gl error ["+N.getError()+"]"),N.deleteShader(y),N.deleteShader(v),_.uniforms={},_.attributes={};var T;v="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),i.useVertexTexture?v.push("boneTexture"):v.push("boneGlobalMatrices");for(T in f)v.push(T);for(T=v,v=0,y=T.length;y>v;v++)r=T[v],_.uniforms[r]=N.getUniformLocation(_,r);for(v="position normal uv uv2 tangent color skinIndex skinWeight".split(" "),T=0;i.maxMorphTargets>T;T++)v.push("morphTarget"+T);for(T=0;i.maxMorphNormals>T;T++)v.push("morphNormal"+T);for(g in t)v.push(g);for(g=v,T=0,v=g.length;v>T;T++)y=g[T],_.attributes[y]=N.getAttribLocation(_,y);_.id=j++,G.push({program:_,code:d,usedTimes:1}),W.info.memory.programs=G.length,g=_}if(e.program=g,g=e.program.attributes,g.position>=0&&N.enableVertexAttribArray(g.position),g.color>=0&&N.enableVertexAttribArray(g.color),g.normal>=0&&N.enableVertexAttribArray(g.normal),g.tangent>=0&&N.enableVertexAttribArray(g.tangent),e.skinning&&g.skinIndex>=0&&g.skinWeight>=0&&(N.enableVertexAttribArray(g.skinIndex),N.enableVertexAttribArray(g.skinWeight)),e.attributes)for(l in e.attributes)void 0!==g[l]&&g[l]>=0&&N.enableVertexAttribArray(g[l]);if(e.morphTargets)for(e.numSupportedMorphTargets=0,_="morphTarget",l=0;this.maxMorphTargets>l;l++)T=_+l,g[T]>=0&&(N.enableVertexAttribArray(g[T]),e.numSupportedMorphTargets++);if(e.morphNormals)for(e.numSupportedMorphNormals=0,_="morphNormal",l=0;this.maxMorphNormals>l;l++)T=_+l,g[T]>=0&&(N.enableVertexAttribArray(g[T]),e.numSupportedMorphNormals++);e.uniformsList=[];for(h in e.uniforms)e.uniformsList.push([e.uniforms[h],h])},this.setFaceCulling=function(e,t){e?(t&&"ccw"!==t?N.frontFace(N.CW):N.frontFace(N.CCW),"back"===e?N.cullFace(N.BACK):"front"===e?N.cullFace(N.FRONT):N.cullFace(N.FRONT_AND_BACK),N.enable(N.CULL_FACE)):N.disable(N.CULL_FACE)},this.setMaterialFaces=function(e){var t=e.side===$i_90.DoubleSide,e=e.side===$i_90.BackSide;$!==t&&(t?N.disable(N.CULL_FACE):N.enable(N.CULL_FACE),$=t),et!==e&&(e?N.frontFace(N.CW):N.frontFace(N.CCW),et=e)},this.setDepthTest=function(e){ot!==e&&(e?N.enable(N.DEPTH_TEST):N.disable(N.DEPTH_TEST),ot=e)},this.setDepthWrite=function(e){at!==e&&(N.depthMask(e),at=e)},this.setBlending=function(e,t,i,r){e!==tt&&(e===$i_90.NoBlending?N.disable(N.BLEND):e===$i_90.AdditiveBlending?(N.enable(N.BLEND),N.blendEquation(N.FUNC_ADD),N.blendFunc(N.SRC_ALPHA,N.ONE)):e===$i_90.SubtractiveBlending?(N.enable(N.BLEND),N.blendEquation(N.FUNC_ADD),N.blendFunc(N.ZERO,N.ONE_MINUS_SRC_COLOR)):e===$i_90.MultiplyBlending?(N.enable(N.BLEND),N.blendEquation(N.FUNC_ADD),N.blendFunc(N.ZERO,N.SRC_COLOR)):e===$i_90.CustomBlending?N.enable(N.BLEND):(N.enable(N.BLEND),N.blendEquationSeparate(N.FUNC_ADD,N.FUNC_ADD),N.blendFuncSeparate(N.SRC_ALPHA,N.ONE_MINUS_SRC_ALPHA,N.ONE,N.ONE_MINUS_SRC_ALPHA)),tt=e),e===$i_90.CustomBlending?(t!==it&&(N.blendEquation(C(t)),it=t),(i!==rt||r!==nt)&&(N.blendFunc(C(i),C(r)),rt=i,nt=r)):nt=rt=it=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.__webglTexture=N.createTexture(),W.info.memory.textures++),N.activeTexture(N.TEXTURE0+t),N.bindTexture(N.TEXTURE_2D,e.__webglTexture),N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,e.flipY),N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);var i=e.image,r=0===(i.width&i.width-1)&&0===(i.height&i.height-1),n=C(e.format),o=C(e.type);if(H(N.TEXTURE_2D,e,r),e instanceof $i_90.CompressedTexture)for(var o=e.mipmaps,a=0,s=o.length;s>a;a++)i=o[a],N.compressedTexImage2D(N.TEXTURE_2D,a,n,i.width,i.height,0,i.data);else e instanceof $i_90.DataTexture?N.texImage2D(N.TEXTURE_2D,0,n,i.width,i.height,0,n,o,i.data):N.texImage2D(N.TEXTURE_2D,0,n,n,o,e.image);e.generateMipmaps&&r&&N.generateMipmap(N.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else N.activeTexture(N.TEXTURE0+t),N.bindTexture(N.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof $i_90.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.__webglTexture=N.createTexture();var i=0===(e.width&e.width-1)&&0===(e.height&e.height-1),r=C(e.format),n=C(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],N.bindTexture(N.TEXTURE_CUBE_MAP,e.__webglTexture),H(N.TEXTURE_CUBE_MAP,e,i);for(var o=0;6>o;o++){e.__webglFramebuffer[o]=N.createFramebuffer(),e.__webglRenderbuffer[o]=N.createRenderbuffer(),N.texImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r,e.width,e.height,0,r,n,null);var a=e,s=N.TEXTURE_CUBE_MAP_POSITIVE_X+o;N.bindFramebuffer(N.FRAMEBUFFER,e.__webglFramebuffer[o]),N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,s,a.__webglTexture,0),S(e.__webglRenderbuffer[o],e)}i&&N.generateMipmap(N.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=N.createFramebuffer(),e.__webglRenderbuffer=N.createRenderbuffer(),N.bindTexture(N.TEXTURE_2D,e.__webglTexture),H(N.TEXTURE_2D,e,i),N.texImage2D(N.TEXTURE_2D,0,r,e.width,e.height,0,r,n,null),r=N.TEXTURE_2D,N.bindFramebuffer(N.FRAMEBUFFER,e.__webglFramebuffer),N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,r,e.__webglTexture,0),S(e.__webglRenderbuffer,e),i&&N.generateMipmap(N.TEXTURE_2D);t?N.bindTexture(N.TEXTURE_CUBE_MAP,null):N.bindTexture(N.TEXTURE_2D,null),N.bindRenderbuffer(N.RENDERBUFFER,null),N.bindFramebuffer(N.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,e=e.height,n=r=0):(t=null,i=ft,e=pt,r=ut,n=dt),t!==Y&&(N.bindFramebuffer(N.FRAMEBUFFER,t),N.viewport(r,n,i,e),Y=t),mt=i,Et=e},this.shadowMapPlugin=new $i_90.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new $i_90.SpritePlugin),this.addPostPlugin(new $i_90.LensFlarePlugin)},$i_90.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:$i_90.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:$i_90.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:$i_90.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:$i_90.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new $i_90.Vector2(0,0),this.repeat=new $i_90.Vector2(1,1),this.format=void 0!==i.format?i.format:$i_90.RGBAFormat,this.type=void 0!==i.type?i.type:$i_90.UnsignedByteType,this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0,this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0,this.generateMipmaps=!0},$i_90.WebGLRenderTarget.prototype.clone=function(){var e=new $i_90.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.anisotropy=this.anisotropy,e.minFilter=this.minFilter,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e},$i_90.WebGLRenderTargetCube=function(e,t,i){$i_90.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},$i_90.WebGLRenderTargetCube.prototype=Object.create($i_90.WebGLRenderTarget.prototype),$i_90.RenderableVertex=function(){this.positionWorld=new $i_90.Vector3,this.positionScreen=new $i_90.Vector4,this.visible=!0},$i_90.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},$i_90.RenderableFace3=function(){this.v1=new $i_90.RenderableVertex,this.v2=new $i_90.RenderableVertex,this.v3=new $i_90.RenderableVertex,this.centroidWorld=new $i_90.Vector3,this.centroidScreen=new $i_90.Vector3,this.normalWorld=new $i_90.Vector3,this.vertexNormalsWorld=[new $i_90.Vector3,new $i_90.Vector3,new $i_90.Vector3],this.vertexNormalsLength=0,this.material=this.color=null,this.uvs=[[]],this.z=null},$i_90.RenderableFace4=function(){this.v1=new $i_90.RenderableVertex,this.v2=new $i_90.RenderableVertex,this.v3=new $i_90.RenderableVertex,this.v4=new $i_90.RenderableVertex,this.centroidWorld=new $i_90.Vector3,this.centroidScreen=new $i_90.Vector3,this.normalWorld=new $i_90.Vector3,this.vertexNormalsWorld=[new $i_90.Vector3,new $i_90.Vector3,new $i_90.Vector3,new $i_90.Vector3],this.vertexNormalsLength=0,this.material=this.color=null,this.uvs=[[]],this.z=null},$i_90.RenderableObject=function(){this.z=this.object=null},$i_90.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=this.object=null,this.scale=new $i_90.Vector2,this.material=null},$i_90.RenderableLine=function(){this.z=null,this.v1=new $i_90.RenderableVertex,this.v2=new $i_90.RenderableVertex,this.material=null},$i_90.ColorUtils={adjustHSV:function(e,t,i,r){var n=$i_90.ColorUtils.__hsv;$i_90.ColorUtils.rgbToHsv(e,n),n.h=$i_90.Math.clamp(n.h+t,0,1),n.s=$i_90.Math.clamp(n.s+i,0,1),n.v=$i_90.Math.clamp(n.v+r,0,1),e.setHSV(n.h,n.s,n.v)},rgbToHsv:function(e,t){var i=e.r,r=e.g,n=e.b,o=Math.max(Math.max(i,r),n),a=Math.min(Math.min(i,r),n);if(a===o)a=i=0;else{var s=o-a,a=s/o,i=(i===o?(r-n)/s:r===o?2+(n-i)/s:4+(i-r)/s)/6;0>i&&(i+=1),i>1&&(i-=1)}return void 0===t&&(t={h:0,s:0,v:0}),t.h=i,t.s=a,t.v=o,t}},$i_90.ColorUtils.__hsv={h:0,s:0,v:0},$i_90.GeometryUtils={merge:function(e,t){for(var i,r,n=e.vertices.length,o=t instanceof $i_90.Mesh?t.geometry:t,a=e.vertices,s=o.vertices,h=e.faces,l=o.faces,c=e.faceVertexUvs[0],u=o.faceVertexUvs[0],d={},f=0;e.materials.length>f;f++)d[e.materials[f].id]=f;t instanceof $i_90.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,r=new $i_90.Matrix4,r.extractRotation(i,t.scale));for(var f=0,p=s.length;p>f;f++){var m=s[f].clone();i&&i.multiplyVector3(m),a.push(m)}for(f=0,p=l.length;p>f;f++){var E,g,a=l[f],v=a.vertexNormals,y=a.vertexColors;for(a instanceof $i_90.Face3?E=new $i_90.Face3(a.a+n,a.b+n,a.c+n):a instanceof $i_90.Face4&&(E=new $i_90.Face4(a.a+n,a.b+n,a.c+n,a.d+n)),E.normal.copy(a.normal),r&&r.multiplyVector3(E.normal),s=0,m=v.length;m>s;s++)g=v[s].clone(),r&&r.multiplyVector3(g),E.vertexNormals.push(g);for(E.color.copy(a.color),s=0,m=y.length;m>s;s++)g=y[s],E.vertexColors.push(g.clone());void 0!==a.materialIndex&&(s=o.materials[a.materialIndex],m=s.id,y=d[m],void 0===y&&(y=e.materials.length,d[m]=y,e.materials.push(s)),E.materialIndex=y),E.centroid.copy(a.centroid),i&&i.multiplyVector3(E.centroid),h.push(E)}for(f=0,p=u.length;p>f;f++){for(i=u[f],r=[],s=0,m=i.length;m>s;s++)r.push(new $i_90.UV(i[s].u,i[s].v));c.push(r)}},clone:function(e){var t,i=new $i_90.Geometry,r=e.vertices,n=e.faces,o=e.faceVertexUvs[0];for(e.materials&&(i.materials=e.materials.slice()),e=0,t=r.length;t>e;e++)i.vertices.push(r[e].clone());for(e=0,t=n.length;t>e;e++)i.faces.push(n[e].clone());for(e=0,t=o.length;t>e;e++){for(var r=o[e],n=[],a=0,s=r.length;s>a;a++)n.push(new $i_90.UV(r[a].u,r[a].v));i.faceVertexUvs[0].push(n)}return i},randomPointInTriangle:function(e,t,i){var r,n,o,a=new $i_90.Vector3,s=$i_90.GeometryUtils.__v1;return r=$i_90.GeometryUtils.random(),n=$i_90.GeometryUtils.random(),r+n>1&&(r=1-r,n=1-n),o=1-r-n,a.copy(e),a.multiplyScalar(r),s.copy(t),s.multiplyScalar(n),a.addSelf(s),s.copy(i),s.multiplyScalar(o),a.addSelf(s),a},randomPointInFace:function(e,t,i){var r,n,o;if(e instanceof $i_90.Face3)return r=t.vertices[e.a],n=t.vertices[e.b],o=t.vertices[e.c],$i_90.GeometryUtils.randomPointInTriangle(r,n,o);if(e instanceof $i_90.Face4){r=t.vertices[e.a],n=t.vertices[e.b],o=t.vertices[e.c];var a,t=t.vertices[e.d];return i?e._area1&&e._area2?(i=e._area1,a=e._area2):(i=$i_90.GeometryUtils.triangleArea(r,n,t),a=$i_90.GeometryUtils.triangleArea(n,o,t),e._area1=i,e._area2=a):(i=$i_90.GeometryUtils.triangleArea(r,n,t),a=$i_90.GeometryUtils.triangleArea(n,o,t)),i>$i_90.GeometryUtils.random()*(i+a)?$i_90.GeometryUtils.randomPointInTriangle(r,n,t):$i_90.GeometryUtils.randomPointInTriangle(n,o,t)}},randomPointsInGeometry:function(e,t){function i(e){function t(i,r){if(i>r)return i;var n=i+Math.floor((r-i)/2);return f[n]>e?t(i,n-1):e>f[n]?t(n+1,r):n}return t(0,f.length-1)}var r,n,o,a,s,h,l=e.faces,c=e.vertices,u=l.length,d=0,f=[];for(n=0;u>n;n++)r=l[n],r instanceof $i_90.Face3?(o=c[r.a],a=c[r.b],s=c[r.c],r._area=$i_90.GeometryUtils.triangleArea(o,a,s)):r instanceof $i_90.Face4&&(o=c[r.a],a=c[r.b],s=c[r.c],h=c[r.d],r._area1=$i_90.GeometryUtils.triangleArea(o,a,h),r._area2=$i_90.GeometryUtils.triangleArea(a,s,h),r._area=r._area1+r._area2),d+=r._area,f[n]=d;for(r=[],n=0;t>n;n++)c=$i_90.GeometryUtils.random()*d,c=i(c),r[n]=$i_90.GeometryUtils.randomPointInFace(l[c],e,!0);return r},triangleArea:function(e,t,i){var r,n=$i_90.GeometryUtils.__v1;return n.sub(e,t),r=n.length(),n.sub(e,i),e=n.length(),n.sub(t,i),i=n.length(),t=.5*(r+e+i),Math.sqrt(t*(t-r)*(t-e)*(t-i))},center:function(e){e.computeBoundingBox();var t=e.boundingBox,i=new $i_90.Vector3;return i.add(t.min,t.max),i.multiplyScalar(-.5),e.applyMatrix((new $i_90.Matrix4).makeTranslation(i.x,i.y,i.z)),e.computeBoundingBox(),i},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,i=e.length;i>t;t++)for(var r=e[t],n=0,o=r.length;o>n;n++)1!==r[n].u&&(r[n].u-=Math.floor(r[n].u)),1!==r[n].v&&(r[n].v-=Math.floor(r[n].v))},triangulateQuads:function(e){var t,i,r,n,o=[],a=[],s=[];for(t=0,i=e.faceUvs.length;i>t;t++)a[t]=[];for(t=0,i=e.faceVertexUvs.length;i>t;t++)s[t]=[];for(t=0,i=e.faces.length;i>t;t++)if(r=e.faces[t],r instanceof $i_90.Face4){n=r.a;var h=r.b,l=r.c,c=r.d,u=new $i_90.Face3,d=new $i_90.Face3;for(u.color.copy(r.color),d.color.copy(r.color),u.materialIndex=r.materialIndex,d.materialIndex=r.materialIndex,u.a=n,u.b=h,u.c=c,d.a=h,d.b=l,d.c=c,4===r.vertexColors.length&&(u.vertexColors[0]=r.vertexColors[0].clone(),u.vertexColors[1]=r.vertexColors[1].clone(),u.vertexColors[2]=r.vertexColors[3].clone(),d.vertexColors[0]=r.vertexColors[1].clone(),d.vertexColors[1]=r.vertexColors[2].clone(),d.vertexColors[2]=r.vertexColors[3].clone()),o.push(u,d),r=0,n=e.faceVertexUvs.length;n>r;r++)e.faceVertexUvs[r].length&&(u=e.faceVertexUvs[r][t],h=u[1],l=u[2],c=u[3],u=[u[0].clone(),h.clone(),c.clone()],h=[h.clone(),l.clone(),c.clone()],s[r].push(u,h));for(r=0,n=e.faceUvs.length;n>r;r++)e.faceUvs[r].length&&(h=e.faceUvs[r][t],a[r].push(h,h))}else{for(o.push(r),r=0,n=e.faceUvs.length;n>r;r++)a[r].push(e.faceUvs[r][t]);for(r=0,n=e.faceVertexUvs.length;n>r;r++)s[r].push(e.faceVertexUvs[r][t])}e.faces=o,e.faceUvs=a,e.faceVertexUvs=s,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},explode:function(e){for(var t=[],i=0,r=e.faces.length;r>i;i++){var n=t.length,o=e.faces[i];if(o instanceof $i_90.Face4){var a=o.a,s=o.b,h=o.c,a=e.vertices[a],s=e.vertices[s],h=e.vertices[h],l=e.vertices[o.d];t.push(a.clone()),t.push(s.clone()),t.push(h.clone()),t.push(l.clone()),o.a=n,o.b=n+1,o.c=n+2,o.d=n+3}else a=o.a,s=o.b,h=o.c,a=e.vertices[a],s=e.vertices[s],h=e.vertices[h],t.push(a.clone()),t.push(s.clone()),t.push(h.clone()),o.a=n,o.b=n+1,o.c=n+2}e.vertices=t,delete e.__tmpVertices},tessellate:function(e,t){var i,r,n,o,a,s,h,l,c,u,d,f,p,m,E,g,v,y,_,T=[],x=[];for(i=0,r=e.faceVertexUvs.length;r>i;i++)x[i]=[];for(i=0,r=e.faces.length;r>i;i++)if(n=e.faces[i],n instanceof $i_90.Face3)if(o=n.a,a=n.b,s=n.c,l=e.vertices[o],c=e.vertices[a],u=e.vertices[s],f=l.distanceTo(c),p=c.distanceTo(u),d=l.distanceTo(u),f>t||p>t||d>t)for(h=e.vertices.length,y=n.clone(),_=n.clone(),p>f||d>f?f>p||d>p?(l=l.clone(),l.lerpSelf(u,.5),y.a=o,y.b=a,y.c=h,_.a=h,_.b=a,_.c=s,3===n.vertexNormals.length&&(o=n.vertexNormals[0].clone(),o.lerpSelf(n.vertexNormals[2],.5),y.vertexNormals[2].copy(o),_.vertexNormals[0].copy(o)),3===n.vertexColors.length&&(o=n.vertexColors[0].clone(),o.lerpSelf(n.vertexColors[2],.5),y.vertexColors[2].copy(o),_.vertexColors[0].copy(o)),n=2):(l=c.clone(),l.lerpSelf(u,.5),y.a=o,y.b=a,y.c=h,_.a=h,_.b=s,_.c=o,3===n.vertexNormals.length&&(o=n.vertexNormals[1].clone(),o.lerpSelf(n.vertexNormals[2],.5),y.vertexNormals[2].copy(o),_.vertexNormals[0].copy(o),_.vertexNormals[1].copy(n.vertexNormals[2]),_.vertexNormals[2].copy(n.vertexNormals[0])),3===n.vertexColors.length&&(o=n.vertexColors[1].clone(),o.lerpSelf(n.vertexColors[2],.5),y.vertexColors[2].copy(o),_.vertexColors[0].copy(o),_.vertexColors[1].copy(n.vertexColors[2]),_.vertexColors[2].copy(n.vertexColors[0])),n=1):(l=l.clone(),l.lerpSelf(c,.5),y.a=o,y.b=h,y.c=s,_.a=h,_.b=a,_.c=s,3===n.vertexNormals.length&&(o=n.vertexNormals[0].clone(),o.lerpSelf(n.vertexNormals[1],.5),y.vertexNormals[1].copy(o),_.vertexNormals[0].copy(o)),3===n.vertexColors.length&&(o=n.vertexColors[0].clone(),o.lerpSelf(n.vertexColors[1],.5),y.vertexColors[1].copy(o),_.vertexColors[0].copy(o)),n=0),T.push(y,_),e.vertices.push(l),o=0,a=e.faceVertexUvs.length;a>o;o++)e.faceVertexUvs[o].length&&(l=e.faceVertexUvs[o][i],_=l[0],s=l[1],y=l[2],0===n?(c=_.clone(),c.lerpSelf(s,.5),l=[_.clone(),c.clone(),y.clone()],s=[c.clone(),s.clone(),y.clone()]):1===n?(c=s.clone(),c.lerpSelf(y,.5),l=[_.clone(),s.clone(),c.clone()],s=[c.clone(),y.clone(),_.clone()]):(c=_.clone(),c.lerpSelf(y,.5),l=[_.clone(),s.clone(),c.clone()],s=[c.clone(),s.clone(),y.clone()]),x[o].push(l,s));else for(T.push(n),o=0,a=e.faceVertexUvs.length;a>o;o++)x[o].push(e.faceVertexUvs[o][i]);else if(o=n.a,a=n.b,s=n.c,h=n.d,l=e.vertices[o],c=e.vertices[a],u=e.vertices[s],d=e.vertices[h],f=l.distanceTo(c),p=c.distanceTo(u),m=u.distanceTo(d),E=l.distanceTo(d),f>t||p>t||m>t||E>t)for(g=e.vertices.length,v=e.vertices.length+1,y=n.clone(),_=n.clone(),(p>f||m>f||E>f)&&(p>m||f>m||E>m)?(f=c.clone(),f.lerpSelf(u,.5),c=d.clone(),c.lerpSelf(l,.5),y.a=o,y.b=a,y.c=g,y.d=v,_.a=v,_.b=g,_.c=s,_.d=h,4===n.vertexNormals.length&&(o=n.vertexNormals[1].clone(),o.lerpSelf(n.vertexNormals[2],.5),a=n.vertexNormals[3].clone(),a.lerpSelf(n.vertexNormals[0],.5),y.vertexNormals[2].copy(o),y.vertexNormals[3].copy(a),_.vertexNormals[0].copy(a),_.vertexNormals[1].copy(o)),4===n.vertexColors.length&&(o=n.vertexColors[1].clone(),o.lerpSelf(n.vertexColors[2],.5),a=n.vertexColors[3].clone(),a.lerpSelf(n.vertexColors[0],.5),y.vertexColors[2].copy(o),y.vertexColors[3].copy(a),_.vertexColors[0].copy(a),_.vertexColors[1].copy(o)),n=1):(f=l.clone(),f.lerpSelf(c,.5),c=u.clone(),c.lerpSelf(d,.5),y.a=o,y.b=g,y.c=v,y.d=h,_.a=g,_.b=a,_.c=s,_.d=v,4===n.vertexNormals.length&&(o=n.vertexNormals[0].clone(),o.lerpSelf(n.vertexNormals[1],.5),a=n.vertexNormals[2].clone(),a.lerpSelf(n.vertexNormals[3],.5),y.vertexNormals[1].copy(o),y.vertexNormals[2].copy(a),_.vertexNormals[0].copy(o),_.vertexNormals[3].copy(a)),4===n.vertexColors.length&&(o=n.vertexColors[0].clone(),o.lerpSelf(n.vertexColors[1],.5),a=n.vertexColors[2].clone(),a.lerpSelf(n.vertexColors[3],.5),y.vertexColors[1].copy(o),y.vertexColors[2].copy(a),_.vertexColors[0].copy(o),_.vertexColors[3].copy(a)),n=0),T.push(y,_),e.vertices.push(f,c),o=0,a=e.faceVertexUvs.length;a>o;o++)e.faceVertexUvs[o].length&&(l=e.faceVertexUvs[o][i],_=l[0],s=l[1],y=l[2],l=l[3],0===n?(c=_.clone(),c.lerpSelf(s,.5),u=y.clone(),u.lerpSelf(l,.5),_=[_.clone(),c.clone(),u.clone(),l.clone()],s=[c.clone(),s.clone(),y.clone(),u.clone()]):(c=s.clone(),c.lerpSelf(y,.5),u=l.clone(),u.lerpSelf(_,.5),_=[_.clone(),s.clone(),c.clone(),u.clone()],s=[u.clone(),c.clone(),y.clone(),l.clone()]),x[o].push(_,s));
else for(T.push(n),o=0,a=e.faceVertexUvs.length;a>o;o++)x[o].push(e.faceVertexUvs[o][i]);e.faces=T,e.faceVertexUvs=x}},$i_90.GeometryUtils.random=$i_90.Math.random16,$i_90.GeometryUtils.__v1=new $i_90.Vector3,$i_90.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i,r){var n=new Image,o=new $i_90.Texture(n,t),t=new $i_90.ImageLoader;return t.addEventListener("load",function(e){o.image=e.content,o.needsUpdate=!0,i&&i(o)}),t.addEventListener("error",function(e){r&&r(e.message)}),t.crossOrigin=this.crossOrigin,t.load(e,n),o},loadCompressedTexture:function(e,t,i,r){var n=new $i_90.CompressedTexture;n.mapping=t;var o=new XMLHttpRequest;return o.onload=function(){var e=$i_90.ImageUtils.parseDDS(o.response,!0);n.format=e.format,n.mipmaps=e.mipmaps,n.image.width=e.width,n.image.height=e.height,n.generateMipmaps=!1,n.needsUpdate=!0,i&&i(n)},o.onerror=r,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null),n},loadTextureCube:function(e,t,i,r){var n=[];n.loadCount=0;var o=new $i_90.Texture;o.image=n,void 0!==t&&(o.mapping=t),o.flipY=!1;for(var t=0,a=e.length;a>t;++t){var s=new Image;n[t]=s,s.onload=function(){n.loadCount=n.loadCount+1,n.loadCount===6&&(o.needsUpdate=!0,i&&i())},s.onerror=r,s.crossOrigin=this.crossOrigin,s.src=e[t]}return o},loadCompressedTextureCube:function(e,t,i,r){var n=[];n.loadCount=0;var o=new $i_90.CompressedTexture;o.image=n,void 0!==t&&(o.mapping=t),o.flipY=!1,o.generateMipmaps=!1;for(var t=function(e,t){return function(){var r=$i_90.ImageUtils.parseDDS(e.response,!0);t.format=r.format,t.mipmaps=r.mipmaps,t.width=r.width,t.height=r.height,n.loadCount=n.loadCount+1,n.loadCount===6&&(o.format=r.format,o.needsUpdate=!0,i&&i())}},a=0,s=e.length;s>a;++a){var h={};n[a]=h;var l=new XMLHttpRequest;l.onload=t(l,h),l.onerror=r,l.open("GET",e[a],!0),l.responseType="arraybuffer",l.send(null)}return o},parseDDS:function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},n=i("DXT1"),o=i("DXT3"),a=i("DXT5"),s=new Int32Array(e,0,31);if(542327876!==s[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),r;if(!s[20]&4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),r;var h=s[21];switch(h){case n:n=8,r.format=$i_90.RGB_S3TC_DXT1_Format;break;case o:n=16,r.format=$i_90.RGBA_S3TC_DXT3_Format;break;case a:n=16,r.format=$i_90.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(h&255,h>>8&255,h>>16&255,h>>24&255)),r}for(r.mipmapCount=1,s[2]&131072&&!1!==t&&(r.mipmapCount=Math.max(1,s[7])),r.width=s[4],r.height=s[3],s=s[1]+4,o=r.width,a=r.height,h=0;r.mipmapCount>h;h++){var l=Math.max(4,o)/4*Math.max(4,a)/4*n,c={data:new Uint8Array(e,s,l),width:o,height:a};r.mipmaps.push(c),s+=l,o=Math.max(.5*o,1),a=Math.max(.5*a,1)}return r},getNormalMap:function(e,t){var i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=t|1,r=e.width,n=e.height,o=document.createElement("canvas");o.width=r,o.height=n;var a=o.getContext("2d");a.drawImage(e,0,0);for(var s=a.getImageData(0,0,r,n).data,h=a.createImageData(r,n),l=h.data,c=0;r>c;c++)for(var u=0;n>u;u++){var d=0>u-1?0:u-1,f=u+1>n-1?n-1:u+1,p=0>c-1?0:c-1,m=c+1>r-1?r-1:c+1,E=[],g=[0,0,s[4*(u*r+c)]/255*t];for(E.push([-1,0,s[4*(u*r+p)]/255*t]),E.push([-1,-1,s[4*(d*r+p)]/255*t]),E.push([0,-1,s[4*(d*r+c)]/255*t]),E.push([1,-1,s[4*(d*r+m)]/255*t]),E.push([1,0,s[4*(u*r+m)]/255*t]),E.push([1,1,s[4*(f*r+m)]/255*t]),E.push([0,1,s[4*(f*r+c)]/255*t]),E.push([-1,1,s[4*(f*r+p)]/255*t]),d=[],p=E.length,f=0;p>f;f++){var m=E[f],v=E[(f+1)%p],m=[m[0]-g[0],m[1]-g[1],m[2]-g[2]],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]];d.push(i([m[1]*v[2]-m[2]*v[1],m[2]*v[0]-m[0]*v[2],m[0]*v[1]-m[1]*v[0]]))}for(E=[0,0,0],f=0;d.length>f;f++)E[0]+=d[f][0],E[1]+=d[f][1],E[2]+=d[f][2];E[0]/=d.length,E[1]/=d.length,E[2]/=d.length,g=4*(u*r+c),l[g]=255*((E[0]+1)/2)|0,l[g+1]=255*((E[1]+1)/2)|0,l[g+2]=255*E[2]|0,l[g+3]=255}return a.putImageData(h,0,0),o},generateDataTexture:function(e,t,i){for(var r=e*t,n=new Uint8Array(3*r),o=Math.floor(255*i.r),a=Math.floor(255*i.g),i=Math.floor(255*i.b),s=0;r>s;s++)n[3*s]=o,n[3*s+1]=a,n[3*s+2]=i;return e=new $i_90.DataTexture(n,e,t,$i_90.RGBFormat),e.needsUpdate=!0,e}},$i_90.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new $i_90.Object3D,r=0,n=t.length;n>r;r++)i.add(new $i_90.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var r=new $i_90.Matrix4;r.getInverse(i.matrixWorld),e.applyMatrix(r),t.remove(e),i.add(e)}},$i_90.WebGLRenderer&&($i_90.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = modelMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:$i_90.UniformsUtils.merge([$i_90.UniformsLib.fog,$i_90.UniformsLib.lights,$i_90.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new $i_90.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new $i_90.Color(16777215)},uSpecularColor:{type:"c",value:new $i_90.Color(1118481)},uAmbientColor:{type:"c",value:new $i_90.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new $i_90.Vector2(0,0)},uRepeat:{type:"v2",value:new $i_90.Vector2(1,1)},wrapRGB:{type:"v3",value:new $i_90.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float uRefractionRatio;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",$i_90.ShaderChunk.shadowmap_pars_fragment,$i_90.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );\nvec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += uDiffuseColor * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );\nvec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, uRefractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",$i_90.ShaderChunk.shadowmap_fragment,$i_90.ShaderChunk.linear_to_gamma_fragment,$i_90.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",$i_90.ShaderChunk.skinning_pars_vertex,$i_90.ShaderChunk.shadowmap_pars_vertex,"void main() {",$i_90.ShaderChunk.skinbase_vertex,$i_90.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalMatrix * skinnedNormal.xyz;\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalMatrix * skinnedTangent.xyz;\n#else\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\n#endif\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 mPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = mPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = modelMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}),$i_90.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),i=this.size/t.resolution,r=0,n=(e+"").split(""),o=n.length,a=[],e=0;o>e;e++){var s=new $i_90.Path,s=this.extractGlyphPoints(n[e],t,i,r,s),r=r+s.offset;a.push(s.path)}return{paths:a,offset:r/2}},extractGlyphPoints:function(e,t,i,r,n){var o,a,s,h,l,c,u,d,f,p,m,E=[],g=t.glyphs[e]||t.glyphs["?"];if(g){if(g.o)for(t=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),h=t.length,e=0;h>e;)switch(s=t[e++]){case"m":s=t[e++]*i+r,l=t[e++]*i,n.moveTo(s,l);break;case"l":s=t[e++]*i+r,l=t[e++]*i,n.lineTo(s,l);break;case"q":if(s=t[e++]*i+r,l=t[e++]*i,d=t[e++]*i+r,f=t[e++]*i,n.quadraticCurveTo(d,f,s,l),o=E[E.length-1])for(c=o.x,u=o.y,o=1,a=this.divisions;a>=o;o++){var v=o/a;$i_90.Shape.Utils.b2(v,c,d,s),$i_90.Shape.Utils.b2(v,u,f,l)}break;case"b":if(s=t[e++]*i+r,l=t[e++]*i,d=t[e++]*i+r,f=t[e++]*-i,p=t[e++]*i+r,m=t[e++]*-i,n.bezierCurveTo(s,l,d,f,p,m),o=E[E.length-1])for(c=o.x,u=o.y,o=1,a=this.divisions;a>=o;o++)v=o/a,$i_90.Shape.Utils.b3(v,c,d,p,s),$i_90.Shape.Utils.b3(v,u,f,m,l)}return{offset:g.ha*i,path:n}}}},$i_90.FontUtils.generateShapes=function(e,t){var t=t||{},i=t.curveSegments!==void 0?t.curveSegments:4,r=t.font!==void 0?t.font:"helvetiker",n=t.weight!==void 0?t.weight:"normal",o=t.style!==void 0?t.style:"normal";for($i_90.FontUtils.size=t.size!==void 0?t.size:100,$i_90.FontUtils.divisions=i,$i_90.FontUtils.face=r,$i_90.FontUtils.weight=n,$i_90.FontUtils.style=o,i=$i_90.FontUtils.drawText(e).paths,r=[],n=0,o=i.length;o>n;n++)Array.prototype.push.apply(r,i[n].toShapes());return r},function(e){var t=function(e){for(var t=e.length,i=0,r=t-1,n=0;t>n;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5};return e.Triangulate=function(e,i){var r=e.length;if(3>r)return null;var n,o,a,s=[],h=[],l=[];if(t(e)>0)for(o=0;r>o;o++)h[o]=o;else for(o=0;r>o;o++)h[o]=r-1-o;var c=2*r;for(o=r-1;r>2;){if(0>=c--){console.log("Warning, unable to triangulate polygon!");break}n=o,n>=r&&(n=0),o=n+1,o>=r&&(o=0),a=o+1,a>=r&&(a=0);var u;e:{u=e;var d=n,f=o,p=a,m=r,E=h,g=void 0,v=void 0,y=void 0,_=void 0,T=void 0,x=void 0,R=void 0,b=void 0,w=void 0,v=u[E[d]].x,y=u[E[d]].y,_=u[E[f]].x,T=u[E[f]].y,x=u[E[p]].x,R=u[E[p]].y;if(1e-10>(_-v)*(R-y)-(T-y)*(x-v))u=!1;else{for(g=0;m>g;g++)if(g!=d&&g!=f&&g!=p){var b=u[E[g]].x,w=u[E[g]].y,H=void 0,S=void 0,M=void 0,C=void 0,A=void 0,P=void 0,L=void 0,I=void 0,U=void 0,D=void 0,F=void 0,z=void 0,H=M=A=void 0,H=x-_,S=R-T,M=v-x,C=y-R,A=_-v,P=T-y,L=b-v,I=w-y,U=b-_,D=w-T,F=b-x,z=w-R,H=H*D-S*U,A=A*I-P*L,M=M*z-C*F;if(H>=0&&M>=0&&A>=0){u=!1;break e}}u=!0}}if(u){for(s.push([e[h[n]],e[h[o]],e[h[a]]]),l.push([h[n],h[o],h[a]]),n=o,a=o+1;r>a;n++,a++)h[n]=h[a];r--,c=2*r}}return i?l:s},e.Triangulate.area=t,e}($i_90.FontUtils),self._typeface_js={faces:$i_90.FontUtils.faces,loadFace:$i_90.FontUtils.loadFace},$i_90.Curve=function(){},$i_90.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},$i_90.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},$i_90.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPoint(t/e));return i},$i_90.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPointAt(t/e));return i},$i_90.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},$i_90.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),o=0;for(r.push(0),i=1;e>=i;i++)t=this.getPoint(i/e),o+=t.distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r},$i_90.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},$i_90.Curve.prototype.getUtoTmapping=function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t?t:e*r[o-1];for(var a,s=0,h=o-1;h>=s;)if(n=Math.floor(s+(h-s)/2),a=r[n]-i,0>a)s=n+1;else{if(0>=a){h=n;break}h=n-1}return n=h,r[n]==i?n/(o-1):(s=r[n],r=(n+(i-s)/(r[n+1]-s))/(o-1))},$i_90.Curve.prototype.getNormalVector=function(e){return e=this.getTangent(e),new $i_90.Vector2(-e.y,e.x)},$i_90.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return 0>t&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().subSelf(t).normalize()},$i_90.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},$i_90.LineCurve=function(e,t){this.v1=e,this.v2=t},$i_90.LineCurve.prototype=Object.create($i_90.Curve.prototype),$i_90.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().subSelf(this.v1);return t.multiplyScalar(e).addSelf(this.v1),t},$i_90.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},$i_90.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()},$i_90.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},$i_90.QuadraticBezierCurve.prototype=Object.create($i_90.Curve.prototype),$i_90.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=$i_90.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=$i_90.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new $i_90.Vector2(t,e)},$i_90.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=$i_90.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=$i_90.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new $i_90.Vector2(t,e),t.normalize(),t},$i_90.CubicBezierCurve=function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},$i_90.CubicBezierCurve.prototype=Object.create($i_90.Curve.prototype),$i_90.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=$i_90.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=$i_90.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new $i_90.Vector2(t,e)},$i_90.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=$i_90.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=$i_90.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new $i_90.Vector2(t,e),t.normalize(),t},$i_90.SplineCurve=function(e){this.points=e==void 0?[]:e},$i_90.SplineCurve.prototype=Object.create($i_90.Curve.prototype),$i_90.SplineCurve.prototype.getPoint=function(e){var t,i=new $i_90.Vector2,r=[],n=this.points;return t=(n.length-1)*e,e=Math.floor(t),t-=e,r[0]=e==0?e:e-1,r[1]=e,r[2]=e>n.length-2?n.length-1:e+1,r[3]=e>n.length-3?n.length-1:e+2,i.x=$i_90.Curve.Utils.interpolate(n[r[0]].x,n[r[1]].x,n[r[2]].x,n[r[3]].x,t),i.y=$i_90.Curve.Utils.interpolate(n[r[0]].y,n[r[1]].y,n[r[2]].y,n[r[3]].y,t),i},$i_90.EllipseCurve=function(e,t,i,r,n,o,a){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a},$i_90.EllipseCurve.prototype=Object.create($i_90.Curve.prototype),$i_90.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;return this.aClockwise||(e=1-e),t=this.aStartAngle+e*t,e=this.aX+this.xRadius*Math.cos(t),t=this.aY+this.yRadius*Math.sin(t),new $i_90.Vector2(e,t)},$i_90.ArcCurve=function(e,t,i,r,n,o){$i_90.EllipseCurve.call(this,e,t,i,i,r,n,o)},$i_90.ArcCurve.prototype=Object.create($i_90.EllipseCurve.prototype),$i_90.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,r,n){var e=(i-e)*.5,r=(r-t)*.5,o=n*n;return(2*t-2*i+e+r)*n*o+(-3*t+3*i-2*e-r)*o+e*n+t}},$i_90.Curve.create=function(e,t){return e.prototype=Object.create($i_90.Curve.prototype),e.prototype.getPoint=t,e},$i_90.LineCurve3=$i_90.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new $i_90.Vector3;return t.sub(this.v2,this.v1),t.multiplyScalar(e),t.addSelf(this.v1),t}),$i_90.QuadraticBezierCurve3=$i_90.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i;return t=$i_90.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=$i_90.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=$i_90.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new $i_90.Vector3(t,i,e)}),$i_90.CubicBezierCurve3=$i_90.Curve.create(function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},function(e){var t,i;return t=$i_90.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=$i_90.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=$i_90.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new $i_90.Vector3(t,i,e)}),$i_90.SplineCurve3=$i_90.Curve.create(function(e){this.points=e==void 0?[]:e},function(e){var t,i=new $i_90.Vector3,r=[],n=this.points,e=(n.length-1)*e;t=Math.floor(e),e-=t,r[0]=t==0?t:t-1,r[1]=t,r[2]=t>n.length-2?n.length-1:t+1,r[3]=t>n.length-3?n.length-1:t+2,t=n[r[0]];var o=n[r[1]],a=n[r[2]],r=n[r[3]];return i.x=$i_90.Curve.Utils.interpolate(t.x,o.x,a.x,r.x,e),i.y=$i_90.Curve.Utils.interpolate(t.y,o.y,a.y,r.y,e),i.z=$i_90.Curve.Utils.interpolate(t.z,o.z,a.z,r.z,e),i}),$i_90.ClosedSplineCurve3=$i_90.Curve.create(function(e){this.points=e==void 0?[]:e},function(e){var t,i=new $i_90.Vector3,r=[],n=this.points;return t=(n.length-0)*e,e=Math.floor(t),t-=e,e+=e>0?0:(Math.floor(Math.abs(e)/n.length)+1)*n.length,r[0]=(e-1)%n.length,r[1]=e%n.length,r[2]=(e+1)%n.length,r[3]=(e+2)%n.length,i.x=$i_90.Curve.Utils.interpolate(n[r[0]].x,n[r[1]].x,n[r[2]].x,n[r[3]].x,t),i.y=$i_90.Curve.Utils.interpolate(n[r[0]].y,n[r[1]].y,n[r[2]].y,n[r[3]].y,t),i.z=$i_90.Curve.Utils.interpolate(n[r[0]].z,n[r[1]].z,n[r[2]].z,n[r[3]].z,t),i}),$i_90.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},$i_90.CurvePath.prototype=Object.create($i_90.Curve.prototype),$i_90.CurvePath.prototype.add=function(e){this.curves.push(e)},$i_90.CurvePath.prototype.checkConnection=function(){},$i_90.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new $i_90.LineCurve(t,e))},$i_90.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),e=0;i.length>e;){if(i[e]>=t)return t=i[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},$i_90.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},$i_90.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;
var e,t=[],i=0,r=this.curves.length;for(e=0;r>e;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t},$i_90.CurvePath.prototype.getBoundingBox=function(){var e,t,i,r,n,o,a=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=n=Number.POSITIVE_INFINITY;var s,h,l,c,u=a[0]instanceof $i_90.Vector3;for(c=u?new $i_90.Vector3:new $i_90.Vector2,h=0,l=a.length;l>h;h++)s=a[h],s.x>e?e=s.x:r>s.x&&(r=s.x),s.y>t?t=s.y:n>s.y&&(n=s.y),u&&(s.z>i?i=s.z:o>s.z&&(o=s.z)),c.addSelf(s);return a={minX:r,minY:n,maxX:e,maxY:t,centroid:c.divideScalar(l)},u&&(a.maxZ=i,a.minZ=o),a},$i_90.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},$i_90.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},$i_90.CurvePath.prototype.createGeometry=function(e){for(var t=new $i_90.Geometry,i=0;e.length>i;i++)t.vertices.push(new $i_90.Vector3(e[i].x,e[i].y,e[i].z||0));return t},$i_90.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},$i_90.CurvePath.prototype.getTransformedPoints=function(e,t){var i,r,n=this.getPoints(e);for(t||(t=this.bends),i=0,r=t.length;r>i;i++)n=this.getWrapPoints(n,t[i]);return n},$i_90.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,r,n=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,r=t.length;r>i;i++)n=this.getWrapPoints(n,t[i]);return n},$i_90.CurvePath.prototype.getWrapPoints=function(e,t){var i,r,n,o,a,s,h=this.getBoundingBox();for(i=0,r=e.length;r>i;i++)n=e[i],o=n.x,a=n.y,s=o/h.maxX,s=t.getUtoTmapping(s,o),o=t.getPoint(s),a=t.getNormalVector(s).multiplyScalar(a),n.x=o.x+a.x,n.y=o.y+a.y;return e},$i_90.Gyroscope=function(){$i_90.Object3D.call(this)},$i_90.Gyroscope.prototype=Object.create($i_90.Object3D.prototype),$i_90.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},$i_90.Gyroscope.prototype.translationWorld=new $i_90.Vector3,$i_90.Gyroscope.prototype.translationObject=new $i_90.Vector3,$i_90.Gyroscope.prototype.rotationWorld=new $i_90.Quaternion,$i_90.Gyroscope.prototype.rotationObject=new $i_90.Quaternion,$i_90.Gyroscope.prototype.scaleWorld=new $i_90.Vector3,$i_90.Gyroscope.prototype.scaleObject=new $i_90.Vector3,$i_90.Path=function(e){$i_90.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},$i_90.Path.prototype=Object.create($i_90.CurvePath.prototype),$i_90.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},$i_90.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;i>t;t++)this.lineTo(e[t].x,e[t].y)},$i_90.Path.prototype.moveTo=function(){var e=Array.prototype.slice.call(arguments);this.actions.push({action:$i_90.PathActions.MOVE_TO,args:e})},$i_90.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=new $i_90.LineCurve(new $i_90.Vector2(r[r.length-2],r[r.length-1]),new $i_90.Vector2(e,t));this.curves.push(r),this.actions.push({action:$i_90.PathActions.LINE_TO,args:i})},$i_90.Path.prototype.quadraticCurveTo=function(e,t,i,r){var n=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,o=new $i_90.QuadraticBezierCurve(new $i_90.Vector2(o[o.length-2],o[o.length-1]),new $i_90.Vector2(e,t),new $i_90.Vector2(i,r));this.curves.push(o),this.actions.push({action:$i_90.PathActions.QUADRATIC_CURVE_TO,args:n})},$i_90.Path.prototype.bezierCurveTo=function(e,t,i,r,n,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,s=new $i_90.CubicBezierCurve(new $i_90.Vector2(s[s.length-2],s[s.length-1]),new $i_90.Vector2(e,t),new $i_90.Vector2(i,r),new $i_90.Vector2(n,o));this.curves.push(s),this.actions.push({action:$i_90.PathActions.BEZIER_CURVE_TO,args:a})},$i_90.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=[new $i_90.Vector2(i[i.length-2],i[i.length-1])];Array.prototype.push.apply(i,e),i=new $i_90.SplineCurve(i),this.curves.push(i),this.actions.push({action:$i_90.PathActions.CSPLINE_THRU,args:t})},$i_90.Path.prototype.arc=function(e,t,i,r,n,o){var a=this.actions[this.actions.length-1].args;this.absarc(e+a[a.length-2],t+a[a.length-1],i,r,n,o)},$i_90.Path.prototype.absarc=function(e,t,i,r,n,o){this.absellipse(e,t,i,i,r,n,o)},$i_90.Path.prototype.ellipse=function(e,t,i,r,n,o,a){var s=this.actions[this.actions.length-1].args;this.absellipse(e+s[s.length-2],t+s[s.length-1],i,r,n,o,a)},$i_90.Path.prototype.absellipse=function(e,t,i,r,n,o,a){var s=Array.prototype.slice.call(arguments),h=new $i_90.EllipseCurve(e,t,i,r,n,o,a);this.curves.push(h),h=h.getPoint(a?1:0),s.push(h.x),s.push(h.y),this.actions.push({action:$i_90.PathActions.ELLIPSE,args:s})},$i_90.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],i=0;e>i;i++)t.push(this.getPoint(i/e));return t},$i_90.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);var i,r,n,o,a,s,h,l,c,u,d,f,p,e=e||12,m=[];for(i=0,r=this.actions.length;r>i;i++)switch(n=this.actions[i],o=n.action,n=n.args,o){case $i_90.PathActions.MOVE_TO:m.push(new $i_90.Vector2(n[0],n[1]));break;case $i_90.PathActions.LINE_TO:m.push(new $i_90.Vector2(n[0],n[1]));break;case $i_90.PathActions.QUADRATIC_CURVE_TO:for(a=n[2],s=n[3],c=n[0],u=n[1],m.length>0?(o=m[m.length-1],d=o.x,f=o.y):(o=this.actions[i-1].args,d=o[o.length-2],f=o[o.length-1]),n=1;e>=n;n++)p=n/e,o=$i_90.Shape.Utils.b2(p,d,c,a),p=$i_90.Shape.Utils.b2(p,f,u,s),m.push(new $i_90.Vector2(o,p));break;case $i_90.PathActions.BEZIER_CURVE_TO:for(a=n[4],s=n[5],c=n[0],u=n[1],h=n[2],l=n[3],m.length>0?(o=m[m.length-1],d=o.x,f=o.y):(o=this.actions[i-1].args,d=o[o.length-2],f=o[o.length-1]),n=1;e>=n;n++)p=n/e,o=$i_90.Shape.Utils.b3(p,d,c,h,a),p=$i_90.Shape.Utils.b3(p,f,u,l,s),m.push(new $i_90.Vector2(o,p));break;case $i_90.PathActions.CSPLINE_THRU:for(o=this.actions[i-1].args,p=[new $i_90.Vector2(o[o.length-2],o[o.length-1])],o=e*n[0].length,p=p.concat(n[0]),p=new $i_90.SplineCurve(p),n=1;o>=n;n++)m.push(p.getPointAt(n/o));break;case $i_90.PathActions.ARC:for(a=n[0],s=n[1],u=n[2],h=n[3],o=n[4],c=!!n[5],d=o-h,f=e*2,n=1;f>=n;n++)p=n/f,c||(p=1-p),p=h+p*d,o=a+u*Math.cos(p),p=s+u*Math.sin(p),m.push(new $i_90.Vector2(o,p));break;case $i_90.PathActions.ELLIPSE:for(a=n[0],s=n[1],u=n[2],l=n[3],h=n[4],o=n[5],c=!!n[6],d=o-h,f=e*2,n=1;f>=n;n++)p=n/f,c||(p=1-p),p=h+p*d,o=a+u*Math.cos(p),p=s+l*Math.sin(p),m.push(new $i_90.Vector2(o,p))}return i=m[m.length-1],1e-10>Math.abs(i.x-m[0].x)&&1e-10>Math.abs(i.y-m[0].y)&&m.splice(m.length-1,1),t&&m.push(m[0]),m},$i_90.Path.prototype.toShapes=function(){var e,t,i,r,n=[],o=new $i_90.Path;for(e=0,t=this.actions.length;t>e;e++)i=this.actions[e],r=i.args,i=i.action,i==$i_90.PathActions.MOVE_TO&&o.actions.length!=0&&(n.push(o),o=new $i_90.Path),o[i].apply(o,r);if(o.actions.length!=0&&n.push(o),n.length==0)return[];var a;if(r=[],e=!$i_90.Shape.Utils.isClockWise(n[0].getPoints()),n.length==1)return o=n[0],a=new $i_90.Shape,a.actions=o.actions,a.curves=o.curves,r.push(a),r;if(e)for(a=new $i_90.Shape,e=0,t=n.length;t>e;e++)o=n[e],$i_90.Shape.Utils.isClockWise(o.getPoints())?(a.actions=o.actions,a.curves=o.curves,r.push(a),a=new $i_90.Shape):a.holes.push(o);else{for(e=0,t=n.length;t>e;e++)o=n[e],$i_90.Shape.Utils.isClockWise(o.getPoints())?(a&&r.push(a),a=new $i_90.Shape,a.actions=o.actions,a.curves=o.curves):a.holes.push(o);r.push(a)}return r},$i_90.Shape=function(){$i_90.Path.apply(this,arguments),this.holes=[]},$i_90.Shape.prototype=Object.create($i_90.Path.prototype),$i_90.Shape.prototype.extrude=function(e){return new $i_90.ExtrudeGeometry(this,e)},$i_90.Shape.prototype.makeGeometry=function(e){return new $i_90.ShapeGeometry(this,e)},$i_90.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;i>t;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},$i_90.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;i>t;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},$i_90.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},$i_90.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},$i_90.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},$i_90.Shape.Utils={removeHoles:function(e,t){var i,r,n,o,a,s,h,l,c,u,d=e.concat(),f=d.concat(),p=[];for(a=0;t.length>a;a++){for(s=t[a],Array.prototype.push.apply(f,s),r=Number.POSITIVE_INFINITY,i=0;s.length>i;i++)for(c=s[i],u=[],l=0;d.length>l;l++)h=d[l],h=c.distanceToSquared(h),u.push(h),r>h&&(r=h,n=i,o=l);i=0>o-1?d.length-1:o-1,r=0>n-1?s.length-1:n-1;var m=[s[n],d[o],d[i]];l=$i_90.FontUtils.Triangulate.area(m);var E=[s[n],s[r],d[o]];c=$i_90.FontUtils.Triangulate.area(E),u=o,h=n,o+=1,n+=-1,0>o&&(o+=d.length),o%=d.length,0>n&&(n+=s.length),n%=s.length,i=0>o-1?d.length-1:o-1,r=0>n-1?s.length-1:n-1,m=[s[n],d[o],d[i]],m=$i_90.FontUtils.Triangulate.area(m),E=[s[n],s[r],d[o]],E=$i_90.FontUtils.Triangulate.area(E),l+c>m+E&&(o=u,n=h,0>o&&(o+=d.length),o%=d.length,0>n&&(n+=s.length),n%=s.length,i=0>o-1?d.length-1:o-1,r=0>n-1?s.length-1:n-1),l=d.slice(0,o),c=d.slice(o),u=s.slice(n),h=s.slice(0,n),r=[s[n],s[r],d[o]],p.push([s[n],d[o],d[i]]),p.push(r),d=l.concat(u).concat(h).concat(c)}return{shape:d,isolatedPts:p,allpoints:f}},triangulateShape:function(e,t){var i,r,n,o,a=$i_90.Shape.Utils.removeHoles(e,t),s=a.allpoints,h=a.isolatedPts,a=$i_90.FontUtils.Triangulate(a.shape,!1),l={};for(i=0,r=s.length;r>i;i++)o=s[i].x+":"+s[i].y,l[o]!==void 0&&console.log("Duplicate point",o),l[o]=i;for(i=0,r=a.length;r>i;i++)for(n=a[i],s=0;3>s;s++)o=n[s].x+":"+n[s].y,o=l[o],o!==void 0&&(n[s]=o);for(i=0,r=h.length;r>i;i++)for(n=h[i],s=0;3>s;s++)o=n[s].x+":"+n[s].y,o=l[o],o!==void 0&&(n[s]=o);return a.concat(h)},isClockWise:function(e){return 0>$i_90.FontUtils.Triangulate.area(e)},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,n){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,n)}},$i_90.AnimationHandler=function(){var e=[],t={},i={update:function(t){for(var i=0;e.length>i;i++)e[i].update(t)},addToUpdate:function(t){e.indexOf(t)===-1&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),t!==-1&&e.splice(t,1)},add:function(e){if(t[e.name]!==void 0&&console.log("$i_90.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,e.initialized!==!0){for(var i=0;e.hierarchy.length>i;i++){for(var r=0;e.hierarchy[i].keys.length>r;r++)if(0>e.hierarchy[i].keys[r].time&&(e.hierarchy[i].keys[r].time=0),e.hierarchy[i].keys[r].rot!==void 0&&!(e.hierarchy[i].keys[r].rot instanceof $i_90.Quaternion)){var n=e.hierarchy[i].keys[r].rot;e.hierarchy[i].keys[r].rot=new $i_90.Quaternion(n[0],n[1],n[2],n[3])}if(e.hierarchy[i].keys.length&&e.hierarchy[i].keys[0].morphTargets!==void 0){for(n={},r=0;e.hierarchy[i].keys.length>r;r++)for(var o=0;e.hierarchy[i].keys[r].morphTargets.length>o;o++){var a=e.hierarchy[i].keys[r].morphTargets[o];n[a]=-1}for(e.hierarchy[i].usedMorphTargets=n,r=0;e.hierarchy[i].keys.length>r;r++){var s={};for(a in n){for(o=0;e.hierarchy[i].keys[r].morphTargets.length>o;o++)if(e.hierarchy[i].keys[r].morphTargets[o]===a){s[a]=e.hierarchy[i].keys[r].morphTargetsInfluences[o];break}o===e.hierarchy[i].keys[r].morphTargets.length&&(s[a]=0)}e.hierarchy[i].keys[r].morphTargetsInfluences=s}}for(r=1;e.hierarchy[i].keys.length>r;r++)e.hierarchy[i].keys[r].time===e.hierarchy[i].keys[r-1].time&&(e.hierarchy[i].keys.splice(r,1),r--);for(r=0;e.hierarchy[i].keys.length>r;r++)e.hierarchy[i].keys[r].index=r}for(r=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[],i=0;e.hierarchy.length>i;i++)e.JIT.hierarchy.push(Array(r));e.initialized=!0}},get:function(e){return typeof e=="string"?t[e]?t[e]:(console.log("$i_90.AnimationHandler.get: Couldn't find animation "+e),null):void 0},parse:function(e){var t=[];if(e instanceof $i_90.SkinnedMesh)for(var i=0;e.bones.length>i;i++)t.push(e.bones[i]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var i=0;e.children.length>i;i++)r(e.children[i],t)};return i.LINEAR=0,i.CATMULLROM=1,i.CATMULLROM_FORWARD=2,i}(),$i_90.Animation=function(e,t,i){this.root=e,this.data=$i_90.AnimationHandler.get(t),this.hierarchy=$i_90.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=i!==void 0?i:$i_90.AnimationHandler.LINEAR,this.points=[],this.target=new $i_90.Vector3},$i_90.Animation.prototype.play=function(e,t){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=e!==void 0?e:!0,this.currentTime=t!==void 0?t:0;var i,r,n=this.hierarchy.length;for(i=0;n>i;i++){r=this.hierarchy[i],this.interpolationType!==$i_90.AnimationHandler.CATMULLROM_FORWARD&&(r.useQuaternion=!0),r.matrixAutoUpdate=!0,r.animationCache===void 0&&(r.animationCache={},r.animationCache.prevKey={pos:0,rot:0,scl:0},r.animationCache.nextKey={pos:0,rot:0,scl:0},r.animationCache.originalMatrix=r instanceof $i_90.Bone?r.skinMatrix:r.matrix);var o=r.animationCache.prevKey;r=r.animationCache.nextKey,o.pos=this.data.hierarchy[i].keys[0],o.rot=this.data.hierarchy[i].keys[0],o.scl=this.data.hierarchy[i].keys[0],r.pos=this.getNextKeyWith("pos",i,1),r.rot=this.getNextKeyWith("rot",i,1),r.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=!1,$i_90.AnimationHandler.addToUpdate(this)},$i_90.Animation.prototype.pause=function(){this.isPaused===!0?$i_90.AnimationHandler.addToUpdate(this):$i_90.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},$i_90.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,$i_90.AnimationHandler.removeFromUpdate(this)},$i_90.Animation.prototype.update=function(e){if(this.isPlaying!==!1){var t,i,r,n,o,a,s,h,l,c=["pos","rot","scl"];l=this.currentTime=this.currentTime+e*this.timeScale,h=this.currentTime=this.currentTime%this.data.length,parseInt(Math.min(h*this.data.fps,this.data.length*this.data.fps),10);for(var u=0,d=this.hierarchy.length;d>u;u++){e=this.hierarchy[u],s=e.animationCache;for(var f=0;3>f;f++){if(t=c[f],o=s.prevKey[t],a=s.nextKey[t],l>=a.time){if(l>h){if(!this.loop)return this.stop(),void 0;for(o=this.data.hierarchy[u].keys[0],a=this.getNextKeyWith(t,u,1);h>a.time;)o=a,a=this.getNextKeyWith(t,u,a.index+1)}else do o=a,a=this.getNextKeyWith(t,u,a.index+1);while(h>a.time);s.prevKey[t]=o,s.nextKey[t]=a}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,i=(h-o.time)/(a.time-o.time),r=o[t],n=a[t],(0>i||i>1)&&(console.log("$i_90.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+u),i=0>i?0:1),t==="pos"?(t=e.position,this.interpolationType===$i_90.AnimationHandler.LINEAR?(t.x=r[0]+(n[0]-r[0])*i,t.y=r[1]+(n[1]-r[1])*i,t.z=r[2]+(n[2]-r[2])*i):(this.interpolationType===$i_90.AnimationHandler.CATMULLROM||this.interpolationType===$i_90.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",u,o.index-1).pos,this.points[1]=r,this.points[2]=n,this.points[3]=this.getNextKeyWith("pos",u,a.index+1).pos,i=i*.33+.33,r=this.interpolateCatmullRom(this.points,i),t.x=r[0],t.y=r[1],t.z=r[2],this.interpolationType===$i_90.AnimationHandler.CATMULLROM_FORWARD&&(i=this.interpolateCatmullRom(this.points,i*1.01),this.target.set(i[0],i[1],i[2]),this.target.subSelf(t),this.target.y=0,this.target.normalize(),i=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,i,0)))):t==="rot"?$i_90.Quaternion.slerp(r,n,e.quaternion,i):t==="scl"&&(t=e.scale,t.x=r[0]+(n[0]-r[0])*i,t.y=r[1]+(n[1]-r[1])*i,t.z=r[2]+(n[2]-r[2])*i)}}}},$i_90.Animation.prototype.interpolateCatmullRom=function(e,t){var i,r,n,o,a,s,h=[],l=[];return i=(e.length-1)*t,r=Math.floor(i),i-=r,h[0]=r===0?r:r-1,h[1]=r,h[2]=r>e.length-2?r:r+1,h[3]=r>e.length-3?r:r+2,r=e[h[0]],o=e[h[1]],a=e[h[2]],s=e[h[3]],h=i*i,n=i*h,l[0]=this.interpolate(r[0],o[0],a[0],s[0],i,h,n),l[1]=this.interpolate(r[1],o[1],a[1],s[1],i,h,n),l[2]=this.interpolate(r[2],o[2],a[2],s[2],i,h,n),l},$i_90.Animation.prototype.interpolate=function(e,t,i,r,n,o,a){return e=(i-e)*.5,r=(r-t)*.5,(2*(t-i)+e+r)*a+(-3*(t-i)-2*e-r)*o+e*n+t},$i_90.Animation.prototype.getNextKeyWith=function(e,t,i){for(var r=this.data.hierarchy[t].keys,i=this.interpolationType===$i_90.AnimationHandler.CATMULLROM||this.interpolationType===$i_90.AnimationHandler.CATMULLROM_FORWARD?r.length-1>i?i:r.length-1:i%r.length;r.length>i;i++)if(r[i][e]!==void 0)return r[i];return this.data.hierarchy[t].keys[0]},$i_90.Animation.prototype.getPrevKeyWith=function(e,t,i){for(var r=this.data.hierarchy[t].keys,i=this.interpolationType===$i_90.AnimationHandler.CATMULLROM||this.interpolationType===$i_90.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:0>i?i+r.length:i;i>=0;i--)if(r[i][e]!==void 0)return r[i];return this.data.hierarchy[t].keys[r.length-1]},$i_90.KeyFrameAnimation=function(e,t,i){for(this.root=e,this.data=$i_90.AnimationHandler.get(t),this.hierarchy=$i_90.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=i!==void 0?i:!0,e=0,t=this.hierarchy.length;t>e;e++){var i=this.data.hierarchy[e].sids,r=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&i){for(var n=0;i.length>n;n++){var o=i[n],a=this.getNextKeyWith(o,e,0);a&&a.apply(o)}r.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}},$i_90.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=e!==void 0?e:!0,this.currentTime=t!==void 0?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var i,r,n,o=this.hierarchy.length;for(i=0;o>i;i++)r=this.hierarchy[i],n=this.data.hierarchy[i],r.useQuaternion=!0,n.animationCache===void 0&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=r instanceof $i_90.Bone?r.skinMatrix:r.matrix),r=this.data.hierarchy[i].keys,r.length&&(n.animationCache.prevKey=r[0],n.animationCache.nextKey=r[1],this.startTime=Math.min(r[0].time,this.startTime),this.endTime=Math.max(r[r.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,$i_90.AnimationHandler.addToUpdate(this)},$i_90.KeyFrameAnimation.prototype.pause=function(){this.isPaused?$i_90.AnimationHandler.addToUpdate(this):$i_90.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},$i_90.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,$i_90.AnimationHandler.removeFromUpdate(this);for(var e=0;this.data.hierarchy.length>e;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(i.animationCache!==void 0){var r=i.animationCache.originalMatrix;t instanceof $i_90.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete i.animationCache}}},$i_90.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,i,r,n,o,a,s,h=this.data.JIT.hierarchy;if(a=this.currentTime=this.currentTime+e*this.timeScale,o=this.currentTime=this.currentTime%this.data.length,this.startTimeMs>o&&(o=this.currentTime=this.startTimeMs+o),n=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10),(s=a>o)&&!this.loop){for(var e=0,l=this.hierarchy.length;l>e;e++){var c=this.data.hierarchy[e].keys,h=this.data.hierarchy[e].sids;if(r=c.length-1,n=this.hierarchy[e],c.length){for(c=0;h.length>c;c++)o=h[c],(a=this.getPrevKeyWith(o,e,r))&&a.apply(o);this.data.hierarchy[e].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}this.stop()}else if(this.startTime<=o){for(e=0,l=this.hierarchy.length;l>e;e++){r=this.hierarchy[e],t=this.data.hierarchy[e];var c=t.keys,u=t.animationCache;if(this.JITCompile&&h[e][n]!==void 0)r instanceof $i_90.Bone?(r.skinMatrix=h[e][n],r.matrixWorldNeedsUpdate=!1):(r.matrix=h[e][n],r.matrixWorldNeedsUpdate=!0);else if(c.length){if(this.JITCompile&&u&&(r instanceof $i_90.Bone?r.skinMatrix=u.originalMatrix:r.matrix=u.originalMatrix),t=u.prevKey,i=u.nextKey,t&&i){if(a>=i.time){if(s&&this.loop)for(t=c[0],i=c[1];o>i.time;)t=i,i=c[t.index+1];else if(!s)for(var d=c.length-1;o>i.time&&i.index!==d;)t=i,i=c[t.index+1];u.prevKey=t,u.nextKey=i}o>i.time?t.interpolate(i,i.time):t.interpolate(i,o)}this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&h[0][n]===void 0)for(this.hierarchy[0].updateMatrixWorld(!0),e=0;this.hierarchy.length>e;e++)h[e][n]=this.hierarchy[e]instanceof $i_90.Bone?this.hierarchy[e].skinMatrix.clone():this.hierarchy[e].matrix.clone()}}},$i_90.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i%=t.length;t.length>i;i++)if(t[i].hasTarget(e))return t[i];return t[0]},$i_90.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i=0>i?i+t.length:i;i>=0;i--)if(t[i].hasTarget(e))return t[i];return t[t.length-1]},$i_90.CubeCamera=function(e,t,i){$i_90.Object3D.call(this);var r=new $i_90.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new $i_90.Vector3(1,0,0)),this.add(r);var n=new $i_90.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new $i_90.Vector3(-1,0,0)),this.add(n);var o=new $i_90.PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new $i_90.Vector3(0,1,0)),this.add(o);var a=new $i_90.PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new $i_90.Vector3(0,-1,0)),this.add(a);var s=new $i_90.PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new $i_90.Vector3(0,0,1)),this.add(s);var h=new $i_90.PerspectiveCamera(90,1,e,t);h.up.set(0,-1,0),h.lookAt(new $i_90.Vector3(0,0,-1)),this.add(h),this.renderTarget=new $i_90.WebGLRenderTargetCube(i,i,{format:$i_90.RGBFormat,magFilter:$i_90.LinearFilter,minFilter:$i_90.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,l=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,r,i),i.activeCubeFace=1,e.render(t,n,i),i.activeCubeFace=2,e.render(t,o,i),i.activeCubeFace=3,e.render(t,a,i),i.activeCubeFace=4,e.render(t,s,i),i.generateMipmaps=l,i.activeCubeFace=5,e.render(t,h,i)}},$i_90.CubeCamera.prototype=Object.create($i_90.Object3D.prototype),$i_90.CombinedCamera=function(e,t,i,r,n,o,a){$i_90.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new $i_90.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new $i_90.PerspectiveCamera(i,e/t,r,n),this.zoom=1,this.toPerspective()},$i_90.CombinedCamera.prototype=Object.create($i_90.Camera.prototype),$i_90.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},$i_90.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},$i_90.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},$i_90.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},$i_90.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},$i_90.CombinedCamera.prototype.setLens=function(e,t){t===void 0&&(t=24);var i=2*Math.atan(t/(e*2))*(180/Math.PI);return this.setFov(i),i},$i_90.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},$i_90.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},$i_90.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},$i_90.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},$i_90.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},$i_90.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},$i_90.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},$i_90.CircleGeometry=function(e,t,i,r){$i_90.Geometry.call(this);var n,e=e||50,i=i!==void 0?i:0,r=r!==void 0?r:Math.PI*2,t=t!==void 0?Math.max(3,t):8,o=[];n=new $i_90.Vector3;var a=new $i_90.UV(.5,.5);for(this.vertices.push(n),o.push(a),n=0;t>=n;n++){var s=new $i_90.Vector3;s.x=e*Math.cos(i+n/t*r),s.y=e*Math.sin(i+n/t*r),this.vertices.push(s),o.push(new $i_90.UV((s.x/e+1)/2,-(s.y/e+1)/2+1))}for(i=new $i_90.Vector3(0,0,-1),n=1;t>=n;n++)this.faces.push(new $i_90.Face3(n,n+1,0,[i,i,i])),this.faceVertexUvs[0].push([o[n],o[n+1],a]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},$i_90.CircleGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.CubeGeometry=function(e,t,i,r,n,o,a,s){function h(e,t,i,a,s,h,l,c){var u,d=r||1,f=n||1,p=s/2,E=h/2,g=m.vertices.length;e==="x"&&t==="y"||e==="y"&&t==="x"?u="z":e==="x"&&t==="z"||e==="z"&&t==="x"?(u="y",f=o||1):(e==="z"&&t==="y"||e==="y"&&t==="z")&&(u="x",d=o||1);var v=d+1,y=f+1,_=s/d,T=h/f,x=new $i_90.Vector3;for(x[u]=l>0?1:-1,s=0;y>s;s++)for(h=0;v>h;h++){var R=new $i_90.Vector3;R[e]=(h*_-p)*i,R[t]=(s*T-E)*a,R[u]=l,m.vertices.push(R)}for(s=0;f>s;s++)for(h=0;d>h;h++)e=new $i_90.Face4(h+v*s+g,h+v*(s+1)+g,h+1+v*(s+1)+g,h+1+v*s+g),e.normal.copy(x),e.vertexNormals.push(x.clone(),x.clone(),x.clone(),x.clone()),e.materialIndex=c,m.faces.push(e),m.faceVertexUvs[0].push([new $i_90.UV(h/d,1-s/f),new $i_90.UV(h/d,1-(s+1)/f),new $i_90.UV((h+1)/d,1-(s+1)/f),new $i_90.UV((h+1)/d,1-s/f)])}$i_90.Geometry.call(this);var l,c,u,d,f,p,m=this,E=e/2,g=t/2,v=i/2;if(a!==void 0){if(a instanceof Array)this.materials=a;else for(this.materials=[],l=0;6>l;l++)this.materials.push(a);l=0,d=1,c=2,f=3,u=4,p=5}else this.materials=[];if(this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0},s!=void 0)for(var y in s)this.sides[y]!==void 0&&(this.sides[y]=s[y]);this.sides.px&&h("z","y",-1,-1,i,t,E,l),this.sides.nx&&h("z","y",1,-1,i,t,-E,d),this.sides.py&&h("x","z",1,1,e,i,g,c),this.sides.ny&&h("x","z",1,-1,e,i,-g,f),this.sides.pz&&h("x","y",1,-1,e,t,v,u),this.sides.nz&&h("x","y",-1,-1,e,t,-v,p),this.computeCentroids(),this.mergeVertices()},$i_90.CubeGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.CylinderGeometry=function(e,t,i,r,n,o){$i_90.Geometry.call(this);var a,s,e=e!==void 0?e:20,t=t!==void 0?t:20,i=i!==void 0?i:100,h=i/2,r=r||8,n=n||1,l=[],c=[];for(s=0;n>=s;s++){var u=[],d=[],f=s/n,p=f*(t-e)+e;for(a=0;r>=a;a++){var m=a/r,E=new $i_90.Vector3;E.x=p*Math.sin(m*Math.PI*2),E.y=-f*i+h,E.z=p*Math.cos(m*Math.PI*2),this.vertices.push(E),u.push(this.vertices.length-1),d.push(new $i_90.UV(m,1-f))}l.push(u),c.push(d)}for(i=(t-e)/i,a=0;r>a;a++)for(e!==0?(u=this.vertices[l[0][a]].clone(),d=this.vertices[l[0][a+1]].clone()):(u=this.vertices[l[1][a]].clone(),d=this.vertices[l[1][a+1]].clone()),u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*i).normalize(),d.setY(Math.sqrt(d.x*d.x+d.z*d.z)*i).normalize(),s=0;n>s;s++){var f=l[s][a],p=l[s+1][a],m=l[s+1][a+1],E=l[s][a+1],g=u.clone(),v=u.clone(),y=d.clone(),_=d.clone(),T=c[s][a].clone(),x=c[s+1][a].clone(),R=c[s+1][a+1].clone(),b=c[s][a+1].clone();this.faces.push(new $i_90.Face4(f,p,m,E,[g,v,y,_])),this.faceVertexUvs[0].push([T,x,R,b])}if(!o&&e>0)for(this.vertices.push(new $i_90.Vector3(0,h,0)),a=0;r>a;a++)f=l[0][a],p=l[0][a+1],m=this.vertices.length-1,g=new $i_90.Vector3(0,1,0),v=new $i_90.Vector3(0,1,0),y=new $i_90.Vector3(0,1,0),T=c[0][a].clone(),x=c[0][a+1].clone(),R=new $i_90.UV(x.u,0),this.faces.push(new $i_90.Face3(f,p,m,[g,v,y])),this.faceVertexUvs[0].push([T,x,R]);if(!o&&t>0)for(this.vertices.push(new $i_90.Vector3(0,-h,0)),a=0;r>a;a++)f=l[s][a+1],p=l[s][a],m=this.vertices.length-1,g=new $i_90.Vector3(0,-1,0),v=new $i_90.Vector3(0,-1,0),y=new $i_90.Vector3(0,-1,0),T=c[s][a+1].clone(),x=c[s][a].clone(),R=new $i_90.UV(x.u,1),this.faces.push(new $i_90.Face3(f,p,m,[g,v,y])),this.faceVertexUvs[0].push([T,x,R]);this.computeCentroids(),this.computeFaceNormals()},$i_90.CylinderGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.ExtrudeGeometry=function(e,t){e!==void 0&&($i_90.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals())},$i_90.ExtrudeGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,r=0;i>r;r++)this.addShape(e[r],t)},$i_90.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).addSelf(e)}function r(e,t,i){var r=$i_90.ExtrudeGeometry.__v1,n=$i_90.ExtrudeGeometry.__v2,o=$i_90.ExtrudeGeometry.__v3,a=$i_90.ExtrudeGeometry.__v4,s=$i_90.ExtrudeGeometry.__v5,h=$i_90.ExtrudeGeometry.__v6;return r.set(e.x-t.x,e.y-t.y),n.set(e.x-i.x,e.y-i.y),r=r.normalize(),n=n.normalize(),o.set(-r.y,r.x),a.set(n.y,-n.x),s.copy(e).addSelf(o),h.copy(e).addSelf(a),s.equals(h)?a.clone():(s.copy(t).addSelf(o),h.copy(i).addSelf(a),o=r.dot(a),a=h.subSelf(s).dot(a),o===0&&(console.log("Either infinite or no solutions!"),a===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),a/=o,0>a?(t=Math.atan2(t.y-e.y,t.x-e.x),e=Math.atan2(i.y-e.y,i.x-e.x),t>e&&(e+=Math.PI*2),i=(t+e)/2,e=-Math.cos(i),i=-Math.sin(i),new $i_90.Vector2(e,i)):r.multiplyScalar(a).addSelf(s).subSelf(e).clone())}function n(i,r){var n,o;for(B=i.length;--B>=0;){n=B,o=B-1,0>o&&(o=i.length-1);for(var a=0,s=g+m*2,a=0;s>a;a++){var h=D*a,l=D*(a+1),c=r+n+h,h=r+o+h,u=r+o+l,l=r+n+l,d=i,f=a,p=s,E=n,v=o,c=c+S,h=h+S,u=u+S,l=l+S;H.faces.push(new $i_90.Face4(c,h,u,l,null,null,T)),c=x.generateSideWallUV(H,e,d,t,c,h,u,l,f,p,E,v),H.faceVertexUvs[0].push(c)}}}function o(e,t,i){H.vertices.push(new $i_90.Vector3(e,t,i))}function a(i,r,n,o){i+=S,r+=S,n+=S,H.faces.push(new $i_90.Face3(i,r,n,null,null,_)),i=o?x.generateBottomUV(H,e,t,i,r,n):x.generateTopUV(H,e,t,i,r,n),H.faceVertexUvs[0].push(i)}var s,h,l,c,u,d=t.amount!==void 0?t.amount:100,f=t.bevelThickness!==void 0?t.bevelThickness:6,p=t.bevelSize!==void 0?t.bevelSize:f-2,m=t.bevelSegments!==void 0?t.bevelSegments:3,E=t.bevelEnabled!==void 0?t.bevelEnabled:!0,g=t.steps!==void 0?t.steps:1,v=t.extrudePath,y=!1,_=t.material,T=t.extrudeMaterial,x=t.UVGenerator!==void 0?t.UVGenerator:$i_90.ExtrudeGeometry.WorldUVGenerator;
v&&(s=v.getSpacedPoints(g),y=!0,E=!1,h=t.frames!==void 0?t.frames:new $i_90.TubeGeometry.FrenetFrames(v,g,!1),l=new $i_90.Vector3,c=new $i_90.Vector3,u=new $i_90.Vector3),E||(p=f=m=0);var R,b,w,H=this,S=this.vertices.length,v=e.extractPoints(),M=v.shape,v=v.holes,C=!$i_90.Shape.Utils.isClockWise(M);if(C){for(M=M.reverse(),b=0,w=v.length;w>b;b++)R=v[b],$i_90.Shape.Utils.isClockWise(R)&&(v[b]=R.reverse());C=!1}var A=$i_90.Shape.Utils.triangulateShape(M,v),C=M;for(b=0,w=v.length;w>b;b++)R=v[b],M=M.concat(R);var P,L,I,U,D=M.length,F=A.length,z=[],B=0,V=C.length;for(P=V-1,L=B+1;V>B;B++,P++,L++)P===V&&(P=0),L===V&&(L=0),z[B]=r(C[B],C[P],C[L]);var N,O=[],k=z.concat();for(b=0,w=v.length;w>b;b++){for(R=v[b],N=[],B=0,V=R.length,P=V-1,L=B+1;V>B;B++,P++,L++)P===V&&(P=0),L===V&&(L=0),N[B]=r(R[B],R[P],R[L]);O.push(N),k=k.concat(N)}for(P=0;m>P;P++){for(R=P/m,I=f*(1-R),L=p*Math.sin(R*Math.PI/2),B=0,V=C.length;V>B;B++)U=i(C[B],z[B],L),o(U.x,U.y,-I);for(b=0,w=v.length;w>b;b++)for(R=v[b],N=O[b],B=0,V=R.length;V>B;B++)U=i(R[B],N[B],L),o(U.x,U.y,-I)}for(L=p,B=0;D>B;B++)U=E?i(M[B],k[B],L):M[B],y?(c.copy(h.normals[0]).multiplyScalar(U.x),l.copy(h.binormals[0]).multiplyScalar(U.y),u.copy(s[0]).addSelf(c).addSelf(l),o(u.x,u.y,u.z)):o(U.x,U.y,0);for(R=1;g>=R;R++)for(B=0;D>B;B++)U=E?i(M[B],k[B],L):M[B],y?(c.copy(h.normals[R]).multiplyScalar(U.x),l.copy(h.binormals[R]).multiplyScalar(U.y),u.copy(s[R]).addSelf(c).addSelf(l),o(u.x,u.y,u.z)):o(U.x,U.y,d/g*R);for(P=m-1;P>=0;P--){for(R=P/m,I=f*(1-R),L=p*Math.sin(R*Math.PI/2),B=0,V=C.length;V>B;B++)U=i(C[B],z[B],L),o(U.x,U.y,d+I);for(b=0,w=v.length;w>b;b++)for(R=v[b],N=O[b],B=0,V=R.length;V>B;B++)U=i(R[B],N[B],L),y?o(U.x,U.y+s[g-1].y,s[g-1].x+I):o(U.x,U.y,d+I)}if(E){for(f=D*0,B=0;F>B;B++)d=A[B],a(d[2]+f,d[1]+f,d[0]+f,!0);for(f=D*(g+m*2),B=0;F>B;B++)d=A[B],a(d[0]+f,d[1]+f,d[2]+f,!1)}else{for(B=0;F>B;B++)d=A[B],a(d[2],d[1],d[0],!0);for(B=0;F>B;B++)d=A[B],a(d[0]+D*g,d[1]+D*g,d[2]+D*g,!1)}for(d=0,n(C,d),d+=C.length,b=0,w=v.length;w>b;b++)R=v[b],n(R,d),d+=R.length},$i_90.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r,n,o){return t=e.vertices[n].x,n=e.vertices[n].y,i=e.vertices[o].x,o=e.vertices[o].y,[new $i_90.UV(e.vertices[r].x,e.vertices[r].y),new $i_90.UV(t,n),new $i_90.UV(i,o)]},generateBottomUV:function(e,t,i,r,n,o){return this.generateTopUV(e,t,i,r,n,o)},generateSideWallUV:function(e,t,i,r,n,o,a,s){var t=e.vertices[n].x,i=e.vertices[n].y,n=e.vertices[n].z,r=e.vertices[o].x,h=e.vertices[o].y,o=e.vertices[o].z,l=e.vertices[a].x,c=e.vertices[a].y,a=e.vertices[a].z,u=e.vertices[s].x,d=e.vertices[s].y,e=e.vertices[s].z;return.01>Math.abs(i-h)?[new $i_90.UV(t,1-n),new $i_90.UV(r,1-o),new $i_90.UV(l,1-a),new $i_90.UV(u,1-e)]:[new $i_90.UV(i,1-n),new $i_90.UV(h,1-o),new $i_90.UV(c,1-a),new $i_90.UV(d,1-e)]}},$i_90.ExtrudeGeometry.__v1=new $i_90.Vector2,$i_90.ExtrudeGeometry.__v2=new $i_90.Vector2,$i_90.ExtrudeGeometry.__v3=new $i_90.Vector2,$i_90.ExtrudeGeometry.__v4=new $i_90.Vector2,$i_90.ExtrudeGeometry.__v5=new $i_90.Vector2,$i_90.ExtrudeGeometry.__v6=new $i_90.Vector2,$i_90.ShapeGeometry=function(e,t){$i_90.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},$i_90.ShapeGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;r>i;i++)this.addShape(e[i],t);return this},$i_90.ShapeGeometry.prototype.addShape=function(e,t){t===void 0&&(t={});var i,r,n,o=t.material,a=t.UVGenerator===void 0?$i_90.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,s=this.vertices.length;i=e.extractPoints();var h=i.shape,l=i.holes;if(!$i_90.Shape.Utils.isClockWise(h))for(h=h.reverse(),i=0,r=l.length;r>i;i++)n=l[i],$i_90.Shape.Utils.isClockWise(n)&&(l[i]=n.reverse());var c=$i_90.Shape.Utils.triangulateShape(h,l);for(i=0,r=l.length;r>i;i++)n=l[i],h=h.concat(n);for(l=h.length,r=c.length,i=0;l>i;i++)n=h[i],this.vertices.push(new $i_90.Vector3(n.x,n.y,0));for(i=0;r>i;i++)l=c[i],h=l[0]+s,n=l[1]+s,l=l[2]+s,this.faces.push(new $i_90.Face3(h,n,l,null,null,o)),this.faceVertexUvs[0].push(a.generateBottomUV(this,e,t,h,n,l))},$i_90.LatheGeometry=function(e,t,i){$i_90.Geometry.call(this);for(var t=t||12,i=i||2*Math.PI,r=[],n=(new $i_90.Matrix4).makeRotationZ(i/t),o=0;e.length>o;o++)r[o]=e[o].clone(),this.vertices.push(r[o]);for(var a=t+1,i=0;a>i;i++)for(o=0;r.length>o;o++)r[o]=n.multiplyVector3(r[o].clone()),this.vertices.push(r[o]);for(i=0;t>i;i++)for(r=0,n=e.length;n-1>r;r++)this.faces.push(new $i_90.Face4(i*n+r,(i+1)%a*n+r,(i+1)%a*n+(r+1)%n,i*n+(r+1)%n)),this.faceVertexUvs[0].push([new $i_90.UV(1-i/t,r/n),new $i_90.UV(1-(i+1)/t,r/n),new $i_90.UV(1-(i+1)/t,(r+1)/n),new $i_90.UV(1-i/t,(r+1)/n)]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},$i_90.LatheGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.PlaneGeometry=function(e,t,i,r){$i_90.Geometry.call(this);for(var n=e/2,o=t/2,i=i||1,r=r||1,a=i+1,s=r+1,h=e/i,l=t/r,c=new $i_90.Vector3(0,0,1),e=0;s>e;e++)for(t=0;a>t;t++)this.vertices.push(new $i_90.Vector3(t*h-n,-(e*l-o),0));for(e=0;r>e;e++)for(t=0;i>t;t++)n=new $i_90.Face4(t+a*e,t+a*(e+1),t+1+a*(e+1),t+1+a*e),n.normal.copy(c),n.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),this.faces.push(n),this.faceVertexUvs[0].push([new $i_90.UV(t/i,1-e/r),new $i_90.UV(t/i,1-(e+1)/r),new $i_90.UV((t+1)/i,1-(e+1)/r),new $i_90.UV((t+1)/i,1-e/r)]);this.computeCentroids()},$i_90.PlaneGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.SphereGeometry=function(e,t,i,r,n,o,a){$i_90.Geometry.call(this);var s,h,e=e||50,r=r!==void 0?r:0,n=n!==void 0?n:Math.PI*2,o=o!==void 0?o:0,a=a!==void 0?a:Math.PI,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),l=[],c=[];for(h=0;i>=h;h++){var u=[],d=[];for(s=0;t>=s;s++){var f=s/t,p=h/i,m=new $i_90.Vector3;m.x=-e*Math.cos(r+f*n)*Math.sin(o+p*a),m.y=e*Math.cos(o+p*a),m.z=e*Math.sin(r+f*n)*Math.sin(o+p*a),this.vertices.push(m),u.push(this.vertices.length-1),d.push(new $i_90.UV(f,1-p))}l.push(u),c.push(d)}for(h=0;i>h;h++)for(s=0;t>s;s++){var r=l[h][s+1],n=l[h][s],o=l[h+1][s],a=l[h+1][s+1],u=this.vertices[r].clone().normalize(),d=this.vertices[n].clone().normalize(),f=this.vertices[o].clone().normalize(),p=this.vertices[a].clone().normalize(),m=c[h][s+1].clone(),E=c[h][s].clone(),g=c[h+1][s].clone(),v=c[h+1][s+1].clone();Math.abs(this.vertices[r].y)==e?(this.faces.push(new $i_90.Face3(r,o,a,[u,f,p])),this.faceVertexUvs[0].push([m,g,v])):Math.abs(this.vertices[o].y)==e?(this.faces.push(new $i_90.Face3(r,n,o,[u,d,f])),this.faceVertexUvs[0].push([m,E,g])):(this.faces.push(new $i_90.Face4(r,n,o,a,[u,d,f,p])),this.faceVertexUvs[0].push([m,E,g,v]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},$i_90.SphereGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.TextGeometry=function(e,t){var i=$i_90.FontUtils.generateShapes(e,t);t.amount=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),$i_90.ExtrudeGeometry.call(this,i,t)},$i_90.TextGeometry.prototype=Object.create($i_90.ExtrudeGeometry.prototype),$i_90.TorusGeometry=function(e,t,i,r,n){for($i_90.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.radialSegments=i||8,this.tubularSegments=r||6,this.arc=n||Math.PI*2,n=new $i_90.Vector3,e=[],t=[],i=0;this.radialSegments>=i;i++)for(r=0;this.tubularSegments>=r;r++){var o=r/this.tubularSegments*this.arc,a=i/this.radialSegments*Math.PI*2;n.x=this.radius*Math.cos(o),n.y=this.radius*Math.sin(o);var s=new $i_90.Vector3;s.x=(this.radius+this.tube*Math.cos(a))*Math.cos(o),s.y=(this.radius+this.tube*Math.cos(a))*Math.sin(o),s.z=this.tube*Math.sin(a),this.vertices.push(s),e.push(new $i_90.UV(r/this.tubularSegments,i/this.radialSegments)),t.push(s.clone().subSelf(n).normalize())}for(i=1;this.radialSegments>=i;i++)for(r=1;this.tubularSegments>=r;r++){var n=(this.tubularSegments+1)*i+r-1,o=(this.tubularSegments+1)*(i-1)+r-1,a=(this.tubularSegments+1)*(i-1)+r,s=(this.tubularSegments+1)*i+r,h=new $i_90.Face4(n,o,a,s,[t[n],t[o],t[a],t[s]]);h.normal.addSelf(t[n]),h.normal.addSelf(t[o]),h.normal.addSelf(t[a]),h.normal.addSelf(t[s]),h.normal.normalize(),this.faces.push(h),this.faceVertexUvs[0].push([e[n].clone(),e[o].clone(),e[a].clone(),e[s].clone()])}this.computeCentroids()},$i_90.TorusGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.TorusKnotGeometry=function(e,t,i,r,n,o,a){function s(e,t,i,r,n,o){var a=Math.cos(e);return Math.cos(t),t=Math.sin(e),e=i/r*e,i=Math.cos(e),a=n*(2+i)*.5*a,t=n*(2+i)*t*.5,n=o*n*Math.sin(e)*.5,new $i_90.Vector3(a,t,n)}for($i_90.Geometry.call(this),this.radius=e||200,this.tube=t||40,this.radialSegments=i||64,this.tubularSegments=r||8,this.p=n||2,this.q=o||3,this.heightScale=a||1,this.grid=Array(this.radialSegments),i=new $i_90.Vector3,r=new $i_90.Vector3,n=new $i_90.Vector3,e=0;this.radialSegments>e;++e)for(this.grid[e]=Array(this.tubularSegments),t=0;this.tubularSegments>t;++t){var h=e/this.radialSegments*2*this.p*Math.PI,a=t/this.tubularSegments*2*Math.PI,o=s(h,a,this.q,this.p,this.radius,this.heightScale),h=s(h+.01,a,this.q,this.p,this.radius,this.heightScale);i.sub(h,o),r.add(h,o),n.cross(i,r),r.cross(n,i),n.normalize(),r.normalize(),h=-this.tube*Math.cos(a),a=this.tube*Math.sin(a),o.x=o.x+(h*r.x+a*n.x),o.y=o.y+(h*r.y+a*n.y),o.z=o.z+(h*r.z+a*n.z),this.grid[e][t]=this.vertices.push(new $i_90.Vector3(o.x,o.y,o.z))-1}for(e=0;this.radialSegments>e;++e)for(t=0;this.tubularSegments>t;++t){var n=(e+1)%this.radialSegments,o=(t+1)%this.tubularSegments,i=this.grid[e][t],r=this.grid[n][t],n=this.grid[n][o],o=this.grid[e][o],a=new $i_90.UV(e/this.radialSegments,t/this.tubularSegments),h=new $i_90.UV((e+1)/this.radialSegments,t/this.tubularSegments),l=new $i_90.UV((e+1)/this.radialSegments,(t+1)/this.tubularSegments),c=new $i_90.UV(e/this.radialSegments,(t+1)/this.tubularSegments);this.faces.push(new $i_90.Face4(i,r,n,o)),this.faceVertexUvs[0].push([a,h,l,c])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},$i_90.TorusKnotGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.TubeGeometry=function(e,t,i,r,n,o){$i_90.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=i||1,this.radiusSegments=r||8,this.closed=n||!1,o&&(this.debug=new $i_90.Object3D),this.grid=[];var a,s,h,l,c,u,d,f,o=this.segments+1,p=new $i_90.Vector3,t=new $i_90.TubeGeometry.FrenetFrames(e,t,n);for(u=t.tangents,d=t.normals,f=t.binormals,this.tangents=u,this.normals=d,this.binormals=f,t=0;o>t;t++)for(this.grid[t]=[],r=t/(o-1),c=e.getPointAt(r),r=u[t],a=d[t],s=f[t],this.debug&&(this.debug.add(new $i_90.ArrowHelper(r,c,i,255)),this.debug.add(new $i_90.ArrowHelper(a,c,i,16711680)),this.debug.add(new $i_90.ArrowHelper(s,c,i,65280))),r=0;this.radiusSegments>r;r++)h=r/this.radiusSegments*2*Math.PI,l=-this.radius*Math.cos(h),h=this.radius*Math.sin(h),p.copy(c),p.x=p.x+(l*a.x+h*s.x),p.y=p.y+(l*a.y+h*s.y),p.z=p.z+(l*a.z+h*s.z),this.grid[t][r]=this.vertices.push(new $i_90.Vector3(p.x,p.y,p.z))-1;for(t=0;this.segments>t;t++)for(r=0;this.radiusSegments>r;r++)o=n?(t+1)%this.segments:t+1,p=(r+1)%this.radiusSegments,e=this.grid[t][r],i=this.grid[o][r],o=this.grid[o][p],p=this.grid[t][p],u=new $i_90.UV(t/this.segments,r/this.radiusSegments),d=new $i_90.UV((t+1)/this.segments,r/this.radiusSegments),f=new $i_90.UV((t+1)/this.segments,(r+1)/this.radiusSegments),a=new $i_90.UV(t/this.segments,(r+1)/this.radiusSegments),this.faces.push(new $i_90.Face4(e,i,o,p)),this.faceVertexUvs[0].push([u,d,f,a]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},$i_90.TubeGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.TubeGeometry.FrenetFrames=function(e,t,i){new $i_90.Vector3;var r=new $i_90.Vector3;new $i_90.Vector3;var n,o,a,s=[],h=[],l=[],c=new $i_90.Vector3,u=new $i_90.Matrix4,t=t+1;for(this.tangents=s,this.normals=h,this.binormals=l,n=0;t>n;n++)o=n/(t-1),s[n]=e.getTangentAt(o),s[n].normalize();for(h[0]=new $i_90.Vector3,l[0]=new $i_90.Vector3,e=Number.MAX_VALUE,n=Math.abs(s[0].x),o=Math.abs(s[0].y),a=Math.abs(s[0].z),n>e||(e=n,r.set(1,0,0)),o>e||(e=o,r.set(0,1,0)),e>=a&&r.set(0,0,1),c.cross(s[0],r).normalize(),h[0].cross(s[0],c),l[0].cross(s[0],h[0]),n=1;t>n;n++)h[n]=h[n-1].clone(),l[n]=l[n-1].clone(),c.cross(s[n-1],s[n]),c.length()>1e-4&&(c.normalize(),r=Math.acos(s[n-1].dot(s[n])),u.makeRotationAxis(c,r).multiplyVector3(h[n])),l[n].cross(s[n],h[n]);if(i)for(r=Math.acos(h[0].dot(h[t-1])),r/=t-1,s[0].dot(c.cross(h[0],h[t-1]))>0&&(r=-r),n=1;t>n;n++)u.makeRotationAxis(s[n],r*n).multiplyVector3(h[n]),l[n].cross(s[n],h[n])},$i_90.PolyhedronGeometry=function(e,t,i,r){function n(e){var t=e.normalize().clone();t.index=h.vertices.push(t)-1;var i=Math.atan2(e.z,-e.x)/2/Math.PI+.5,e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;return t.uv=new $i_90.UV(i,1-e),t}function o(e,t,i,r){1>r?(r=new $i_90.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]),r.centroid.addSelf(e).addSelf(t).addSelf(i).divideScalar(3),r.normal=r.centroid.clone().normalize(),h.faces.push(r),r=Math.atan2(r.centroid.z,-r.centroid.x),h.faceVertexUvs[0].push([s(e.uv,e,r),s(t.uv,t,r),s(i.uv,i,r)])):(r-=1,o(e,a(e,t),a(e,i),r),o(a(e,t),t,a(t,i),r),o(a(e,i),a(t,i),i,r),o(a(e,t),a(t,i),a(e,i),r))}function a(e,t){u[e.index]||(u[e.index]=[]),u[t.index]||(u[t.index]=[]);var i=u[e.index][t.index];return i===void 0&&(u[e.index][t.index]=u[t.index][e.index]=i=n((new $i_90.Vector3).add(e,t).divideScalar(2))),i}function s(e,t,i){return 0>i&&e.u===1&&(e=new $i_90.UV(e.u-1,e.v)),t.x===0&&t.z===0&&(e=new $i_90.UV(i/2/Math.PI+.5,e.v)),e}$i_90.Geometry.call(this);for(var i=i||1,r=r||0,h=this,l=0,c=e.length;c>l;l++)n(new $i_90.Vector3(e[l][0],e[l][1],e[l][2]));for(var u=[],e=this.vertices,l=0,c=t.length;c>l;l++)o(e[t[l][0]],e[t[l][1]],e[t[l][2]],r);for(this.mergeVertices(),l=0,c=this.vertices.length;c>l;l++)this.vertices[l].multiplyScalar(i);this.computeCentroids(),this.boundingSphere={radius:i}},$i_90.PolyhedronGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2;$i_90.PolyhedronGeometry.call(this,[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},$i_90.IcosahedronGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.OctahedronGeometry=function(e,t){$i_90.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},$i_90.OctahedronGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.TetrahedronGeometry=function(e,t){$i_90.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},$i_90.TetrahedronGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.ParametricGeometry=function(e,t,i,r){$i_90.Geometry.call(this);var n,o,a,s,h=this.vertices,l=this.faces,c=this.faceVertexUvs[0],r=r===void 0?!1:r,u=t+1;for(n=0;i>=n;n++)for(s=n/i,o=0;t>=o;o++)a=o/t,a=e(a,s),h.push(a);var d,f,p,m;for(n=0;i>n;n++)for(o=0;t>o;o++)e=n*u+o,h=n*u+o+1,s=(n+1)*u+o,a=(n+1)*u+o+1,d=new $i_90.UV(o/t,n/i),f=new $i_90.UV((o+1)/t,n/i),p=new $i_90.UV(o/t,(n+1)/i),m=new $i_90.UV((o+1)/t,(n+1)/i),r?(l.push(new $i_90.Face3(e,h,s)),l.push(new $i_90.Face3(h,a,s)),c.push([d,f,p]),c.push([f,m,p])):(l.push(new $i_90.Face4(e,h,a,s)),c.push([d,f,m,p]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},$i_90.ParametricGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.ConvexGeometry=function(e){function t(e){var t=e.length();return new $i_90.UV(e.x/t,e.y/t)}$i_90.Geometry.call(this);for(var i=[[0,1,2],[0,2,1]],r=3;e.length>r;r++){var n=r,o=e[n].clone(),a=o.length();o.x=o.x+a*(Math.random()-.5)*2e-6,o.y=o.y+a*(Math.random()-.5)*2e-6,o.z=o.z+a*(Math.random()-.5)*2e-6;for(var a=[],s=0;i.length>s;){var h,l=i[s],c=o,u=e[l[0]];h=u;var d=e[l[1]],f=e[l[2]],p=new $i_90.Vector3,m=new $i_90.Vector3;if(p.sub(f,d),m.sub(h,d),p.crossSelf(m),p.isZero()||p.normalize(),h=p,u=h.dot(u),u>h.dot(c))s++;else{for(c=0;3>c;c++){for(u=[l[c],l[(c+1)%3]],h=!0,d=0;a.length>d;d++)if(a[d][0]===u[1]&&a[d][1]===u[0]){a[d]=a[a.length-1],a.pop(),h=!1;break}h&&a.push(u)}i[s]=i[i.length-1],i.pop()}}for(d=0;a.length>d;d++)i.push([a[d][0],a[d][1],n])}for(n=0,o=Array(e.length),r=0;i.length>r;r++)for(a=i[r],s=0;3>s;s++)o[a[s]]===void 0&&(o[a[s]]=n++,this.vertices.push(e[a[s]])),a[s]=o[a[s]];for(r=0;i.length>r;r++)this.faces.push(new $i_90.Face3(i[r][0],i[r][1],i[r][2]));for(r=0;this.faces.length>r;r++)a=this.faces[r],this.faceVertexUvs[0].push([t(this.vertices[a.a]),t(this.vertices[a.b]),t(this.vertices[a.c])]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},$i_90.ConvexGeometry.prototype=Object.create($i_90.Geometry.prototype),$i_90.AxisHelper=function(e){var t=new $i_90.Geometry;t.vertices.push(new $i_90.Vector3,new $i_90.Vector3(e||1,0,0),new $i_90.Vector3,new $i_90.Vector3(0,e||1,0),new $i_90.Vector3,new $i_90.Vector3(0,0,e||1)),t.colors.push(new $i_90.Color(16711680),new $i_90.Color(16755200),new $i_90.Color(65280),new $i_90.Color(11206400),new $i_90.Color(255),new $i_90.Color(43775)),e=new $i_90.LineBasicMaterial({vertexColors:$i_90.VertexColors}),$i_90.Line.call(this,t,e,$i_90.LinePieces)},$i_90.AxisHelper.prototype=Object.create($i_90.Line.prototype),$i_90.ArrowHelper=function(e,t,i,r){$i_90.Object3D.call(this),r===void 0&&(r=16776960),i===void 0&&(i=20);var n=new $i_90.Geometry;n.vertices.push(new $i_90.Vector3(0,0,0)),n.vertices.push(new $i_90.Vector3(0,1,0)),this.line=new $i_90.Line(n,new $i_90.LineBasicMaterial({color:r})),this.add(this.line),n=new $i_90.CylinderGeometry(0,.05,.25,5,1),this.cone=new $i_90.Mesh(n,new $i_90.MeshBasicMaterial({color:r})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof $i_90.Vector3&&(this.position=t),this.setDirection(e),this.setLength(i)},$i_90.ArrowHelper.prototype=Object.create($i_90.Object3D.prototype),$i_90.ArrowHelper.prototype.setDirection=function(e){var t=new $i_90.Vector3(0,1,0).crossSelf(e),e=Math.acos(new $i_90.Vector3(0,1,0).dot(e.clone().normalize()));this.matrix=(new $i_90.Matrix4).makeRotationAxis(t.normalize(),e),this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},$i_90.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},$i_90.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},$i_90.CameraHelper=function(e){function t(e,t,r){i(e,r),i(t,r)}function i(e,t){r.geometry.vertices.push(new $i_90.Vector3),r.geometry.colors.push(new $i_90.Color(t)),r.pointMap[e]===void 0&&(r.pointMap[e]=[]),r.pointMap[e].push(r.geometry.vertices.length-1)}$i_90.Line.call(this);var r=this;this.geometry=new $i_90.Geometry,this.material=new $i_90.LineBasicMaterial({color:16777215,vertexColors:$i_90.FaceColors}),this.type=$i_90.LinePieces,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap={},t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),this.camera=e,this.update(e)},$i_90.CameraHelper.prototype=Object.create($i_90.Line.prototype),$i_90.CameraHelper.prototype.update=function(){function e(e,i,r,n){if($i_90.CameraHelper.__v.set(i,r,n),$i_90.CameraHelper.__projector.unprojectVector($i_90.CameraHelper.__v,$i_90.CameraHelper.__c),e=t.pointMap[e],e!==void 0)for(i=0,r=e.length;r>i;i++)t.geometry.vertices[e[i]].copy($i_90.CameraHelper.__v)}var t=this;$i_90.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0},$i_90.CameraHelper.__projector=new $i_90.Projector,$i_90.CameraHelper.__v=new $i_90.Vector3,$i_90.CameraHelper.__c=new $i_90.Camera,$i_90.SubdivisionModifier=function(e){this.subdivisions=e===void 0?1:e,this.useOldVertexColors=!1,this.supportUVs=!0,this.debug=!1},$i_90.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-->0;)this.smooth(e)},$i_90.GeometryUtils.orderedKey=function(e,t){return Math.min(e,t)+"_"+Math.max(e,t)},$i_90.GeometryUtils.computeEdgeFaces=function(e){function t(e,t){a[e]===void 0&&(a[e]=[]),a[e].push(t)}var i,r,n,o,a={},s=$i_90.GeometryUtils.orderedKey;for(i=0,r=e.faces.length;r>i;i++)n=e.faces[i],n instanceof $i_90.Face3?(o=s(n.a,n.b),t(o,i),o=s(n.b,n.c),t(o,i),o=s(n.c,n.a),t(o,i)):n instanceof $i_90.Face4&&(o=s(n.a,n.b),t(o,i),o=s(n.b,n.c),t(o,i),o=s(n.c,n.d),t(o,i),o=s(n.d,n.a),t(o,i));return a},$i_90.SubdivisionModifier.prototype.smooth=function(e){function t(){E.debug&&console&&console.assert&&console.assert.apply(console,arguments)}function i(){E.debug&&console.log.apply(console,arguments)}function r(){console&&console.log.apply(console,arguments)}function n(e,t,r,n,a,s,h){var l=new $i_90.Face4(e,t,r,n,null,a.color,a.materialIndex);if(E.useOldVertexColors){l.vertexColors=[];for(var c,u,d,f=0;4>f;f++){d=s[f],c=new $i_90.Color,c.setRGB(0,0,0);for(var g=0;d.length>g;g++)u=a.vertexColors[d[g]-1],c.r=c.r+u.r,c.g=c.g+u.g,c.b=c.b+u.b;c.r=c.r/d.length,c.g=c.g/d.length,c.b=c.b/d.length,l.vertexColors[f]=c}}p.push(l),E.supportUVs&&(a=[o(e,""),o(t,h),o(r,h),o(n,h)],a[0]?a[1]?a[2]?a[3]?m.push(a):i("d :( ",n+":"+h):i("c :( ",r+":"+h):i("b :( ",t+":"+h):i("a :( ",e+":"+h))}function o(e,t){var n=e+":"+t,o=w[n];return o?o:(e>=T&&T+_.length>e?i("face pt"):i("edge pt"),r("warning, UV not found for",n),null)}function a(e,t,i){var n=e+":"+t;n in w?r("dup vertexNo",e,"oldFaceNo",t,"value",i,"key",n,w[n]):w[n]=i}var s,h,l,c,u,d,f=[],p=[],m=[],E=this,g=$i_90.GeometryUtils.orderedKey,v=$i_90.GeometryUtils.computeEdgeFaces,y=e.vertices,_=e.faces,T=y.length,f=y.concat(),x=[],R={},b={},w={},H=e.faceVertexUvs[0];if(i("originalFaces, uvs, originalVerticesLength",_.length,H.length,T),E.supportUVs)for(s=0,h=H.length;h>s;s++)for(l=0,c=H[s].length;c>l;l++)d=_[s]["abcd".charAt(l)],a(d,s,H[s][l]);H.length==0&&(E.supportUVs=!1),s=0;for(var S in w)s++;for(s||(E.supportUVs=!1,i("no uvs")),s=0,h=_.length;h>s;s++)u=_[s],x.push(u.centroid),f.push(u.centroid),E.supportUVs&&(c=new $i_90.UV,u instanceof $i_90.Face3?(c.u=o(u.a,s).u+o(u.b,s).u+o(u.c,s).u,c.v=o(u.a,s).v+o(u.b,s).v+o(u.c,s).v,c.u=c.u/3,c.v=c.v/3):u instanceof $i_90.Face4&&(c.u=o(u.a,s).u+o(u.b,s).u+o(u.c,s).u+o(u.d,s).u,c.v=o(u.a,s).v+o(u.b,s).v+o(u.c,s).v+o(u.d,s).v,c.u=c.u/4,c.v=c.v/4),a(T+s,"",c));var M,v=v(e);h=0;var C,A;S={},H={};for(s in v){for(d=v[s],C=s.split("_"),A=C[0],C=C[1],l=A,u=[A,C],S[l]===void 0&&(S[l]=[]),S[l].push(u),l=C,u=[A,C],S[l]===void 0&&(S[l]=[]),S[l].push(u),l=0,c=d.length;c>l;l++){u=d[l],M=A;var P=u,L=s;H[M]===void 0&&(H[M]={}),H[M][P]=L,M=C,P=s,H[M]===void 0&&(H[M]={}),H[M][u]=P}2>d.length&&(b[s]=!0)}for(s in v)d=v[s],u=d[0],M=d[1],C=s.split("_"),A=C[0],C=C[1],c=new $i_90.Vector3,t(d.length>0,"an edge without faces?!"),d.length==1?(c.addSelf(y[A]),c.addSelf(y[C]),c.multiplyScalar(.5)):(c.addSelf(x[u]),c.addSelf(x[M]),c.addSelf(y[A]),c.addSelf(y[C]),c.multiplyScalar(.25)),R[s]=T+_.length+h,f.push(c),h++,E.supportUVs&&(c=new $i_90.UV,c.u=o(A,u).u+o(C,u).u,c.v=o(A,u).v+o(C,u).v,c.u=c.u/2,c.v=c.v/2,a(R[s],u,c),2>d.length||(t(d.length==2,"did we plan for more than 2 edges?"),c=new $i_90.UV,c.u=o(A,M).u+o(C,M).u,c.v=o(A,M).v+o(C,M).v,c.u=c.u/2,c.v=c.v/2,a(R[s],M,c)));i("-- Step 2 done");var I,U;c=["123","12","2","23"],M=["123","23","3","31"];var P=["123","31","1","12"],L=["1234","12","2","23"],D=["1234","23","3","34"],F=["1234","34","4","41"],z=["1234","41","1","12"];for(s=0,h=x.length;h>s;s++)u=_[s],d=T+s,u instanceof $i_90.Face3?(A=g(u.a,u.b),C=g(u.b,u.c),I=g(u.c,u.a),n(d,R[A],u.b,R[C],u,c,s),n(d,R[C],u.c,R[I],u,M,s),n(d,R[I],u.a,R[A],u,P,s)):u instanceof $i_90.Face4?(A=g(u.a,u.b),C=g(u.b,u.c),I=g(u.c,u.d),U=g(u.d,u.a),n(d,R[A],u.b,R[C],u,L,s),n(d,R[C],u.c,R[I],u,D,s),n(d,R[I],u.d,R[U],u,F,s),n(d,R[U],u.a,R[A],u,z,s)):i("face should be a face!",u);for(R=new $i_90.Vector3,u=new $i_90.Vector3,s=0,h=y.length;h>s;s++)if(S[s]!==void 0){R.set(0,0,0),u.set(0,0,0),C=new $i_90.Vector3(0,0,0),d=0;for(l in H[s])R.addSelf(x[l]),d++;for(M=0,A=S[s].length,c=d!=A,l=0;A>l;l++)b[g(S[s][l][0],S[s][l][1])]&&M++;if(R.divideScalar(d),M=0,c){for(l=0;A>l;l++)d=S[s][l],(P=v[g(d[0],d[1])].length==1)&&(d=y[d[0]].clone().addSelf(y[d[1]]).divideScalar(2),u.addSelf(d),M++);u.divideScalar(4),t(M==2,"should have only 2 boundary edges")}else{for(l=0;A>l;l++)d=S[s][l],d=y[d[0]].clone().addSelf(y[d[1]]).divideScalar(2),u.addSelf(d);u.divideScalar(A)}C.addSelf(y[s]),c?(C.divideScalar(2),C.addSelf(u)):(C.multiplyScalar(A-3),C.addSelf(R),C.addSelf(u.multiplyScalar(2)),C.divideScalar(A)),f[s]=C}e.vertices=f,e.faces=p,e.faceVertexUvs[0]=m,delete e.__tmpVertices,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals()},$i_90.ImmediateRenderObject=function(){$i_90.Object3D.call(this),this.render=function(){}},$i_90.ImmediateRenderObject.prototype=Object.create($i_90.Object3D.prototype),$i_90.LensFlare=function(e,t,i,r,n){$i_90.Object3D.call(this),this.lensFlares=[],this.positionScreen=new $i_90.Vector3,this.customUpdateCallback=void 0,e!==void 0&&this.add(e,t,i,r,n)},$i_90.LensFlare.prototype=Object.create($i_90.Object3D.prototype),$i_90.LensFlare.prototype.add=function(e,t,i,r,n,o){t===void 0&&(t=-1),i===void 0&&(i=0),o===void 0&&(o=1),n===void 0&&(n=new $i_90.Color(16777215)),r===void 0&&(r=$i_90.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:n,blending:r})},$i_90.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,r=-this.positionScreen.x*2,n=-this.positionScreen.y*2;for(e=0;i>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation=t.rotation+(t.wantedRotation-t.rotation)*.25},$i_90.MorphBlendMesh=function(e,t){$i_90.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length;this.createAnimation("__default",0,i-1,i/1),this.setAnimationWeight("__default",1)},$i_90.MorphBlendMesh.prototype=Object.create($i_90.Mesh.prototype),$i_90.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){t={startFrame:t,endFrame:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},$i_90.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,r={},n=this.geometry,o=0,a=n.morphTargets.length;a>o;o++){var s=n.morphTargets[o].name.match(i);if(s&&s.length>1){var h=s[1];r[h]||(r[h]={start:1/0,end:-1/0}),s=r[h],s.start>o&&(s.start=o),o>s.end&&(s.end=o),t||(t=h)}}for(h in r)s=r[h],this.createAnimation(h,s.start,s.end,e);this.firstAnimation=t},$i_90.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){(e=this.animationsMap[e])&&(e.direction=1,e.directionBackwards=!1)},$i_90.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){(e=this.animationsMap[e])&&(e.direction=-1,e.directionBackwards=!0)},$i_90.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},$i_90.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},$i_90.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},$i_90.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},$i_90.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;return(e=this.animationsMap[e])&&(t=e.time),t},$i_90.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;return(e=this.animationsMap[e])&&(t=e.duration),t},$i_90.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},$i_90.MorphBlendMesh.prototype.stopAnimation=function(e){(e=this.animationsMap[e])&&(e.active=!1)},$i_90.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;i>t;t++){var r=this.animationsList[t];if(r.active){var n=r.duration/r.length;r.time=r.time+r.direction*e,r.mirroredLoop?(r.time>r.duration||0>r.time)&&(r.direction=r.direction*-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),0>r.time&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,0>r.time&&(r.time=r.time+r.duration));var o=r.startFrame+$i_90.Math.clamp(Math.floor(r.time/n),0,r.length-1),a=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o),n=r.time%n/n,r.directionBackwards&&(n=1-n),this.morphTargetInfluences[r.currentFrame]=n*a,this.morphTargetInfluences[r.lastFrame]=(1-n)*a}}},$i_90.LensFlarePlugin=function(){function e(e){var i=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),n=t.createShader(t.VERTEX_SHADER);return t.shaderSource(r,e.fragmentShader),t.shaderSource(n,e.vertexShader),t.compileShader(r),t.compileShader(n),t.attachShader(i,r),t.attachShader(i,n),t.linkProgram(i),i}var t,i,r,n,o,a,s,h,l,c,u,d,f;this.init=function(p){t=p.context,i=p,r=new Float32Array(16),n=new Uint16Array(6),p=0,r[p++]=-1,r[p++]=-1,r[p++]=0,r[p++]=0,r[p++]=1,r[p++]=-1,r[p++]=1,r[p++]=0,r[p++]=1,r[p++]=1,r[p++]=1,r[p++]=1,r[p++]=-1,r[p++]=1,r[p++]=0,r[p++]=1,p=0,n[p++]=0,n[p++]=1,n[p++]=2,n[p++]=0,n[p++]=2,n[p++]=3,o=t.createBuffer(),a=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW),s=t.createTexture(),h=t.createTexture(),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0?(l=!0,c=e($i_90.ShaderFlares.lensFlareVertexTexture)):(l=!1,c=e($i_90.ShaderFlares.lensFlare)),u={},d={},u.vertex=t.getAttribLocation(c,"position"),u.uv=t.getAttribLocation(c,"uv"),d.renderType=t.getUniformLocation(c,"renderType"),d.map=t.getUniformLocation(c,"map"),d.occlusionMap=t.getUniformLocation(c,"occlusionMap"),d.opacity=t.getUniformLocation(c,"opacity"),d.color=t.getUniformLocation(c,"color"),d.scale=t.getUniformLocation(c,"scale"),d.rotation=t.getUniformLocation(c,"rotation"),d.screenPosition=t.getUniformLocation(c,"screenPosition"),f=!1
},this.render=function(e,r,n,p){var e=e.__webglFlares,m=e.length;if(m){var E=new $i_90.Vector3,g=p/n,v=n*.5,y=p*.5,_=16/p,T=new $i_90.Vector2(_*g,_),x=new $i_90.Vector3(1,1,0),R=new $i_90.Vector2(1,1),b=d,_=u;t.useProgram(c),f||(t.enableVertexAttribArray(u.vertex),t.enableVertexAttribArray(u.uv),f=!0),t.uniform1i(b.occlusionMap,0),t.uniform1i(b.map,1),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(_.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(_.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.disable(t.CULL_FACE),t.depthMask(!1);var w,H,S,M,C;for(w=0;m>w;w++)if(_=16/p,T.set(_*g,_),M=e[w],E.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),r.matrixWorldInverse.multiplyVector3(E),r.projectionMatrix.multiplyVector3(E),x.copy(E),R.x=x.x*v+v,R.y=x.y*y+y,l||R.x>0&&n>R.x&&R.y>0&&p>R.y)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,R.x-8,R.y-8,16,16,0),t.uniform1i(b.renderType,0),t.uniform2f(b.scale,T.x,T.y),t.uniform3f(b.screenPosition,x.x,x.y,x.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,R.x-8,R.y-8,16,16,0),t.uniform1i(b.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),M.positionScreen.copy(x),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),t.uniform1i(b.renderType,2),t.enable(t.BLEND),H=0,S=M.lensFlares.length;S>H;H++)C=M.lensFlares[H],C.opacity>.001&&C.scale>.001&&(x.x=C.x,x.y=C.y,x.z=C.z,_=C.size*C.scale/p,T.x=_*g,T.y=_,t.uniform3f(b.screenPosition,x.x,x.y,x.z),t.uniform2f(b.scale,T.x,T.y),t.uniform1f(b.rotation,C.rotation),t.uniform1f(b.opacity,C.opacity),t.uniform3f(b.color,C.color.r,C.color.g,C.color.b),i.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),i.setTexture(C.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},$i_90.ShadowMapPlugin=function(){var e,t,i,r,n,o,a=new $i_90.Frustum,s=new $i_90.Matrix4,h=new $i_90.Vector3,l=new $i_90.Vector3;this.init=function(a){e=a.context,t=a;var a=$i_90.ShaderLib.depthRGBA,s=$i_90.UniformsUtils.clone(a.uniforms);i=new $i_90.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s}),r=new $i_90.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,morphTargets:!0}),n=new $i_90.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,skinning:!0}),o=new $i_90.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,morphTargets:!0,skinning:!0}),i._shadowPass=!0,r._shadowPass=!0,n._shadowPass=!0,o._shadowPass=!0},this.render=function(e,i){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,i)},this.update=function(c,u){var d,f,p,m,E,g,v,y,_,T=[];for(m=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFrontFaces?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),d=0,f=c.__lights.length;f>d;d++)if(p=c.__lights[d],p.castShadow)if(p instanceof $i_90.DirectionalLight&&p.shadowCascade)for(E=0;p.shadowCascadeCount>E;E++){var x;if(p.shadowCascadeArray[E])x=p.shadowCascadeArray[E];else{_=p,v=E,x=new $i_90.DirectionalLight,x.isVirtual=!0,x.onlyShadow=!0,x.castShadow=!0,x.shadowCameraNear=_.shadowCameraNear,x.shadowCameraFar=_.shadowCameraFar,x.shadowCameraLeft=_.shadowCameraLeft,x.shadowCameraRight=_.shadowCameraRight,x.shadowCameraBottom=_.shadowCameraBottom,x.shadowCameraTop=_.shadowCameraTop,x.shadowCameraVisible=_.shadowCameraVisible,x.shadowDarkness=_.shadowDarkness,x.shadowBias=_.shadowCascadeBias[v],x.shadowMapWidth=_.shadowCascadeWidth[v],x.shadowMapHeight=_.shadowCascadeHeight[v],x.pointsWorld=[],x.pointsFrustum=[],y=x.pointsWorld,g=x.pointsFrustum;for(var R=0;8>R;R++)y[R]=new $i_90.Vector3,g[R]=new $i_90.Vector3;y=_.shadowCascadeNearZ[v],_=_.shadowCascadeFarZ[v],g[0].set(-1,-1,y),g[1].set(1,-1,y),g[2].set(-1,1,y),g[3].set(1,1,y),g[4].set(-1,-1,_),g[5].set(1,-1,_),g[6].set(-1,1,_),g[7].set(1,1,_),x.originalCamera=u,g=new $i_90.Gyroscope,g.position=p.shadowCascadeOffset,g.add(x),g.add(x.target),u.add(g),p.shadowCascadeArray[E]=x,console.log("Created virtualLight",x)}v=p,y=E,_=v.shadowCascadeArray[y],_.position.copy(v.position),_.target.position.copy(v.target.position),_.lookAt(_.target),_.shadowCameraVisible=v.shadowCameraVisible,_.shadowDarkness=v.shadowDarkness,_.shadowBias=v.shadowCascadeBias[y],g=v.shadowCascadeNearZ[y],v=v.shadowCascadeFarZ[y],_=_.pointsFrustum,_[0].z=g,_[1].z=g,_[2].z=g,_[3].z=g,_[4].z=v,_[5].z=v,_[6].z=v,_[7].z=v,T[m]=x,m++}else T[m]=p,m++;for(d=0,f=T.length;f>d;d++){if(p=T[d],p.shadowMap||(p.shadowMap=new $i_90.WebGLRenderTarget(p.shadowMapWidth,p.shadowMapHeight,{minFilter:$i_90.LinearFilter,magFilter:$i_90.LinearFilter,format:$i_90.RGBAFormat}),p.shadowMapSize=new $i_90.Vector2(p.shadowMapWidth,p.shadowMapHeight),p.shadowMatrix=new $i_90.Matrix4),!p.shadowCamera){if(p instanceof $i_90.SpotLight)p.shadowCamera=new $i_90.PerspectiveCamera(p.shadowCameraFov,p.shadowMapWidth/p.shadowMapHeight,p.shadowCameraNear,p.shadowCameraFar);else{if(!(p instanceof $i_90.DirectionalLight)){console.error("Unsupported light type for shadow");continue}p.shadowCamera=new $i_90.OrthographicCamera(p.shadowCameraLeft,p.shadowCameraRight,p.shadowCameraTop,p.shadowCameraBottom,p.shadowCameraNear,p.shadowCameraFar)}c.add(p.shadowCamera),t.autoUpdateScene&&c.updateMatrixWorld()}if(p.shadowCameraVisible&&!p.cameraHelper&&(p.cameraHelper=new $i_90.CameraHelper(p.shadowCamera),p.shadowCamera.add(p.cameraHelper)),p.isVirtual&&x.originalCamera==u){for(E=u,m=p.shadowCamera,g=p.pointsFrustum,_=p.pointsWorld,h.set(1/0,1/0,1/0),l.set(-1/0,-1/0,-1/0),v=0;8>v;v++)y=_[v],y.copy(g[v]),$i_90.ShadowMapPlugin.__projector.unprojectVector(y,E),m.matrixWorldInverse.multiplyVector3(y),h.x>y.x&&(h.x=y.x),y.x>l.x&&(l.x=y.x),h.y>y.y&&(h.y=y.y),y.y>l.y&&(l.y=y.y),h.z>y.z&&(h.z=y.z),y.z>l.z&&(l.z=y.z);m.left=h.x,m.right=l.x,m.top=l.y,m.bottom=h.y,m.updateProjectionMatrix()}for(m=p.shadowMap,g=p.shadowMatrix,E=p.shadowCamera,E.position.copy(p.matrixWorld.getPosition()),E.lookAt(p.target.matrixWorld.getPosition()),E.updateMatrixWorld(),E.matrixWorldInverse.getInverse(E.matrixWorld),p.cameraHelper&&(p.cameraHelper.visible=p.shadowCameraVisible),p.shadowCameraVisible&&p.cameraHelper.update(),g.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),g.multiplySelf(E.projectionMatrix),g.multiplySelf(E.matrixWorldInverse),E._viewMatrixArray||(E._viewMatrixArray=new Float32Array(16)),E._projectionMatrixArray||(E._projectionMatrixArray=new Float32Array(16)),E.matrixWorldInverse.flattenToArray(E._viewMatrixArray),E.projectionMatrix.flattenToArray(E._projectionMatrixArray),s.multiply(E.projectionMatrix,E.matrixWorldInverse),a.setFromMatrix(s),t.setRenderTarget(m),t.clear(),_=c.__webglObjects,p=0,m=_.length;m>p;p++)v=_[p],g=v.object,v.render=!1,!g.visible||!g.castShadow||g instanceof $i_90.Mesh&&g.frustumCulled&&!a.contains(g)||(g._modelViewMatrix.multiply(E.matrixWorldInverse,g.matrixWorld),v.render=!0);for(p=0,m=_.length;m>p;p++)v=_[p],v.render&&(g=v.object,v=v.buffer,R=g.material instanceof $i_90.MeshFaceMaterial?g.geometry.materials[0]:g.material,y=g.geometry.morphTargets.length>0&&R.morphTargets,R=g instanceof $i_90.SkinnedMesh&&R.skinning,y=g.customDepthMaterial?g.customDepthMaterial:R?y?o:n:y?r:i,v instanceof $i_90.BufferGeometry?t.renderBufferDirect(E,c.__lights,null,y,v,g):t.renderBuffer(E,c.__lights,null,y,v,g));for(_=c.__webglObjectsImmediate,p=0,m=_.length;m>p;p++)v=_[p],g=v.object,g.visible&&g.castShadow&&(g._modelViewMatrix.multiply(E.matrixWorldInverse,g.matrixWorld),t.renderImmediateObject(E,c.__lights,null,i,g))}d=t.getClearColor(),f=t.getClearAlpha(),e.clearColor(d.r,d.g,d.b,f),e.enable(e.BLEND),t.shadowMapCullFrontFaces&&e.cullFace(e.BACK)}},$i_90.ShadowMapPlugin.__projector=new $i_90.Projector,$i_90.SpritePlugin=function(){function e(e,t){return t.z-e.z}var t,i,r,n,o,a,s,h,l,c;this.init=function(e){t=e.context,i=e,r=new Float32Array(16),n=new Uint16Array(6),e=0,r[e++]=-1,r[e++]=-1,r[e++]=0,r[e++]=0,r[e++]=1,r[e++]=-1,r[e++]=1,r[e++]=0,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=-1,r[e++]=1,r[e++]=0,r[e++]=1,e=0,n[e++]=0,n[e++]=1,n[e++]=2,n[e++]=0,n[e++]=2,n[e++]=3,o=t.createBuffer(),a=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW);var e=$i_90.ShaderSprite.sprite,u=t.createProgram(),d=t.createShader(t.FRAGMENT_SHADER),f=t.createShader(t.VERTEX_SHADER);t.shaderSource(d,e.fragmentShader),t.shaderSource(f,e.vertexShader),t.compileShader(d),t.compileShader(f),t.attachShader(u,d),t.attachShader(u,f),t.linkProgram(u),s=u,h={},l={},h.position=t.getAttribLocation(s,"position"),h.uv=t.getAttribLocation(s,"uv"),l.uvOffset=t.getUniformLocation(s,"uvOffset"),l.uvScale=t.getUniformLocation(s,"uvScale"),l.rotation=t.getUniformLocation(s,"rotation"),l.scale=t.getUniformLocation(s,"scale"),l.alignment=t.getUniformLocation(s,"alignment"),l.color=t.getUniformLocation(s,"color"),l.map=t.getUniformLocation(s,"map"),l.opacity=t.getUniformLocation(s,"opacity"),l.useScreenCoordinates=t.getUniformLocation(s,"useScreenCoordinates"),l.affectedByDistance=t.getUniformLocation(s,"affectedByDistance"),l.screenPosition=t.getUniformLocation(s,"screenPosition"),l.modelViewMatrix=t.getUniformLocation(s,"modelViewMatrix"),l.projectionMatrix=t.getUniformLocation(s,"projectionMatrix"),c=!1},this.render=function(r,n,u,d){var r=r.__webglSprites,f=r.length;if(f){var p=h,m=l,E=d/u,u=u*.5,g=d*.5,v=!0;t.useProgram(s),c||(t.enableVertexAttribArray(p.position),t.enableVertexAttribArray(p.uv),c=!0),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.depthMask(!0),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(p.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(p.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.uniformMatrix4fv(m.projectionMatrix,!1,n._projectionMatrixArray),t.activeTexture(t.TEXTURE0),t.uniform1i(m.map,0);for(var y,_=[],p=0;f>p;p++)y=r[p],y.visible&&y.opacity!==0&&(y.useScreenCoordinates?y.z=-y.position.z:(y._modelViewMatrix.multiply(n.matrixWorldInverse,y.matrixWorld),y.z=-y._modelViewMatrix.elements[14]));for(r.sort(e),p=0;f>p;p++)y=r[p],y.visible&&y.opacity!==0&&y.map&&y.map.image&&y.map.image.width&&(y.useScreenCoordinates?(t.uniform1i(m.useScreenCoordinates,1),t.uniform3f(m.screenPosition,(y.position.x-u)/u,(g-y.position.y)/g,Math.max(0,Math.min(1,y.position.z)))):(t.uniform1i(m.useScreenCoordinates,0),t.uniform1i(m.affectedByDistance,y.affectedByDistance?1:0),t.uniformMatrix4fv(m.modelViewMatrix,!1,y._modelViewMatrix.elements)),n=y.map.image.width/(y.scaleByViewport?d:1),_[0]=n*E*y.scale.x,_[1]=n*y.scale.y,t.uniform2f(m.uvScale,y.uvScale.x,y.uvScale.y),t.uniform2f(m.uvOffset,y.uvOffset.x,y.uvOffset.y),t.uniform2f(m.alignment,y.alignment.x,y.alignment.y),t.uniform1f(m.opacity,y.opacity),t.uniform3f(m.color,y.color.r,y.color.g,y.color.b),t.uniform1f(m.rotation,y.rotation),t.uniform2fv(m.scale,_),y.mergeWith3D&&!v?(t.enable(t.DEPTH_TEST),v=!0):!y.mergeWith3D&&v&&(t.disable(t.DEPTH_TEST),v=!1),i.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst),i.setTexture(y.map,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},$i_90.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,i,r,n=new $i_90.Frustum,o=new $i_90.Matrix4;this.init=function(n){e=n.context,t=n;var n=$i_90.ShaderLib.depthRGBA,o=$i_90.UniformsUtils.clone(n.uniforms);i=new $i_90.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o}),r=new $i_90.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o,morphTargets:!0}),i._shadowPass=!0,r._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(a,s){var h,l,c,u,d,f;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),t.autoUpdateScene&&a.updateMatrixWorld(),s._viewMatrixArray||(s._viewMatrixArray=new Float32Array(16)),s._projectionMatrixArray||(s._projectionMatrixArray=new Float32Array(16)),s.matrixWorldInverse.getInverse(s.matrixWorld),s.matrixWorldInverse.flattenToArray(s._viewMatrixArray),s.projectionMatrix.flattenToArray(s._projectionMatrixArray),o.multiply(s.projectionMatrix,s.matrixWorldInverse),n.setFromMatrix(o),t.setRenderTarget(this.renderTarget),t.clear(),f=a.__webglObjects,h=0,l=f.length;l>h;h++)c=f[h],d=c.object,c.render=!1,!d.visible||d instanceof $i_90.Mesh&&d.frustumCulled&&!n.contains(d)||(d._modelViewMatrix.multiply(s.matrixWorldInverse,d.matrixWorld),c.render=!0);for(h=0,l=f.length;l>h;h++)c=f[h],c.render&&(d=c.object,c=c.buffer,d.material&&t.setMaterialFaces(d.material),u=d.customDepthMaterial?d.customDepthMaterial:d.geometry.morphTargets.length?r:i,c instanceof $i_90.BufferGeometry?t.renderBufferDirect(s,a.__lights,null,u,c,d):t.renderBuffer(s,a.__lights,null,u,c,d));for(f=a.__webglObjectsImmediate,h=0,l=f.length;l>h;h++)c=f[h],d=c.object,d.visible&&d.castShadow&&(d._modelViewMatrix.multiply(s.matrixWorldInverse,d.matrixWorld),t.renderImmediateObject(s,a.__lights,null,i,d));h=t.getClearColor(),l=t.getClearAlpha(),e.clearColor(h.r,h.g,h.b,l),e.enable(e.BLEND)}},$i_90.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},$i_90.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}};var $i_91=$i_3.extend({classId:"$i_91",componentId:"three",init:function(e,t){this._entity=e,this._options=t,this._loader=new $i_90.JSONLoader,this._geometryLoader=new $i_90.GeometryLoader,$i_92.prototype._frontBufferSetup=this.$i_92_frontBufferSetup,$i_53.prototype._transformContext=this.$i_53_transformContext,$i_53.prototype._renderEntity=this.$i_53_renderEntity,$i_53.prototype.material=this.$i_53_material,$i_53.prototype.model=this.$i_53_model,$i_53.prototype.mesh=this.$i_53_mesh,$i_53.prototype._$mount=$i_53.prototype.mount,$i_53.prototype.mount=this.$i_53_mount,$i_53.prototype._$unMount=$i_53.prototype.unMount,$i_53.prototype.unMount=this.$i_53_unMount,$i_64.prototype._$init=$i_64.prototype.init,$i_64.prototype.init=this.$i_64_init,$i_62.prototype._$init=$i_62.prototype.init,$i_62.prototype.init=this.$i_62_init,$i_62.prototype.tick=this.$i_62_tick,$i_63.prototype.tick=this.$i_63_tick},$i_62_init:function(e){this._$init(e),this._threeObj=new $i_90.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.01,1e4)},$i_62_tick:function(){if(this._trackTranslateTarget){var e,t,i,r,n=this._trackTranslateTarget,o=n._translate.x,a=n._translate.y;this._trackTranslateSmoothing?(e=this._translate.x,t=this._translate.y,i=o-e,r=a-t,this._translate.x+=i/this._trackTranslateSmoothing,this._translate.y+=r/this._trackTranslateSmoothing):this.lookAt(this._trackTranslateTarget)}if(this._trackRotateTarget){var s,h,l=this._trackRotateTarget._parent!==void 0?this._trackRotateTarget._parent._rotate.z:0,c=-(l+this._trackRotateTarget._rotate.z);this._trackRotateSmoothing?(s=this._rotate.z,h=c-s,this._rotate.z+=h/this._trackRotateSmoothing):this._rotate.z=c}this._threeObj.position.x=this._translate.x,this._threeObj.position.y=-this._translate.y,this._threeObj.position.z=this._translate.z,this._threeObj.rotation.x=this._rotate.x,this._threeObj.rotation.y=this._rotate.y,this._threeObj.rotation.z=this._rotate.z},$i_63_tick:function(e,t){this._scene&&(ige._currentCamera=this.camera,ige._currentViewport=this,this._scene._parent=this,$i_53.prototype.tick.apply(this,[e]),this.camera.tick(e),this._scene.tick(e,t),ige._threeRenderer.clear(),ige._threeRenderer.render(this._scene._threeObj,this.camera._threeObj))},$i_64_init:function(e){this._$init(e),this._threeObj=new $i_90.Scene;var t=new $i_90.AmbientLight(2368548);this._threeObj.add(t);var i=new $i_90.SpotLight(14082815,1,0,Math.PI,1);i.position.set(600,400,1e3),i.target.position.set(0,0,0),i.castShadow=!0,i.shadowCameraNear=200,i.shadowCameraFar=1800,i.shadowCameraFov=45,i.shadowBias=5e-4,i.shadowDarkness=.55,i.shadowMapWidth=2048,i.shadowMapHeight=2048,i.shadowMapSoft=!0,this._threeObj.add(i)},$i_92_frontBufferSetup:function(){this._threeRenderer=new $i_90.WebGLRenderer({antialias:!1}),this._threeRenderer.setSize(window.innerWidth,window.innerHeight),this._threeRenderer.autoClear=!1,this.three._canvas=this._threeRenderer.domElement,document.body.appendChild(this.three._canvas),ige._geometry=new $i_5(this.three._canvas.width,this.three._canvas.height,0)},$i_53_transformContext:function(){},$i_53_renderEntity:function(){var e=this._threeObj;e&&(e.position&&(e.position.x=this._translate.x,e.position.y=-this._translate.y,e.position.z=this._translate.z),e.rotation&&(e.rotation.x=this._rotate.x,e.rotation.y=this._rotate.y,e.rotation.z=-this._rotate.z),e.scale&&(e.scale.x=this._scale.x,e.scale.y=this._scale.y,e.scale.z=this._scale.z))},$i_53_material:function(e){return e!==void 0?(this._material=e,this):this._material},$i_53_model:function(e){return e!==void 0?(ige.three._geometryLoader.path="./models",this._threeObj=new $i_90.Mesh(ige.three._geometryLoader.parse(e),this._material||new $i_90.MeshFaceMaterial),this._threeObj.receiveShadow=!0,this._threeObj.castShadow=!0,this):this._threeObj},$i_53_mesh:function(e){return e!==void 0?(this._threeObj=new $i_90.Mesh(e,this._material||new $i_90.MeshBasicMaterial({color:255,wireframe:!0})),this):this._threeObj},$i_53_mount:function(e){return this._threeObj&&(e._threeObj.add(this._threeObj),this._threeObj._igeEntity=this),this._$mount(e)},$i_53_unMount:function(){return this._threeObj&&(delete this._threeObj._igeEntity,this._parent._threeObj.remove(this._threeObj)),this._$unMount()}}),$i_92=$i_53.extend({classId:"$i_92",init:function(){this._alwaysInView=!0,this._super(),this._id="ige",this.basePath="",this.isServer=typeof module!="undefined"&&module.exports!==void 0,ige=this,console.log("------------------------------------------------------------------------------"),console.log("* Powered by the Isogenic Game Engine "+igeVersion+"                                  *"),console.log("* (C)opyright 2012 Irrelon Software Limited                                  *"),console.log("* http://www.isogenicengine.com                                              *"),console.log("------------------------------------------------------------------------------"),this._super(),this.isServer||this.addComponent($i_39),this._textureStore=[],this._idCounter=(new Date).getTime(),this.addComponent($i_14),this.addComponent($i_12),this._renderModes=["2d","three"],this._renderContext="2d",this._renderMode=this._renderModes[this._renderContext],this._tickTime="NA",this._tickDelta=0,this._fpsRate=60,this._state=0,this._textureImageStore={},this._texturesLoading=0,this._texturesTotal=0,this._dependencyQueue=[],this._drawCount=0,this._dps=0,this._frames=0,this._fps=0,this._clientNetDiff=0,this._frameAlternator=!1,this._viewportDepth=!1,this._mousePos=new $i_5(0,0,0),this._currentViewport=null,this._currentCamera=null,this._currentTime=0,this._globalSmoothing=!1,this._register={ige:this},this._postTick=[],this._tsit={},this._tslt={},this._timeScale=1,this._ctx=$i_44,this._headless=!0,this.dependencyTimeout(3e4),this._dependencyQueue.push(this.texturesLoaded),setInterval(this._secondTick,1e3)},$:function(e){return typeof e=="string"?this._register[e]:typeof e=="object"?e:this},$$:function(){},register:function(e){return e!==void 0?this._register[e.id()]?(e._registered=!1,this.log('Cannot add object id "'+e.id()+'" to scenegraph because there is already another object in the graph with the same ID!',"error"),!1):(this._register[e.id()]=e,e._registered=!0,this):this._register},unRegister:function(e){return e!==void 0&&this._register[e.id()]&&(delete this._register[e.id()],e._registered=!1),this},setFps:function(e){e!==void 0&&(this.isServer?requestAnimFrame=function(t){setTimeout(function(){t((new Date).getTime())},1e3/e)}:window.requestAnimFrame=function(t){setTimeout(function(){t((new Date).getTime())},1e3/e)})},showStats:function(e,t){if(e!==void 0){switch(e){case 0:clearInterval(this._statsTimer),this._removeStatsDiv();break;case 1:this._createStatsDiv(),t!==void 0?this._statsInterval=t:this._statsInterval===void 0&&(this._statsInterval=16),this._statsTimer=setInterval(this._statsTick,this._statsInterval)}return this._showStats=e,this}return this._showStats},_createStatsDiv:function(){if(!ige.isServer&&!document.getElementById("igeStats")){var e=document.createElement("div");e.id="igeStatsFloater",e.className="igeStatsFloater",e.style.fontFamily="Verdana, Tahoma",e.style.fontSize="12px",e.style.position="absolute",e.style.color="#ffffff",e.style.textShadow="1px 1px 3px #000000",e.style.bottom="10px",e.style.left="10px",e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.MozkitUserSelect="none",e.style.zIndex=1e5,e.innerHTML="Please wait...",document&&document.readyState==="complete"?document.body.appendChild(e):window.addEventListener("load",function(){document.body.appendChild(e)}),window.addEventListener("unload",function(){}),this._statsDiv=e}},_removeStatsDiv:function(){document.body.removeChild(this._statsDiv),delete this._statsDiv},defineClass:function(e,t){igeClassStore[e]=t},getClass:function(e){return igeClassStore[e]},newClassInstance:function(e,t){return new igeClassStore[e](t)},dependencyCheck:function(){var e=this._dependencyQueue,t=e.length;while(t--)if(!this._dependencyQueue[t]())return!1;return!0},viewportDepth:function(e){return e!==void 0?(this._viewportDepth=e,this):this._viewportDepth},dependencyTimeout:function(e){this._dependencyCheckTimeout=e},textureLoadStart:function(e,t){this._texturesLoading++,this._texturesTotal++,this.emit("textureLoadStart",t)},textureLoadEnd:function(e,t){t._destroyed||this._textureStore.push(t),this._texturesLoading--,this.emit("textureLoadEnd",t),this._texturesLoading===0&&this._allTexturesLoaded()},textureFromUrl:function(e){var t,i=this._textureStore,r=i.length;while(r--)if(t=i[r],t._url===e)return t},texturesLoaded:function(){return ige._texturesLoading===0},_allTexturesLoaded:function(){this._loggedATL||(this._loggedATL=!0,this.log("All textures have loaded")),this.emit("texturesLoaded")},globalSmoothing:function(e){return e!==void 0?(this._globalSmoothing=e,this):this._globalSmoothing},canvasReady:function(){return ige._canvas!==void 0||ige.isServer},newId:function(){return this._idCounter++,this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))+""},newIdHex:function(){return this._idCounter++,(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16)},start:function(e){if(!ige._state)if(ige.dependencyCheck())ige.log("Starting engine..."),ige._state=1,requestAnimFrame(ige.tick),ige.log("Engine started"),typeof e=="function"&&e(!0);else{var t=(new Date).getTime();ige._dependencyCheckStart||(ige._dependencyCheckStart=t),t-ige._dependencyCheckStart>this._dependencyCheckTimeout?(this.log("Engine start failed because the dependency check timed out after "+this._dependencyCheckTimeout/1e3+" seconds","error"),typeof e=="function"&&e(!1)):setTimeout(function(){ige.start(e)},200)}},stop:function(){return this._state?(this.log("Stopping engine..."),this._state=0,!0):!1},autoSize:function(e){return e!==void 0?(this._autoSize=e,this):this._autoSize},pixelRatioScaling:function(e){return e!==void 0?(this._pixelRatioScaling=e,this):this._pixelRatioScaling},renderContext:function(e){return e!==void 0?(this._renderContext=e,this._renderMode=this._renderModes[e],this.log("Rendering mode set to: "+e),this):this._renderContext},createFrontBuffer:function(e,t){this.isServer||this._canvas||(this._createdFrontBuffer=!0,this._pixelRatioScaling=!t,this._frontBufferSetup(e,t))},_frontBufferSetup:function(e){var t,i=document.createElement("canvas");this._pixelRatioScaling?(t=i.getContext(ige._renderContext),this._devicePixelRatio=window.devicePixelRatio||1,this._backingStoreRatio=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,this._deviceFinalDrawRatio=this._devicePixelRatio/this._backingStoreRatio):(this._devicePixelRatio=1,this._backingStoreRatio=1,this._deviceFinalDrawRatio=1),i.id="igeFrontBuffer",this.canvas(i,e),document.body.appendChild(i)},canvas:function(e,t){return e!==void 0&&(this._canvas||(this._canvas=e,t&&(this._autoSize=t,window.addEventListener("resize",this._resizeEvent)),this._resizeEvent(),this._ctx=this._canvas.getContext(this._renderContext),this._headless=!1,this.input.setupListeners(this._canvas))),this._canvas},clearCanvas:function(){this._ctx&&this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},removeCanvas:function(){this.input&&this.input.destroyListeners(),this._autoSize&&window.removeEventListener("resize",this._resizeEvent),this._createdFrontBuffer&&document.body.removeChild(this._canvas),delete this._canvas,delete this._ctx,this._ctx=$i_44,this._headless=!0},openUrl:function(e){e!==void 0&&(ige.cocoonJs&&ige.cocoonJs.detected?ige.cocoonJs.openUrl(e):window.open(e))},showWebView:function(e){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.showWebView(e);else{var t=document.getElementById("igeOverlay");t||(t=document.createElement("iframe"),t.id="igeOverlay",t.style.position="absolute",t.style.border="none",t.style.left="0px",t.style.top="0px",t.style.width="100%",t.style.height="100%",document.body.appendChild(t)),e!==void 0&&(t.src=e),t.style.display="block"}return this},hideWebView:function(){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.hideWebView();else{var e=document.getElementById("igeOverlay");e&&(e.style.display="none")}return this},layerCall:function(js){js!==void 0&&eval(js)},mousePos:function(){return this._mousePos},_resizeEvent:function(e){if(ige._autoSize){var t=window.innerWidth,i=window.innerHeight,r=ige._children,n=r.length;ige._canvas&&(t%2&&t--,i%2&&i--,ige._canvas.width=t*ige._deviceFinalDrawRatio,ige._canvas.height=i*ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio!==1&&(ige._canvas.style.width=t+"px",ige._canvas.style.height=i+"px",ige._ctx.scale(ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio))),ige._geometry=new $i_5(t,i,0);while(n--)r[n]._resizeEvent(e)}else ige._canvas&&(ige._geometry=new $i_5(ige._canvas.width,ige._canvas.height,0));ige._resized=!0},watchStart:function(e){return this._watch=this._watch||[],this._watch.push(e),this._watch.length-1},watchStop:function(e){this._watch=this._watch||[],this._watch.splice(e,1)},traceSet:function(e,t){var i=e[t];Object.defineProperty(e,t,{get:function(){return i},set:function(e){i=e}})},traceSetOff:function(e,t){Object.defineProperty(e,t,{set:this.prototype[t]})},_secondTick:function(){var e=ige;e._fps=e._frames,e._dps=e._dpt*e._fps,e._frames=0,e._drawCount=0},_statsTick:function(){var self=ige,i,watchCount,watchItem,itemName,res,html="";if(self._showStats&&!self._statsPauseUpdate)switch(self._showStats){case 1:if(self._watch&&self._watch.length){for(watchCount=self._watch.length,i=0;watchCount>i;i++){if(watchItem=self._watch[i],typeof watchItem=="string"){itemName=watchItem;try{eval("res = "+watchItem)}catch(err){res='<span style="color:#ff0000;">'+err+"</span>"}}else itemName=watchItem.name,res=watchItem.value;
html+=i+' (<a href="javascript:ige.watchStop('+i+'); ige._statsPauseUpdate = false;" style="color:#cccccc;" onmouseover="ige._statsPauseUpdate = true;" onmouseout="ige._statsPauseUpdate = false;">Remove</a>): <span style="color:#7aff80">'+itemName+'</span>: <span style="color:#00c6ff">'+res+"</span><br />"}html+="<br />"}html+='<span class="met" title="Frames Per Second">fps: '+self._fps+'</span> <span class="met" title="Draws Per Second">dps: '+self._dps+'</span> <span class="met" title="Draws Per Tick">dpt: '+self._dpt+'</span> <span class="met" title="Time Spent Processing Tick">tps: '+self._tickTime+"ms</span>",self.network&&(html+=' <span class="met" title="Network Latency (Time From Server to This Client)">lat: '+self.network._latency+"ms</span>"),self._statsDiv.innerHTML=html}},timeScale:function(e){return e!==void 0?(this._timeScale=e,this):this._timeScale},incrementTime:function(e,t){return t||(t=e),this._currentTime+=(e-t)*this._timeScale,this._currentTime},currentTime:function(){return this._currentTime},tick:function(e,t){var i,r,n,o=ige,a=o._postTick,s=a.length;if(o.incrementTime(e,o._timeScaleLastTimestamp),o._timeScaleLastTimestamp=e,e=Math.floor(o._currentTime),igeDebug.timing&&(i=(new Date).getTime()),o._state){for(t===void 0&&(t=o._ctx),requestAnimFrame(o.tick),o._frameAlternator=!o._frameAlternator,o.tickStart=e,o.tickStart-=o._clientNetDiff,o.lastTick?o._tickDelta=o.tickStart-o.lastTick:(o.lastTick=0,o._tickDelta=0),o._processBehaviours(t),o.render(t),n=0;s>n;n++)a[n]();o.lastTick=o.tickStart,o._frames++,o._dpt=o._drawCount,o._drawCount=0,o.input.tick()}o._resized=!1,igeDebug.timing&&(r=(new Date).getTime(),ige._tickTime=r-i)},fps:function(){return this._fps},dpt:function(){return this._dpt},dps:function(){return this._dps},render:function(e){var t,i;this._viewportDepth&&(igeDebug.timing?(t=(new Date).getTime(),this.depthSortChildren(),i=(new Date).getTime()-t,ige._tslt[this.id()]||(ige._tslt[this.id()]={}),ige._tslt[this.id()].depthSortChildren=i):this.depthSortChildren()),e.save(),e.translate(this._geometry.x2,this._geometry.y2);var r,n=this._children;if(n)if(r=n.length,igeDebug.timing)while(r--)e.save(),t=(new Date).getTime(),n[r].tick(e),i=(new Date).getTime()-t,n[r]&&(ige._tsit[n[r].id()]||(ige._tsit[n[r].id()]=0),ige._tslt[n[r].id()]||(ige._tslt[n[r].id()]={}),ige._tsit[n[r].id()]+=i,ige._tslt[n[r].id()].tick=i),e.restore();else while(r--)e.save(),n[r].tick(e),e.restore();e.restore()},analyseTiming:function(){igeDebug.timing||this.log("Cannot analyse timing because the igeDebug.timing flag is not enabled so no timing data has been recorded!","warning")},sceneGraph:function(e,t){var i,r,n,o,a="";for(t===void 0&&(t=0),e||(e=ige),i=0;t>i;i++)a+="----";if(igeDebug.timing?(r="",r+="T: "+ige._tsit[e.id()],ige._tslt[e.id()]&&(typeof ige._tslt[e.id()].tick=="number"&&(r+=" | LastTick: "+ige._tslt[e.id()].tick),typeof ige._tslt[e.id()].depthSortChildren=="number"&&(r+=" | ChildDepthSort: "+ige._tslt[e.id()].depthSortChildren)),console.log(a+e.id()+" ("+e._classId+") : "+e._inView+" Timing("+r+")")):console.log(a+e.id()+" ("+e._classId+") : "+e._inView),t++,e===ige){if(n=e._children){o=n.length;while(o--)n[o]._scene._shouldRender&&(igeDebug.timing?(r="",r+="T: "+ige._tsit[n[o].id()],ige._tslt[n[o].id()]&&(typeof ige._tslt[n[o].id()].tick=="number"&&(r+=" | LastTick: "+ige._tslt[n[o].id()].tick),typeof ige._tslt[n[o].id()].depthSortChildren=="number"&&(r+=" | ChildDepthSort: "+ige._tslt[n[o].id()].depthSortChildren)),console.log(a+"----"+n[o].id()+" ("+n[o]._classId+") : "+n[o]._inView+" Timing("+r+")")):console.log(a+"----"+n[o].id()+" ("+n[o]._classId+") : "+n[o]._inView),this.sceneGraph(n[o]._scene,t+1))}}else if(n=e._children){o=n.length;while(o--)this.sceneGraph(n[o],t)}},getSceneGraphData:function(e){var t,i,r,n,o,a=[];if(e||(e=ige),t={text:e.id()+" ("+e._classId+")",parent:e._parent,id:e.id()},e===ige){if(n=e._children){o=n.length;while(o--)i={text:n[o].id()+" ("+n[o]._classId+")",parent:n[o]._parent,id:n[o].id()},n[o]._scene&&(r=this.getSceneGraphData(n[o]._scene),i.items=[r]),a.push(i)}}else if(n=e._children){o=n.length;while(o--)i=this.getSceneGraphData(n[o]),a.push(i)}return a.length>0&&(t.items=a),t},destroy:function(){this.stop(),this.isServer||this.removeCanvas(),this._super(),this.log("Engine destroy complete.")}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_92);var ClientNetworkEvents={example:function(){}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=ClientNetworkEvents);var Rotator=$i_53.extend({classId:"Rotator",init:function(e,t,i){this._super(),this._rotationX=e,this._rotationY=t,this._rotationZ=i},tick:function(e){this.rotateBy(this._rotationX*ige.tickDelta*Math.PI/180,this._rotationY*ige.tickDelta*Math.PI/180,this._rotationZ*ige.tickDelta*Math.PI/180),this._super(e)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Rotator);var modelSpaceFrigate6={metadata:{formatVersion:3.1,generatedBy:"Blender 2.64 Exporter",vertices:151,faces:298,normals:147,colors:0,uvs:[189],materials:1,morphTargets:0,bones:0},scale:1,materials:[{DbgColor:15658734,DbgIndex:0,DbgName:"Material.001",blending:"NormalBlending",colorAmbient:[.6400000190734865,.6400000190734865,.6400000190734865],colorDiffuse:[.6400000190734865,.6400000190734865,.6400000190734865],colorSpecular:[.5,.5,.5],depthTest:!0,depthWrite:!0,mapDiffuse:"space_frigate_6_color.jpg",mapDiffuseWrap:["repeat","repeat"],shading:"Lambert",specularCoef:50,transparency:1,transparent:!1,vertexColors:!1}],vertices:[29412e-10,-.275588,-3.7706,-2.55831,-.275593,-3.7706,-2.01402,6.03312,-3.83908,-912313e-11,6.03312,-3.83908,-1.36047,1.83953,1.6565,-459032e-11,1.83953,1.6565,-103242e-10,5.10657,.818048,-.952329,5.10656,.818047,234956e-10,-12.1809,-.183119,-1.16718,-12.1809,-.18312,-1.56394,-12.1809,-1.40149,244965e-10,-12.1809,-1.74752,-1.23393,-12.1809,-1.74752,-.614152,12.4956,-1.80496,-228277e-10,12.4956,-1.80496,-217519e-10,12.4956,-3.48651,-.924225,12.4956,-2.40057,-.486163,12.4956,-3.48651,267449e-10,-13.2757,-1.97752,-1.39896,-13.2757,-1.97752,-2.48322,-7.73113,-3.37928,170001e-10,-7.73112,-3.37927,-.627894,13.2757,-3.69651,-231149e-10,13.2757,-3.69651,-1.42153,-6.14883,1.53146,108215e-10,-6.14883,1.53146,31538e-10,-2.23497,1.77523,-1.476,-2.23497,1.77523,-12.506,-10.6641,-1.82496,-12.5038,-10.7005,-1.55253,-14.0083,-7.35856,-1.55253,-14.0062,-7.29896,-1.84592,-3.25196,6.03312,-1.33199,-1.15517,13.2757,-2.38941,-3.51447,-7.63878,-2.67742,-3.5807,-.266894,-3.01122,-3.65472,-9.19907,-1.97449,-1.80627,-13.2757,-1.40285,-1.33417,-13.2757,.0468801,-3.65472,-9.19907,-1.36386,-2.57383,-7.73113,.10658,-3.49922,-8.0281,-.830523,-2.64892,-.70012,.10658,-2.47531,1.44753,-.846264,-3.85502,1.42012,-1.35389,-4.3121,-.700123,.106579,-3.85502,1.42012,-1.77443,-7.14635,-7.78083,-.984483,-5.99194,1.28252,-1.33758,-4.28003,-.34432,-.968398,-5.99133,1.29981,-1.77864,-2.10462,6.03312,-.838648,-.741581,13.2757,-1.59495,-244594e-10,13.2757,-1.59495,-.797162,11.5431,-1.39401,-212625e-10,11.5431,-1.39401,-1.76596,6.05352,-.916672,-.76661,5.26765,.530033,-104492e-10,5.26765,.530033,-2.23106,-7.76384,.0532696,-1.22489,-6.39406,1.31063,-1.41186,-11.0242,.102938,254498e-10,-13.2757,.046881,210927e-10,-11.0242,.102939,114335e-10,-6.39406,1.31063,-8.33977,-4.23088,-.984483,-3.35316,-8.20455,3.83907,-3.36635,-5.30339,3.83907,-3.53276,-5.30339,3.83907,-3.51957,-8.20455,3.83907,-4.23701,-7.73113,.106579,-7.89303,-4.21304,-.448144,-6.82466,-7.66344,-.448143,-3.05481,-1.02704,.10658,-2.98798,-6.97969,.10658,-3.89795,-1.02704,.10658,-3.83112,-6.97969,.10658,-1.23393,-13.2757,-1.74752,-1.56394,-13.2757,-1.40149,265978e-10,-13.2757,-1.74752,-1.16718,-13.2757,-.18312,255969e-10,-13.2757,-.183119,-.486164,13.2757,-3.48651,-232493e-10,13.2757,-3.48651,-.924227,13.2757,-2.40057,-.614153,13.2757,-1.80496,-24325e-9,13.2757,-1.80496,2.014,6.03313,-3.83907,2.55832,-.275583,-3.7706,1.36046,1.83953,1.6565,.952309,5.10657,.818049,1.23398,-12.1809,-1.74752,1.56399,-12.1809,-1.40149,1.16723,-12.1809,-.183118,.614106,12.4956,-1.80495,.924181,12.4956,-2.40057,.486119,12.4956,-3.48651,2.48325,-7.73112,-3.37927,1.39901,-13.2757,-1.97752,.627848,13.2757,-3.69651,1.42156,-6.14883,1.53146,1.476,-2.23497,1.77523,12.5061,-10.664,-1.82494,14.0062,-7.29891,-1.84591,14.0083,-7.35851,-1.55252,12.5039,-10.7004,-1.55252,1.15512,13.2757,-2.38941,3.25194,6.03313,-1.33199,3.5807,-.26688,-3.01122,3.51451,-7.63876,-2.67741,3.65476,-9.19905,-1.97449,1.80632,-13.2757,-1.40284,3.65476,-9.19905,-1.36385,1.33422,-13.2757,.0468819,3.49925,-8.02809,-.830519,2.57385,-7.73112,.106584,2.64892,-.70011,.106584,4.3121,-.700107,.106585,3.85502,1.42013,-1.35388,2.4753,1.44754,-.84626,3.85502,1.42013,-1.77443,7.14639,-7.7808,-.984473,4.28004,-.344304,-.968392,5.99193,1.28255,-1.33757,5.99133,1.29983,-1.77864,.741533,13.2757,-1.59495,2.1046,6.03313,-.838646,.79712,11.5431,-1.39401,1.76594,6.05352,-.91667,.76659,5.26765,.530033,1.22492,-6.39405,1.31064,2.23109,-7.76383,.0532724,1.4119,-11.0242,.10294,8.33979,-4.23085,-.984473,3.35318,-8.20453,3.83908,3.5196,-8.20453,3.83908,3.53278,-5.30338,3.83908,3.36637,-5.30338,3.83908,4.23704,-7.73112,.106585,6.82469,-7.66341,-.448135,7.89304,-4.21301,-.448134,2.988,-6.97968,.106584,3.05481,-1.02703,.106584,3.89795,-1.02702,.106584,3.83115,-6.97967,.106584,1.56399,-13.2757,-1.40149,1.23398,-13.2757,-1.74752,1.16723,-13.2757,-.183118,.486118,13.2757,-3.48651,.924179,13.2757,-2.40057,.614105,13.2757,-1.80495],morphTargets:[],normals:[0,-.031617,-.999481,-.364818,.036012,-.930357,-.521928,.093661,-.847804,0,.004395,-.999969,-.501694,.1554,.850948,0,.139714,.990173,0,.609973,.792413,-.296854,.545366,.783837,0,-.707083,-.707083,.471877,-.595721,-.649922,.774255,-.607868,.175939,0,-.707083,.707083,.306192,-.628315,.71514,.412305,.606861,-.679464,0,.707083,-.707083,0,.707083,.707083,.780541,.62392,-.03769,.447432,.600238,.662954,0,-.788995,-.614368,-.267281,-.744041,-.612323,-.304636,-.171178,-.936918,0,-.149449,-.988739,-.385418,.646138,-.658711,0,.714011,-.700095,-.354717,-.296152,.886807,0,-.387249,.921964,0,-.016511,.999847,-.466872,-.020875,.88406,-.405011,-.687399,-.602863,-.396283,-.758019,.517991,-.815332,.069735,.574755,-.812525,.174566,-.556139,-.91345,.193854,.357768,-.686422,.727134,.007263,-.328318,-.193182,-.924589,-.402509,.253761,-.879513,-.423566,-.646016,-.634968,-.616077,-.782525,-.089908,-.35432,-.668569,.653768,-.555437,-.600513,.575182,-.240028,-.301126,.922849,-.333506,-.63683,.69509,-.526597,.194372,.82757,-.655141,.204413,.727287,-.503708,.515946,.692831,-.404187,.436598,.803735,-.657186,.557848,-.506821,-.246101,-.352886,.902707,-.34959,.724723,.593738,-.673025,.388867,.629109,-.391125,.793237,-.466628,-.314798,.292001,.903104,-.3296,.69219,.641987,0,.746727,.66512,-.127079,.167119,.977691,0,.204993,.978729,-.22074,.478195,.850032,-.114353,.716483,.688131,0,.628132,.778069,-.203864,-.29957,.932005,-.074709,-.542467,.836726,-.073763,-.089389,.993255,0,-.715842,.698233,0,-.139561,.990204,0,-.474258,.880367,-.376385,.113559,.919462,.536943,-.676809,.503525,.598651,.270302,.75399,-.601459,.265389,.753502,-.537065,-.678304,.501389,-.089541,-.595599,.798242,-.576861,.183691,.795892,-.392987,-.589648,.705588,.118686,.166356,.978881,.373669,-.276467,.885372,-.118534,.162847,.979492,-.377453,-.288552,.87991,.232276,-.807276,.542497,.525346,-.842463,.119358,.294046,-.865719,-.404981,.288339,.856899,.427259,.579547,.814417,-.027985,.277932,.844325,-.458052,.521928,.093661,-.847804,.364818,.036012,-.930357,.501694,.1554,.850948,.296854,.545366,.783837,-.306192,-.628315,.71514,-.774255,-.607868,.175939,-.471877,-.595721,-.649922,-.412305,.606861,-.679464,-.780541,.62392,-.03769,-.447432,.600208,.662954,.304636,-.171178,-.936918,.267281,-.744011,-.612323,.385418,.646138,-.658711,.354717,-.296152,.886807,.466872,-.020875,.88406,.405011,-.687368,-.602863,.812525,.174566,-.556139,.815332,.069735,.574755,.396283,-.758019,.517991,.686422,.727134,.007263,.91345,.193854,.357768,.402509,.253761,-.879513,.328318,-.193182,-.924589,.423566,-.646016,-.634968,.616077,-.782495,-.089908,.555437,-.600513,.575182,.35432,-.668569,.653768,.333506,-.63683,.69509,.240028,-.301126,.922849,.526597,.194372,.82757,.404187,.436598,.803735,.503708,.515946,.692831,.655141,.204413,.727287,.657186,.557848,-.506821,.246101,-.352886,.902707,.673025,.388867,.629109,.34959,.724723,.593738,.391095,.793237,-.466628,.3296,.69219,.641987,.314798,.292001,.903104,.127079,.167119,.977691,.22074,.478195,.850032,.114353,.716483,.688131,.074709,-.542467,.836726,.203864,-.29957,.932005,.073763,-.089389,.993255,.376385,.113559,.919462,-.536943,-.67684,.503525,.537065,-.678304,.501389,.601459,.265389,.753502,-.598651,.270302,.75399,.089541,-.595599,.798242,.392987,-.589648,.705588,.576861,.183691,.795892,-.373669,-.276467,.885372,-.118686,.166356,.978881,.118534,.162847,.979492,.377453,-.288552,.87991,-.525315,-.842463,.119358,-.232276,-.807276,.542497,-.294015,-.865719,-.404981,-.288339,.856899,.427259,-.579547,.814417,-.027985,-.277932,.844325,-.458052],colors:[],uvs:[[.489329,.329477,.489328,.419322,.267761,.400206,.267761,.329476,.162391,.247822,.162127,.295599,.043676,.29494,.043861,.2615,.874288,.215699,.874288,.256605,.8315,.270538,.819348,.215699,.819348,.258949,.78526,.085519,.78526,.064027,.844315,.064028,.806178,.096408,.844315,.081024,.952139,.329481,.952138,.378611,.751291,.416687,.751292,.329478,.013478,.351526,.013478,.329475,.443267,.247229,.442992,.297151,.305277,.29639,.305564,.244556,.634246,.311758,.635061,.321374,.506453,.316228,.50499,.305829,.016437,.417444,.275029,.43208,.275975,.53024,.016213,.466882,.496987,.438969,.758987,.428684,.758401,.472604,.499469,.483618,.962828,.413255,.816896,.487257,.967351,.436712,.996402,.48169,.826049,.505599,.82745,.587838,.805205,.546012,.297138,.544003,.379118,.551177,.378493,.602297,.286467,.601354,.439901,.524232,.438799,.53764,.439585,.524054,.499379,.481985,.794338,.644405,.679892,.876934,.348617,.830529,.354474,.701269,.648206,.928238,.947278,.275558,.949387,.29688,.635057,.321336,.362484,.625838,.291451,.738304,.077396,.760472,.569177,.943286,.503753,.980371,.521928,.898417,.017041,.304601,.092174,.303383,.092451,.318874,.01725,.319366,.810277,.572049,.738504,.549797,.540394,.581304,.540164,.538278,.797043,.498743,.802183,.527396,.817003,.487202,.967238,.436767,.256175,.169826,.502528,.186402,.443222,.247228,.008942,.168055,.169232,.151018,.163071,.247398,.044767,.236446,.163131,.247933,.876061,.601385,.901844,.605051,.895154,.665972,.867499,.662039,.913239,.864961,.901609,.86227,.872751,.93161,.866236,.920023,.901333,.862207,.839311,.93161,.839383,.920023,.815242,.897526,.815249,.667013,.843182,.667014,.842103,.897527,.89575,.856335,.020646,.063096,.095647,.023043,.097687,.035092,.032197,.070066,.293008,.052381,.213946,.055379,.097666,.034965,.296397,.099113,.217532,.104833,.209139,.134955,.041095,.134025,.041333,.091009,.209413,.085373,.098818,.04402,.100291,.887127,.327434,.864811,.71508,.159076,.613211,.157236,.61329,.151392,.715159,.153233,.044252,.555484,.142927,.70491,.030096,.647024,.308793,.63404,.135562,.728091,.019556,.502785,.002002,.546829,.019344,.666585,.054573,.497754,.283318,.556003,.077976,.516735,.278083,.585147,.072741,.545879,.669752,.290005,.460726,.286092,.413741,.16548,.414142,.135873,.465452,.017062,.674478,.020956,.703379,.014517,.720863,.151962,.820098,.100032,.84028,.114336,.832202,.120132,.82005,.108542,.84028,.163466,.832202,.163382,.769185,.163466,.769185,.116612,.777263,.122476,.777263,.163381,.814415,.17266,.831208,.17266,.831208,.21111,.814415,.21111,.874458,.172661,.874458,.21111,.72851,.17266,.769416,.17266,.769416,.21111,.72851,.21111,.863882,.015441,.863881,.037492,.856507,.032514,.856507,.015517,.817978,.056009,.818369,.047898,.790077,.041484,.797452,.037009,.790077,.015441,.797452,.015517,.871713,.064028,.871713,.081025,.871712,.122147,.844315,.122147,.871712,.14573,.844314,.145729,.871712,.167221,.844314,.167221,.393014,.659597,.100512,.887105,.163031,.24802,.02037,.113018,.031959,.113082]],faces:[42,0,1,2,0,0,1,2,0,1,2,42,3,0,2,0,3,0,2,3,0,2,42,4,5,6,0,4,5,6,4,5,6,42,6,7,4,0,6,7,4,6,7,4,42,8,9,10,0,8,9,10,8,9,10,42,11,8,10,0,11,8,10,11,8,10,42,11,10,12,0,11,10,12,11,10,12,42,13,14,15,0,13,14,15,13,14,15,42,16,13,15,0,16,13,15,16,13,15,42,17,16,15,0,17,16,15,17,16,15,42,18,19,20,0,18,19,20,18,19,20,42,20,21,18,0,20,21,18,20,21,18,42,21,20,1,0,21,20,1,21,20,1,42,1,0,21,0,1,0,21,1,0,21,42,22,23,3,0,22,23,3,22,23,3,42,3,2,22,0,3,2,22,3,2,22,42,24,25,26,0,24,25,26,24,25,26,42,26,27,24,0,26,27,24,26,27,24,42,28,29,30,0,28,29,30,28,29,30,42,30,31,28,0,30,31,28,30,31,28,42,22,2,32,0,32,33,34,22,2,32,42,32,33,22,0,34,35,32,32,33,22,42,1,20,34,0,36,37,38,1,20,34,42,34,35,1,0,38,39,36,34,35,1,42,20,19,36,0,37,40,41,20,19,36,42,36,34,20,0,41,38,37,36,34,20,42,37,38,39,0,42,43,44,37,38,39,42,38,40,41,0,43,45,46,38,40,41,42,41,39,38,0,46,44,43,41,39,38,42,42,43,44,0,47,48,49,42,43,44,42,44,45,42,0,49,50,47,44,45,42,42,32,2,46,0,34,33,51,32,2,46,42,46,44,32,0,51,52,34,46,44,32,42,46,2,1,0,53,33,36,46,2,1,42,1,35,46,0,36,54,53,1,35,46,42,35,34,28,0,55,56,57,35,34,28,42,28,31,35,0,57,58,55,28,31,35,42,34,36,28,0,56,59,57,34,36,28,42,36,39,29,0,60,61,62,36,39,29,42,29,28,36,0,62,28,60,29,28,36,42,39,47,29,0,63,64,65,39,47,29,42,44,48,49,0,66,67,68,44,48,49,42,46,50,48,0,69,70,71,46,50,48,42,48,44,46,0,71,72,69,48,44,46,42,46,35,50,0,73,55,74,46,35,50,42,32,51,52,0,75,76,77,32,51,52,42,52,33,32,0,77,78,75,52,33,32,42,36,19,37,0,79,40,80,36,19,37,42,37,39,36,0,80,44,79,37,39,36,42,42,40,24,0,81,82,83,42,40,24,42,24,27,42,0,83,27,81,24,27,42,42,51,43,4,0,84,85,86,51,43,4,42,4,7,51,0,86,87,84,4,7,51,42,42,27,4,0,81,27,88,42,27,4,42,4,27,26,0,4,27,26,4,27,26,42,26,5,4,0,26,5,4,26,5,4,42,53,52,54,0,89,90,91,53,52,54,42,54,55,53,0,91,92,89,54,55,53,42,52,51,56,0,90,93,94,52,51,56,42,56,54,52,0,94,91,90,56,54,52,42,51,7,57,0,93,95,96,51,7,57,42,57,56,51,0,96,97,93,57,56,51,42,7,6,58,0,95,98,99,7,6,58,42,58,57,7,0,99,96,95,58,57,7,42,58,55,54,0,100,101,102,58,55,54,42,54,57,58,0,102,103,100,54,57,58,42,56,57,54,0,104,103,102,56,57,54,42,24,40,59,0,105,106,107,24,40,59,42,59,60,24,0,107,108,105,59,60,24,42,40,38,61,0,106,109,110,40,38,61,42,61,59,40,0,110,111,106,61,59,40,42,38,62,63,0,109,112,113,38,62,63,42,63,61,38,0,113,110,109,63,61,38,42,63,64,60,0,114,115,116,63,64,60,42,60,61,63,0,116,117,114,60,61,63,42,59,61,60,0,118,117,116,59,61,60,42,30,29,47,0,119,65,64,30,29,47,42,47,65,30,0,64,120,119,47,65,30,42,66,67,68,0,121,122,123,66,67,68,42,68,69,66,0,123,124,121,68,69,66,42,70,45,71,0,125,50,126,70,45,71,42,71,72,70,0,126,127,125,71,72,70,42,49,65,71,0,128,129,126,49,65,71,42,71,45,49,0,126,50,128,71,45,49,42,40,70,41,0,130,125,131,40,70,41,42,41,70,72,0,131,125,127,41,70,72,42,72,47,41,0,127,132,131,72,47,41,42,40,42,73,0,133,47,134,40,42,73,42,73,74,40,0,134,135,133,73,74,40,42,42,45,75,0,47,50,136,42,45,75,42,75,73,42,0,136,134,47,75,73,42,42,45,70,76,0,50,125,137,45,70,76,42,76,75,45,0,137,136,50,76,75,45,42,70,40,74,0,125,133,135,70,40,74,42,74,76,70,0,135,137,125,74,76,70,42,74,73,67,0,138,139,122,74,73,67,42,67,66,74,0,122,121,138,67,66,74,42,73,75,68,0,140,141,123,73,75,68,42,68,67,73,0,123,122,140,68,67,73,42,75,76,69,0,142,143,124,75,76,69,42,69,68,75,0,124,123,142,69,68,75,42,76,74,66,0,143,144,145,76,74,66,42,66,69,76,0,145,124,143,66,69,76,42,48,65,49,0,67,120,68,48,65,49,42,31,30,48,0,31,30,71,31,30,48,42,48,50,31,0,71,70,31,48,50,31,42,35,31,50,0,55,58,74,35,31,50,42,37,19,77,0,146,147,148,37,19,77,42,77,78,37,0,148,149,146,77,78,37,42,19,18,79,0,147,150,151,19,18,11,42,79,77,19,0,151,148,147,11,77,19,42,62,38,80,0,152,153,154,62,38,79,42,80,81,62,0,154,155,152,79,8,62,42,38,37,78,0,153,146,149,38,37,78,42,78,80,38,0,149,154,153,78,79,38,42,78,77,12,0,156,157,158,78,77,12,42,12,10,78,0,158,159,156,12,10,78,42,77,79,11,0,157,160,161,77,11,11,42,11,12,77,0,161,158,157,11,12,77,42,81,80,9,0,162,163,164,8,79,9,42,9,8,81,0,164,165,162,9,8,8,42,80,78,10,0,163,156,159,79,78,10,42,10,9,80,0,159,164,163,10,9,79,42,23,22,82,0,166,167,168,23,22,80,42,82,83,23,0,168,169,166,80,15,23,42,22,33,84,0,167,170,171,22,33,81,42,84,82,22,0,171,168,167,81,80,22,42,33,52,85,0,170,172,173,33,52,82,42,85,84,33,0,173,171,170,82,81,33,42,52,53,86,0,172,174,175,52,53,14,42,86,85,52,0,175,173,172,14,82,52,42,83,82,17,0,176,177,17,15,80,17,42,17,15,83,0,17,15,176,17,15,15,42,82,84,16,0,177,178,179,80,81,16,42,16,17,82,0,179,17,177,16,17,80,42,84,85,13,0,178,180,181,81,82,13,42,13,16,84,0,181,179,178,13,16,81,42,85,86,14,0,180,182,183,82,14,14,42,14,13,85,0,183,181,180,14,13,82,42,51,32,44,0,76,75,49,51,32,44,42,44,43,51,0,49,48,76,44,43,51,42,39,41,47,0,63,184,64,39,41,47,42,48,30,65,0,67,185,120,48,30,65,42,65,47,72,0,129,132,127,65,47,72,42,72,71,65,0,127,126,129,72,71,65,42,44,49,45,0,49,128,50,44,49,45,42,43,42,4,0,85,81,186,43,42,4,42,25,24,60,0,187,105,108,25,24,60,42,60,64,25,0,108,188,187,60,64,25,42,0,3,87,0,0,3,2,0,3,83,42,88,0,87,0,1,0,2,84,0,83,42,89,90,6,0,4,7,6,85,86,6,42,6,5,89,0,6,5,4,6,5,85,42,11,91,92,0,11,12,10,11,87,88,42,92,93,8,0,10,9,8,88,89,8,42,11,92,8,0,11,10,8,11,88,8,42,15,14,94,0,15,14,13,15,14,90,42,15,94,95,0,15,13,16,15,90,91,42,96,15,95,0,17,15,16,92,15,91,42,18,21,97,0,18,21,20,18,21,93,42,97,98,18,0,20,19,18,93,94,18,42,21,0,88,0,21,0,1,21,0,84,42,88,97,21,0,1,20,21,84,93,21,42,99,87,3,0,22,2,3,95,83,3,42,3,23,99,0,3,23,22,3,23,95,42,100,101,26,0,24,27,26,96,97,26,42,26,25,100,0,26,25,24,26,25,96,42,102,103,104,0,28,31,30,98,99,100,42,104,105,102,0,30,29,28,100,101,98,42,99,106,107,0,32,35,34,95,102,103,42,107,87,99,0,34,33,32,103,83,95,42,88,108,109,0,36,39,38,84,104,105,42,109,97,88,0,38,37,36,105,93,84,42,97,109,110,0,37,38,41,93,105,106,42,110,98,97,0,41,40,37,106,94,93,42,111,112,113,0,42,44,43,107,108,109,42,113,112,114,0,43,44,46,109,108,110,42,114,115,113,0,46,45,43,110,111,109,42,116,117,118,0,47,50,49,112,113,114,42,118,119,116,0,49,48,47,114,115,112,42,107,118,120,0,34,52,51,103,114,116,42,120,87,107,0,51,33,34,116,83,103,42,120,108,88,0,53,54,36,116,104,84,42,88,87,120,0,36,33,53,84,83,116,42,108,103,102,0,55,58,57,104,99,98,42,102,109,108,0,57,56,55,98,105,104,42,109,102,110,0,56,57,59,105,98,106,42,110,102,105,0,60,28,62,106,98,101,42,105,112,110,0,62,61,60,101,108,106,42,112,105,121,0,63,65,64,108,101,117,42,118,122,123,0,66,68,67,114,118,119,42,120,118,123,0,69,72,71,116,114,119,42,123,124,120,0,71,70,69,119,120,116,42,120,124,108,0,73,74,55,116,120,104,42,107,106,125,0,75,78,77,103,102,121,42,125,126,107,0,77,76,75,121,122,103,42,110,112,111,0,79,44,80,106,108,107,42,111,98,110,0,80,40,79,107,94,106,42,116,101,100,0,81,27,83,112,97,96,42,100,115,116,0,83,82,81,96,111,112,42,126,90,89,0,84,87,86,122,86,85,42,89,119,126,0,86,85,84,85,115,122,42,116,89,101,0,81,88,27,112,85,97,42,89,5,26,0,4,5,26,85,5,26,42,26,101,89,0,26,27,4,26,97,85,42,53,55,127,0,89,92,91,53,55,123,42,127,125,53,0,91,90,89,123,121,53,42,125,127,128,0,90,91,94,121,123,124,42,128,126,125,0,94,93,90,124,122,121,42,126,128,129,0,93,97,96,122,124,125,42,129,90,126,0,96,95,93,125,86,122,42,90,129,58,0,95,96,99,86,125,58,42,58,6,90,0,99,98,95,58,6,86,42,58,129,127,0,100,103,102,58,125,123,42,127,55,58,0,102,101,100,123,55,58,42,128,127,129,0,104,102,103,124,123,125,42,100,130,131,0,105,108,107,96,126,127,42,131,115,100,0,107,106,105,127,111,96,42,115,131,132,0,106,111,110,111,127,128,42,132,113,115,0,110,109,106,128,109,111,42,113,132,63,0,109,110,113,109,128,63,42,63,62,113,0,113,112,109,63,62,109,42,63,132,130,0,114,117,116,63,128,126,42,130,64,63,0,116,115,114,126,64,63,42,131,130,132,0,118,116,117,127,126,128,42,104,133,121,0,119,120,64,100,129,117,42,121,105,104,0,64,65,119,117,101,100,42,134,135,136,0,121,124,123,130,131,132,42,136,137,134,0,123,122,121,132,133,130,42,138,139,140,0,125,127,126,134,135,136,42,140,117,138,0,126,50,125,136,113,134,42,122,117,140,0,128,50,126,118,113,136,42,140,133,122,0,126,129,128,136,129,118,42,115,114,138,0,130,131,125,111,110,134,42,114,121,139,0,131,132,127,110,117,135,42,139,138,114,0,127,125,131,135,134,110,42,115,141,142,0,133,135,134,111,137,138,42,142,116,115,0,134,47,133,138,112,111,42,116,142,143,0,47,134,136,112,138,139,42,143,117,116,0,136,50,47,139,113,112,42,117,143,144,0,50,136,137,113,139,140,42,144,138,117,0,137,125,50,140,134,113,42,138,144,141,0,125,137,135,134,140,137,42,141,115,138,0,135,133,125,137,111,134,42,141,134,137,0,138,121,122,137,130,133,42,137,142,141,0,122,139,138,133,138,137,42,142,137,136,0,140,122,123,138,133,132,42,136,143,142,0,123,141,140,132,139,138,42,143,136,135,0,142,123,124,139,132,131,42,135,144,143,0,124,143,142,131,140,139,42,144,135,134,0,143,124,145,140,131,130,42,134,141,144,0,145,144,143,130,137,140,42,123,122,133,0,67,68,120,119,118,129,42,103,124,123,0,31,70,71,99,120,119,42,123,104,103,0,71,30,31,119,100,99,42,108,124,103,0,55,74,58,104,120,99,42,111,145,146,0,146,149,148,107,141,142,42,146,98,111,0,148,147,146,142,94,107,42,98,146,79,0,147,148,151,94,142,11,42,79,18,98,0,151,150,147,11,18,94,42,62,81,147,0,152,155,154,62,8,143,42,147,113,62,0,154,153,152,143,109,62,42,113,147,145,0,153,154,149,109,143,141,42,145,111,113,0,149,146,153,141,107,109,42,145,92,91,0,156,159,158,141,88,87,42,91,146,145,0,158,157,156,87,142,141,42,146,91,11,0,157,158,161,142,87,11,42,11,79,146,0,161,160,157,11,11,142,42,81,8,93,0,162,165,164,8,8,89,42,93,147,81,0,164,163,162,89,143,8,42,147,93,92,0,163,164,159,143,89,88,42,92,145,147,0,159,156,163,88,141,143,42,23,83,148,0,166,169,168,23,15,144,42,148,99,23,0,168,167,166,144,95,23,42,99,148,149,0,167,168,171,95,144,145,42,149,106,99,0,171,170,167,145,102,95,42,106,149,150,0,170,171,173,102,145,146,42,150,125,106,0,173,172,170,146,121,102,42,125,150,86,0,172,173,175,121,146,14,42,86,53,125,0,175,174,172,14,53,121,42,83,15,96,0,176,15,17,15,15,92,42,96,148,83,0,17,177,176,92,144,15,42,148,96,95,0,177,17,179,144,92,91,42,95,149,148,0,179,178,177,91,145,144,42,149,95,94,0,178,179,181,145,91,90,42,94,150,149,0,181,180,178,90,146,145,42,150,94,14,0,180,181,183,146,90,14,42,14,86,150,0,183,182,180,14,14,146,42,126,119,118,0,76,48,49,122,115,114,42,118,107,126,0,49,75,76,114,103,122,42,112,121,114,0,63,64,184,108,117,110,42,123,133,104,0,67,120,185,119,129,100,42,133,140,139,0,129,126,127,129,136,135,42,139,121,133,0,127,132,129,135,117,129,42,118,117,122,0,49,50,128,114,113,118,42,119,89,116,0,85,186,81,115,85,112,42,25,64,130,0,187,188,108,25,64,126,42,130,100,25,0,108,105,187,126,96,25],bones:[],skinIndices:[],skinWeights:[],animation:{}},modelTurret={metadata:{formatVersion:3.1,generatedBy:"Blender 2.64 Exporter",vertices:300,faces:410,normals:248,colors:0,uvs:[240],materials:1,morphTargets:0,bones:0},scale:1,materials:[{DbgColor:15658734,DbgIndex:0,DbgName:"Material.001",blending:"NormalBlending",colorAmbient:[.6400000190734865,.6400000190734865,.6400000190734865],colorDiffuse:[.6400000190734865,.6400000190734865,.6400000190734865],colorSpecular:[.5,.5,.5],depthTest:!0,depthWrite:!0,mapDiffuse:"turret_2_color_1.jpg",mapDiffuseWrap:["repeat","repeat"],shading:"Lambert",specularCoef:50,transparency:1,transparent:!1,vertexColors:!1}],vertices:[-4.46507,11.9892,15.7655,-330967e-10,11.9892,15.7655,-1103e-8,.491792,15.7655,-7.52242,.491778,15.7655,-4.46507,11.9892,21.4003,-7.52242,.491778,25.4045,-171966e-10,.491792,25.4045,-367016e-10,11.9892,21.4003,995659e-11,-10.4429,15.7655,378998e-11,-10.4429,25.4045,-6.02541,-10.4429,25.4045,-6.0254,-10.4429,15.7655,-7.5224,-8.68113,25.4045,-7.5224,-8.68113,15.7655,-105792e-10,-.466101,17.9346,160943e-10,-14.3638,17.9346,-5.01778,-14.3638,17.9346,-5.01781,-.466111,17.9346,-5.01779,-14.3638,28.722,919297e-11,-14.3638,28.722,-60948e-10,-6.39843,28.722,-5.0178,-6.39844,28.722,325689e-10,-24.7288,23.2783,290862e-10,-24.7288,28.722,-2.22841,-24.7288,28.722,-2.22841,-24.7288,23.2783,-2.95745,-9.31371,30.3359,-153211e-11,-9.3137,30.3359,-114534e-10,-4.14442,30.3359,-2.95746,-4.14442,30.3359,-2.95747,-1.27256,25.1082,-2.95744,-14.451,25.1082,116722e-10,-14.451,25.1082,-7.3809,10.8315,-.0346737,-207665e-10,10.8315,-.034669,207806e-10,-10.8158,-.034669,-7.38086,-10.8158,-.0346737,-9.94679,-8.2396,-.0346754,-9.94683,8.25529,-.0346754,-7.08417,5.18987,11.8615,-7.08415,-5.17417,11.8615,-4.51821,-7.75038,11.8615,728658e-11,-7.75037,11.8615,-224938e-10,7.7661,11.8615,-4.51824,7.76609,11.8615,-2.89019,5.12472,11.4119,-5.10569,2.90921,11.4119,-5.1057,2.90921,15.9199,-2.89019,5.12472,15.9199,-5.91662,-.117235,11.4119,-5.91662,-.117235,15.9199,-5.10568,-3.14367,11.4119,-5.10568,-3.14367,15.9199,-2.89017,-5.35917,11.4119,-2.89017,-5.35917,15.9199,453975e-11,-6.16931,11.4119,165574e-11,-6.16931,15.9199,-24.0309,-2.11056,18.2718,-24.0308,-6.40088,18.2718,-24.0308,-6.40088,22.8815,-24.0309,-2.11056,22.8815,-6.62122,-.690658,16.7463,-6.62121,-7.82072,16.7463,-6.62121,-7.82072,24.407,-6.62123,-.690658,24.407,-22.2318,-8.59108,16.7598,-22.2319,-8.59108,24.0062,-22.2319,-4.30077,24.0062,-22.2319,-4.30077,16.7598,-10.1799,-3.94611,15.2043,-10.1799,-11.0762,15.2043,-7.058,-23.3899,22.1093,-13.8684,-22.4099,21.5908,-13.8684,-22.4099,19.1753,-7.05799,-23.3899,18.6568,-10.1799,-11.0762,25.5617,-10.1799,-3.94611,25.5617,-8.55099,8.50207,17.8669,-20.1687,4.3637,18.8042,-20.1727,4.36639,22.2434,-8.547,8.49939,23.0484,-8.31391,-.982512,17.5958,-22.8644,-2.20888,18.63,-22.8604,-2.21156,22.2852,-8.31791,-.979829,23.4518,-11.1402,6.78956,22.2919,-9.24273,6.78956,20.9133,-10.0589,42.9549,20.6481,-11.1403,42.9549,21.4338,-9.96751,6.78956,18.6826,-10.4719,42.9549,19.3768,-12.3129,6.78955,18.6826,-11.8086,42.9549,19.3768,-13.0377,6.78955,20.9133,-12.2217,42.9549,20.6481,-23.8814,-5.80127,20.6534,-23.8814,-4.68668,22.1875,-28.361,-4.68669,22.1875,-28.361,-5.80127,20.6534,-23.8814,-2.88323,21.6015,-28.361,-2.88324,21.6015,-23.8814,-2.88323,19.7052,-28.361,-2.88324,19.7052,-23.8814,-4.68668,19.1193,-28.361,-4.68669,19.1193,-14.7058,-4.72965,1.79847,-14.7059,4.76217,1.79847,-8.10641,4.76218,1.79847,-8.10639,-4.72964,1.79847,-13.4636,2.58015,7.34122,-7.92067,2.58016,7.34122,-13.4636,-2.54764,7.34122,-7.92066,-2.54763,7.34122,-26.854,3.94518,-.0346882,-14.8457,7.747,-.0346805,-14.8457,-8.1693,-.0346805,-26.854,-4.36754,-.0346882,-25.7267,2.27802,3.41602,-25.7266,-2.70037,3.41602,-12.6073,-4.97719,8.74859,-12.6073,4.55489,8.74859,-13.6334,-5.69681,27.5058,-13.6334,-8.15602,27.5058,-11.5855,-8.15602,27.6463,-11.5855,-5.69681,27.6463,-13.9381,-4.93544,24.8605,-13.9381,-8.9174,24.8605,-10.6222,-8.91739,25.088,-10.6222,-4.93543,25.088,-12.2248,-7.76342,22.9041,-11.3679,-7.13811,22.984,-14.6104,-6.85848,45.5608,-11.6952,-6.12636,22.9535,-12.7545,-6.12636,22.8548,-13.0818,-7.13812,22.8243,-16.7585,-3.75394,25.9448,-16.7585,-6.81439,25.9448,-14.9204,-6.81439,26.0886,-14.9204,-3.75394,26.0886,-16.6273,-2.53214,23.38,-16.6273,-8.03619,23.38,-14.7892,-8.03619,23.5238,-14.7892,-2.53214,23.5238,-20.1772,-3.75395,25.5786,-20.1772,-6.8144,25.5786,-18.3391,-6.8144,25.7225,-18.3391,-3.75395,25.7225,-20.046,-2.53215,23.0139,-20.046,-8.0362,23.0139,-18.2079,-8.0362,23.1577,-18.2079,-2.53215,23.1577,-16.6534,1.15108,14.0873,-11.8271,3.83636,13.4035,-11.8271,-4.99713,13.4035,-16.6533,-4.99714,14.0873,-19.0164,-7.77569,19.1542,-19.0164,3.62857,19.1542,-11.8271,-7.77568,18.4704,-11.8271,6.31385,18.4704,-136208e-10,-1.27255,25.1082,-215755e-10,5.93486,15.9199,-186915e-10,5.93486,11.4119,4.465,11.9892,15.7655,7.52239,.491806,15.7655,4.465,11.9892,21.4003,7.52239,.491806,25.4045,6.02542,-10.4428,15.7655,6.02542,-10.4428,25.4045,7.52241,-8.6811,25.4045,7.52241,-8.6811,15.7655,5.01779,-.466091,17.9346,5.01781,-14.3638,17.9346,5.01781,-14.3638,28.722,5.01779,-6.39842,28.722,2.22847,-24.7288,23.2783,2.22847,-24.7288,28.722,2.95745,-9.3137,30.3359,2.95744,-4.14441,30.3359,2.95744,-1.27255,25.1082,2.95746,-14.451,25.1082,9.94683,-8.23956,-.0346626,7.3809,-10.8158,-.0346643,7.38086,10.8315,-.0346643,9.94679,8.25533,-.0346626,4.51823,-7.75036,11.8615,7.08415,-5.17415,11.8615,7.08413,5.1899,11.8615,4.5182,7.76611,11.8615,2.89016,5.12473,11.4119,2.89015,5.12473,15.9199,5.10566,2.90922,15.9199,5.10567,2.90922,11.4119,5.9166,-.117213,15.9199,5.9166,-.117213,11.4119,5.10567,-3.14365,15.9199,5.10568,-3.14365,11.4119,2.89017,-5.35916,15.9199,2.89018,-5.35916,11.4119,24.0308,-2.11047,18.2719,24.0308,-2.11047,22.8815,24.0308,-6.40078,22.8815,24.0308,-6.40078,18.2719,6.6212,-.690632,16.7463,6.62122,-7.82069,16.7463,6.62121,-7.82069,24.407,6.6212,-.690632,24.407,22.2319,-8.591,16.7598,22.2319,-4.30069,16.7598,22.2318,-4.30069,24.0062,22.2319,-8.591,24.0062,10.1799,-3.94607,15.2044,10.1799,-11.0761,15.2044,7.05806,-23.3898,22.1093,7.05806,-23.3898,18.6568,13.8684,-22.4098,19.1753,13.8684,-22.4098,21.5908,10.1799,-11.0761,25.5617,10.1799,-3.94607,25.5617,8.55093,8.50211,17.8669,8.54693,8.49942,23.0484,20.1727,4.36646,22.2435,20.1687,4.36378,18.8042,8.31389,-.98248,17.5958,22.8644,-2.20879,18.63,22.8604,-2.21148,22.2853,8.31788,-.979797,23.4518,11.1402,6.7896,22.2919,11.1401,42.9549,21.4338,10.0587,42.9549,20.6481,9.24267,6.78959,20.9133,10.4718,42.9549,19.3768,9.96746,6.7896,18.6826,11.8085,42.9549,19.3768,12.3129,6.7896,18.6826,12.2215,42.9549,20.6481,13.0377,6.7896,20.9133,23.8814,-5.80117,20.6534,28.361,-5.80117,20.6534,28.361,-4.68658,22.1875,23.8814,-4.68659,22.1875,28.361,-2.88313,21.6015,23.8814,-2.88314,21.6015,28.361,-2.88313,19.7053,23.8814,-2.88314,19.7053,28.361,-4.68658,19.1193,23.8814,-4.68659,19.1193,14.7059,-4.7296,1.79849,8.10641,-4.72961,1.79848,8.10639,4.76221,1.79848,14.7058,4.76222,1.79849,7.92065,2.58019,7.34123,13.4636,2.58021,7.34123,7.92066,-2.5476,7.34123,13.4636,-2.54759,7.34123,26.854,3.94528,-.0346538,26.854,-4.36743,-.0346538,14.8457,-8.16925,-.0346615,14.8457,7.74705,-.0346615,25.7266,2.27811,3.41606,12.6073,4.55494,8.7486,12.6073,-4.97714,8.7486,25.7267,-2.70027,3.41606,13.6334,-5.69676,27.5058,11.5855,-5.69676,27.6463,11.5855,-8.15598,27.6463,13.6334,-8.15597,27.5058,13.9381,-4.93539,24.8605,13.9381,-8.91734,24.8605,10.6222,-8.91735,25.0881,10.6222,-4.93539,25.0881,12.2248,-7.76337,22.9041,14.6104,-6.85842,45.5609,11.3679,-7.13807,22.984,11.6952,-6.12631,22.9535,12.7545,-6.12631,22.8548,13.0818,-7.13807,22.8243,16.7585,-3.75388,25.9448,14.9204,-3.75388,26.0886,14.9204,-6.81433,26.0886,16.7585,-6.81433,25.9448,16.6273,-2.53208,23.38,16.6273,-8.03613,23.38,14.7892,-8.03613,23.5239,14.7891,-2.53208,23.5239,20.1772,-3.75387,25.5787,18.3391,-3.75387,25.7225,18.3391,-6.81433,25.7225,20.1772,-6.81432,25.5787,20.046,-2.53207,23.0139,20.046,-8.03613,23.0139,18.2079,-8.03613,23.1577,18.2079,-2.53208,23.1577,16.6533,1.15114,14.0873,16.6533,-4.99708,14.0873,11.8271,-4.99708,13.4035,11.8271,3.8364,13.4035,19.0164,3.62864,19.1542,19.0164,-7.77562,19.1542,11.8271,-7.77563,18.4704,11.8271,6.3139,18.4704],morphTargets:[],normals:[-.491104,.638752,-.592242,0,.707083,-.707083,0,0,-1,-.727866,.095096,-.679067,-.501328,.726737,.469558,-.688711,.187597,.700308,0,.166753,.985992,0,.815119,.579241,0,-.707083,-.707083,0,-.707083,.707083,-.328135,-.709433,.623676,-.328135,-.709433,-.623676,-.723472,-.265847,.637074,-.723472,-.265847,-.637074,0,.860775,-.508957,0,-.235755,-.971801,-.673177,-.229438,-.702933,-.555406,.715781,-.423231,-.728019,-.096225,.678762,0,0,1,0,.508957,.860775,-.608478,.403882,.683065,0,-.853877,-.520463,-.490066,-.639393,.592425,-.506912,-.755791,-.414472,-.629536,-.300455,.716514,0,-.3867,.922178,0,.509171,.860653,-.608448,.404065,.683004,-.562395,.724693,.398083,-.451155,-.636525,.625507,0,-.713248,.700888,-.351115,.787744,-.506088,0,.790399,-.612537,0,-.790399,-.612537,-.351115,-.787744,-.506088,-.785058,-.352489,-.509293,-.785058,.352489,-.509293,-.630024,.232826,.740806,-.630024,-.232826,.740806,-.236366,-.624897,.744011,0,-.612537,.790399,0,.612537,.790399,-.236366,.624897,.744011,-.504959,.863124,0,-.866024,.499985,0,-1,0,0,-.866024,-.499985,0,-.504959,-.863124,0,0,-.999969,0,0,-1,0,-.621418,.555132,-.552812,-.621418,-.555132,-.552812,-.621418,-.555132,.552812,-.621418,.555132,.552812,-.118778,.700827,-.70333,-.118778,-.700827,-.70333,-.118778,-.700827,.70333,-.118778,.700827,.70333,-.752922,-.234962,-.614704,-.754845,-.231727,.613575,-.617664,.574633,.536882,-.617664,.574633,-.536882,.535051,.579608,-.614612,.582842,-.072329,-.809351,.620319,-.603168,.501358,-.468215,-.734092,.491775,-.462386,-.723167,-.512986,.615345,-.599322,-.511979,.587756,-.057222,.807001,.535051,.579608,.614612,.452742,.681082,-.575427,-.56624,.579516,-.586077,-.567003,.575274,.589526,.456099,.684683,.568438,.65389,.045198,-.755211,-.765557,.327891,-.553514,-.771752,.318827,.550157,.650929,.048341,.757561,0,.023713,.999695,.950774,.023713,.308908,.757561,.604541,.246132,0,.604541,.796533,.587603,.023713,-.808771,.468184,.604541,-.644398,-.587603,.023713,-.808771,-.468184,.604541,-.644398,-.950774,.023713,.308908,-.757561,.604541,.246132,0,-.309,.951048,-.595691,-.248207,.763878,-.595691,-.803186,0,0,.809015,.587756,-.595691,.6498,.472091,0,.809015,-.587756,-.595691,.6498,-.472091,0,-.309,-.951048,-.595691,-.248177,-.763878,0,-.764611,-.644459,0,.764611,-.644459,0,.834559,-.55089,0,-.834559,-.55089,0,.596942,.802271,0,.557207,.830348,0,-.596942,.802271,0,-.557207,.830348,-.710227,.577746,-.402173,.373455,.795953,-.476363,.383557,-.787957,-.481613,-.719779,-.559099,-.411451,-.652333,.369915,.661489,-.664418,-.341899,.66451,.545915,-.48677,.681906,.541734,.49382,.680166,-.574389,.487075,.657826,-.574389,-.487075,.657826,.436476,-.490677,.754112,.436476,.490677,.754112,-.672353,.687124,.275216,-.672353,-.687124,.275216,.625904,-.65099,.429426,.625904,.65099,.429426,671e-6,-.999176,.039979,.941374,-.307321,.138981,-.104892,-275e-6,.994476,.583087,.806024,.101291,-.58507,.810663,-.021668,-.948759,-.31019,-.059969,-.646107,.425275,.633778,-.646107,-.425275,.633778,.560167,-.425611,.710654,.560167,.425611,.710654,-.611805,.725791,.314432,-.611805,-.725791,.314432,.551805,-.741569,.381481,.551805,.741569,.381481,-.582171,.249031,-.773949,.468307,.511521,-.720389,.561907,-.405713,-.720847,-.489669,-.406903,-.771081,-.604724,-.544877,-.580828,-.727012,.457045,-.512375,.508591,-.750511,-.421918,.38667,.828455,-.405072,0,.876431,.48146,0,1,0,.491104,.638752,-.592242,.727866,.095126,-.679067,.501328,.726737,.469558,.688711,.187597,.700308,.328135,-.709433,-.623676,.328135,-.709433,.623676,.723472,-.265847,.637074,.723472,-.265847,-.637074,.555406,.715781,-.423231,.673208,-.229438,-.702933,.728019,-.096225,.678762,.608478,.403882,.683065,.506943,-.75576,-.414472,.490066,-.639393,.592425,.629536,-.300455,.716514,.608448,.404065,.683004,.562395,.724693,.398114,.451155,-.636525,.625507,.785058,-.352489,-.509293,.351115,-.787744,-.506088,.351115,.787744,-.506088,.785058,.352489,-.509293,.236366,-.624897,.744011,.630024,-.232826,.740806,.630024,.232826,.740806,.236366,.624897,.744011,.504959,.863124,0,.866024,.499985,0,1,0,0,.866024,-.499985,0,.504959,-.863124,0,.621418,.555132,-.552812,.621418,.555132,.552812,.621418,-.555132,.552812,.621418,-.555132,-.552812,.118778,.700827,-.70333,.118778,-.700827,-.70333,.118778,-.700827,.70333,.118778,.700827,.70333,.752922,-.234962,-.614704,.617664,.574633,-.536882,.617664,.574633,.536882,.754845,-.231727,.613575,-.535051,.579608,-.614612,-.582842,-.072329,-.809351,-.620319,-.603168,.501358,-.615345,-.599322,-.511979,.462386,-.723167,-.512986,.468215,-.734092,.491775,-.587756,-.057253,.807001,-.535051,.579608,.614612,-.452742,.681082,-.575427,-.456099,.684683,.568438,.567003,.575274,.589526,.56624,.579516,-.586077,-.65389,.045198,-.755211,.765557,.327891,-.553514,.771752,.318827,.550157,-.650929,.048341,.757561,.595691,-.803186,0,.595691,-.248177,.763878,.595691,.6498,.472091,.595691,.6498,-.472091,.595691,-.248177,-.763878,.710227,.577746,-.402173,.719779,-.559099,-.411451,-.383557,-.787957,-.481613,-.373455,.795953,-.476363,.652333,.369915,.661489,-.541734,.49382,.680166,-.545915,-.48677,.681906,.664418,-.341899,.66451,.574389,.487075,.657826,-.436476,.490677,.754112,-.436476,-.490677,.754112,.574389,-.487075,.657826,.672353,.687124,.275216,.672353,-.687124,.275216,-.625904,-.65099,.429426,-.625904,.65099,.429426,-671e-6,-.999176,.039979,.104678,427e-6,.994476,-.941374,-.307321,.138981,-.583087,.806024,.101291,.58507,.810663,-.021668,.948759,-.31016,-.059969,.646107,.425275,.633778,-.560167,.425611,.710654,-.560167,-.425611,.710654,.646107,-.425275,.633778,.611805,.725791,.314432,.611805,-.725791,.314432,-.551805,-.741569,.381481,-.551805,.741569,.381481,.582171,.249031,-.773949,.4897,-.406903,-.771081,-.561907,-.405713,-.720847,-.468307,.511521,-.720389,.727012,.457045,-.512375,.604724,-.544877,-.580828,-.508591,-.750511,-.421949,-.38667,.828455,-.405072],colors:[],uvs:[[.595341,.061641,.595321,.013146,.720194,.013095,.720227,.094795,.534142,.061666,.401926,.094926,.401892,.013226,.534122,.013172,.595394,.190853,.490706,.190897,.595472,.38103,.490784,.381073,.490757,.315632,.595445,.315588,.3023,.094967,.283159,.078717,.283132,.013275,.595435,.29048,.490747,.290523,.422313,.777044,.422318,.626102,.476816,.626104,.476811,.777046,.476825,.327752,.422327,.327751,.42233,.241239,.476828,.24124,.714044,.557495,.563102,.55749,.563105,.440328,.649617,.440331,.422322,.499448,.422324,.440324,.446527,.440325,.446525,.499449,.188927,.060903,.188927,.093024,.132784,.093024,.132784,.060903,.101593,.004125,.244723,.004125,.268532,.093024,.268532,.060903,.093753,.184435,.093753,.104272,.328863,.104272,.328863,.184435,.300883,.212304,.121733,.215768,.154957,.348611,.26752,.345241,.295384,.373202,.295301,.422274,.126778,.421991,.12686,.372919,.410613,.258059,.349662,.376748,.30601,.354331,.339303,.221439,.116607,.357795,.083314,.224903,.141715,.696803,.141715,.730833,.092754,.730832,.092754,.696803,.141715,.764862,.092754,.764862,.141714,.798891,.092754,.798891,.141714,.832921,.092753,.832921,.141714,.865521,.092753,.865521,.703758,.291743,.750355,.291743,.750447,.341833,.70385,.341833,.688245,.101908,.765684,.101908,.847713,.115835,.799622,.300097,.920812,.141394,.843607,.315477,.606217,.115835,.654308,.300097,.832749,.709751,.754039,.709451,.754039,.662854,.832741,.662855,.968496,.749282,.921837,.811081,.860825,.672856,.774641,.959612,.780272,.884883,.807022,.885243,.812137,.959612,.671437,.814837,.6225,.75482,.726381,.675087,.737145,.531902,.849636,.531902,.737145,.454463,.849636,.454464,.859365,.939637,.774643,.316493,.81214,.316494,.496447,.780531,.530624,.910393,.495671,.922591,.443008,.799054,.59951,.786755,.59905,.945738,.558342,.982317,.520905,.995528,.601474,.723183,.498404,.724333,.935364,.666242,.909899,.666914,.905005,.274045,.919518,.273662,.884425,.666876,.890488,.274024,.858963,.666128,.875976,.273597,.986188,.662769,.9608,.66486,.934014,.272874,.948483,.271683,.900156,.260361,.911672,.251521,.923638,.259741,.571407,.641673,.571407,.662268,.522754,.662268,.522754,.641673,.571407,.682863,.522754,.682863,.571407,.579888,.571407,.600483,.522754,.600483,.522754,.579888,.571407,.621078,.522754,.621078,.503167,.594118,.491061,.61078,.503167,.627442,.011454,.942665,.011454,.839575,.083131,.839575,.08313,.942665,.024947,.774878,.085148,.774878,.024947,.719186,.085148,.719186,.011455,.654489,.083131,.654489,.237802,.659432,.196513,.52901,.369379,.529013,.328086,.659433,.255908,.69886,.309979,.698861,.334702,.852653,.23118,.852651,.34301,.670929,.415631,.786816,.231184,.430567,.334711,.430568,.150254,.786812,.222878,.670927,.177146,.904664,.203855,.904664,.203855,.926958,.177146,.926958,.168876,.875744,.212124,.875744,.233469,.899395,.233469,.935494,.212124,.956648,.168876,.956648,.147531,.935494,.147531,.899395,.931861,.010294,.943398,.009649,.949054,.257325,.954951,.009698,.966485,.01038,.977985,.011505,.920368,.011477,.637659,.606463,.637659,.639703,.6177,.639718,.617625,.606479,.665551,.593193,.665551,.652972,.638411,.670581,.618387,.670581,.589933,.653129,.589665,.593351,.618387,.575584,.638412,.575585,.305396,.904318,.305396,.937557,.285553,.937682,.285672,.904443,.333288,.891048,.333287,.950827,.306148,.968436,.286123,.968435,.257748,.950876,.258177,.891099,.286123,.873439,.306148,.873439,.076319,.518079,.129041,.488732,.129386,.584665,.076316,.584587,.015593,.614764,.015593,.490903,.121544,.646871,.043175,.643737,.184012,.461657,.184677,.61468,.030404,.470642,.10477,.432622,.365639,.865661,.46183,.991649,.780273,.884922,.729673,.939913,.838981,.078487,.819853,.094754,.838954,.013046,.476832,.107531,.422334,.10753,.068003,.060903,.068003,.093024,.012003,.258061,.072954,.376751,.092754,.664203,.141715,.664203]],faces:[42,0,1,2,0,0,1,2,0,1,2,42,3,0,2,0,3,0,2,3,0,2,42,4,5,6,0,4,5,6,4,5,6,42,6,7,4,0,6,7,4,6,7,4,42,3,5,4,0,8,9,4,3,5,4,42,4,0,3,0,4,0,8,4,0,3,42,8,9,10,0,10,11,12,8,9,10,42,10,11,8,0,12,13,10,10,11,8,42,12,10,9,0,14,15,16,12,10,9,42,12,9,6,0,14,16,6,12,9,6,42,5,12,6,0,5,14,6,5,12,6,42,13,12,5,0,17,18,9,13,12,5,42,5,3,13,0,9,8,17,5,3,13,42,13,11,10,0,17,13,12,13,11,10,42,10,12,13,0,12,18,17,10,12,13,42,14,15,16,0,19,20,21,14,15,16,42,16,17,14,0,21,22,19,16,17,14,42,18,19,20,0,23,24,25,18,19,20,42,20,21,18,0,25,26,23,20,21,18,42,17,16,18,0,27,28,29,17,16,18,42,18,21,17,0,29,30,27,18,21,17,42,22,23,24,0,31,32,33,22,9,23,42,24,25,22,0,33,34,31,23,24,22,42,15,22,25,0,20,31,34,15,22,24,42,25,16,15,0,34,21,20,24,16,15,42,18,16,25,0,29,28,34,18,16,24,42,25,24,18,0,34,33,29,24,23,18,42,26,27,28,0,35,36,37,25,26,27,42,28,29,26,0,37,38,35,27,28,25,42,30,31,26,0,39,40,35,29,30,25,42,26,29,30,0,35,38,39,25,28,29,42,32,27,26,0,41,36,35,31,26,25,42,26,31,32,0,35,42,41,25,30,31,42,33,34,35,0,43,44,45,32,33,34,42,35,36,37,0,45,46,47,34,35,36,42,33,35,37,0,43,45,47,32,34,36,42,38,33,37,0,48,43,47,37,32,36,42,39,40,41,0,49,50,51,38,39,40,42,39,41,42,0,49,51,52,38,40,41,42,39,42,43,0,49,52,53,38,41,42,42,44,39,43,0,54,49,53,43,38,42,42,38,37,40,0,48,47,50,37,36,39,42,40,39,38,0,50,49,48,39,38,37,42,35,42,41,0,55,56,57,34,41,40,42,41,36,35,0,57,58,55,40,35,34,42,37,36,41,0,47,58,57,36,35,40,42,41,40,37,0,57,50,47,40,39,36,42,39,44,33,0,49,59,60,38,43,32,42,33,38,39,0,60,48,49,32,37,38,42,45,46,47,0,61,62,63,44,45,45,42,47,48,45,0,63,64,61,45,44,44,42,46,49,50,0,62,65,66,45,46,46,42,50,47,46,0,66,63,62,46,45,45,42,49,51,52,0,65,67,68,46,47,47,42,52,50,49,0,68,66,65,47,46,46,42,51,53,54,0,67,69,70,47,48,48,42,54,52,51,0,70,68,67,48,47,47,42,55,56,54,0,71,72,70,49,50,48,42,54,53,55,0,70,69,71,48,48,49,42,57,58,59,0,73,74,75,51,52,53,42,59,60,57,0,75,76,73,53,54,51,42,61,62,58,0,77,78,74,55,56,52,42,58,57,61,0,74,73,77,52,51,55,42,62,63,59,0,78,79,80,56,57,53,42,59,58,62,0,80,74,78,53,52,56,42,63,64,60,0,79,81,82,57,58,54,42,60,59,63,0,82,80,79,54,53,57,42,64,61,57,0,83,77,73,58,55,51,42,57,60,64,0,73,84,83,51,54,58,42,65,66,67,0,85,86,87,59,60,61,42,67,68,65,0,87,88,85,61,62,59,42,69,70,65,0,89,90,85,63,64,59,42,65,68,69,0,85,91,89,59,62,63,42,71,72,73,0,92,93,94,65,66,67,42,73,74,71,0,94,95,92,67,68,65,42,75,76,67,0,96,97,98,69,70,61,42,67,66,75,0,98,86,96,61,60,69,42,76,69,68,0,99,100,88,70,63,62,42,68,67,76,0,88,87,99,62,61,70,42,76,75,70,0,99,101,102,70,69,64,42,70,69,76,0,102,100,99,64,63,70,42,65,70,74,0,85,90,103,59,64,68,42,74,73,65,0,103,94,85,68,67,59,42,73,72,66,0,94,93,86,67,66,60,42,66,65,73,0,86,85,94,60,59,67,42,71,74,70,0,104,105,102,65,68,64,42,70,75,71,0,102,101,104,64,69,65,42,77,78,79,0,106,107,108,71,72,73,42,79,80,77,0,108,109,106,73,74,71,42,81,82,78,0,110,111,107,75,76,72,42,78,77,81,0,107,106,110,72,71,75,42,82,83,79,0,112,113,108,76,77,73,42,79,78,82,0,108,107,112,73,72,76,42,84,81,77,0,114,110,106,78,75,71,42,77,80,84,0,106,115,114,71,74,78,42,85,86,87,0,116,117,118,79,80,81,42,87,88,85,0,118,119,116,81,82,79,42,86,89,90,0,117,120,121,80,83,84,42,90,87,86,0,121,118,117,84,81,80,42,89,91,92,0,120,122,123,83,85,86,42,92,90,89,0,123,121,120,86,84,83,42,91,93,94,0,124,125,126,85,87,88,42,94,92,91,0,126,127,124,88,86,85,42,93,85,88,0,125,116,119,87,79,82,42,88,94,93,0,119,126,125,82,88,87,42,90,92,94,0,128,129,130,84,86,88,42,87,90,94,0,118,128,130,81,84,88,42,88,87,94,0,119,118,130,82,81,88,42,95,96,97,0,131,132,133,50,89,90,42,97,98,95,0,133,134,131,90,91,50,42,96,99,100,0,132,135,136,89,92,93,42,100,97,96,0,136,133,132,93,90,89,42,99,101,102,0,137,138,139,92,94,95,42,102,100,99,0,139,140,137,95,93,92,42,101,103,104,0,138,141,142,94,96,97,42,104,102,101,0,142,139,138,97,95,94,42,103,95,98,0,141,131,134,96,50,91,42,98,104,103,0,134,142,141,91,97,96,42,100,102,104,0,143,139,142,93,95,97,42,97,100,104,0,144,143,142,90,93,97,42,98,97,104,0,145,144,142,91,90,97,42,105,106,107,0,146,147,148,98,99,100,42,107,108,105,0,148,149,146,100,101,98,42,106,109,110,0,147,150,151,99,102,103,42,110,107,106,0,151,148,147,103,100,99,42,109,111,112,0,150,152,153,102,104,105,42,112,110,109,0,153,151,150,105,103,102,42,111,105,108,0,152,154,155,104,98,101,42,108,112,111,0,155,153,152,101,105,104,42,113,114,115,0,156,157,158,106,107,108,42,115,116,113,0,158,159,156,108,109,106,42,117,118,119,0,160,161,162,110,111,112,42,119,120,117,0,162,163,160,112,113,110,42,113,116,118,0,156,159,161,106,109,111,42,118,117,113,0,161,160,156,111,110,106,42,116,115,119,0,164,165,162,109,108,112,42,119,118,116,0,162,161,164,112,111,109,42,115,114,120,0,158,157,166,108,107,113,42,120,119,115,0,166,167,158,113,112,108,42,114,113,117,0,168,169,160,107,106,110,42,117,120,114,0,160,163,168,110,113,107,42,121,122,123,0,170,171,172,114,115,116,42,123,124,121,0,172,173,170,116,117,114,42,125,126,122,0,174,175,171,118,119,115,42,122,121,125,0,171,170,174,115,114,118,42,126,127,123,0,176,177,172,119,120,116,42,123,122,126,0,172,171,176,116,115,119,42,127,128,124,0,178,179,173,120,121,117,42,124,123,127,0,173,172,178,117,116,120,42,128,125,121,0,180,181,170,121,118,114,42,121,124,128,0,170,173,180,114,117,121,42,129,130,131,0,182,183,184,122,123,124,42,130,132,131,0,183,185,184,123,125,124,42,132,133,131,0,185,186,184,125,126,124,42,133,134,131,0,186,187,184,126,127,124,42,134,129,131,0,188,182,184,127,122,124,42,135,136,137,0,189,190,191,128,129,130,42,137,138,135,0,191,192,189,130,131,128,42,139,140,136,0,193,194,190,132,133,129,42,136,135,139,0,190,189,193,129,128,132,42,140,141,137,0,195,196,191,133,134,130,42,137,136,140,0,191,190,195,130,129,133,42,141,142,138,0,197,198,192,134,135,131,42,138,137,141,0,192,191,197,131,130,134,42,142,139,135,0,199,200,189,135,132,128,42,135,138,142,0,189,192,199,128,131,135,42,143,144,145,0,201,202,203,128,129,130,42,145,146,143,0,203,204,201,130,131,128,42,147,148,144,0,205,206,202,132,133,129,42,144,143,147,0,202,201,205,129,128,132,42,148,149,145,0,207,208,203,133,134,130,42,145,144,148,0,203,202,207,130,129,133,42,149,150,146,0,209,210,204,134,135,131,42,146,145,149,0,204,203,209,131,130,134,42,150,147,143,0,211,212,201,135,132,128,42,143,146,150,0,201,204,211,128,131,135,42,151,152,153,0,213,214,215,136,137,138,42,153,154,151,0,215,216,213,138,139,136,42,151,154,155,0,213,216,217,136,139,140,42,155,156,151,0,217,218,213,140,141,136,42,154,153,157,0,216,215,219,139,138,142,42,157,155,154,0,219,220,216,142,140,139,42,153,152,158,0,215,214,221,138,137,143,42,158,157,153,0,221,222,215,143,142,138,42,152,151,156,0,214,213,223,137,136,141,42,156,158,152,0,223,224,214,141,143,137,42,84,80,79,0,225,109,108,78,74,73,42,79,83,84,0,108,226,225,73,77,78,42,72,71,75,0,227,228,96,66,65,69,42,75,66,72,0,96,86,227,69,60,66,42,0,4,7,0,0,4,7,0,4,7,42,1,0,7,0,1,0,7,1,0,7,42,11,13,3,0,229,230,3,11,13,3,42,11,3,2,0,229,3,2,11,3,2,42,8,11,2,0,231,229,2,8,11,2,42,17,21,20,0,232,26,25,17,21,20,42,20,14,17,0,25,233,232,20,14,17,42,19,18,24,0,24,23,33,19,18,23,42,24,23,19,0,33,32,24,23,9,19,42,30,29,28,0,234,38,37,29,28,27,42,28,159,30,0,37,235,234,27,144,29,42,34,33,44,0,236,60,59,33,32,43,42,44,43,34,0,59,237,236,43,42,33,42,45,48,160,0,61,64,238,44,44,145,42,160,161,45,0,238,239,61,145,145,44,42,162,163,2,0,0,3,2,146,147,2,42,2,1,162,0,2,1,0,2,1,146,42,164,7,6,0,4,7,6,148,7,6,42,6,165,164,0,6,5,4,6,149,148,42,163,162,164,0,8,0,4,147,146,148,42,164,165,163,0,4,9,8,148,149,147,42,8,166,167,0,10,13,12,8,150,151,42,167,9,8,0,12,11,10,151,9,8,42,9,167,168,0,16,15,14,9,151,152,42,6,9,168,0,6,16,14,6,9,152,42,165,6,168,0,5,6,14,149,6,152,42,169,163,165,0,17,8,9,153,147,149,42,165,168,169,0,9,18,17,149,152,153,42,169,168,167,0,17,18,12,153,152,151,42,167,166,169,0,12,13,17,151,150,153,42,14,170,171,0,19,22,21,14,154,155,42,171,15,14,0,21,20,19,155,15,14,42,172,173,20,0,23,26,25,156,157,20,42,20,19,172,0,25,24,23,20,19,156,42,170,173,172,0,27,30,29,154,157,156,42,172,171,170,0,29,28,27,156,155,154,42,22,174,175,0,31,34,33,22,158,159,42,175,23,22,0,33,32,31,159,9,22,42,15,171,174,0,20,21,34,15,155,158,42,174,22,15,0,34,31,20,158,22,15,42,172,175,174,0,29,33,34,156,159,158,42,174,171,172,0,34,28,29,158,155,156,42,176,177,28,0,35,38,37,160,161,27,42,28,27,176,0,37,36,35,27,26,160,42,178,177,176,0,39,38,35,162,161,160,42,176,179,178,0,35,40,39,160,163,162,42,32,179,176,0,41,42,35,31,163,160,42,176,27,32,0,35,36,41,160,26,31,42,180,181,35,0,47,46,45,164,165,34,42,35,34,182,0,45,44,43,34,33,166,42,180,35,182,0,47,45,43,164,34,166,42,183,180,182,0,48,47,43,167,164,166,42,184,185,186,0,51,50,49,168,169,170,42,42,184,186,0,52,51,49,41,168,170,42,43,42,186,0,53,52,49,42,41,170,42,187,43,186,0,54,53,49,171,42,170,42,183,186,185,0,48,49,50,167,170,169,42,185,180,183,0,50,47,48,169,164,167,42,35,181,184,0,55,58,57,34,165,168,42,184,42,35,0,57,56,55,168,41,34,42,180,185,184,0,47,50,57,164,169,168,42,184,181,180,0,57,58,47,168,165,164,42,186,183,182,0,49,48,60,170,167,166,42,182,187,186,0,60,59,49,166,171,170,42,188,189,190,0,61,64,63,172,172,173,42,190,191,188,0,63,62,61,173,173,172,42,191,190,192,0,62,63,66,173,173,174,42,192,193,191,0,66,65,62,174,174,173,42,193,192,194,0,65,66,68,174,174,175,42,194,195,193,0,68,67,65,175,175,174,42,195,194,196,0,67,68,70,175,175,176,42,196,197,195,0,70,69,67,176,176,175,42,55,197,196,0,71,69,70,49,176,176,42,196,56,55,0,70,72,71,176,50,49,42,198,199,200,0,73,76,75,177,178,179,42,200,201,198,0,75,74,73,179,180,177,42,202,198,201,0,77,73,74,181,177,180,42,201,203,202,0,74,78,77,180,182,181,42,203,201,200,0,78,74,80,182,180,179,42,200,204,203,0,80,79,78,179,183,182,42,204,200,199,0,79,80,82,183,179,178,42,199,205,204,0,82,81,79,178,184,183,42,205,199,198,0,83,84,73,184,178,177,42,198,202,205,0,73,77,83,177,181,184,42,206,207,208,0,85,88,87,185,186,187,42,208,209,206,0,87,86,85,187,188,185,42,210,207,206,0,89,91,85,189,186,185,42,206,211,210,0,85,90,89,185,190,189,42,212,213,214,0,92,95,94,191,192,193,42,214,215,212,0,94,93,92,193,194,191,42,216,209,208,0,96,86,98,195,188,187,42,208,217,216,0,98,97,96,187,196,195,42,217,208,207,0,99,87,88,196,187,186,42,207,210,217,0,88,100,99,186,189,196,42,217,210,211,0,99,100,102,196,189,190,42,211,216,217,0,102,101,99,190,195,196,42,206,214,213,0,85,94,103,185,193,192,42,213,211,206,0,103,90,85,192,190,185,42,214,206,209,0,94,85,86,193,185,188,42,209,215,214,0,86,93,94,188,194,193,42,212,216,211,0,104,101,102,191,195,190,42,211,213,212,0,102,105,104,190,192,191,42,218,219,220,0,106,109,108,197,198,199,42,220,221,218,0,108,107,106,199,200,197,42,222,218,221,0,110,106,107,201,197,200,42,221,223,222,0,107,111,110,200,202,201,42,223,221,220,0,112,107,108,202,200,199,42,220,224,223,0,108,113,112,199,203,202,42,225,219,218,0,114,115,106,204,198,197,42,218,222,225,0,106,110,114,197,201,204,42,226,227,228,0,116,119,118,79,82,88,42,228,229,226,0,118,117,116,88,87,79,42,229,228,230,0,117,118,121,87,88,86,42,230,231,229,0,121,120,117,86,85,87,42,231,230,232,0,120,121,123,85,86,84,42,232,233,231,0,123,122,120,84,83,85,42,233,232,234,0,124,127,126,83,84,81,42,234,235,233,0,126,125,124,81,80,83,42,235,234,227,0,125,126,119,80,81,82,42,227,226,235,0,119,116,125,82,79,80,42,234,232,230,0,130,129,128,81,84,86,42,234,230,228,0,130,128,118,81,86,88,42,227,234,228,0,119,130,118,82,81,88,42,236,237,238,0,131,134,133,50,205,206,42,238,239,236,0,133,132,131,206,89,50,42,239,238,240,0,132,133,136,89,206,207,42,240,241,239,0,136,135,132,207,92,89,42,241,240,242,0,137,140,139,92,207,208,42,242,243,241,0,139,138,137,208,94,92,42,243,242,244,0,138,139,142,94,208,209,42,244,245,243,0,142,141,138,209,96,94,42,245,244,237,0,141,142,134,96,209,205,42,237,236,245,0,134,131,141,205,50,96,42,244,242,240,0,142,139,143,209,208,207,42,244,240,238,0,142,143,144,209,207,206,42,237,244,238,0,145,142,144,205,209,206,42,246,247,248,0,146,149,148,98,101,100,42,248,249,246,0,148,147,146,100,99,98,42,249,248,250,0,147,148,151,99,100,103,42,250,251,249,0,151,150,147,103,102,99,42,251,250,252,0,150,151,153,102,103,105,42,252,253,251,0,153,152,150,105,104,102,42,253,252,247,0,152,153,155,104,105,101,42,247,246,253,0,155,154,152,101,98,104,42,254,255,256,0,156,159,158,210,211,212,42,256,257,254,0,158,157,156,212,213,210,42,258,259,260,0,160,163,162,214,215,216,42,260,261,258,0,162,161,160,216,217,214,42,254,258,261,0,156,160,161,210,214,217,42,261,255,254,0,161,159,156,217,211,210,42,255,261,260,0,164,161,162,211,217,216,42,260,256,255,0,162,165,164,216,212,211,42,256,260,259,0,158,167,166,212,216,215,42,259,257,256,0,166,157,158,215,213,212,42,257,259,258,0,168,163,160,213,215,214,42,258,254,257,0,160,169,168,214,210,213,42,262,263,264,0,170,173,172,218,219,220,42,264,265,262,0,172,171,170,220,221,218,42,266,262,265,0,174,170,171,222,218,221,42,265,267,266,0,171,175,174,221,223,222,42,267,265,264,0,176,171,172,223,221,220,42,264,268,267,0,172,177,176,220,224,223,42,268,264,263,0,178,172,173,224,220,219,42,263,269,268,0,173,179,178,219,225,224,42,269,263,262,0,180,173,170,225,219,218,42,262,266,269,0,170,181,180,218,222,225,42,270,271,272,0,182,184,183,226,227,228,42,272,271,273,0,183,184,185,228,227,229,42,273,271,274,0,185,184,186,229,227,230,42,274,271,275,0,186,184,187,230,227,231,42,275,271,270,0,188,184,182,231,227,226,42,276,277,278,0,189,192,191,232,233,234,42,278,279,276,0,191,190,189,234,235,232,42,280,276,279,0,193,189,190,236,232,235,42,279,281,280,0,190,194,193,235,237,236,42,281,279,278,0,195,190,191,237,235,234,42,278,282,281,0,191,196,195,234,238,237,42,282,278,277,0,197,191,192,238,234,233,42,277,283,282,0,192,198,197,233,239,238,42,283,277,276,0,199,192,189,239,233,232,42,276,280,283,0,189,200,199,232,236,239,42,284,285,286,0,201,204,203,232,233,234,42,286,287,284,0,203,202,201,234,235,232,42,288,284,287,0,205,201,202,236,232,235,42,287,289,288,0,202,206,205,235,237,236,42,289,287,286,0,207,202,203,237,235,234,42,286,290,289,0,203,208,207,234,238,237,42,290,286,285,0,209,203,204,238,234,233,42,285,291,290,0,204,210,209,233,239,238,42,291,285,284,0,211,204,201,239,233,232,42,284,288,291,0,201,212,211,232,236,239,42,292,293,294,0,213,216,215,240,241,242,42,294,295,292,0,215,214,213,242,243,240,42,292,296,297,0,213,218,217,240,244,245,42,297,293,292,0,217,216,213,245,241,240,42,293,297,298,0,216,220,219,241,245,246,42,298,294,293,0,219,215,216,246,242,241,42,294,298,299,0,215,222,221,242,246,247,42,299,295,294,0,221,214,215,247,243,242,42,295,299,296,0,214,224,223,243,247,244,42,296,292,295,0,223,213,214,244,240,243,42,225,224,220,0,225,226,108,204,203,199,42,220,219,225,0,108,109,225,199,198,204,42,215,209,216,0,227,86,96,194,188,195,42,216,212,215,0,96,228,227,195,191,194,42,162,1,7,0,0,1,7,146,1,7,42,7,164,162,0,7,4,0,7,148,146,42,163,169,166,0,3,230,229,147,153,150,42,2,163,166,0,2,3,229,2,147,150,42,8,2,166,0,231,2,229,8,2,150,42,170,14,20,0,232,233,25,154,14,20,42,20,173,170,0,25,26,232,20,157,154,42,19,23,175,0,24,32,33,19,9,159,42,175,172,19,0,33,23,24,159,156,19,42,178,159,28,0,234,235,37,162,144,27,42,28,177,178,0,37,38,234,27,161,162,42,34,43,187,0,236,237,59,33,42,171,42,187,182,34,0,59,60,236,171,166,33,42,188,161,160,0,61,239,238,172,145,145,42,160,189,188,0,238,64,61,145,172,172],bones:[],skinIndices:[],skinWeights:[],animation:{}},Client=$i_2.extend({classId:"Client",init:function(){ige.showStats(1),ige.renderContext("three"),ige.addComponent($i_91);
var e=this;this.obj=[],ige.input.debug(!0),ige.createFrontBuffer(!0),ige.start(function(t){t&&(e.scene1=(new $i_64).id("scene1"),e.vp1=(new $i_63).id("vp1").autoSize(!0).scene(e.scene1).drawBounds(!0).mount(ige),e.vp1.camera.translateTo(0,50,400),e.obj[0]=new Rotator(0,0,-.1).id("ship0").translateTo(-200,-50,0).rotateTo(0,0,0).scaleTo(10,10,10).material(new $i_90.MeshFaceMaterial).model(modelSpaceFrigate6).mount(e.scene1),e.obj[1]=new Rotator(0,.1,0).id("ship1").translateTo(200,-50,0).rotateTo(0,35*Math.PI/180,0).scaleTo(10,10,10).material(new $i_90.MeshFaceMaterial).model(modelSpaceFrigate6).mount(e.scene1),e.obj[2]=(new $i_53).id("turret1").translateTo(0,0,1.8).rotateTo(0,0,0).scaleTo(.1,.1,.1).material(new $i_90.MeshFaceMaterial).model(modelTurret).mount(e.obj[1]))})}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Client);var Game=$i_2.extend({classId:"Game",init:function(e,t){ige=new $i_92,ige.isServer||(ige.client=new e),ige.isServer&&(ige.server=new e(t))}});if(typeof module!="undefined"&&module.exports!==void 0)module.exports=Game;else var game=new Game(Client)