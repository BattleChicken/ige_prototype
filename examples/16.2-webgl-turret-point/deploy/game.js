function printStackTrace(t){t=t||{guess:!0};for(var e=t.e||null,i=!!t.guess,s=new printStackTrace.implementation,n=s.run(e),r=i?s.guessAnonymousFunctions(n):n,o=0;4>o;o++)r.shift();return r}printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(t){t=t||this.createException();var e=this.mode(t);return e==="other"?this.other(arguments.callee):this[e](t)},createException:function(){try{return this.undef(),null}catch(t){return t}},mode:function(t){return this._mode=t.arguments&&t.stack?"chrome":t.message&&typeof window!="undefined"&&window.opera?t.stacktrace?"opera10":"opera":t.stack?"firefox":"other"},instrumentFunction:function(t,e,i){t=t||window;var s=t[e];t[e]=function(){return i.call(this,printStackTrace().slice(4)),t[e]._instrumented.apply(this,arguments)},t[e]._instrumented=s},deinstrumentFunction:function(t,e){t[e].constructor===Function&&t[e]._instrumented&&t[e]._instrumented.constructor===Function&&(t[e]=t[e]._instrumented)},chrome:function(t){var e=(t.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return e.pop(),e},firefox:function(t){return t.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera10:function(t){var e,i,s,n=t.stacktrace,r=n.split("\n"),o="{anonymous}",a=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i;for(e=2,i=0,s=r.length;s-2>e;e++)if(a.test(r[e])){var h=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2,u=RegExp.$3;u=u.replace(/<anonymous function\:?\s?(\S+)?>/g,o),r[i++]=u+"@"+h}return r.splice(i,r.length-i),r},opera:function(t){var e,i,s,n=t.message.split("\n"),r="{anonymous}",o=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i;for(e=4,i=0,s=n.length;s>e;e+=2)o.test(n[e])&&(n[i++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:r+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+n[e+1].replace(/^\s+/,""));return n.splice(i,n.length-i),n},other:function(t){var e,i,s="{anonymous}",n=/function\s*([\w\-$]+)?\s*\(/i,r=[],o=10;while(t&&o>r.length)e=n.test(t+"")?RegExp.$1||s:s,i=Array.prototype.slice.call(t.arguments||[]),r[r.length]=e+"("+this.stringifyArguments(i)+")",t=t.caller;return r},stringifyArguments:function(t){for(var e=Array.prototype.slice,i=0;t.length>i;++i){var s=t[i];s===void 0?t[i]="undefined":s===null?t[i]="null":s.constructor&&(s.constructor===Array?t[i]=3>s.length?"["+this.stringifyArguments(s)+"]":"["+this.stringifyArguments(e.call(s,0,1))+"..."+this.stringifyArguments(e.call(s,-1))+"]":s.constructor===Object?t[i]="#object":s.constructor===Function?t[i]="#function":s.constructor===String&&(t[i]='"'+s+'"'))}return t.join(",")},sourceCache:{},ajax:function(t){var e=this.createXMLHTTPObject();if(e)return e.open("GET",t,!1),e.send(""),e.responseText},createXMLHTTPObject:function(){for(var t,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],i=0;e.length>i;i++)try{return t=e[i](),this.createXMLHTTPObject=e[i],t}catch(s){}},isSameDomain:function(t){return t.indexOf(location.hostname)!==-1},getSource:function(t){return t in this.sourceCache||(this.sourceCache[t]=this.ajax(t).split("\n")),this.sourceCache[t]},guessAnonymousFunctions:function(t){for(var e=0;t.length>e;++e){var i=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/,s=t[e],n=i.exec(s);if(n){var r=n[1],o=n[4],a=n[7]||0;if(r&&this.isSameDomain(r)&&o){var h=this.guessAnonymousFunction(r,o,a);t[e]=s.replace("{anonymous}",h)}}}return t},guessAnonymousFunction:function(t,e){var i;try{i=this.findFunctionName(this.getSource(t),e)}catch(s){i="getSource failed with url: "+t+", exception: "+(s+"")}return i},findFunctionName:function(t,e){for(var i,s,n=/function\s+([^(]*?)\s*\(([^)]*)\)/,r=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,o=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,a="",h=10,u=0;h>u;++u)if(i=t[e-u]){if(a=i+a,s=r.exec(a),s&&s[1])return s[1];if(s=n.exec(a),s&&s[1])return s[1];if(s=o.exec(a),s&&s[1])return s[1]}return"(?)"}},ige=null,igeVersion="1.1.0",igeClassStore={},igeDebug={node:typeof module!="undefined"&&module.exports!==void 0,level:["log","warning","error"],stacks:!0,throwErrors:!0,timing:!0},igeDebug.node&&(igeDebug.util=require("util")),Object.defineProperty(Object.prototype,"tween",{enumerable:!1,writable:!0,configurable:!0}),Object.prototype.tween=function(t,e,i){var s=(new $i_47).targetObj(this).properties(t).duration(e);return i&&(i.beforeTween&&s.beforeTween(i.beforeTween),i.afterTween&&s.afterTween(i.afterTween),i.easing&&s.easing(i.easing),i.startTime&&s.startTime(i.startTime)),s},Object.defineProperty(Array.prototype,"clone",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.clone=function(){var t,e=[];for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t]instanceof Array?this[t].clone():this[t]);return e},Object.defineProperty(Array.prototype,"pull",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.pull=function(t){var e=this.indexOf(t);return e>-1?(this.splice(e,1),e):-1},Object.defineProperty(Array.prototype,"each",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.each=function(t){var e,i=this.length;for(e=0;i>e;e++)t(this[e])},Object.defineProperty(Array.prototype,"eachReverse",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachReverse=function(t){var e,i=this.length;for(e=i-1;e>=0;e--)t(this[e])},Object.defineProperty(Array.prototype,"eachIsolated",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachIsolated=function(t){var e,i=[],s=i.length;for(e=0;s>e;e++)i[e]=this[e];for(e=0;s>e;e++)t(i[e])},Object.defineProperty(Math,"PI180",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180=Math.PI/180,Object.defineProperty(Math,"PI180R",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180R=180/Math.PI,Object.defineProperty(Math,"radians",{enumerable:!1,writable:!0,configurable:!0}),Math.radians=function(t){return t*Math.PI180},Object.defineProperty(Math,"degrees",{enumerable:!1,writable:!0,configurable:!0}),Math.degrees=function(t){return t*Math.PI180R},Object.defineProperty(Math,"distance",{enumerable:!1,writable:!0,configurable:!0}),Math.distance=function(t,e,i,s){return Math.sqrt((t-i)*(t-i)+(e-s)*(e-s))};var disableContextMenu=function(t){t!==null&&(t.oncontextmenu=function(){return!1})};Array.prototype.indexOf||(Object.defineProperty(Array.prototype,"indexOf",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.indexOf=function(t){var e,i=this.length;for(e=0;i>e;e++)if(this[e]===t)return e;return-1}),requestAnimFrame=typeof window!="undefined"?function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(function(){t((new Date).getTime())},1e3/60)}}():function(){return function(t){setTimeout(function(){t((new Date).getTime())},1e3/60)}}(),typeof console=="object"?typeof console.log=="function"&&(console.info===void 0&&(console.info=console.log),console.warn===void 0&&(console.warn=console.log)):console={log:function(){},warn:function(){},info:function(){},error:function(){}},typeof JSON.decycle!="function"&&(JSON.decycle=function decycle(t){"use strict";var e=[],i=[];return function s(t,n){var r,o,a;switch(typeof t){case"object":if(!t)return null;for(r=0;e.length>r;r+=1)if(e[r]===t)return{$ref:i[r]};if(e.push(t),i.push(n),Object.prototype.toString.apply(t)==="[object Array]")for(a=[],r=0;t.length>r;r+=1)a[r]=s(t[r],n+"["+r+"]");else{a={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(a[o]=s(t[o],n+"["+JSON.stringify(o)+"]"))}return a;case"number":case"string":case"boolean":return t}}(t,"$")}),typeof JSON.retrocycle!="function"&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return function rez(value){var i,item,name,path;if(value&&typeof value=="object")if(Object.prototype.toString.apply(value)==="[object Array]")for(i=0;value.length>i;i+=1)item=value[i],item&&typeof item=="object"&&(path=item.$ref,typeof path=="string"&&px.test(path)?value[i]=eval(path):rez(item));else for(name in value)typeof value[name]=="object"&&(item=value[name],item&&(path=item.$ref,typeof path=="string"&&px.test(path)?value[name]=eval(path):rez(item)))}($),$});var $i_2=function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/,i=function(){},s=function(t,e,i){var s,n="";if(e=e||"log",i!==void 0&&console.warn(i),(e==="warning"||e==="error")&&igeDebug.stacks&&(igeDebug.node?(s=Error().stack,console.log("Stack:",s)):typeof printStackTrace=="function"&&console.log("Stack:",printStackTrace().join("\n ---- "))),e==="error"){if(igeDebug.throwErrors)throw n+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+"] : "+t;console.log(n+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+"] : "+t)}else console.log(n+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+"] : "+t);return this},n=function(){return this._classId},r=function(t,e){var i=new t(this,e);return this[i.componentId]=i,this._components.push(i),this},o=function(t){return this[t]&&this[t].destroy&&this[t].destroy(),this._components&&this._components.pull(this[t]),delete this[t],this},a=function(t,e){var i,s=t.prototype||t;for(i in s)s.hasOwnProperty(i)&&(e||this[i]===void 0)&&(this[i]=s[i]);return this},h=function(t,e){return t!==void 0?e!==void 0?(this._data[t]=e,this):this._data[t]:void 0};return i.extend=function(){function i(){this._data={},!t&&this.init&&(this._components=[],typeof ige!="undefined"&&(this.ige=ige),this.init.apply(this,arguments))}var u,l,d,c,_,g,p,f=this.prototype,m=arguments[arguments.length-1],y=arguments[0];if(!m.classId)throw console.log(m),"Cannot create a new class without giving the class a classId property!";if(igeClassStore[m.classId])throw'Cannot create class with classId "'+m.classId+'" because a class with that ID has already been created!';t=!0,l=new this,t=!1;for(u in m)typeof m[u]=="function"&&typeof f[u]=="function"&&e.test(m[u])?(l["__"+u]=m[u],l[u]=function(t,e){return function(){var i,s=this._super;return this._super=f[t],i=e["__"+t].apply(this,arguments),this._super=s,i}}(u,l)):l[u]=m[u];if(arguments.length>1&&y&&y.length)for(_=0;y.length>_;_++){d=y[_],p=d.extension.prototype||d.extension,c=d.overwrite;for(g in p)p.hasOwnProperty(g)&&(c||l[g]===void 0)&&(l[g]=p[g])}return i.prototype=l,i.prototype.constructor=i,i.extend=arguments.callee,i.prototype.log=s,i.prototype.data=h,i.prototype.classId=n,i.prototype._classId=m.classId||"$i_2",i.prototype.addComponent=r,i.prototype.removeComponent=o,i.prototype.implement=a,igeClassStore[m.classId]=i,i},i}();typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_2);var $i_3=$i_2.extend({classId:"$i_3",on:function(t,e,i,s,n){var r,o,a,h,u,l,d,c,_,g=this;if(this._eventListeners=this._eventListeners||{},typeof e=="function"){if(typeof t=="string")return r={call:e,context:i,oneShot:s,sendEventName:n},h=this._eventListeners[t]=this._eventListeners[t]||[],o=!0,a=h.indexOf(r),a>-1&&(o=!1),o&&h.push(r),r;if(t.length){u=[],u[0]=0,u[1]=0,u[3]=function(){u[1]++,u[0]===u[1]&&e.apply(i||g)};for(l in t)t.hasOwnProperty(l)&&(d=t[l],c=d[0],_=d[1],u[0]++,c.on(_,u[3],null,!0,!0))}}else typeof t!="string"&&(t="*Multi-Event*"),this.log('Cannot register event listener for event "'+t+'" because the passed callback is not a function!',"error")},emit:function(t,e){if(this._eventListeners&&this._eventListeners[t]){var i,s,n,r,o,a,h=this._eventListeners[t].length,u=this._eventListeners[t].length-1;if(h){if(i=[],typeof e=="object"&&e!==null&&e[0]!==null&&e[0]!==void 0)for(s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);else i=[e];n=!1,this._eventListeners._processing=!0;while(h--)r=u-h,o=this._eventListeners[t][r],o.sendEventName&&(i=[t]),a=o.call.apply(o.context||this,i),a===!0&&(n=!0),o.oneShot&&(this.off(t,o),u--);if(this._eventListeners._processing=!1,this._processRemovals(),n)return 1}}},_processRemovals:function(){if(this._eventListeners){var t,e,i,s=this._eventListeners._removeQueue;if(s){t=s.length;while(t--)e=s[t],i=this.off(e[0],e[1]),s[2]&&s[2](i)}delete this._eventListeners._removeQueue}},off:function(t,e,i){if(this._eventListeners){if(this._eventListeners._processing)return this._eventListeners._removeQueue=this._eventListeners._removeQueue||[],this._eventListeners._removeQueue.push([t,e,i]),-1;if(this._eventListeners[t]){var s=this._eventListeners[t].indexOf(e);if(s>-1)return this._eventListeners[t].splice(s,1),i&&i(!0),!0;this.log('Failed to cancel event listener for event named "'+t+'" !',"warning",e)}else this.log("Failed to cancel event listener!")}return i&&i(!1),!1},eventList:function(){return this._eventListeners}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_3);var $i_5=function(t,e,i,s){return s===void 0?this._floor=!0:this.floor(s),this.x=t=t!==void 0?t:0,this.y=e=e!==void 0?e:0,this.z=i=i!==void 0?i:0,this._floor?(this.x2=Math.floor(t/2),this.y2=Math.floor(e/2),this.z2=Math.floor(i/2)):(this.x2=t/2,this.y2=e/2,this.z2=i/2),this};$i_5.prototype.floor=function(t){return t!==void 0?(this._floor=t,this):this._floor},$i_5.prototype.compare=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},$i_5.prototype.toIso=function(){var t=this.x-this.y,e=-this.z*1.2247+(this.x+this.y)*.5;return{x:t,y:e}},$i_5.prototype.thisToIso=function(){var t=this.toIso();return this.x=t.x,this.y=t.y,this.z=0,this},$i_5.prototype.to2d=function(){var t=this.y+this.x/2,e=this.y-this.x/2;return{x:t,y:e}},$i_5.prototype.thisTo2d=function(){var t=this.to2d();return this.x=t.x,this.y=t.y,this.z=0,this},$i_5.prototype.addPoint=function(t){return new $i_5(this.x+t.x,this.y+t.y,this.z+t.z)},$i_5.prototype.thisAddPoint=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},$i_5.prototype.minusPoint=function(t){return new $i_5(this.x-t.x,this.y-t.y,this.z-t.z)},$i_5.prototype.thisMinusPoint=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},$i_5.prototype.multiply=function(t,e,i){return new $i_5(this.x*t,this.y*e,this.z*i)},$i_5.prototype.thisMultiply=function(t,e,i){return this.x*=t,this.y*=e,this.z*=i,this},$i_5.prototype.divide=function(t,e,i){return new $i_5(this.x/t,this.y/e,this.z/i)},$i_5.prototype.thisDivide=function(t,e,i){return this.x/=t,this.y/=e,this.z/=i,this},$i_5.prototype.clone=function(){return new $i_5(this.x,this.y,this.z)},$i_5.prototype.interpolate=function(t,e,i,s){var n=t.x-this.x,r=t.y-this.y,o=t.z-this.z,a=s-e,h=a-(i-e),u=h/a;return new $i_5(t.x-n*u,t.y-r*u,t.z-o*u)},$i_5.prototype.toString=function(t){return t===void 0&&(t=2),this.x.toFixed(t)+","+this.y.toFixed(t)+","+this.z.toFixed(t)},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_5);var $i_6=$i_2.extend({classId:"$i_6",init:function(){this._poly=[],this._scale=new $i_5(1,1,1)},scale:function(t,e){return t!==void 0&&e!==void 0?(this._scale.x=t,this._scale.y=e,this):this._scale},addPoint:function(t,e){return this._poly.push(new $i_5(t,e,0)),this},length:function(){return this._poly.length},pointInPoly:function(t){var e,i=this._poly,s=i.length,n=s-1,r=0;for(e=0;s>e;n=e++)i[e].y>t.y!=i[n].y>t.y&&(i[n].x-i[e].x)*(t.y-i[e].y)/(i[n].y-i[e].y)+i[e].x>t.x&&(r=!r);return r},render:function(t){var e=this._poly,s=e.length,n=this._scale.x,r=this._scale.y;for(t.beginPath(),t.moveTo(e[0].x*n,e[0].y*r),i=1;s>i;i++)t.lineTo(e[i].x*n,e[i].y*r);return t.lineTo(e[0].x*n,e[0].y*r),t.stroke(),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_6);var $i_7=function(t,e,i,s){return this.x=t=t!==void 0?t:0,this.y=e=e!==void 0?e:0,this.width=i=i!==void 0?i:0,this.height=s=s!==void 0?s:0,this};$i_7.prototype.compare=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},$i_7.prototype.xyInside=function(t,e){return t>=this.x&&e>this.y&&this.x+this.width>=t&&this.y+this.height>=e},$i_7.prototype.pointInside=function(t){return x>=this.x&&t.y>this.y&&this.x+this.width>=t.x&&this.y+this.height>=t.y},$i_7.prototype.rectIntersect=function(t){if(t){var e=this.x,i=this.y,s=this.width,n=this.height,r=t.x,o=t.y,a=t.width,h=t.height,u=e+s,l=i+n,d=r+a,c=o+h;if(d>e&&u>r&&c>i&&l>o)return!0}return!1},$i_7.prototype.toString=function(t){return t===void 0&&(t=2),this.x.toFixed(t)+","+this.y.toFixed(t)+","+this.width.toFixed(t)+","+this.height.toFixed(t)},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_7);var $i_8=function(){this.matrix=[1,0,0,0,1,0,0,0,1],this._rotateOrigin=new $i_5(0,0,0),this._scaleOrigin=new $i_5(0,0,0)};$i_8.prototype={matrix:null,transformCoord:function(t){var e=t.x,i=t.y,s=this.matrix;return t.x=e*s[0]+i*s[1]+s[2],t.y=e*s[3]+i*s[4]+s[5],t},transformCoordInverse:function(t){var e=t.x,i=t.y,s=this.matrix;return t.x=e*s[0]+i*s[1]-s[2],t.y=e*s[3]+i*s[4]-s[5],t},transform:function(t){var e,i=t.length;for(e=0;i>e;e++)this.transformCoord(t[e]);return t},_newRotate:function(t){var e=new $i_8;return e.rotateTo(t),e},rotateBy:function(t){var e=new $i_8;return e.translateBy(this._rotateOrigin.x,this._rotateOrigin.y),e.rotateTo(t),e.translateBy(-this._rotateOrigin.x,-this._rotateOrigin.y),this.multiply(e),this},rotateTo:function(t){var e=this.matrix,i=Math.cos(t),s=Math.sin(t);return e[0]=i,e[1]=-s,e[3]=s,e[4]=i,this},_newScale:function(t,e){var i=new $i_8;return i.matrix[0]=t,i.matrix[4]=e,i},scaleBy:function(t,e){var i=new $i_8;return i.matrix[0]=t,i.matrix[4]=e,this.multiply(i),this},scaleTo:function(t,e){return this.matrix[0]=t,this.matrix[4]=e,this},_newTranslate:function(t,e){var i=new $i_8;return i.matrix[2]=t,i.matrix[5]=e,i},translateBy:function(t,e){var i=new $i_8;return i.matrix[2]=t,i.matrix[5]=e,this.multiply(i),this},translateTo:function(t,e){return this.matrix[2]=t,this.matrix[5]=e,this},copy:function(t){t=t.matrix;var e=this.matrix;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},identity:function(){var t=this.matrix;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},multiply:function(t){var e=this.matrix,i=t.matrix,s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],h=e[5],u=e[6],l=e[7],d=e[8],c=i[0],_=i[1],g=i[2],p=i[3],f=i[4],m=i[5],y=i[6],v=i[7],x=i[8];return e[0]=s*c+n*p+r*y,e[1]=s*_+n*f+r*v,e[2]=s*g+n*m+r*x,e[3]=o*c+a*p+h*y,e[4]=o*_+a*f+h*v,e[5]=o*g+a*m+h*x,e[6]=u*c+l*p+d*y,e[7]=u*_+l*f+d*v,e[8]=u*g+l*m+d*x,this},premultiply:function(t){var e=t.matrix[0]*this.matrix[0]+t.matrix[1]*this.matrix[3]+t.matrix[2]*this.matrix[6],i=t.matrix[0]*this.matrix[1]+t.matrix[1]*this.matrix[4]+t.matrix[2]*this.matrix[7],s=t.matrix[0]*this.matrix[2]+t.matrix[1]*this.matrix[5]+t.matrix[2]*this.matrix[8],n=t.matrix[3]*this.matrix[0]+t.matrix[4]*this.matrix[3]+t.matrix[5]*this.matrix[6],r=t.matrix[3]*this.matrix[1]+t.matrix[4]*this.matrix[4]+t.matrix[5]*this.matrix[7],o=t.matrix[3]*this.matrix[2]+t.matrix[4]*this.matrix[5]+t.matrix[5]*this.matrix[8],a=t.matrix[6]*this.matrix[0]+t.matrix[7]*this.matrix[3]+t.matrix[8]*this.matrix[6],h=t.matrix[6]*this.matrix[1]+t.matrix[7]*this.matrix[4]+t.matrix[8]*this.matrix[7],u=t.matrix[6]*this.matrix[2]+t.matrix[7]*this.matrix[5]+t.matrix[8]*this.matrix[8];return this.matrix[0]=e,this.matrix[1]=i,this.matrix[2]=s,this.matrix[3]=n,this.matrix[4]=r,this.matrix[5]=o,this.matrix[6]=a,this.matrix[7]=h,this.matrix[8]=u,this},getInverse:function(){var t=this.matrix,e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],u=t[8],l=new $i_8,d=e*(r*u-h*o)-n*(i*u-h*s)+a*(i*o-r*s);if(d===0)return null;var c=l.matrix;return c[0]=r*u-o*h,c[1]=s*h-i*u,c[2]=i*o-s*r,c[3]=o*a-n*u,c[4]=e*u-s*a,c[5]=s*n-e*o,c[6]=n*h-r*a,c[7]=i*a-e*h,c[8]=e*r-i*n,l.multiplyScalar(1/d),l},multiplyScalar:function(t){var e;for(e=0;9>e;e++)this.matrix[e]*=t;return this},transformRenderingContextSet:function(t){var e=this.matrix;return t.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this},transformRenderingContext:function(t){var e=this.matrix;return t.transform(e[0],e[3],e[1],e[4],e[2],e[5]),this}},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_8);var $i_12=$i_2.extend({classId:"$i_12",componentId:"tween",init:function(t){this._entity=t,this._transform=t.transform,this._tweens=[],t.addBehaviour("tween",this._behaviour)},_behaviour:function(t){this.tween.tick(t)},start:function(t){var e,i=t._targetObj,s=t._propertyObj,n=[];if(i){t._startTime===void 0&&(t._startTime=(new Date).getTime()),t._durationMs===void 0&&(t._durationMs=0),t._endTime=t._startTime+t._durationMs;for(e in s)s.hasOwnProperty(e)&&n.push({targetObj:i,propName:e,startVal:i[e],endVal:s[e],deltaVal:s[e]-i[e]});return t._targetData=n,t._destTime=t._endTime-t._startTime,this._tweens.push(t),this.enable(),t}return this.log('Cannot start tweening properties of the specified object "'+obj+'" because it does not exist!',"error"),-1},stop:function(t){return this._tweens.pull(t),this._tweens.length||this.disable(),this},stopAll:function(){return this.disable(),delete this._tweens,this._tweens=[],this},enable:function(){return this._tweening||(this._tweening=!0),this},disable:function(){return this._tweening&&(this._tweening=!1),this},tick:function(){if(this._tweens&&this._tweens.length){var t,e,i,s,n,r,o,a=ige.tickStart,h=this._tweens,u=h.length;while(u--)if(t=h[u],t._started||a>=t._startTime)if(t._started||(typeof t._beforeTween=="function"&&(t._beforeTween(t),delete t._beforeTween),t._started=!0),e=a-t._startTime,i=t._destTime,s=t._easing,i>e){r=t._targetData;for(o in r)r.hasOwnProperty(o)&&(n=r[o],n.targetObj[n.propName]=this.easing[s](e,n.startVal,n.deltaVal,i))}else{r=t._targetData;for(o in r)r.hasOwnProperty(o)&&(n=r[o],n.targetObj[n.propName]=n.endVal);t.stop(),typeof t._afterTween=="function"&&(t._afterTween(t),delete t._afterTween)}}},easing:{none:function(t,e,i,s){return i*t/s+e},inQuad:function(t,e,i,s){return i*(t/=s)*t+e},outQuad:function(t,e,i,s){return-i*(t/=s)*(t-2)+e},inOutQuad:function(t,e,i,s){return 1>(t/=s/2)?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},inCubic:function(t,e,i,s){return i*(t/=s)*t*t+e},outCubic:function(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e},inOutCubic:function(t,e,i,s){return 1>(t/=s/2)?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},outInCubic:function(t,e,i,s){return s/2>t?this.outCubic(t*2,e,i/2,s):this.inCubic(t*2-s,e+i/2,i/2,s)},inQuart:function(t,e,i,s){return i*(t/=s)*t*t*t+e},outQuart:function(t,e,i,s){return-i*((t=t/s-1)*t*t*t-1)+e},inOutQuart:function(t,e,i,s){return 1>(t/=s/2)?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},outInQuart:function(t,e,i,s){return s/2>t?this.outQuart(t*2,e,i/2,s):this.inQuart(t*2-s,e+i/2,i/2,s)},inQuint:function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},outQuint:function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},inOutQuint:function(t,e,i,s){return 1>(t/=s/2)?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},outInQuint:function(t,e,i,s){return s/2>t?this.outQuint(t*2,e,i/2,s):this.inQuint(t*2-s,e+i/2,i/2,s)},inSine:function(t,e,i,s){return-i*Math.cos(t/s*(Math.PI/2))+i+e},outSine:function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},inOutSine:function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},outInSine:function(t,e,i,s){return s/2>t?this.outSine(t*2,e,i/2,s):this.inSine(t*2-s,e+i/2,i/2,s)},inExpo:function(t,e,i,s){return t===0?e:i*Math.pow(2,10*(t/s-1))+e-i*.001},outExpo:function(t,e,i,s){return t===s?e+i:i*1.001*(-Math.pow(2,-10*t/s)+1)+e},inOutExpo:function(t,e,i,s){return t===0?e:t===s?e+i:1>(t/=s/2)?i/2*Math.pow(2,10*(t-1))+e-i*5e-4:i/2*1.0005*(-Math.pow(2,-10*--t)+2)+e},outInExpo:function(t,e,i,s){return s/2>t?this.outExpo(t*2,e,i/2,s):this.inExpo(t*2-s,e+i/2,i/2,s)},inCirc:function(t,e,i,s){return-i*(Math.sqrt(1-(t/=s)*t)-1)+e},outCirc:function(t,e,i,s){return i*Math.sqrt(1-(t=t/s-1)*t)+e},inOutCirc:function(t,e,i,s){return 1>(t/=s/2)?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},outInCirc:function(t,e,i,s){return s/2>t?this.outCirc(t*2,e,i/2,s):this.inCirc(t*2-s,e+i/2,i/2,s)},inElastic:function(t,e,i,s,n,r){var o;return t===0?e:(t/=s)===1?e+i:(r||(r=s*.3),!n||Math.abs(i)>n?(n=i,o=r/4):o=r/(2*Math.PI)*Math.asin(i/n),-(n*Math.pow(2,10*(t-=1))*Math.sin((t*s-o)*2*Math.PI/r))+e)},outElastic:function(t,e,i,s,n,r){var o;return t===0?e:(t/=s)===1?e+i:(r||(r=s*.3),!n||Math.abs(i)>n?(n=i,o=r/4):o=r/(2*Math.PI)*Math.asin(i/n),n*Math.pow(2,-10*t)*Math.sin((t*s-o)*2*Math.PI/r)+i+e)},inOutElastic:function(t,e,i,s,n,r){var o;return t===0?e:(t/=s/2)===2?e+i:(r||(r=s*.3*1.5),!n||Math.abs(i)>n?(n=i,o=r/4):o=r/(2*Math.PI)*Math.asin(i/n),1>t?-.5*n*Math.pow(2,10*(t-=1))*Math.sin((t*s-o)*2*Math.PI/r)+e:n*Math.pow(2,-10*(t-=1))*Math.sin((t*s-o)*2*Math.PI/r)*.5+i+e)},outInElastic:function(t,e,i,s,n,r){return s/2>t?this.outElastic(t*2,e,i/2,s,n,r):this.inElastic(t*2-s,e+i/2,i/2,s,n,r)},inBack:function(t,e,i,s,n){return n===void 0&&(n=1.70158),i*(t/=s)*t*((n+1)*t-n)+e},outBack:function(t,e,i,s,n){return n===void 0&&(n=1.70158),i*((t=t/s-1)*t*((n+1)*t+n)+1)+e},inOutBack:function(t,e,i,s,n){return n===void 0&&(n=1.70158),1>(t/=s/2)?i/2*t*t*(((n*=1.525)+1)*t-n)+e:i/2*((t-=2)*t*(((n*=1.525)+1)*t+n)+2)+e},outInBack:function(t,e,i,s,n){return s/2>t?this.outBack(t*2,e,i/2,s,n):this.inBack(t*2-s,e+i/2,i/2,s,n)},inBounce:function(t,e,i,s){return i-this.outBounce(s-t,0,i,s)+e},outBounce:function(t,e,i,s){return 1/2.75>(t/=s)?i*7.5625*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},inOutBounce:function(t,e,i,s){return s/2>t?this.inBounce(t*2,0,i,s)*.5+e:this.outBounce(t*2-s,0,i,s)*.5+i*.5+e},outInBounce:function(t,e,i,s){return s/2>t?this.outBounce(t*2,e,i/2,s):this.inBounce(t*2-s,e+i/2,i/2,s)}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_12);var $i_14=$i_3.extend({classId:"$i_14",componentId:"input",init:function(){this._eventQueue=[],this._eventControl={_cancelled:!1,stopPropagation:function(){this._cancelled=!0}},this.tick(),this.mouse={dblClick:-302,down:-301,up:-300,move:-259,wheel:-258,wheelUp:-257,wheelDown:-256,x:-255,y:-254,button1:-253,button2:-252,button3:-251},this.pad1={button1:-250,button2:-249,button3:-248,button4:-247,button5:-246,button6:-245,button7:-244,button8:-243,button9:-242,button10:-241,button11:-240,button12:-239,button13:-238,button14:-237,button15:-236,button16:-235,button17:-234,button18:-233,button19:-232,button20:-231,stick1:-230,stick2:-229,stick1Up:-228,stick1Down:-227,stick1Left:-226,stick1Right:-225,stick2Up:-224,stick2Down:-223,stick2Left:-222,stick2Right:-221},this.pad2={button1:-220,button2:-219,button3:-218,button4:-217,button5:-216,button6:-215,button7:-214,button8:-213,button9:-212,button10:-211,button11:-210,button12:-209,button13:-208,button14:-207,button15:-206,button16:-205,button17:-204,button18:-203,button19:-202,button20:-201,stick1:-200,stick2:-199,stick1Up:-198,stick1Down:-197,stick1Left:-196,stick1Right:-195,stick2Up:-194,stick2Down:-193,stick2Left:-192,stick2Right:-191},this.key={shift:-3,ctrl:-2,alt:-1,backspace:8,tab:9,enter:13,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90},this._controlMap=[],this._state=[],this._state[this.mouse.x]=0,this._state[this.mouse.y]=0},debug:function(t){return t!==void 0?(this._debug=t,this):this._debug},_rationalise:function(t,e){if(t.igeType==="key"&&t.keyCode===8){var i=t.srcElement||t.target;i.tagName.toLowerCase()==="body"&&t.preventDefault()}t.igeType==="touch"&&t.preventDefault(),e?(t.button=0,t.changedTouches&&t.changedTouches.length&&(t.igePageX=t.changedTouches[0].pageX,t.igePageY=t.changedTouches[0].pageY)):(t.igePageX=t.pageX,t.igePageY=t.pageY),t.igeX=t.igePageX-this._canvas.offsetLeft,t.igeY=t.igePageY-this._canvas.offsetTop},setupListeners:function(t){this.log("Setting up input event listeners..."),this._canvas=t;var e=this;this._evRef={mousedown:function(t){t.igeType="mouse",e._rationalise(t),e._mouseDown(t)},mouseup:function(t){t.igeType="mouse",e._rationalise(t),e._mouseUp(t)},mousemove:function(t){t.igeType="mouse",e._rationalise(t),e._mouseMove(t)},mousewheel:function(t){t.igeType="mouse",e._rationalise(t),e._mouseWheel(t)},touchmove:function(t){t.igeType="touch",e._rationalise(t,!0),e._mouseMove(t)},touchstart:function(t){t.igeType="touch",e._rationalise(t,!0),e._mouseDown(t)},touchend:function(t){t.igeType="touch",e._rationalise(t,!0),e._mouseUp(t)},contextmenu:function(t){t.preventDefault()},keydown:function(t){t.igeType="key",e._rationalise(t),e._keyDown(t)},keyup:function(t){t.igeType="key",e._rationalise(t),e._keyUp(t)}},t.addEventListener("mousedown",this._evRef.mousedown,!1),t.addEventListener("mouseup",this._evRef.mouseup,!1),t.addEventListener("mousemove",this._evRef.mousemove,!1),t.addEventListener("mousewheel",this._evRef.mousewheel,!1),t.addEventListener("touchmove",this._evRef.touchmove,!1),t.addEventListener("touchstart",this._evRef.touchstart,!1),t.addEventListener("touchend",this._evRef.touchend,!1),t.addEventListener("contextmenu",this._evRef.contextmenu,!1),window.addEventListener("keydown",this._evRef.keydown,!1),window.addEventListener("keyup",this._evRef.keyup,!1)},destroyListeners:function(){this.log("Removing input event listeners...");var t=this._canvas;t.removeEventListener("mousedown",this._evRef.mousedown,!1),t.removeEventListener("mouseup",this._evRef.mouseup,!1),t.removeEventListener("mousemove",this._evRef.mousemove,!1),t.removeEventListener("mousewheel",this._evRef.mousewheel,!1),t.removeEventListener("touchmove",this._evRef.touchmove,!1),t.removeEventListener("touchstart",this._evRef.touchstart,!1),t.removeEventListener("touchend",this._evRef.touchend,!1),t.removeEventListener("contextmenu",this._evRef.contextmenu,!1),window.removeEventListener("keydown",this._evRef.keydown,!1),window.removeEventListener("keyup",this._evRef.keyup,!1)},_mouseDown:function(t){this._debug&&console.log("Mouse Down",t),this._updateMouseData(t);var e=t.igeX-ige.geometry.x2,i=t.igeY-ige.geometry.y2,s=this;t.igeBaseX=e,t.igeBaseY=i,t.button===0&&(this._state[this.mouse.button1]=!0),t.button===1&&(this._state[this.mouse.button2]=!0),t.button===2&&(this._state[this.mouse.button3]=!0),this.mouseDown=t,this.queueEvent(this,function(){s.emit("mouseDown",[t,e,i,t.button+1])})},_mouseUp:function(t){this._debug&&console.log("Mouse Up",t),this._updateMouseData(t);var e=t.igeX-ige.geometry.x2,i=t.igeY-ige.geometry.y2,s=this;t.igeBaseX=e,t.igeBaseY=i,t.button===0&&(this._state[this.mouse.button1]=!1),t.button===1&&(this._state[this.mouse.button2]=!1),t.button===2&&(this._state[this.mouse.button3]=!1),this.mouseUp=t,this.queueEvent(this,function(){s.emit("mouseUp",[t,e,i,t.button+1])})},_mouseMove:function(t){ige._mouseOverVp=this._updateMouseData(t);var e=t.igeX-ige.geometry.x2,i=t.igeY-ige.geometry.y2,s=this;t.igeBaseX=e,t.igeBaseY=i,this._state[this.mouse.x]=e,this._state[this.mouse.y]=i,this.mouseMove=t,this.queueEvent(this,function(){s.emit("mouseMove",[t,e,i,t.button+1])})},_mouseWheel:function(t){this._updateMouseData(t);var e=t.igeX-ige.geometry.x2,i=t.igeY-ige.geometry.y2,s=this;t.igeBaseX=e,t.igeBaseY=i,this._state[this.mouse.wheel]=t.wheelDelta,t.wheelDelta>0?this._state[this.mouse.wheelUp]=!0:this._state[this.mouse.wheelDown]=!0,this.mouseWheel=t,this.queueEvent(this,function(){s.emit("mouseWheel",[t,e,i,t.button+1])
})},_keyDown:function(t){var e=this;this._state[t.keyCode]=!0,this.queueEvent(this,function(){e.emit("keyDown",[t,t.keyCode])})},_keyUp:function(t){var e=this;this._state[t.keyCode]=!1,this.queueEvent(this,function(){e.emit("keyUp",[t,t.keyCode])})},_updateMouseData:function(t){var e,i,s=ige._children,n=s.length,r=t.igeX-ige.geometry.x/2,o=t.igeY-ige.geometry.y/2;ige._mousePos.x=r,ige._mousePos.y=o;while(n--)if(e=s[s.length-(n+1)],r>e._translate.x-e.geometry.x/2&&e._translate.x+e.geometry.x/2>r&&o>e._translate.y-e.geometry.y/2&&e._translate.y+e.geometry.y/2>o){e._mousePos=new $i_5(Math.floor((r-e._translate.x)/e.camera._scale.x+e.camera._translate.x),Math.floor((o-e._translate.y)/e.camera._scale.y+e.camera._translate.y),0),i=e;break}return i},mapAction:function(t,e){this._controlMap[t]=e},actionVal:function(t){return this._state[this._controlMap[t]]},actionState:function(t){var e=this._state[this._controlMap[t]];return!!e},val:function(t){return this._state[t]},state:function(t){return!!this._state[t]},stopPropagation:function(){return this._eventControl._cancelled=!0,this},queueEvent:function(t,e){return e!==void 0&&this._eventQueue.push([t,e]),this},tick:function(){var t=this._eventQueue,e=t.length,i=this._eventControl;while(e--)if(t[e][1].apply(t[e][0],[i]),i._cancelled)break;this._eventQueue=[],this._eventControl._cancelled=!1,this.dblClick=!1,this.mouseMove=!1,this.mouseDown=!1,this.mouseUp=!1,this.mouseWheel=!1},emit:function(t,e){if(this._eventListeners&&this._eventListeners[t]){var i,s,n,r,o,a,h=this._eventListeners[t].length,u=this._eventListeners[t].length-1,l=this._eventControl;if(h){if(i=[],typeof e=="object"&&e!==null&&e[0]!==null)for(s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);else i=[e];n=!1,this._eventListeners._processing=!0;while(h--){if(l._cancelled)break;r=u-h,o=this._eventListeners[t][r],o.sendEventName&&(i=[t]),a=o.call.apply(o.context||this,i),(a===!0||this._eventControl._cancelled===!0)&&(n=!0),o.oneShot&&this.off(t,o)}if(this._eventListeners._processing=!1,this._processRemovals(),n)return 1}}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_14);var $i_22={timeSyncInterval:function(t){return t!==void 0?(this._timeSyncInterval=t,this._entity):this._timeSyncInterval},_onTimeSync:function(t,e){var i,s,n=(new Date).getTime();ige.isServer||(n=(new Date).getTime(),i=parseInt(t,10),this._latency=n-i,this._sendTimeSync([t,n])),ige.isServer&&(i=parseInt(t[1],10),s=n-parseInt(t[0],10),this._timeSyncLog[e]=n-i)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_22);var $i_23=$i_3.extend({classId:"$i_23",componentId:"stream",init:function(t,e){this._entity=t,this._options=e;var i=this;ige.isServer||(this._entity.define("_igeStream",function(){i._onStreamData.apply(i,arguments)}),this._entity.define("_igeStreamTime",function(){i._onStreamTime.apply(i,arguments)})),this._renderLatency=100,this._streamInterval=50},renderLatency:function(t){return t!==void 0?(this._renderLatency=t,this._entity):this._renderLatency},sendInterval:function(t){return t!==void 0?(this.log("Setting delta stream interval to "+t+"ms"),this._streamInterval=t,this._entity):this._streamInterval},start:function(){var t=this;return this.log("Starting delta stream..."),this._streamTimer=setInterval(function(){t._sendQueue()},this._streamInterval),this._entity},stop:function(){return this._stopTimeSync(),this.log("Stopping delta stream..."),clearInterval(this._streamTimer),this._entity},queue:function(t,e,i){return this._queuedData[t]=[e,i],this._entity},_sendQueue:function(){var t,e,i,s,n=(new Date).getTime(),r=this._queuedData,o=this._entity,a=(new Date).getTime(),h={};for(i in r)if(r.hasOwnProperty(i)&&(s=r[i],h[s[1]]||(o.send("_igeStreamTime",a,s[1]),h[s[1]]=!0),o.send("_igeStream",s[0],s[1]),delete r[i]),t=(new Date).getTime(),e=t-n,e>this._streamInterval){console.log("WARNING, Stream send is taking too long: "+e+"ms");break}},_onStreamTime:function(t){this._streamDataTime=t},_onStreamData:function(t){var e,i,s,n,r,o,a,h,u,l,d,c,_=t.split("|"),g=_.length;if(e=_.shift(),i=e.split(","),s=i[0],n=i[1],r=i[2],a=parseInt(i[3],10),u=ige.$(n))if(h=ige.$(s),a)for(h||(o=igeClassStore[r],o?(h=(new o).id(s).mount(u),c=!0,this.emit("entityCreated",h)):(ige.stop(),ige.network.stop(),this.log("Cannot create entity with class "+r+" because the class has not been defined!","error"))),l=h._streamSections,d=0;g>d;d++)h.streamSectionData(l[d],_[d],c);else h&&h.destroy()}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_23);var $i_39=$i_3.extend({classId:"$i_39",componentId:"cocoonJs",init:function(){this.detected=typeof ext!="undefined"&&ext.IDTK_APP!==void 0,this.detected&&this.log("CocoonJS support enabled!")},showInputDialog:function(t,e,i,s,n,r){this.detected?(t=t||"",e=e||"",i=i||"",s=s||"text",n=n||"Cancel",r=r||"OK",ext.IDTK_APP.makeCall("showTextDialog",t,e,i,s,n,r)):this.log("Cannot open CocoonJS input dialog! CocoonJS is not detected!","error")},showWebView:function(t){this.detected&&(ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('loadPath', '"+t+"')"),ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('show');"))},hideWebView:function(){this.detected&&ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('hide');")}}),$i_40={translateBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._translate.x+=t,this._translate.y+=e,this._translate.z+=i):this.log("translateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translateTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._translate.x=t,this._translate.y=e,this._translate.z=i):this.log("translateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translate:function(){return this.x=this._translateAccessorX,this.y=this._translateAccessorY,this.z=this._translateAccessorZ,this._entity||this},_translateAccessorTween:function(t,e,i){return new $i_47(this._translate,t,e,i)},_translateAccessorX:function(t){return t!==void 0?(this._translate.x=t,this._entity||this):this._translate.x},_translateAccessorY:function(t){return t!==void 0?(this._translate.y=t,this._entity||this):this._translate.y},_translateAccessorZ:function(t){return t!==void 0?(this._translate.z=t,this._entity||this):this._translate.z},rotateBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._rotate.x+=t,this._rotate.y+=e,this._rotate.z+=i):this.log("rotateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotateTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._rotate.x=t,this._rotate.y=e,this._rotate.z=i):this.log("rotateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotate:function(){return this.x=this._rotateAccessorX,this.y=this._rotateAccessorY,this.z=this._rotateAccessorZ,this._entity||this},_rotateAccessorTween:function(t,e,i){return new $i_47(this._rotate,t,e,i)},_rotateAccessorX:function(t){return t!==void 0?(this._rotate.x=t,this._entity||this):this._rotate.x},_rotateAccessorY:function(t){return t!==void 0?(this._rotate.y=t,this._entity||this):this._rotate.y},_rotateAccessorZ:function(t){return t!==void 0?(this._rotate.z=t,this._entity||this):this._rotate.z},scaleBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._scale.x+=t,this._scale.y+=e,this._scale.z+=i):this.log("scaleBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scaleTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._scale.x=t,this._scale.y=e,this._scale.z=i):this.log("scaleTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scale:function(){return this.x=this._scaleAccessorX,this.y=this._scaleAccessorY,this.z=this._scaleAccessorZ,this._entity||this},_scaleAccessorTween:function(t,e,i){return new $i_47(this._scale,t,e,i)},_scaleAccessorX:function(t){return t!==void 0?(this._scale.x=t,this._entity||this):this._scale.x},_scaleAccessorY:function(t){return t!==void 0?(this._scale.y=t,this._entity||this):this._scale.y},_scaleAccessorZ:function(t){return t!==void 0?(this._scale.z=t,this._entity||this):this._scale.z},originBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._origin.x+=t,this._origin.y+=e,this._origin.z+=i):this.log("originBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},originTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._origin.x=t,this._origin.y=e,this._origin.z=i):this.log("originTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},origin:function(){return this.x=this._originAccessorX,this.y=this._originAccessorY,this.z=this._originAccessorZ,this._entity||this},_originAccessorTween:function(t,e,i){return new $i_47(this._origin,t,e,i)},_originAccessorX:function(t){return t!==void 0?(this._origin.x=t,this._entity||this):this._origin.x},_originAccessorY:function(t){return t!==void 0?(this._origin.y=t,this._entity||this):this._origin.y},_originAccessorZ:function(t){return t!==void 0?(this._origin.z=t,this._entity||this):this._origin.z},_rotatePoint:function(t,e,i){var s=Math.cos(e),n=Math.sin(e);return{x:i.x+(t.x-i.x)*s+(t.y-i.y)*n,y:i.y-(t.x-i.x)*n+(t.y-i.y)*s}},updateTransform:function(){if(this._localMatrix.identity(),this._mode===0&&this._localMatrix.multiply(this._localMatrix._newTranslate(this._translate.x,this._translate.y)),this._mode===1){var t=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this.geometry.z/2).toIso();this._parent&&this._parent.geometry.z&&(t.y+=this._parent.geometry.z/1.6),this._localMatrix.multiply(this._localMatrix._newTranslate(t.x,t.y))}this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z)),this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y)),this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_40);var $i_41={left:function(t){return t!==void 0?(this._uiX=t,this._uiXAlign="left",this._updateUiPosition(),this):this._uiX},center:function(t){return t!==void 0?(this._uiX=t,this._uiXAlign="center",this._updateUiPosition(),this):this._uiX},right:function(t){return t!==void 0?(this._uiX=t,this._uiXAlign="right",this._updateUiPosition(),this):this._uiX},top:function(t){return t!==void 0?(this._uiY=t,this._uiYAlign="top",this._updateUiPosition(),this):this._uiY},middle:function(t){return t!==void 0?(this._uiY=t,this._uiYAlign="middle",this._updateUiPosition(),this):this._uiY},bottom:function(t){return t!==void 0?(this._uiY=t,this._uiYAlign="bottom",this._updateUiPosition(),this):this._uiY},width:function(t,e,i){if(t!==void 0){if(this._width=t,this._widthModifier=e!==void 0?e:0,typeof t=="string")if(this._parent){var s=this._parent.geometry.x,n=parseInt(t,10);this.geometry.x=s/100*n+this._widthModifier|0,this.geometry.x2=Math.floor(this.geometry.x/2)}else{var s=ige.geometry.x,n=parseInt(t,10);this.geometry.x=s/100*n+this._widthModifier|0,this.geometry.x2=Math.floor(this.geometry.x/2)}else this.geometry.x=t,this.geometry.x2=Math.floor(this.geometry.x/2);return i||this._updateUiPosition(),this}return this._width},height:function(t,e,i){if(t!==void 0){if(this._height=t,this._heightModifier=e!==void 0?e:0,typeof t=="string")if(this._parent){var s=this._parent.geometry.y,n=parseInt(t,10);this.geometry.y=s/100*n+this._heightModifier|0,this.geometry.y2=Math.floor(this.geometry.y/2)}else{var s=ige.geometry.y,n=parseInt(t,10);this.geometry.y=s/100*n+this._heightModifier|0,this.geometry.y2=Math.floor(this.geometry.y/2)}else this.geometry.y=t,this.geometry.y2=Math.floor(this.geometry.y/2);return i||this._updateUiPosition(),this}return this._height},_updateUiPosition:function(){if(this._parent){var t=this._parent.geometry,e=this.geometry;this._width&&this.width(this._width,this._widthModifier,!0),this._height&&this.height(this._height,this._heightModifier,!0),this._uiXAlign==="right"?this._translate.x=Math.floor(t.x2-e.x2-this._uiX):this._uiXAlign==="center"?this._translate.x=Math.floor(this._uiX):this._uiXAlign==="left"&&(this._translate.x=Math.floor(this._uiX+e.x2-t.x2)),this._uiYAlign==="bottom"?this._translate.y=Math.floor(t.y2-e.y2-this._uiY):this._uiYAlign==="middle"?this._translate.y=Math.floor(this._uiY):this._uiYAlign==="top"&&(this._translate.y=Math.floor(this._uiY+e.y2-t.y2)),this.dirty(!0)}}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_41);var $i_42={backgroundImage:function(t,e){if(t&&t.image){if(e||(e="no-repeat"),this._patternRepeat=e,this._patternTexture=t,this._backgroundSize?(t.resize(this._backgroundSize.x,this._backgroundSize.y),this._patternWidth=this._backgroundSize.x,this._patternHeight=this._backgroundSize.y):(this._patternWidth=t.image.width,this._patternHeight=t.image.height),this._cell>1){var i=document.createElement("canvas"),s=i.getContext("2d"),n=t._cells[this._cell];i.width=n[2],i.height=n[3],s.drawImage(t.image,n[0],n[1],n[2],n[3],0,0,n[2],n[3]),this._patternFill=ige._ctx.createPattern(i,e)}else this._patternFill=ige._ctx.createPattern(t.image,e);return t.restoreOriginal(),this.dirty(!0),this}return this._patternFill},backgroundSize:function(t,e){return t!==void 0&&e!==void 0?(typeof t=="string"&&(t=this.geometry.x/100*parseInt(t,10)),typeof e=="string"&&(e=this.geometry.y/100*parseInt(e,10)),this._backgroundSize={x:t,y:e},this._patternTexture&&this._patternRepeat&&this.backgroundImage(this._patternTexture,this._patternRepeat),this.dirty(!0),this):this._backgroundSize},backgroundColor:function(t){return t!==void 0?(this._backgroundColor=t,this.dirty(!0),this):this._backgroundColor},backgroundPosition:function(t,e){return t!==void 0&&e!==void 0?(this._backgroundPosition={x:t,y:e},this.dirty(!0),this):this._backgroundPosition},borderColor:function(t){return t!==void 0?(this._borderColor=t,this._borderLeftColor=t,this._borderTopColor=t,this._borderRightColor=t,this._borderBottomColor=t,this.dirty(!0),this):this._borderColor},borderLeftColor:function(t){return t!==void 0?(this._borderLeftColor=t,this.dirty(!0),this):this._borderLeftColor},borderTopColor:function(t){return t!==void 0?(this._borderTopColor=t,this.dirty(!0),this):this._borderTopColor},borderRightColor:function(t){return t!==void 0?(this._borderRightColor=t,this.dirty(!0),this):this._borderRightColor},borderBottomColor:function(t){return t!==void 0?(this._borderBottomColor=t,this.dirty(!0),this):this._borderBottomColor},borderWidth:function(t){return t!==void 0?(this._borderWidth=t,this._borderLeftWidth=t,this._borderTopWidth=t,this._borderRightWidth=t,this._borderBottomWidth=t,this.dirty(!0),this):this._borderWidth},borderLeftWidth:function(t){return t!==void 0?(this._borderLeftWidth=t,this.dirty(!0),this):this._borderLeftWidth},borderTopWidth:function(t){return t!==void 0?(this._borderTopWidth=t,this.dirty(!0),this):this._borderTopWidth},borderRightWidth:function(t){return t!==void 0?(this._borderRightWidth=t,this.dirty(!0),this):this._borderRightWidth},borderBottomWidth:function(t){return t!==void 0?(this._borderBottomWidth=t,this.dirty(!0),this):this._borderBottomWidth},borderRadius:function(t){return t!==void 0?(this._borderRadius=t,this._borderTopLeftRadius=t,this._borderTopRightRadius=t,this._borderBottomRightRadius=t,this._borderBottomLeftRadius=t,this.dirty(!0),this):this._borderRadius},padding:function(t,e,i,s){return this._paddingLeft=t,this._paddingTop=e,this._paddingRight=i,this._paddingBottom=s,this.dirty(!0),this},paddingLeft:function(t){return t!==void 0?(this._paddingLeft=t,this.dirty(!0),this):this._paddingLeft},paddingTop:function(t){return t!==void 0?(this._paddingTop=t,this.dirty(!0),this):this._paddingTop},paddingRight:function(t){return t!==void 0?(this._paddingRight=t,this.dirty(!0),this):this._paddingRight},paddingBottom:function(t){return t!==void 0?(this._paddingBottom=t,this.dirty(!0),this):this._paddingBottom}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_42);var $i_43={mouseMove:function(t){return t?(this._mouseMove=t,this._mouseEventsActive=!0,this):this._mouseMove},mouseMoveOff:function(){delete this._mouseMove},mouseOver:function(t){return t?(this._mouseOver=t,this._mouseEventsActive=!0,this):this._mouseOver},mouseOverOff:function(){delete this._mouseOver},mouseOut:function(t){return t?(this._mouseOut=t,this._mouseEventsActive=!0,this):this._mouseOut},mouseOutOff:function(){delete this._mouseOut},mouseUp:function(t){return t?(this._mouseUp=t,this._mouseEventsActive=!0,this):this._mouseUp},mouseUpOff:function(){delete this._mouseUp},mouseDown:function(t){return t?(this._mouseDown=t,this._mouseEventsActive=!0,this):this._mouseDown},mouseDownOff:function(){delete this._mouseDown},_handleMouseIn:function(t){this._mouseStateOver||(this._mouseStateOver=!0,this._mouseOver&&this._mouseOver(t)),this._mouseMove&&this._mouseMove(t)},_handleMouseOut:function(t){this._mouseStateDown=!1,this._mouseStateOver&&(this._mouseStateOver=!1,this._mouseOut&&this._mouseOut(t))},_handleMouseUp:function(t){this._mouseStateDown=!1,this._mouseUp&&this._mouseUp(t)},_handleMouseDown:function(t){this._mouseStateDown||(this._mouseStateDown=!0,this._mouseDown&&this._mouseDown(t))}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_43);var nullMethod=function(){},$i_44={dummy:!0,save:nullMethod,restore:nullMethod,translate:nullMethod,rotate:nullMethod,scale:nullMethod,drawImage:nullMethod,fillRect:nullMethod,strokeRect:nullMethod,stroke:nullMethod,fill:nullMethod,rect:nullMethod,moveTo:nullMethod,lineTo:nullMethod,arc:nullMethod,clearRect:nullMethod,beginPath:nullMethod,clip:nullMethod,transform:nullMethod,setTransform:nullMethod,fillText:nullMethod};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_44);var $i_45=$i_2.extend({classId:"$i_45",init:function(t,e,i,s,n,r){this.x=t,this.y=e,this.g=i+s,this.h=n,this.moveCost=s,this.f=i+n,this.link=r,this.hash=t+","+e,this.listType=0}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_45);var $i_46=$i_3.extend({classId:"$i_46",init:function(){this._neighbourLimit=1e3},neighbourLimit:function(t){return t!==void 0?(this._neighbourLimit=t,this):this._neighbourLimit},aStar:function(t,e,i,s,n,r,o){var a,h,u,l,d,c,_,g,p,f,m,y,v,x=[],w=[],b={};if(n===void 0&&(n=!0),r===void 0&&(r=!1),m=t.map._mapData,f=m[i.y]&&m[i.y][i.x]?m[i.y][i.x]:null,!o&&!s(f,i.x,i.y))return this.emit("noPathFound"),[];a=new $i_45(e.x,e.y,0,0,this._heuristic(e.x,e.y,i.x,i.y,10)),a.link=1,x.push(a),b[a.hash]=a,a.listType=1,v=a;while(x.length){if(x.length>this._neighbourLimit){this.emit("exceededLimit");break}h=0,u=x.length;while(u--)x[h].f>x[u].f&&(h=u);if(l=x[h],l.x===i.x&&l.y===i.y){d=l,c=[];while(d.link)c.push(d),d=d.link;return this.emit("pathFound",c),c.reverse()}x.splice(h,1),w.push(l),l.listType=-1,_=this._getNeighbours(l,i,t,s,n,r),g=_.length;while(g--)p=_[g],y=b[p.hash],y&&y.listType===-1||(y&&y.listType===1?y.g>p.g&&(y.link=p.link,y.g=p.g,y.f=p.f):(x.push(p),b[p.hash]=p,p.listType=1,y=p)),(!v||v.h>y.h)&&(v=y)}if(!o||o&&!v)return this.emit("noPathFound"),[];d=v,c=[];while(d.link)c.push(d),d=d.link;return this.emit("pathFound",c),c.reverse()},_getNeighbours:function(t,e,i,s,n,r){var o,a,h=[],u=t.x,l=t.y,d=0,c=0,_=i.map._mapData,g=_[l]&&_[l][u]?_[l][u]:void 0;return n&&(d=u-1,c=l,a=_[c]&&_[c][d]?_[c][d]:null,s(a,d,c,g,u,l)&&(o=new $i_45(d,c,t.g,10,this._heuristic(d,c,e.x,e.y,10),t),h.push(o)),d=u+1,c=l,a=_[c]&&_[c][d]?_[c][d]:null,s(a,d,c,g,u,l)&&(o=new $i_45(d,c,t.g,10,this._heuristic(d,c,e.x,e.y,10),t),h.push(o)),d=u,c=l-1,a=_[c]&&_[c][d]?_[c][d]:null,s(a,d,c,g,u,l)&&(o=new $i_45(d,c,t.g,10,this._heuristic(d,c,e.x,e.y,10),t),h.push(o)),d=u,c=l+1,a=_[c]&&_[c][d]?_[c][d]:null,s(a,d,c,g,u,l)&&(o=new $i_45(d,c,t.g,10,this._heuristic(d,c,e.x,e.y,10),t),h.push(o))),r&&(d=u-1,c=l-1,a=_[c]&&_[c][d]?_[c][d]:null,s(a,d,c,g,u,l)&&(o=new $i_45(d,c,t.g,14,this._heuristic(d,c,e.x,e.y,14),t),h.push(o)),d=u+1,c=l-1,a=_[c]&&_[c][d]?_[c][d]:null,s(a,d,c,g,u,l)&&(o=new $i_45(d,c,t.g,14,this._heuristic(d,c,e.x,e.y,14),t),h.push(o)),d=u-1,c=l+1,a=_[c]&&_[c][d]?_[c][d]:null,s(a,d,c,g,u,l)&&(o=new $i_45(d,c,t.g,14,this._heuristic(d,c,e.x,e.y,14),t),h.push(o)),d=u+1,c=l+1,a=_[c]&&_[c][d]?_[c][d]:null,s(a,d,c,g,u,l)&&(o=new $i_45(d,c,t.g,14,this._heuristic(d,c,e.x,e.y,14),t),h.push(o))),h},_heuristic:function(t,e,i,s,n){return n*(Math.abs(t-i)+Math.abs(e-s))},as:function(t,e){var i=[];i.push(e)},_as:function(){}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_46);var $i_47=$i_2.extend({classId:"$i_47",init:function(t,e,i,s){this._targetObj=t,this._propertyObj=e!==void 0?e:{},this._durationMs=i!==void 0?i:0,this._started=!1,s&&s.easing?this.easing(s.easing):this.easing("none"),s&&s.startTime!==void 0&&this.startTime(s.startTime),s&&s.beforeTween!==void 0&&this.beforeTween(s.beforeTween),s&&s.afterTween!==void 0&&this.afterTween(s.afterTween)},targetObj:function(t){return t!==void 0&&(this._targetObj=t),this},properties:function(t){return t!==void 0&&(this._propertyObj=t),this},duration:function(t){return t!==void 0&&(this._durationMs=t),this},beforeTween:function(t){return t!==void 0&&(this._beforeTween=t),this},afterTween:function(t){return t!==void 0&&(this._afterTween=t),this},easing:function(t){return t!==void 0&&(this._easing=t),this},startTime:function(t){return t!==void 0&&(this._startTime=t),this},start:function(){return ige.tween.start(this),this._targetObj._tweenArr=this._targetObj._tweenArr||[],this._targetObj._tweenArr.push(this),this},stop:function(){return ige.tween.stop(this),this._targetObj._tweenArr.pull(this),this},startAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(t){t.start()}),this},stopAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(t){t.stop()}),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_47);var $i_48=$i_3.extend({classId:"$i_48",$i_48:!0,init:function(t){this._cells=[],t&&this.url(t)},id:function(t){if(t!==void 0){if(!ige._register[t])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=t,ige.register(this),this;this.log('Cannot set ID of object to "'+t+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=ige.newIdHex(),ige.register(this)),this._id},url:function(t){return t!==void 0?(this._url=t,t.substr(t.length-2,2)==="js"?this._loadScript(t):this._loadImage(t),this):this._url},_loadImage:function(t){var e,i=this;ige.isServer||(ige.textureLoadStart(t,this),ige._textureImageStore[t]?(e=this.image=this._originalImage=ige._textureImageStore[t],e._igeTextures.push(this),e._loaded&&(i._mode=0,i.sizeX(e.width),i.sizeY(e.height),i._cells[1]=[0,0,i._sizeX,i._sizeY],i._loaded=!0,setTimeout(function(){i.emit("loaded"),ige.textureLoadEnd(t,i)},1))):(e=ige._textureImageStore[t]=this.image=this._originalImage=new Image,e._igeTextures=e._igeTextures||[],e._igeTextures.push(this),e.onload=function(){this._loaded=!0,ige.log('Texture image "'+t+'" loaded successfully');var s,n,r=this._igeTextures,o=r.length;for(s=0;o>s;s++)n=r[s],n._mode=0,n.sizeX(e.width),n.sizeY(e.height),n._cells[1]=[0,0,n._sizeX,n._sizeY],n._loaded=!0,n.emit("loaded"),ige.textureLoadEnd(t,i)},e.src=t))},_loadScript:function(scriptUrl){var textures=ige.textures,rs_sandboxContext,self=this,scriptElem;ige.textureLoadStart(scriptUrl,this),ige.isServer||(scriptElem=document.createElement("script"),scriptElem.onload=function(data){self.log('Texture script "'+scriptUrl+'" loaded successfully'),eval(data),self._mode=1,self.script=image,typeof image.init=="function"&&image.init.apply(image,[self]),self._loaded=!0,self.emit("loaded"),ige.textureLoadEnd(scriptUrl,self)},scriptElem.addEventListener("error",function(){self.log("Error loading smart texture script file: "+scriptUrl,"error")},!0),scriptElem.src=scriptUrl,document.getElementsByTagName("head")[0].appendChild(scriptElem)),ige.isServer&&(rs_sandboxContext={},textures.fs.readFile(scriptUrl,this.bind(function(t,e){try{if(textures.vm.runInNewContext(e,rs_sandboxContext),typeof rs_sandboxContext.image=="object"){this.log('Texture script "'+scriptUrl+'" loaded successfully');var i=rs_sandboxContext.image;typeof i.init=="function"&&i.init.apply(i,[ige,this]),this.sizeX(i.width),this.sizeY(i.height),this._loaded=!0,self.emit("loaded"),ige.textureLoadEnd(scriptUrl,self)}else this.log("Error reading asset render script data. The script does not contain an image variable!","error",[this.url,rs_sandboxContext])}catch(s){this.log("Error executing asset render script: ","error",[s,this.url])}})))},sizeX:function(t){this._sizeX=t},sizeY:function(t){this._sizeY=t},resize:function(t,e,i){this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas")),this._textureCanvas.width=t,this._textureCanvas.height=e,this._textureCtx=this._textureCanvas.getContext("2d"),i||this._textureCtx.drawImage(this._originalImage,0,0,this._originalImage.width,this._originalImage.height,0,0,t,e),this.image=this._textureCanvas)},restoreOriginal:function(){this.image=this._originalImage,delete this._textureCtx,delete this._textureCanvas},smoothing:function(t){return t!==void 0?(this._smoothing=t,this):this._smoothing},render:function(t,e){if(e._cell!==null){if(this._smoothing?(ige._ctx.imageSmoothingEnabled=!0,ige._ctx.webkitImageSmoothingEnabled=!0,ige._ctx.mozImageSmoothingEnabled=!0):(ige._ctx.imageSmoothingEnabled=!1,ige._ctx.webkitImageSmoothingEnabled=!1,ige._ctx.mozImageSmoothingEnabled=!1),this._mode===0){var i=this._cells[e._cell],s=e.geometry,n=e._renderPos;i?(this._preFilter&&this._textureCtx&&(this._textureCtx.save(),this._preFilter(this._textureCanvas,this._textureCtx,this._originalImage,this,this._preFilterData),this._textureCtx.restore()),t.drawImage(this.image,i[0],i[1],i[2],i[3],n.x,n.y,s.x,s.y),ige._drawCount++):this.log("Cannot render texture using cell "+e._cell+" because the cell does not exist in the assigned texture!","error")}this._mode===1&&(t.save(),this.script.render(t,e,this),t.restore(),ige._drawCount++)}},preFilter:function(t,e){return t!==void 0?(this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d")),this.image=this._textureCanvas,this._preFilter=t,this._preFilterData=e),this):(this.log("Cannot use pre-filter, no filter method was passed!","warning"),this._preFilter)},applyFilter:function(t,e){return t!==void 0?this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d")),this.image=this._textureCanvas,this._textureCtx.save(),t(this._textureCanvas,this._textureCtx,this._originalImage,this,e),this._textureCtx.restore()):this.log("Cannot apply filter, no filter method was passed!","warning"),this},stringify:function(){var t="new "+this.classId()+"('"+this._url+"')";return t+=".id('"+this.id()+"')",t+=this._stringify()},destroy:function(){delete this._eventListeners,this.image&&this.image._igeTextures&&this.image._igeTextures.pull(this),ige.TextureStore.pull(this),delete this.image,delete this.script,delete this._textureCanvas,delete this._textureCtx,this._destroyed=!0}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_48);var $i_49=$i_48.extend({classId:"$i_49",$i_50:!0,init:function(t,e,i){var s=this;s.horizontalCells(e||1),s.verticalCells(i||1),this.on("loaded",function(){s.image?(s._sheetImage=this.image,s._applyCells()):s.log("Cannot create cell-sheet because texture has not loaded an image!","error")}),this._super(t)},cellCount:function(){return this.horizontalCells()*this.verticalCells()},horizontalCells:function(t){return t!==void 0?(this._cellColumns=t,this):this._cellColumns},verticalCells:function(t){return t!==void 0?(this._cellRows=t,this):this._cellRows},_applyCells:function(){var t,e,i,s,n,r,o,a,h;if(this.image&&this._cellRows&&this._cellColumns)if(t=this._sizeX,e=this._sizeY,i=this._cellRows,s=this._cellColumns,n=this._cellWidth=t/s,r=this._cellHeight=e/i,n!==parseInt(n,10)&&this.log("Cell width is a floating-point number! (Image Width "+t+" / Number of Columns "+s+" = "+n+")","warning"),r!==parseInt(r,10)&&this.log("Cell height is a floating-point number! (Image Height "+e+" / Number of Rows "+i+" = "+r,"warning"),i>1||s>1)for(o=1;i*s>=o;o++)h=Math.ceil(o/s)-1,a=o-s*h-1,this._cells[o]=[a*n,h*r,n,r];else this._cells[1]=[0,0,this._sizeX,this._sizeY]},stringify:function(){var t="new "+this.classId()+"('"+this.url()+"', "+this.horizontalCells()+", "+this.verticalCells()+")";return t+=".id('"+this.id()+"');"}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_48);var $i_50=$i_48.extend({classId:"$i_50",$i_50:!0,init:function(t,e){var i=this;this.on("loaded",function(){if(i.image){i._sheetImage=this.image;var t;for(t=0;e.length>t;t++)i._cells[t+1]=e[t]}else i.log("Cannot create cell-sheet because texture has not loaded an image!","error")}),this._super(t)},cellCount:function(){return this._cells.length},cellIdToIndex:function(t){var e,i=this._cells;for(e=1;i.length>e;e++)if(i[e][4]===t)return e;return-1},stringify:function(){var t="new "+this.classId()+"('"+this.url()+"', "+(this._cells+"")+")";return t+=".id('"+this.id()+"');"}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_50);var $i_51=$i_48.extend({classId:"$i_51",init:function(t,e){this._super(t),e===void 0&&(e=1),e&&(this._cacheCount=e,this._cacheIndex=-1,this._cacheText={},this._cacheIndexes=[],this._cacheCanvas=[],this._caching=!0),this._noDimensions=!0,this.on("loaded",function(){if(this.image)if(this._sheetImage=this.image,this._fontData=this.decodeHeader(),this._charCodeMap=this._fontData.characters.charCodes,this._charPosMap=this._fontData.characters.charPosition,this._measuredWidthMap=this._fontData.characters.measuredWidth,this._pixelWidthMap=this._fontData.characters.pixelWidth,this._fontData){var t=this._fontData.font;this.log("Loaded font sheet for font: "+t.fontName+" @ "+t.fontSize+t.fontSizeUnit+" in "+t.fontColor)}else this.log("Could not load data header for font sheet: "+this.image.src,"error")})},decodeHeader:function(){var t=document.createElement("canvas"),e=t.getContext("2d");return t.width=this.image.width,t.height=1,e.drawImage(this.image,0,0),this._decode(t,0,0,this.image.width)},_decode:function(t,e,i,s){"use strict";var n,r=t.getContext("2d"),o=r.getImageData(e,i,s,t.height).data,a=!0,h=0,u="";while(a){if(n=o[h]+""+" "+(o[h+1]+"")+" "+(o[h+2]+""),n==="3 2 1")return a=!1,JSON.parse(u);u+=String.fromCharCode(o[h])+String.fromCharCode(o[h+1])+String.fromCharCode(o[h+2]),h+=4,h>o.length&&(a=!1,console.log("Image JSON Decode Error!"))}},lineHeightModifier:function(t){t!==void 0&&(this._lineHeightModifier=t)},render:function(t,e){if(e._text&&this._loaded){var i,s,n,r,o,a,h=t,u=e._text,l=[],d=this._charCodeMap,c=this._charPosMap,_=this._measuredWidthMap,g=this._pixelWidthMap,p=0,f=0,m=0,y=0,v=0,x=0,w=[],b=this._sizeY-2,I=0,T=0;
switch(u.indexOf("\n")>-1?l=u.split("\n"):l.push(u),o=b*l.length,e._textAlignY){case 0:y=-(b*l.length/2)-e._textLineSpacing*((l.length-1)/2);break;case 1:y=-(b*l.length/2)-e._textLineSpacing*((l.length-1)/2);break;case 2:y=-(b*l.length/2)-e._textLineSpacing*((l.length-1)/2)}for(n=0;l.length>n;n++){for(s=l[n],r=0;s.length>r;r++)a=d[s.charCodeAt(r)],I+=_[a]||0;w[n]=I,I>T&&(T=I),I=0}switch(e._textAlignX){case 0:m=-e.geometry.x2;break;case 1:m=-T/2;break;case 2:m=e.geometry.x2-T}if(this._caching){if(i=this._cacheText[u],i!==void 0)return h.drawImage(this._cacheCanvas[i],0,0,this._cacheCanvas[i].width,this._cacheCanvas[i].height,Math.floor(m),Math.floor(y),this._cacheCanvas[i].width,this._cacheCanvas[i].height),ige._drawCount++,void 0;switch(this._cacheIndex++,this._cacheCount>this._cacheIndex||(this._cacheIndex=this._cacheCount-1),this._cacheIndexes[this._cacheIndex]&&delete this._cacheText[this._cacheIndexes[this._cacheIndex]],this._cacheText[u]=this._cacheIndex,this._cacheIndexes[this._cacheIndex]=u,this._cacheCanvas[this._cacheIndex]=document.createElement("canvas"),this._cacheCanvas[this._cacheIndex].width=T,this._cacheCanvas[this._cacheIndex].height=o,h=this._cacheCanvas[this._cacheIndex].getContext("2d"),h.translate(T/2,o/2),e._textAlignY){case 0:x=e._textLineSpacing*((l.length-1)/2);break;case 1:x=e._textLineSpacing*((l.length-1)/2);break;case 2:x=e._textLineSpacing*((l.length-1)/2)}}for(n=0;l.length>n;n++){if(s=l[n],f=b*n+e._textLineSpacing*n,this._caching)switch(e._textAlignX){case 0:p=-T/2;break;case 1:p=-w[n]/2;break;case 2:p=T/2-w[n]}else switch(e._textAlignX){case 0:p=-e.geometry.x2;break;case 1:p=-w[n]/2;break;case 2:p=e.geometry.x2-w[n]}for(r=0;s.length>r;r++)a=d[s.charCodeAt(r)],h.drawImage(this.image,c[a],2,g[a],this._sizeY-2,Math.floor(v+p),Math.floor(x+y+f),g[a],this._sizeY-2),p+=_[a]||0,ige._drawCount++;p=0}this._caching&&this.render(t,e)}},destroy:function(){this.image=null,this.script=null}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_51);var $i_52=$i_3.extend({classId:"$i_52",init:function(){this._alive=!0,this._mode=0,this._mountMode=0,this._parent=null,this._children=[],this._layer=0,this._depth=0,this._dirty=!0,this._depthSortMode=0,this._timeStream=[],this._inView=!0},alive:function(t){return t!==void 0?(this._alive=t,this):this._alive},id:function(t){if(t!==void 0){if(t===this._id)return this;if(!ige._register[t])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=t,ige.register(this),this;ige._register[t]!==this&&this.log('Cannot set ID of object to "'+t+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=ige.newIdHex(),ige.register(this)),this._id},group:function(t){return t!==void 0?(this._group=t,this):this._group},addBehaviour:function(t,e){if(typeof t=="string"){if(typeof e=="function")return this._behaviours=this._behaviours||[],this._behaviours.push({id:t,method:e}),this;this.log("The behaviour you passed is not a function! The second parameter of the call must be a function!","error")}else this.log("Cannot add behaviour to object because the specified behaviour id is not a string. You must provide two parameters with the addBehaviour() call, an id:String and a behaviour:Function. Adding a behaviour with an id allows you to remove it by it's id at a later stage!","error");return!1},removeBehaviour:function(t){if(t!==void 0){var e,i=this._behaviours;if(i){e=i.length;while(e--)if(i[e].id===t)return i.splice(e,1),this}}return!1},drawBounds:function(t){return t!==void 0?(this._drawBounds=t,this):this._drawBounds},drawBoundsData:function(t){return t!==void 0?(this._drawBoundsData=t,this):this._drawBoundsData},drawMouse:function(t){return t!==void 0?(this._drawMouse=t,this):this._drawMouse},parent:function(){return this._parent},children:function(){return this._children},mount:function(t){if(t){if(t._children){if(this.id(),this._parent){if(this._parent===t)return this;this.unMount()}return this._parent=t,t._children.push(this),this._parent._childMounted(this),this.emit("mounted",this._parent),this}return!1}this.log("Cannot mount non-existent object!","error")},unMount:function(){if(this._parent){var t=this._parent._children,e=t.indexOf(this);return e>-1?(t.splice(e,1),this._parent._childUnMounted(this),this._parent=null,this):!1}return!1},clone:function(){},mode:function(t){return t!==void 0?(this._mode=t,this):this._mode},isometric:function(t){return t===!0?(this._mode=1,this):t===!1?(this._mode=0,this):this._mode===1},isometricMounts:function(t){return t===!0?(this._mountMode=1,this):t===!1?(this._mountMode=0,this):this._mountMode===1},indestructible:function(t){return t!==void 0?(this._indestructible=t,this):this._indestructible},layer:function(t){return t!==void 0?(this._layer=t,this):this._layer},depth:function(t){return t!==void 0?(this._depth=t,this):this._depth},destroyChildren:function(){var t,e=this._children;if(e){t=e.length;while(t--)e[t].destroy()}return delete this._children,this},destroyBehaviours:function(){delete this._behaviours},destroyComponents:function(){var t,e=this._components;if(e){t=e.length;while(t--)e[t].destroy&&e[t].destroy()}return delete this._components,this},dirty:function(t){return t!==void 0?(this._dirty=t,this._parent&&this._parent.dirty(t),this):this._dirty},depthSortMode:function(t){return t!==void 0?(this._depthSortMode=t,this):this._depthSortMode},depthSortChildren:function(){var t,e,i,s,n=this._children;if(n&&(t=n.length,t>1))if(this._mountMode===1){if(this._depthSortMode===0){for(e={adj:[],c:[],p:[],order:[],order_ind:t-1},i=0;t>i;++i)for(e.c[i]=0,e.p[i]=-1,s=i+1;t>s;++s)e.adj[i]=e.adj[i]||[],e.adj[s]=e.adj[s]||[],n[i]._inView&&n[s]._inView&&n[i]._projectionOverlap&&n[s]._projectionOverlap&&n[i]._projectionOverlap(n[s])&&(n[i].isBehind(n[s])?e.adj[s].push(i):e.adj[i].push(s));for(i=0;t>i;++i)e.c[i]===0&&this._depthSortVisit(i,e);for(i=0;e.order.length>i;i++)n[e.order[i]].depth(i);this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?e._depth-t._depth:i})}if(this._depthSortMode===1&&this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?t.isBehind(e)?-1:1:i}),this._depthSortMode===2){while(t--)e=n[t],s=e._translate,s&&(e._depth=s.x+s.y+s.z);this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?e._depth-t._depth:i})}}else this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?e._depth-t._depth:i})},viewChecking:function(t){return t!==void 0?(this._viewChecking=t,this):this._viewChecking},viewCheckChildren:function(){var t,e=this._children,i=e.length,s=ige._currentViewport.viewArea();while(i--)t=e[i],t._inView=t._alwaysInView?!0:t.aabb?s.rectIntersect(t.aabb())?!0:!1:!1},tick:function(t){var e,i,s,n,r,o=this._children;if(this._viewChecking&&this.viewCheckChildren(),o)if(e=o.length,n=e,e&&!ige._headless&&(igeDebug.timing?(ige._tslt[this.id()]||(ige._tslt[this.id()]={}),i=(new Date).getTime(),this.depthSortChildren(),s=(new Date).getTime()-i,ige._tslt[this.id()].depthSortChildren=s):this.depthSortChildren()),r=e,igeDebug.timing)while(e--)t.save(),i=(new Date).getTime(),o[e].tick(t),s=(new Date).getTime()-i,o[e]&&(ige._tsit[o[e].id()]||(ige._tsit[o[e].id()]=0),ige._tslt[o[e].id()]||(ige._tslt[o[e].id()]={}),ige._tsit[o[e].id()]+=s,ige._tslt[o[e].id()].tick=s),t.restore();else while(e--)t.save(),o[e].tick(t),t.restore()},_depthSortVisit:function(t,e){var i,s,n=e.adj[t],r=n.length;for(e.c[t]=1,i=0;r>i;++i)s=n[i],e.c[s]===0&&(e.p[s]=t,this._depthSortVisit(s,e));e.c[t]=2,e.order[e.order_ind]=t,--e.order_ind},_resizeEvent:function(t){var e,i=this._children;if(i){e=i.length;while(e--)i[e]._resizeEvent(t)}},_processBehaviours:function(){if(ige._frameAlternator!==this._behaviourFA){var t,e=this._behaviours;if(e){t=e.length;while(t--)e[t].method.apply(this,arguments);this._behaviourFA=ige._frameAlternator}}},_childMounted:function(){this._resizeEvent(null)},_childUnMounted:function(){},destroy:function(){return this.unMount(),this._children&&this.destroyChildren(),this.destroyComponents(),this.destroyBehaviours(),ige.unRegister(this),this._alive=!1,delete this._eventListeners,this},stringify:function(){var t="new "+this.classId()+"()";return t+=".id('"+this.id()+"')",this.parent()&&(t+=".mount(ige.$('"+this.parent().id()+"'))"),t+=this._stringify()},_stringify:function(){var t,e="";for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_group":e+=".group('"+this.group()+"')";break;case"_drawBounds":e+=".drawBounds('"+this.drawBounds()+"')";break;case"_drawBoundsData":e+=".drawBoundsData('"+this.drawBoundsData()+"')";break;case"_drawMouse":e+=".drawMouse('"+this.drawMouse()+"')";break;case"_mode":e+=".mode('"+this.mode()+"')";break;case"_isometricMounts":e+=".isometricMounts('"+this.isometricMounts()+"')";break;case"_indestructible":e+=".indestructible('"+this.indestructible()+"')";break;case"_layer":e+=".layer('"+this.layer()+"')";break;case"_depth":e+=".depth('"+this.depth()+"')"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_52);var $i_53=$i_52.extend([{extension:$i_40,overwrite:!1},{extension:$i_43,overwrite:!0}],{classId:"$i_53",init:function(){this._super(),this._width=void 0,this._height=void 0,this._anchor=new $i_5(0,0,0),this._renderPos={x:0,y:0},this._opacity=1,this._cell=1,this._deathTime=void 0,this._oldTranslate=new $i_5(0,0,0),this._translate=new $i_5(0,0,0),this._rotate=new $i_5(0,0,0),this._scale=new $i_5(1,1,1),this._origin=new $i_5(.5,.5,.5),this.geometry=new $i_5(40,40,40),this._highlight=!1,this._mouseEventsActive=!1,this._localMatrix=new $i_8(this),this._worldMatrix=new $i_8(this),this._inView=!0,this.streamSections(["transform"])},mousePos:function(){var t;if(this._parent){if(this._parent.mousePos)return t=this._parent.mousePos(),new $i_5(t.x-this._translate.x,t.y-this._translate.y,0);throw"What happened? This code path should never be reached!"}return new $i_5(0,0,0)},translateToTile:function(t,e,i){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var s;s=i!==void 0?i*this._parent._tileWidth:this._translate.z,this.translateTo(t*this._parent._tileWidth,e*this._parent._tileHeight,s)}else this.log("Cannot translate to tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},widthByTile:function(t,e){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var i,s=this._mode===0?this._parent._tileWidth:this._parent._tileWidth*2;this.width(t*s),e&&(this._texture?(i=this._texture._sizeX/this.geometry.x,this.height(this._texture._sizeY/i)):this.log("Cannot set height based on texture aspect ratio and new width because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set width by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},heightByTile:function(t,e){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var i,s=this._mode===0?this._parent._tileHeight:this._parent._tileHeight*2;this.height(t*s),e&&(this._texture?(i=this._texture._sizeY/this.geometry.y,this.width(this._texture._sizeX/i)):this.log("Cannot set width based on texture aspect ratio and new height because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set height by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},occupyTile:function(){this.log("Cannot occupy a tile because the entity is not currently mounted to a tile sheet.","warning")},overTiles:function(){this.log("Cannot determine which tiles this entity lies over because the entity is not currently mounted to a tile sheet.","warning")},anchor:function(t,e){return t!==void 0&&e!==void 0?(this._anchor=new $i_5(t,e,0),this):this._anchor},width:function(t){return t!==void 0?(this._width=t,this.geometry.x=t,this.geometry.x2=t/2,this):this._width},height:function(t){return t!==void 0?(this._height=t,this.geometry.y=t,this.geometry.y2=t/2,this):this._height},size3d:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this.geometry=new $i_5(t,e,i),this):this.geometry},lifeSpan:function(t){return t!==void 0?(this.deathTime((new Date).getTime()+t),this):this.deathTime()-(new Date).getTime()},deathTime:function(t){return t!==void 0?(this._deathTime=t,this):this._deathTime},opacity:function(t){return t!==void 0?(this._opacity=t,this):this._opacity},texture:function(t){return t!==void 0?(this._texture=t,this):this._texture},cell:function(t){return t>0||t===null?(this._cell=t,this):this._cell},cellById:function(t){if(t!==void 0)if(this._texture){var e,i=this._texture,s=i._cells;for(e=1;s.length>e;e++)if(s[e][4]===t)return this.cell(e),this;this.log('Could not find the cell id "'+t+'" in the assigned entity texture '+i.id()+', please check your sprite sheet (texture) cell definition to ensure the cell id "'+t+'" has been assigned to a cell!',"error")}else this.log("Cannot assign cell index from cell ID until an $i_50 has been set as the texture for this entity. Please set the texture before calling cellById().","error");return this._cell},dimensionsFromTexture:function(){return this._texture&&(this.width(this._texture._sizeX),this.height(this._texture._sizeY)),this},dimensionsFromCell:function(){return this._texture&&(this.width(this._texture._cells[this._cell][2]),this.height(this._texture._cells[this._cell][3])),this},highlight:function(t){return t!==void 0?(this._highlight=t,this):this._highlight},localToWorld:function(t){this._worldMatrix.transform(t)},aabb:function(t){if(t||!this._aabb){var e,i,s,n,r,o,a,h,u,l=new $i_6,d=new $i_7(0,0,0,0),c=this._anchor,_=this.geometry,g=_.x,p=_.y,f=_.z,m=_.x2,y=_.y2,v=(_.z2,this._origin),x=v.x-.5,w=v.y-.5,b=v.z-.5;return this._mode===0&&(r=m+c.x,o=y+c.y,a=g*x,h=p*w,l.addPoint(-r+a,-o+h),l.addPoint(r+a,-o+h),l.addPoint(r+a,o+h),l.addPoint(-r+a,o+h),this._renderPos={x:-r+a,y:-o+h},this.localToWorld(l._poly),e=Math.min(l._poly[0].x,l._poly[1].x,l._poly[2].x,l._poly[3].x),i=Math.min(l._poly[0].y,l._poly[1].y,l._poly[2].y,l._poly[3].y),s=Math.max(l._poly[0].x,l._poly[1].x,l._poly[2].x,l._poly[3].x),n=Math.max(l._poly[0].y,l._poly[1].y,l._poly[2].y,l._poly[3].y),d.x=e,d.y=i,d.width=s-e,d.height=n-i),this._mode===1&&(u=new $i_5(-(_.x/2),-(_.y/2),_.z/2).toIso(),r=u.x+_.x+c.x,o=u.y+c.y,a=g*x,h=f*b,l.addPoint(-r+a,-o+h),l.addPoint(r+a,-o+h),l.addPoint(r+a,o+h),l.addPoint(-r+a,o+h),this._renderPos={x:-r+a,y:-o+h},this.localToWorld(l._poly),e=Math.min(l._poly[0].x,l._poly[1].x,l._poly[2].x,l._poly[3].x),i=Math.min(l._poly[0].y,l._poly[1].y,l._poly[2].y,l._poly[3].y),s=Math.max(l._poly[0].x,l._poly[1].x,l._poly[2].x,l._poly[3].x),n=Math.max(l._poly[0].y,l._poly[1].y,l._poly[2].y,l._poly[3].y),d.x=e,d.y=i,d.width=s-e,d.height=n-i),this._aabb=d,d}return this._aabb},_swapVars:function(t,e){return[e,t]},_internalsOverlap:function(t,e,i,s){var n;return t>e&&(n=this._swapVars(t,e),t=n[0],e=n[1]),i>s&&(n=this._swapVars(i,s),i=n[0],s=n[1]),t>i&&(n=this._swapVars(t,i),t=n[0],i=n[1],n=this._swapVars(e,s),e=n[0],s=n[1]),e>i},_projectionOverlap:function(t){var e=this.geometry,i=new $i_5(this._translate.x-e.x/2,this._translate.y-e.y/2,this._translate.z-e.z),s=new $i_5(this._translate.x+e.x/2,this._translate.y+e.y/2,this._translate.z+e.z),n=t.geometry,r=new $i_5(t._translate.x-n.x/2,t._translate.y-n.y/2,t._translate.z-n.z),o=new $i_5(t._translate.x+n.x/2,t._translate.y+n.y/2,t._translate.z+n.z);return this._internalsOverlap(i.x-s.y,s.x-i.y,r.x-o.y,o.x-r.y)&&this._internalsOverlap(i.x-s.z,s.x-i.z,r.x-o.z,o.x-r.z)&&this._internalsOverlap(i.z-s.y,s.z-i.y,r.z-o.y,o.z-r.y)},isBehind:function(t){var e=this.geometry,i=new $i_5(this._translate.x-e.x/2,this._translate.y-e.y/2,this._translate.z),s=new $i_5(this._translate.x+e.x/2,this._translate.y+e.y/2,this._translate.z+e.z),n=t.geometry,r=new $i_5(t._translate.x-n.x/2,t._translate.y-n.y/2,t._translate.z),o=new $i_5(t._translate.x+n.x/2,t._translate.y+n.y/2,t._translate.z+n.z);return s.x>r.x?o.x>i.x?s.y>r.y?o.y>i.y?s.z>r.z?o.z>i.z?this._translate.x+this._translate.y+this._translate.z>t._translate.x+t._translate.y+t._translate.z:!0:!1:!0:!1:!0:!1},mouseEventsActive:function(t){return t!==void 0?(this._mouseEventsActive=t,this):this._mouseEventsActive},tick:function(t,e){if(this._deathTime===void 0||ige.tickStart<this._deathTime){if(delete this._streamDataCache,this._processBehaviours(t),this._timeStream.length&&this._processInterpolate(ige.tickStart-ige.network.stream._renderLatency),this._inView&&(!this._parent||this._parent._inView)){var i,s,n,r,o=(ige._renderMode,this);this._mouseEventsActive&&(i=ige._currentViewport._mousePos,i&&(s=this.aabb(),n=i.x,r=i.y,s&&n>=s.x&&r>=s.y&&s.x+s.width>n&&s.y+s.height>r?ige.input.queueEvent(this,this._mouseInAabb):ige.input.mouseMove&&o._handleMouseOut(ige.input.mouseMove))),e||this._transformContext(t),this._renderEntity(t,e),this._streamMode===1&&this.streamSync()}this._super(t),this._oldTranslate=this._translate.clone()}else this.destroy()},_renderEntity:function(t){var e=this._texture;this._opacity>0&&e&&(e.render(t,this,ige.tickDelta),this._highlight&&(t.globalCompositeOperation="lighter",e.render(t,this)))},_transformContext:function(t){this.updateTransform(),this.aabb(!0),t.globalAlpha=this._parent?this._parent._opacity*this._opacity:this._opacity,this._localMatrix.transformRenderingContext(t)},_transformPoint:function(t){if(this._parent){var e=new $i_8;e.copy(this._parent._worldMatrix),e.multiply(this._localMatrix),e.transformCoord(t)}else this._localMatrix.transformCoord(t);return t},_mouseInAabb:function(t){ige.input.mouseMove&&this._handleMouseIn(ige.input.mouseMove,t),ige.input.mouseDown&&this._handleMouseDown(ige.input.mouseDown,t),ige.input.mouseUp&&this._handleMouseUp(ige.input.mouseUp,t)},_stringify:function(){var t,e=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_opacity":e+=".opacity("+this.opacity()+")";break;case"_texture":e+=".texture(ige.$('"+this.texture().id()+"'))";break;case"_cell":e+=".cell("+this.cell()+")";break;case"_translate":e+=".translateTo("+this._translate.x+", "+this._translate.y+", "+this._translate.z+")";break;case"_rotate":e+=".rotateTo("+this._rotate.x+", "+this._rotate.y+", "+this._rotate.z+")";break;case"_scale":e+=".scaleTo("+this._scale.x+", "+this._scale.y+", "+this._scale.z+")";break;case"_origin":e+=".originTo("+this._origin.x+", "+this._origin.y+", "+this._origin.z+")";break;case"_anchor":e+=".anchor("+this._anchor.x+", "+this._anchor.y+")";break;case"_width":e+=typeof this.width()=="string"?".width('"+this.width()+"')":".width("+this.width()+")";break;case"_height":e+=typeof this.height()=="string"?".height('"+this.height()+"')":".height("+this.height()+")";break;case"geometry":e+=".size3d("+this.geometry.x+", "+this.geometry.y+", "+this.geometry.z+")";break;case"_deathTime":e+=".deathTime('"+this.deathTime()+"')";break;case"_highlight":e+=".highlight('"+this.highlight()+"')"}return e},destroy:function(){this._alive=!1,this.emit("destroyed",this),this._super()},streamSections:function(t){return t!==void 0?(this._streamSections=t,this):this._streamSections},streamSectionData:function(t,e,i){if(t==="transform"){if(!e)return this._translate.toString(this._streamFloatPrecision)+","+this._scale.toString(this._streamFloatPrecision)+","+this._rotate.toString(this._streamFloatPrecision)+",";var s=e.split(",");i?(s[0]&&(this._translate.x=parseFloat(s[0])),s[1]&&(this._translate.y=parseFloat(s[1])),s[2]&&(this._translate.z=parseFloat(s[2])),s[3]&&(this._scale.x=parseFloat(s[3])),s[4]&&(this._scale.y=parseFloat(s[4])),s[5]&&(this._scale.z=parseFloat(s[5])),s[6]&&(this._rotate.x=parseFloat(s[6])),s[7]&&(this._rotate.y=parseFloat(s[7])),s[8]&&(this._rotate.z=parseFloat(s[8]))):(s[0]&&(s[0]=parseFloat(s[0])),s[1]&&(s[1]=parseFloat(s[1])),s[2]&&(s[2]=parseFloat(s[2])),s[3]&&(s[3]=parseFloat(s[3])),s[4]&&(s[4]=parseFloat(s[4])),s[5]&&(s[5]=parseFloat(s[5])),s[6]&&(s[6]=parseFloat(s[6])),s[7]&&(s[7]=parseFloat(s[7])),s[8]&&(s[8]=parseFloat(s[8])),this._timeStream.push([ige.network.stream._streamDataTime+ige.network._latency,s]),this._timeStream.length>10&&this._timeStream.shift())}},interpolateValue:function(t,e,i,s,n){var r=e-t,o=n-i,a=s-i,h=a/o;return 0>h?h=0:h>1&&(h=1),r*h+t},_processInterpolate:function(t,e){e||(e=200);var i,s,n,r,o,a,h,u=this._timeStream,l=[],d=1;while(u[d]){if(u[d][0]>=t){i=u[d-1],s=u[d];break}d++}s||i?u.splice(0,d-1):u.length>2&&t>u[u.length-1][0]&&(i=u[u.length-2],s=u[u.length-1],u.shift(),this.emit("entityInterpolationLag")),s&&i&&(n=s[0]-i[0],r=t-i[0],o=r/n,0>o?o=0:o>1&&(o=1),a=i[1],h=s[1],l[0]=this.interpolateValue(a[0],h[0],i[0],t,s[0]),l[1]=this.interpolateValue(a[1],h[1],i[0],t,s[0]),l[2]=this.interpolateValue(a[2],h[2],i[0],t,s[0]),l[3]=this.interpolateValue(a[3],h[3],i[0],t,s[0]),l[4]=this.interpolateValue(a[4],h[4],i[0],t,s[0]),l[5]=this.interpolateValue(a[5],h[5],i[0],t,s[0]),l[6]=this.interpolateValue(a[6],h[6],i[0],t,s[0]),l[7]=this.interpolateValue(a[7],h[7],i[0],t,s[0]),l[8]=this.interpolateValue(a[8],h[8],i[0],t,s[0]),this.translateTo(parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])),this.scaleTo(parseFloat(l[3]),parseFloat(l[4]),parseFloat(l[5])),this.rotateTo(parseFloat(l[6]),parseFloat(l[7]),parseFloat(l[8])),this._lastUpdate=(new Date).getTime())}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_53);var $i_54=$i_53.extend([{extension:$i_42,overwrite:!0},{extension:$i_41,overwrite:!0}],{classId:"$i_54",init:function(){this._super(),this._uiX=0,this._uiY=0,this._width=0,this._height=0,this._borderLeftWidth=0,this._borderTopWidth=0,this._borderRightWidth=0,this._borderBottomWidth=0,this._borderTopLeftRadius=0,this._borderTopRightRadius=0,this._borderBottomRightRadius=0,this._borderBottomLeftRadius=0,this._backgroundPosition={x:0,y:0},this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0,this._overflow="hidden"},_renderBackground:function(t){var e,i,s,n,r=this.geometry;(this._backgroundColor||this._patternFill)&&(e=-(r.x/2)|0,i=-(r.y/2)|0,s=r.x,n=r.y,t.save(),t.beginPath(),this._borderTopRightRadius||!this._borderBottomRightRadius||this._borderBottomLeftRadius||this._borderTopLeftRadius?(t.moveTo(e+this._borderTopLeftRadius,i),t.lineTo(e+s-this._borderTopRightRadius,i),this._borderTopRightRadius>0&&t.arcTo(e+s,i,e+s,i+this._borderTopRightRadius,this._borderTopRightRadius),t.lineTo(e+s,i+n-this._borderBottomRightRadius),this._borderBottomRightRadius>0&&t.arcTo(e+s,i+n,e+s-this._borderBottomRightRadius,i+n,this._borderBottomRightRadius),t.lineTo(e+this._borderBottomLeftRadius,i+n),this._borderBottomLeftRadius>0&&t.arcTo(e,i+n,e,i+n-this._borderBottomLeftRadius,this._borderBottomLeftRadius),t.lineTo(e,i+this._borderTopLeftRadius),this._borderTopLeftRadius>0&&t.arcTo(e,i,e+this._borderTopLeftRadius,i,this._borderTopLeftRadius),t.clip()):t.rect(e,i,s,n),this._backgroundColor&&(t.fillStyle=this._backgroundColor,t.fill()),this._patternFill&&(t.translate(-(s/2|0)+this._backgroundPosition.x,-(n/2|0)+this._backgroundPosition.y),t.fillStyle=this._patternFill,t.fill()),t.restore())},_renderBorder:function(t){var e,i=this.geometry,s=-(i.x/2)|0,n=-(i.y/2)|0,r=i.x,o=i.y;this._borderTopRightRadius||this._borderBottomRightRadius||this._borderBottomLeftRadius||this._borderTopLeftRadius||this._borderLeftWidth!==this._borderWidth||this._borderTopWidth!==this._borderWidth||this._borderRightWidth!==this._borderWidth||this._borderBottomWidth!==this._borderWidth?(e=Math.PI/180,this._borderTopWidth&&(t.strokeStyle=this._borderTopColor,t.lineWidth=this._borderTopWidth,this._borderTopLeftRadius>0&&(t.beginPath(),t.arc(s+this._borderTopLeftRadius,n+this._borderTopLeftRadius,this._borderTopLeftRadius,225*e,270*e),t.stroke()),t.beginPath(),t.moveTo(s+this._borderTopLeftRadius,n),t.lineTo(s+r-this._borderTopRightRadius,n),t.stroke(),this._borderTopRightRadius>0&&(t.beginPath(),t.arc(s+r-this._borderTopRightRadius,n+this._borderTopRightRadius,this._borderTopRightRadius,-90*e,-45*e),t.stroke())),this._borderRightWidth&&(t.strokeStyle=this._borderRightColor,t.lineWidth=this._borderRightWidth,this._borderTopRightRadius>0&&(t.beginPath(),t.arc(s+r-this._borderTopRightRadius,n+this._borderTopRightRadius,this._borderTopRightRadius,-45*e,0),t.stroke()),t.beginPath(),t.moveTo(s+r,n+this._borderTopRightRadius),t.lineTo(s+r,n+o-this._borderBottomRightRadius),t.stroke(),this._borderBottomRightRadius>0&&(t.beginPath(),t.arc(s+r-this._borderBottomRightRadius,n+o-this._borderBottomRightRadius,this._borderTopRightRadius,0,45*e),t.stroke())),this._borderBottomWidth&&(t.strokeStyle=this._borderBottomColor,t.lineWidth=this._borderBottomWidth,this._borderBottomRightRadius>0&&(t.beginPath(),t.arc(s+r-this._borderBottomRightRadius,n+o-this._borderBottomRightRadius,this._borderBottomRightRadius,45*e,90*e),t.stroke()),t.beginPath(),t.moveTo(s+r-this._borderBottomRightRadius,n+o),t.lineTo(s+this._borderBottomLeftRadius,n+o),t.stroke(),this._borderBottomLeftRadius>0&&(t.beginPath(),t.arc(s+this._borderBottomLeftRadius,n+o-this._borderBottomLeftRadius,this._borderBottomLeftRadius,90*e,135*e),t.stroke())),this._borderLeftWidth&&(t.strokeStyle=this._borderLeftColor,t.lineWidth=this._borderLeftWidth,this._borderBottomLeftRadius>0&&(t.beginPath(),t.arc(s+this._borderBottomLeftRadius,n+o-this._borderBottomLeftRadius,this._borderBottomLeftRadius,135*e,180*e),t.stroke()),t.beginPath(),t.moveTo(s,n+o-this._borderBottomLeftRadius),t.lineTo(s,n+this._borderTopLeftRadius),t.stroke(),this._borderTopLeftRadius>0&&(t.beginPath(),t.arc(s+this._borderTopLeftRadius,n+this._borderTopLeftRadius,this._borderTopLeftRadius,180*e,225*e),t.stroke()))):(t.strokeStyle=this._borderColor,t.lineWidth=this._borderWidth,t.strokeRect(s,n,r,o))},cell:function(t){var e=this._super(t);return e===this&&this._patternTexture&&this.backgroundImage(this._patternTexture,this._patternRepeat),e},mount:function(t){var e=this._super(t);return this._parent&&this._updateUiPosition(),e},tick:function(t,e){if(e||this._transformContext(t),this._renderBackground(t),this._renderBorder(t),(!ige.cocoonJs||ige.cocoonJs&&!ige.cocoonJs.detected)&&this._overflow==="hidden"){var i=this.geometry,s=-(i.x/2)+this._paddingLeft|0,n=-(i.y/2)+this._paddingTop|0,r=i.x+this._paddingRight,o=i.y+this._paddingBottom;t.rect(s,n,r,o),t.clip()}t.translate(this._paddingLeft,this._paddingTop),this._super(t,!0)},_resizeEvent:function(t){this._updateUiPosition(),this._super(t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_54);var $i_55=$i_54.extend({classId:"$i_55",init:function(){this._super(),this._text=void 0,this._textAlignX=1,this._textAlignY=1,this._textLineSpacing=0},text:function(t){return t!==void 0?(this._text=t,this):this._text},textAlignX:function(t){return t!==void 0?(this._textAlignX=t,this):this._textAlignX},textAlignY:function(t){return t!==void 0?(this._textAlignY=t,this):this._textAlignY},textLineSpacing:function(t){return t!==void 0?(this._textLineSpacing=t,this):this._textLineSpacing},_stringify:function(){var t,e=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_text":e+=".text("+this.text()+")";break;case"_textAlignX":e+=".textAlignX("+this.textAlignX()+")";break;case"_textAlignY":e+=".textAlignY("+this.textAlignY()+")";break;case"_textLineSpacing":e+=".textLineSpacing("+this.textLineSpacing()+")"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_55);var $i_56=$i_53.extend({classId:"$i_56",$i_56:!0,init:function(){this._super(),this._quantityTimespan=1e3,this._currentDelta=0,this._started=!1,this._particles=[],this.applyDepthToParticles(!0),this.applyLayerToParticles(!0),this.quantityVariance(0,0),this.translateBaseX(0),this.translateBaseY(0),this.translateBaseZ(0),this.translateVarianceX(0,0),this.translateVarianceY(0,0),this.translateVarianceZ(0,0),this.rotateBase(0),this.rotateVariance(0,0),this.deathRotateBase(0),this.deathRotateVariance(0,0),this.scaleBaseX(0),this.scaleBaseY(0),this.scaleBaseZ(0),this.scaleVarianceX(0,0),this.scaleVarianceY(0,0),this.scaleVarianceZ(0,0),this.scaleLockAspect(!1),this.deathScaleBaseX(0),this.deathScaleBaseY(0),this.deathScaleBaseZ(0),this.deathScaleVarianceX(0,0),this.deathScaleVarianceY(0,0),this.deathScaleVarianceZ(0,0),this.deathScaleLockAspect(!1),this.opacityBase(1),this.opacityVariance(0,0),this.deathOpacityBase(1),this.deathOpacityVariance(0,0),this.lifeBase(1e3),this.lifeVariance(0,0)},particle:function(t){return this._particle=t,this},applyDepthToParticles:function(t){return this._applyDepthToParticles=t,this},applyLayerToParticles:function(t){return this._applyLayerToParticles=t,this},quantityTimespan:function(t){return this._quantityTimespan=t,this},quantityBase:function(t){return this._quantityBase=t,this},quantityVariance:function(t,e){return this._quantityVariance=[t,e],this},quantityMax:function(t){return this._quantityMax=t,this._quantityProduced=0,this},translateBaseX:function(t){return this._translateBaseX=t,this},translateBaseY:function(t){return this._translateBaseY=t,this},translateBaseZ:function(t){return this._translateBaseZ=t,this},translateVarianceX:function(t,e){return this._translateVarianceX=[t,e],this},translateVarianceY:function(t,e){return this._translateVarianceY=[t,e],this},translateVarianceZ:function(t,e){return this._translateVarianceZ=[t,e],this},rotateBase:function(t){return this._rotateBase=t,this},rotateVariance:function(t,e){return this._rotateVariance=[t,e],this},deathRotateBase:function(t){return this._deathRotateBase=t,this},deathRotateVariance:function(t,e){return this._deathRotateVariance=[t,e],this},scaleBaseX:function(t){return this._scaleBaseX=t,this},scaleBaseY:function(t){return this._scaleBaseY=t,this},scaleBaseZ:function(t){return this._scaleBaseZ=t,this},scaleVarianceX:function(t,e){return this._scaleVarianceX=[t,e],this},scaleVarianceY:function(t,e){return this._scaleVarianceY=[t,e],this},scaleVarianceZ:function(t,e){return this._scaleVarianceZ=[t,e],this},scaleLockAspect:function(t){return this._scaleLockAspect=t,this},deathScaleBaseX:function(t){return this._deathScaleBaseX=t,this},deathScaleBaseY:function(t){return this._deathScaleBaseY=t,this},deathScaleBaseZ:function(t){return this._deathScaleBaseZ=t,this},deathScaleVarianceX:function(t,e){return this._deathScaleVarianceX=[t,e],this},deathScaleVarianceY:function(t,e){return this._deathScaleVarianceY=[t,e],this},deathScaleVarianceZ:function(t,e){return this._deathScaleVarianceZ=[t,e],this},deathScaleLockAspect:function(t){return this._deathScaleLockAspect=t,this},opacityBase:function(t){return this._opacityBase=t,this},opacityVariance:function(t,e){return this._opacityVariance=[t,e],this},deathOpacityBase:function(t){return this._deathOpacityBase=t,this},deathOpacityVariance:function(t,e){return this._deathOpacityVariance=[t,e],this},lifeBase:function(t){return this._lifeBase=t,this},lifeVariance:function(t,e){return this._lifeVariance=[t,e],this},velocityVector:function(t,e,i){return this._velocityVector={base:t,min:e,max:i},this},linearForceVector:function(t,e,i){return this._linearForceVector={base:t,min:e,max:i},this},start:function(){return this._particle?(this._quantityTimespan=this._quantityTimespan||1e3,this._maxParticles=this.baseAndVarianceValue(this._quantityBase,this._quantityVariance,!0),this._particlesPerTimeVector=this._quantityTimespan/this._maxParticles,this._currentDelta=0,this._quantityProduced=0,this._started=!0):this.log("Cannot start particle emitter because no particle class was specified with a call to particle()","error"),this
},stop:function(){return this._started=!1,this},stopAndKill:function(){this._started=!1;var t=this._particles,e=t.length;while(e--)t[e].destroy();return this._particles=[],this},baseAndVarianceValue:function(t,e,i){t=t||0,e=e||[0,0];var s=0;return s=i?Math.floor(e[0]+Math.random()*(e[1]-e[0])):e[0]+Math.random()*(e[1]-e[0]),t+s},vectorFromBaseMinMax:function(t){if(t.min&&t.max){var e=t.base,i=t.min,s=t.max,n={};return n.x=e.x+(i.x+Math.random()*(s.x-i.x)),n.y=e.y+(i.y+Math.random()*(s.y-i.y)),n.z=e.z+(i.z+Math.random()*(s.z-i.z)),n}return t.base},tick:function(t){if(this._currentDelta+=ige.tickDelta,this._parent&&this._started&&(!this._quantityMax||this._quantityMax>this._quantityProduced)){var e,i,s,n,r,o,a,h,u,l,d,c,_,g,p,f,m,y,v,x,w,b,I,T,C,M,S;if(this._currentDelta>this._quantityTimespan&&(this._currentDelta=this._quantityTimespan),this._currentDelta>=this._particlesPerTimeVector&&(e=this._currentDelta/this._particlesPerTimeVector|0,this._currentDelta-=this._particlesPerTimeVector*e,e))while(e--){if(this._quantityMax&&(this._quantityProduced++,this._quantityProduced>=this._quantityMax)){this.stop();break}for(i=this.baseAndVarianceValue(this._translateBaseX,this._translateVarianceX,!0),s=this.baseAndVarianceValue(this._translateBaseY,this._translateVarianceY,!0),n=this.baseAndVarianceValue(this._translateBaseZ,this._translateVarianceZ,!0),r=this.vectorFromBaseMinMax(this._velocityVector),h=r.x,u=r.y,l=Math.cos(this._rotate.z),d=Math.sin(this._rotate.z),o=h*l-u*d,a=u*l+h*d,r.x=o,r.y=a,c=this.baseAndVarianceValue(this._scaleBaseX,this._scaleVarianceX,!1),g=_=c,this._scaleLockAspect||(_=this.baseAndVarianceValue(this._scaleBaseY,this._scaleVarianceY,!1),g=this.baseAndVarianceValue(this._scaleBaseZ,this._scaleVarianceZ,!1)),p=this.baseAndVarianceValue(this._rotateBase,this._rotateVariance,!0),f=this.baseAndVarianceValue(this._opacityBase,this._opacityVariance,!1),m=this.baseAndVarianceValue(this._lifeBase,this._lifeVariance,!0),y=this.vectorFromBaseMinMax(this._linearForceVector),h=y.x,u=y.y,l=Math.cos(this._rotate.z),d=Math.sin(this._rotate.z),o=h*l-u*d,a=u*l+h*d,y.x=o,y.y=a,this._deathScaleBaseX!==void 0&&(v=this.baseAndVarianceValue(this._deathScaleBaseX,this._deathScaleVarianceX,!1)),this._deathScaleBaseY===void 0||this._deathScaleLockAspect||(x=this.baseAndVarianceValue(this._deathScaleBaseY,this._deathScaleVarianceY,!1)),this._deathScaleBaseZ===void 0||this._deathScaleLockAspect||(w=this.baseAndVarianceValue(this._deathScaleBaseZ,this._deathScaleVarianceZ,!1)),this._deathScaleLockAspect&&(w=x=v),this._deathRotateBase!==void 0&&(b=this.baseAndVarianceValue(this._deathRotateBase,this._deathRotateVariance,!0)),this._deathOpacityBase!==void 0&&(I=this.baseAndVarianceValue(this._deathOpacityBase,this._deathOpacityVariance,!1)),T=new this._particle(this),i+=this._translate.x,s+=this._translate.y,n+=this._translate.z,c*=this._scale.x,_*=this._scale.y,g*=this._scale.z,v*=this._scale.x,x*=this._scale.y,w*=this._scale.z,T.translateTo(i,s,n),T.rotateTo(0,0,p*Math.PI/180),T.scaleTo(c,_,g),T.opacity(f),this._applyDepthToParticles&&T.depth(this._depth),this._applyLayerToParticles&&T.layer(this._layer),typeof r=="object"&&T.velocity.vector3(r,!1),typeof y=="object"&&T.velocity.linearForceVector3(y,!1),C=[],b!==void 0&&C.push((new $i_47).targetObj(T._rotate).properties({z:b*Math.PI/180}).duration(m)),I!==void 0&&C.push((new $i_47).targetObj(T).properties({_opacity:I}).duration(m)),M={},v!==void 0&&(M.x=v),x!==void 0&&(M.y=x),w!==void 0&&(M.z=w),(M.x||M.y||M.z)&&C.push((new $i_47).targetObj(T._scale).properties(M).duration(m)),S=0;C.length>S;S++)C[S].start();typeof m=="number"&&T.lifeSpan(m),this._particles.push(T),T.mount(this._parent)}}this._super(t)},particles:function(){return this._particles},_stringify:function(){var t=this._super();return t}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_56);var $i_57=$i_2.extend({classId:"$i_57",init:function(t){this._mapData=t||[]},tileData:function(t,e,i){if(t!==void 0&&e!==void 0){if(i!==void 0)return this._mapData[e]=this._mapData[e]||[],this._mapData[e][t]=i,this;if(this._mapData[e])return this._mapData[e][t]}return void 0},clearData:function(t,e){return t!==void 0&&e!==void 0&&this._mapData[e]!==void 0?(delete this._mapData[e][t],!0):!1},collision:function(t,e,i,s){var n,r;if(i===void 0&&(i=1),s===void 0&&(s=1),t!==void 0&&e!==void 0)for(r=0;s>r;r++)for(n=0;i>n;n++)if(this.tileData(t+n,e+r))return!0;return!1},mapData:function(t){return t!==void 0?(this._mapData=t,this):this._mapData},mapDataString:function(){return JSON.stringify(this.mapData())},insertMapData:function(){},rotateData:function(t,e){switch(e){case-90:break;case 180:break;case 90:default:}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_57);var $i_58=$i_2.extend({classId:"$i_58",init:function(t){this._mapData=t||[]},tileData:function(t,e,i){if(t!==void 0&&e!==void 0){if(i!==void 0)return this._mapData[e]=this._mapData[e]||[],this._mapData[e][t]=[],this._mapData[e][t].push(i),this;if(this._mapData[e]!==void 0)return this._mapData[e][t]}return void 0},tileDataAtIndex:function(t,e,i){return this._mapData[e]&&this._mapData[e][t]?this._mapData[e][t][i]:void 0},push:function(t,e,i){return i!==void 0?(this._mapData[e]=this._mapData[e]||[],this._mapData[e][t]=this._mapData[e][t]||[],this._mapData[e][t].push(i),this):!1},pull:function(t,e,i){return this._mapData[e]&&this._mapData[e][t]?(this._mapData[e][t].pull(i),this):!1},collision:function(t,e,i,s){var n,r;if(i===void 0&&(i=1),s===void 0&&(s=1),t!==void 0&&e!==void 0)for(r=0;s>r;r++)for(n=0;i>n;n++)if(this._mapData[e+r]&&this._mapData[e+r][t+n]&&this._mapData[e+r][t+n].length)return!0;return!1},clearData:function(t,e){return t!==void 0&&e!==void 0&&this._mapData[e]!==void 0?(delete this._mapData[e][t],!0):!1},mapData:function(t){return t!==void 0?(this._mapData=t,this):this._mapData}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_58);var $i_59=$i_53.extend({classId:"$i_59",init:function(t,e){this._alwaysInView=!0,this._super(),this.map=new $i_57,this._tileWidth=t!==void 0?t:40,this._tileHeight=e!==void 0?e:40,this._drawGrid=0},drawGrid:function(t){return t!==void 0?(this._drawGrid=t,this):this._drawGrid},highlightOccupied:function(t){return t!==void 0?(this._highlightOccupied=t,this):this._highlightOccupied},highlightTileRect:function(t){return t!==void 0?(this._highlightTileRect=t,this):this._highlightTileRect},tileWidth:function(t){return t!==void 0?(this._tileWidth=t,this):this._tileWidth},tileHeight:function(t){return t!==void 0?(this._tileHeight=t,this):this._tileHeight},_childMounted:function(t){t.occupyTile=this._objectOccupyTile,t.unOccupyTile=this._objectUnOccupyTile,t.overTiles=this._objectOverTiles,this._super(t)},_objectOccupyTile:function(t,e,i,s){return t!==void 0&&e!==void 0?this._parent.occupyTile(t,e,i,s,this):this.overTiles(),this},_objectUnOccupyTile:function(t,e,i,s){return t!==void 0&&e!==void 0?this._parent.unOccupyTile(t,e,i,s):this.overTiles(),this},_objectOverTiles:function(){if(this._tileWidth&&this._tileHeight){var t,e;for(t=0;this._tileWidth>t;t++)for(e=0;this._tileHeight>e;e++);}else this.log('Cannot calculate which tiles this entity is currently "over" because it has not been assigned either a tileWidth or a tileHeight.',"error")},_resizeEvent:function(t){this.geometry=this._parent.geometry.clone(),this._super(t)},occupyTile:function(t,e,i,s,n){var r,o;if(i===void 0&&(i=1),s===void 0&&(s=1),t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),s=Math.floor(s),t!==void 0&&e!==void 0){for(r=0;i>r;r++)for(o=0;s>o;o++)this.map.tileData(t+r,e+o,n);n._classId&&(n._occupiedRect=new $i_7(t,e,i,s))}return this},unOccupyTile:function(t,e,i,s){var n,r,o;if(i===void 0&&(i=1),s===void 0&&(s=1),t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),s=Math.floor(s),t!==void 0&&e!==void 0)for(n=0;i>n;n++)for(r=0;s>r;r++)o=this.map.tileData(t+n,e+r),o&&o._occupiedRect&&delete o._occupiedRect,this.map.clearData(t+n,e+r);return this},isTileOccupied:function(t,e,i,s){return i===void 0&&(i=1),s===void 0&&(s=1),this.map.collision(t,e,i,s)},mouseDown:function(t){return t!==void 0?(this._tileMapMouseDown=t,this):this._tileMapMouseDown},mouseUp:function(t){return t!==void 0?(this._tileMapMouseUp=t,this):this._tileMapMouseUp},mouseOver:function(t){return t!==void 0?(this._tileMapMouseOver=t,this):this._tileMapMouseOver},pointToTile:function(t){var e,i,s,n=t.x,r=t.y;return this._mountMode===0&&(e=n+this._tileWidth/2,i=r+this._tileHeight/2,s=new $i_5(Math.floor(e/this._tileWidth),Math.floor(i/this._tileWidth))),this._mountMode===1&&(e=n,i=r-this._tileHeight/2,s=new $i_5(e,i,0).to2d(),s=new $i_5(Math.floor(s.x/this._tileWidth)+1,Math.floor(s.y/this._tileHeight)+1)),s},mouseTileWorldXY:function(){return this._mountMode===0?this._mouseTilePos.clone().thisMultiply(this._tileWidth,this._tileHeight,0):this._mountMode===1?this._mouseTilePos.clone().thisMultiply(this._tileWidth,this._tileHeight,0).thisToIso():void 0},mouseToTile:function(){return this.pointToTile(this.mousePos())},scanRects:function(t){var e,i,s=[],n=this.map._mapData.clone();for(i in n)if(n.hasOwnProperty(i))for(e in n[i])n[i].hasOwnProperty(e)&&n[i][e]&&(!t||t&&t(n[i][e],e,i))&&s.push(this._scanRects(n,parseInt(e,10),parseInt(i,10),t));return s},_scanRects:function(t,e,i,s){var n={x:e,y:i,width:1,height:1},r=e+1,o=i+1;t[i][e]=0;while(t[i][r]&&(!s||s&&s(t[i][r],r,i)))n.width++,t[i][r]=0,r++;while(t[o]&&t[o][e]&&(!s||s&&s(t[o][e],e,o))){if(t[o][e-1]&&(!s||s&&s(t[o][e-1],e-1,o))||t[o][e+n.width]&&(!s||s&&s(t[o][e+n.width],e+n.width,o)))return n;for(r=e;e+n.width>r;r++)if(!t[o][r]||s&&!s(t[o][r],r,o))return n;for(r=e;e+n.width>r;r++)t[o][r]=0;n.height++,o++}return n},_calculateMousePosition:function(){this._mouseTilePos=this.pointToTile(this.mousePos())},tick:function(t){var e,i,s,n,r,o,a,h,u=this._tileWidth,l=this._tileHeight;if(this._calculateMousePosition(),ige.input.mouseMove&&this._tileMapMouseOver&&this._tileMapMouseOver(this._mouseTilePos.x,this._mouseTilePos.y),ige.input.mouseDown&&this._tileMapMouseDown&&this._tileMapMouseDown(this._mouseTilePos.x,this._mouseTilePos.y),ige.input.mouseUp&&this._tileMapMouseUp&&this._tileMapMouseUp(this._mouseTilePos.x,this._mouseTilePos.y),this._transformContext(t),this._drawGrid>0){for(t.strokeStyle="#ffffff",gridCount=this._drawGrid,i=-(u/2),s=-(l/2),n=i+u*gridCount,r=s+l*gridCount,e=0;gridCount>=e;e++)o=new $i_5(i,s+l*e,0),a=new $i_5(n,s+l*e,0),this._mountMode===1&&(o=o.toIso(),a=a.toIso()),t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(a.x,a.y),t.stroke();for(e=0;gridCount>=e;e++)o=new $i_5(i+u*e,s,0),a=new $i_5(i+u*e,r,0),this._mountMode===1&&(o=o.toIso(),a=a.toIso()),t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(a.x,a.y),t.stroke()}if(this._highlightOccupied){t.fillStyle="#ff0000";for(s in this.map._mapData)if(this.map._mapData[s])for(i in this.map._mapData[s])this.map._mapData[s][i]&&(h=new $i_5(u*i,l*s,0),this._mountMode===0&&t.fillRect(h.x-u/2,h.y-l/2,u,l),this._mountMode===1&&(h.thisToIso(),t.beginPath(),t.moveTo(h.x,h.y-l/2),t.lineTo(h.x+u,h.y),t.lineTo(h.x,h.y+l/2),t.lineTo(h.x-u,h.y),t.lineTo(h.x,h.y-l/2),t.fill()))}if(this._highlightTileRect)for(t.fillStyle="#e4ff00",s=this._highlightTileRect.y;this._highlightTileRect.y+this._highlightTileRect.height>s;s++)for(i=this._highlightTileRect.x;this._highlightTileRect.x+this._highlightTileRect.width>i;i++)h=new $i_5(u*i,l*s,0),this._mountMode===0&&t.fillRect(h.x-u/2,h.y-l/2,u,l),this._mountMode===1&&(h.thisToIso(),t.beginPath(),t.moveTo(h.x,h.y-l/2),t.lineTo(h.x+u,h.y),t.lineTo(h.x,h.y+l/2),t.lineTo(h.x-u,h.y),t.lineTo(h.x,h.y-l/2),t.fill());this._drawMouse&&(t.fillStyle="#6000ff",this._mountMode===0&&t.fillRect(this._mouseTilePos.x*u-u/2,this._mouseTilePos.y*l-l/2,u,l),this._mountMode===1&&(h=this._mouseTilePos.clone().thisMultiply(u,l,0).thisToIso(),t.beginPath(),t.moveTo(h.x,h.y-l/2),t.lineTo(h.x+u,h.y),t.lineTo(h.x,h.y+l/2),t.lineTo(h.x-u,h.y),t.lineTo(h.x,h.y-l/2),t.fill())),this._super(t,!0)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_59);var $i_48Map=$i_59.extend({classId:"$i_48Map",init:function(t,e){this._super(t,e),this.map=new $i_57,this._textureList=[],this._renderCenter=new $i_5(0,0,0),this._cacheDirty=!0},caching:function(t){return t!==void 0?(t===0&&(delete this._cache,delete this._cacheCtx),this._caching=t,this._caching>0&&this._renderArea&&this._resizeCacheCanvas(),this):this._caching},cacheForceFrame:function(){this._cacheDirty=!0},negate:function(t){if(t!==void 0){var e,i,s=t.map._mapData,n=this.map._mapData;for(i in s)if(s.hasOwnProperty(i))for(e in s[i])s[i].hasOwnProperty(e)&&n[i]&&n[i][e]&&delete n[i][e]}return this},addTexture:function(t){return this._textureList.push(t),this._textureList.length-1},paintTile:function(t,e,i,s){t!==void 0&&e!==void 0&&i!==void 0&&((s===void 0||1>s)&&(s=1),this.map.tileData(t,e,[i,s]))},clearTile:function(t,e){this.map.clearData(t,e)},_loadMapTextureLoaded:function(){this._loadMapTexturesLoading--,this._loadMapTexturesLoading===0&&this.emit("loadMapAllTexturesLoaded")},loadMap:function(map){if(map.textures){this._textureList=[],this._loadMapTexturesLoading=map.textures.length;var tex=[],i,self=this,_texLoaded=function(){self._loadMapTextureLoaded()};for(this.on("loadMapAllTexturesLoaded",function(){var t;for(t=0;map.textures.length>t;t++)self.addTexture(tex[t]);self.map.mapData(map.data)}),i=0;map.textures.length>i;i++)eval("tex["+i+"] = "+map.textures[0]),tex[i].on("loaded",_texLoaded)}else this.map.mapData(map.data);return this},saveMap:function(){var t,e,i,s=[],n=0,r=0,o=this.map._mapData;for(t=0;this._textureList.length>t;t++)s.push(this._textureList[t].stringify());for(i in o)if(o.hasOwnProperty(i))for(e in o[i])o[i].hasOwnProperty(e)&&(n>e&&(n=e),r>i&&(r=i));return JSON.stringify({textures:s,data:this.map.mapDataString(),dataXY:[n,r]})},tileTextureIndex:function(t,e,i){if(t!==void 0&&e!==void 0){var s=this.map.tileData(t,e);if(i===void 0)return s[0];s[0]=i}},tileTextureCell:function(t,e,i){if(t!==void 0&&e!==void 0){var s=this.map.tileData(t,e);if(i===void 0)return s[1];s[1]=i}},convertOldData:function(t){var e,i,s=[];for(e in t)if(t.hasOwnProperty(e))for(i in t[e])t[e].hasOwnProperty(i)&&(s[i]=s[i]||[],s[i][e]=t[e][i]);console.log(JSON.stringify(s))},renderArea:function(t,e,i,s){var n=!1;return this._renderArea?(t!==void 0&&(this._renderArea[0]=t,n=!0),e!==void 0&&(this._renderArea[1]=e,n=!0),i!==void 0&&(this._renderArea[2]=i,n=!0),s!==void 0&&(this._renderArea[3]=s,n=!0)):t!==void 0&&e!==void 0&&i!==void 0&&s!==void 0&&(this._renderArea=[t,e,i,s],n=!0),n?this:this._renderArea},renderAreaAutoSize:function(t,e){return t!==void 0?(this._renderAreaAutoSize=t,this._renderAreaAutoSizeOptions=e,this):this._renderAreaAutoSize},renderCenter:function(t,e){if(t!==void 0&&e!==void 0){var i;return this._mode===0&&(i=this._translate),this._mode===1&&(i=this._translate.toIso()),t-=i.x,e-=i.y,this._renderCenter&&this._renderCenter.x===t&&this._renderCenter.y===e||(this._renderCenter=new $i_5(t,e,0),this._cacheDirty=!0),this}return this._renderCenter},trackTranslate:function(t){return t!==void 0?(this._trackTranslateTarget=t,this):this._trackTranslateTarget},unTrackTranslate:function(){delete this._trackTranslateTarget},tick:function(t){this._super(t);var e,i,s,n,r,o,a=this.map._mapData,h=this._renderArea,u=this._newTileEntity();if(h)this._trackTranslateTarget&&(n=this._trackTranslateTarget.isometric()===!0?this._trackTranslateTarget._translate.toIso():this._trackTranslateTarget._translate,this.renderCenter(n.x,n.y)),this._caching>0?this._cacheDirty?this._caching===1&&this._cache&&this._cache[0]&&(r=this._cache[0],o=this._cacheCtx[0],this._cacheCtx[0].clearRect(0,0,r.width,r.height),o.save(),o.translate(r.width/2-this._renderCenter.x,r.height/2-this._renderCenter.y),this._renderMap(this._cacheCtx[0],u,a,h),o.restore(),this._renderMapCache(t,0,h),this._cacheDirty=!1):(this._renderMapCache(t,0,h),this._cacheDirty=!1):this._renderMap(t,u,a,h);else for(i in a)if(a.hasOwnProperty(i))for(e in a[i])a[i].hasOwnProperty(e)&&(s=a[i][e],s&&this._renderTile(t,e,i,s,u))},_renderMapCache:function(t,e,i){e===0&&t.drawImage(this._cache[e],-(i[2]/2)+this._renderCenter.x,-(i[3]/2)+this._renderCenter.y)},_renderMap:function(t,e,i,s){var n,r,o,a,h,u=this._renderCenter,l=this.pointToTile(this._renderCenter),d=l.x,c=l.y,_=Math.ceil(s[2]/this._tileWidth),g=Math.ceil(s[3]/this._tileHeight),p=new $i_7(s[0]+u.x,s[1]+u.y,s[2],s[3]);if(this._drawBounds&&(t.strokeStyle="#ff0000",t.strokeRect(p.x,p.y,p.width,p.height)),p.x-=this._tileWidth,p.y-=this._tileHeight/2,p.width+=this._tileWidth*2,p.height+=this._tileHeight,this._mountMode===0)for(r=c-Math.floor(g/2)-1;c+Math.floor(g/2)+1>=r;r++)if(i[r])for(n=d-Math.floor(_/2)-1;d+Math.floor(_/2)+1>=n;n++)o=i[r][n],o&&this._renderTile(t,n,r,o,e,p);if(this._mountMode===1)for(a=Math.abs(_)>Math.abs(g)?_:g,h=1,r=c-Math.floor(a*h);c+Math.floor(a*h)>=r;r++)if(i[r])for(n=d-Math.floor(a*h);d+Math.floor(a*h)>=n;n++)o=i[r][n],o&&this._renderTile(t,n,r,o,e,p)},_renderTile:function(t,e,i,s,n,r){var o,a;this._mountMode===0&&(o=e*this._tileWidth,a=i*this._tileHeight),this._mountMode===1&&(tx=e*this._tileWidth,ty=i*this._tileHeight,sx=tx-ty,sy=(tx+ty)*.5,o=sx,a=sy),(!r||r.xyInside(o,a))&&(t.save(),t.translate(o,a),texture=this._textureList[s[0]],n._cell=s[1],texture.render(t,n,ige.tickDelta),t.restore())},_resizeEvent:function(t){if(this._renderAreaAutoSize){var e=this._parent.geometry,i=0,s=0;this._renderAreaAutoSizeOptions&&(this._renderAreaAutoSizeOptions.bufferMultiple&&(i=e.x*this._renderAreaAutoSizeOptions.bufferMultiple.x-e.x,s=e.y*this._renderAreaAutoSizeOptions.bufferMultiple.y-e.y),this._renderAreaAutoSizeOptions.bufferPixels&&(i=this._renderAreaAutoSizeOptions.bufferPixels.x,s=this._renderAreaAutoSizeOptions.bufferPixels.y)),this.renderArea(-Math.floor((e.x+i)/2),-Math.floor((e.y+s)/2),e.x+i,e.y+s),this._caching>0&&this._resizeCacheCanvas()}this._super(t)},_resizeCacheCanvas:function(){switch(this._caching){case 1:this._cache=[],this._cacheCtx=[],this._cacheDirty=!0,canvas=document.createElement("canvas"),canvas.width=this._renderArea[2],canvas.height=this._renderArea[3],canvas.style.position="absolute",canvas.style.left="0px",canvas.style.top="0px",canvas.style.opacity="0",this._cache.push(canvas),this._cacheCtx.push(canvas.getContext("2d"))}},_newTileEntity:function(){return this._mountMode===0?{_cell:1,geometry:{x:this._tileWidth,y:this._tileHeight},_renderPos:{x:-this._tileWidth/2,y:-this._tileHeight/2}}:this._mountMode===1?{_cell:1,geometry:{x:this._tileWidth*2,y:this._tileHeight},_renderPos:{x:-this._tileWidth,y:-this._tileHeight/2}}:void 0}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_48Map);var $i_61=$i_53.extend({classId:"$i_61",init:function(){this._super(),this.map=new $i_57},mapData:function(t){return t!==void 0?(this.map.mapData(t),this):this.map.mapData()}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_61);var $i_62=$i_53.extend({classId:"$i_62",init:function(t){this._super(),this._trackRotateTarget=void 0,this._trackTranslateTarget=void 0,this._trackRotateSmoothing=void 0,this._trackTranslateSmoothing=void 0,this._entity=t},limit:function(t){return t!==void 0?(this._limit=t,this._entity):this._limit},panTo:function(t,e,i){return t!==void 0&&this._translate.tween().properties({x:t.x,y:t.y,z:t.z}).duration(e).easing(i).start(),this._entity},panBy:function(t,e,i){return t!==void 0&&this._translate.tween().properties({x:t.x+this._translate.x,y:t.y+this._translate.y,z:t.z+this._translate.z}).duration(e).easing(i).start(),this._entity},trackTranslate:function(t,e){return t!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking translation target "+t.id()),this._trackTranslateSmoothing=1>e?0:e,this._trackTranslateTarget=t,this._entity):this._trackTranslateTarget},trackTranslateSmoothing:function(t){return t!==void 0?(this._trackTranslateSmoothing=t,this):this._trackTranslateSmoothing},unTrackTranslate:function(){delete this._trackTranslateTarget},trackRotate:function(t,e){return t!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking rotation of target "+t.id()),this._trackRotateSmoothing=1>e?0:e,this._trackRotateTarget=t,this._entity):this._trackRotateTarget},trackRotateSmoothing:function(t){return t!==void 0?(this._trackRotateSmoothing=t,this):this._trackRotateSmoothing},unTrackRotate:function(){delete this._trackRotateTarget},lookAt:function(t){return t!==void 0&&(t.updateTransform(),this._translate.x=t._worldMatrix.matrix[2],this._translate.y=t._worldMatrix.matrix[5],this.updateTransform()),this},tick:function(t){if(this._trackTranslateTarget){var e,i,s,n,r=this._trackTranslateTarget,o=r._worldMatrix.matrix,a=o[2],h=o[5];this._trackTranslateSmoothing?(e=this._translate.x,i=this._translate.y,s=a-e,n=h-i,this._translate.x+=s/this._trackTranslateSmoothing,this._translate.y+=n/this._trackTranslateSmoothing):this.lookAt(this._trackTranslateTarget)}if(this._trackRotateTarget){var u,l,d=this._trackRotateTarget._parent!==void 0?this._trackRotateTarget._parent._rotate.z:0,c=-(d+this._trackRotateTarget._rotate.z);this._trackRotateSmoothing?(u=this._rotate.z,l=c-u,this._rotate.z+=l/this._trackRotateSmoothing):this._rotate.z=c}this.updateTransform(),this._localMatrix.transformRenderingContext(t)},updateTransform:function(){if(this._localMatrix.identity(),this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z)),this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y)),this._mode===0&&this._localMatrix.multiply(this._localMatrix._newTranslate(-this._translate.x,-this._translate.y)),this._mode===1){var t=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this.geometry.z/2).toIso();this._parent&&this._parent.geometry.z&&(t.y+=this._parent.geometry.z/1.6),this._localMatrix.multiply(this._localMatrix._newTranslate(t.x,t.y))}this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix)},_stringify:function(){var t,e=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_trackTranslateTarget":e+=".trackTranslate(ige.$('"+this._trackTranslateTarget.id()+"'), "+this.trackTranslateSmoothing()+")";break;case"_trackRotateTarget":e+=".trackRotate(ige.$('"+this._trackRotateTarget.id()+"'), "+this.trackRotateSmoothing()+")"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_62);var $i_63=$i_53.extend([{extension:$i_42,overwrite:!0},{extension:$i_41,overwrite:!0}],{classId:"$i_63",init:function(t){this._alwaysInView=!0,this._super(),this._mousePos=new $i_5(0,0,0),this._overflow="",this._uiX=0,this._uiY=0,t===void 0&&(t={left:0,top:0,width:ige.geometry.x,height:ige.geometry.y,autoSize:!0}),this.geometry=new $i_5(t.width||250,t.height||150,0),this.camera=new $i_62(this),this.camera._entity=this},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},scene:function(t){return t!==void 0?(this._scene=t,this):this._scene},mousePos:function(){return this._mousePos},viewArea:function(){var t=this.aabb(),e=this.camera._translate;return new $i_7(t.x+e.x,t.y+e.y,t.width,t.height)},tick:function(t,e){if(this._scene&&(ige._currentCamera=this.camera,ige._currentViewport=this,this._scene._parent=this,this._super(t),t.translate(-(this.geometry.x*this._origin.x)|0,-(this.geometry.y*this._origin.y)|0),t.clearRect(0,0,this.geometry.x,this.geometry.y),(!ige.cocoonJs||ige.cocoonJs&&!ige.cocoonJs.detected)&&(t.beginPath(),t.rect(0,0,this.geometry.x,this.geometry.y),this._borderColor&&(t.strokeStyle=this._borderColor,t.stroke()),t.clip()),t.translate(this.geometry.x/2|0,this.geometry.y/2|0),this.camera.tick(t),t.save(),this._scene.tick(t,e),t.restore(),this._drawBounds&&t===ige._ctx&&this.drawAABBs(t,this._scene,0),this._drawMouse&&t===ige._ctx&&this._mousePos)){t.save(),t.scale(1/this.camera._scale.x,1/this.camera._scale.y);var i,s=Math.floor(this._mousePos.x*this.camera._scale.x),n=Math.floor(this._mousePos.y*this.camera._scale.y);t.fillStyle="#fc00ff",t.fillRect(s-5,n-5,10,10),i=t.measureText("Viewport "+this.id()+" :: "+s+", "+n),t.fillText("Viewport "+this.id()+" :: "+s+", "+n,s-i.width/2,n-15),t.restore()}},drawAABBs:function(t,e,i){var s,n,r,o,a,h,u,l,d,c,_,g,p,f,m,y,v,x,w,b=e._children;if(b){s=b.length;while(s--)n=b[s],i++,n._shouldRender!==!1&&(typeof n.aabb=="function"&&(r=n.aabb(),r&&((n._drawBounds||n._drawBounds===void 0)&&(t.strokeStyle="#00deff",t.strokeRect(r.x,r.y,r.width,r.height),n._parent&&n._parent._mountMode===1&&(t.save(),t.translate(r.x+r.width/2,r.y+r.height/2),a=n.geometry,h=new $i_5(-(a.x/2),0,0).toIso(),u=new $i_5(+(a.x/2),0,0).toIso(),l=new $i_5(0,-(a.y/2),0).toIso(),d=new $i_5(0,+(a.y/2),0).toIso(),c=new $i_5(0,0,-(a.z/2)).toIso(),_=new $i_5(0,0,+(a.z/2)).toIso(),g=new $i_5(-(a.x/2),-(a.y/2),-(a.z/2)).toIso(),p=new $i_5(+(a.x/2),-(a.y/2),-(a.z/2)).toIso(),f=new $i_5(+(a.x/2),+(a.y/2),-(a.z/2)).toIso(),m=new $i_5(-(a.x/2),+(a.y/2),-(a.z/2)).toIso(),y=new $i_5(-(a.x/2),-(a.y/2),a.z/2).toIso(),v=new $i_5(+(a.x/2),-(a.y/2),a.z/2).toIso(),x=new $i_5(+(a.x/2),+(a.y/2),a.z/2).toIso(),w=new $i_5(-(a.x/2),+(a.y/2),a.z/2).toIso(),o=t.globalAlpha,t.globalAlpha=1,t.strokeStyle="#ff0000",t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(u.x,u.y),t.stroke(),t.strokeStyle="#00ff00",t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(d.x,d.y),t.stroke(),t.strokeStyle="#fffc00",t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(_.x,_.y),t.stroke(),t.strokeStyle="#a200ff",t.globalAlpha=.6,t.fillStyle="#545454",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(m.x,m.y),t.lineTo(w.x,w.y),t.lineTo(x.x,x.y),t.lineTo(f.x,f.y),t.fill(),t.stroke(),t.fillStyle="#282828",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(p.x,p.y),t.lineTo(v.x,v.y),t.lineTo(x.x,x.y),t.lineTo(f.x,f.y),t.fill(),t.stroke(),t.fillStyle="#676767",t.beginPath(),t.moveTo(y.x,y.y),t.lineTo(v.x,v.y),t.lineTo(x.x,x.y),t.lineTo(w.x,w.y),t.lineTo(y.x,y.y),t.fill(),t.stroke(),t.globalAlpha=o,t.restore())),this._drawBoundsData&&(n._drawBounds||n._drawBoundsData===void 0)&&(t.globalAlpha=1,t.fillStyle="#f6ff00",t.fillText("ID: "+n.id()+" "+"("+n.classId()+") "+n.layer()+":"+n.depth().toFixed(0),r.x+r.width+3,r.y+10),t.fillText("X: "+n._translate.x.toFixed(2)+", "+"Y: "+n._translate.y.toFixed(2)+", "+"Z: "+n._translate.z.toFixed(2),r.x+r.width+3,r.y+20)))),this.drawAABBs(t,n,i))}},_resizeEvent:function(t){this._autoSize&&this._parent&&(this.geometry=this._parent.geometry.clone()),this._updateUiPosition(),this._scene&&this._scene._resizeEvent(t)},_stringify:function(){var t,e=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_autoSize":e+=".autoSize("+this._autoSize+")";break;case"_scene":e+=".scene(ige.$('"+this.scene().id()+"'))"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_63);var $i_64=$i_53.extend({classId:"$i_64",init:function(){this._alwaysInView=!0,this._super(),this._shouldRender=!0,this._autoSize=!0,this.geometry.x=ige.geometry.x,this.geometry.y=ige.geometry.y},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},shouldRender:function(t){return t!==void 0?(this._shouldRender=t,this):this._shouldRender},ignoreCamera:function(t){return t!==void 0?(this._ignoreCamera=t,this):this._ignoreCamera},tick:function(t){if(this._shouldRender){if(this._ignoreCamera){var e=ige._currentCamera;this.translateTo(e._translate.x,e._translate.y,e._translate.z)}this._super(t)}},_resizeEvent:function(t){this._autoSize&&(this.geometry=ige.geometry.clone());var e=this._children,i=e.length;while(i--)e[i]._resizeEvent(t)},_stringify:function(){var t,e=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_shouldRender":e+=".shouldRender("+this.shouldRender()+")";break;case"_autoSize":e+=".autoSize("+this.autoSize()+")"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_64);var $i_65=$i_3.extend({classId:"$i_65",init:function(t,e){this._linear=!1,this._items=[],this._itemCount=0,this._eventCount=0,this._itemCompleteCount=0,this._eventCompleteCount=0,this._started=!1,this._isComplete=!1,t!==void 0&&this.items(t),e!==void 0&&(this._completeCallback=e)},complete:function(t){return t!==void 0?(this._completeCallback=t,this):this._completeCallback},isComplete:function(t){return t!==void 0?(this._isComplete=t,this):this._isComplete},linear:function(t){return t!==void 0?(this._linear=t,this):this._linear},items:function(t){if(t!==void 0){this._items=t;var e,i=this._items,s=i.length,n=0;for(e=0;s>e;e++)n+=i[e].count;return this._eventCount=n,this._itemCount=s,this}return this._items},itemCount:function(){return this._itemCount},eventCount:function(){return this._eventCount},eventCompleteCount:function(){return this._eventCompleteCount},itemCompleteCount:function(){return this._itemCompleteCount},percentComplete:function(){return Math.floor(100/this._eventCount*this._eventCompleteCount)},start:function(){if(this._started)this.log("Cannot start quest because it has already been started!","warning"),this.emit("alreadyStarted");else{var t,e=this._items,i=e.length;if(this._started=!0,this._linear)this._setupItemListener(e[0]);else for(t=0;i>t;t++)this._setupItemListener(e[t]);this.emit("started")}return this},stop:function(){return this._started?(this._started=!1,this.emit("stopped")):(this.log("Cannot stop quest because it has not been started yet!","warning"),this.emit("notStarted")),this},reset:function(){var t,e,i=this._items,s=i.length;for(t=0;s>t;t++)e=i[t],e._complete=!1,e._eventCount=0,e._listener&&e.emitter.off(e.eventName,e._listener),delete e._listener;return this._eventCompleteCount=0,this._itemCompleteCount=0,this._isComplete=!1,this.emit("reset"),this},_setupItemListener:function(t){var e=this;t._listener||(t._eventCount=0,t._complete=!1,t._listener=t.emitter.on(t.eventName,function(){e._started&&(t.eventEvaluate?t.eventEvaluate.apply(e,arguments)&&e._eventComplete(t):e._eventComplete(t))}))},_eventComplete:function(t){t._eventCount++,this._eventCompleteCount++,t.eventCallback&&t.eventCallback.apply(this,t),this.emit("eventComplete",t),t._eventCount===t.count&&this._itemComplete(t)},_itemComplete:function(t){var e,i=this._items;t._complete=!0,t.emitter.off(t.eventName,t._listener),delete t._listener,this._itemCompleteCount++,t.itemCallback&&t.itemCallback.apply(this,t),this.emit("itemComplete",t),this._update(),this._started&&this._linear&&this.itemCount()>this._itemCompleteCount&&(e=i.indexOf(t),this._setupItemListener(i[e+1]),this.emit("nextItem",i[e+1]))},_update:function(){this._itemCompleteCount===this.itemCount()&&(this._isComplete=!0,this._completeCallback.apply(this),this.emit("complete"),this.stop(),this.reset())}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_65);var $i_69=$i_54.extend({classId:"$i_69",click:function(){return this._mouseDown&&this._mouseDown(),this._mouseUp&&this._mouseUp(),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_69);var $i_70=$i_69.extend({classId:"$i_70",radioGroup:function(t){return t!==void 0?(this._uiRadioGroup=t,this):this._uiRadioGroup},select:function(t){if(t!==void 0)return this._uiOnSelect=t,this;if(this._parent){var e,i=this._parent._children,s=i.length;while(s--)e=i[s],e!==this&&e._uiRadioGroup===this._uiRadioGroup&&e._uiSelected&&(e._uiSelected=!1,e._uiOnDeSelect&&e._uiOnDeSelect())}return this._uiSelected=!0,this._uiOnSelect&&this._uiOnSelect(),this
},deSelect:function(t){return t!==void 0?(this._uiOnDeSelect=t,this):(this._uiSelected=!1,this._uiOnDeSelect&&this._uiOnDeSelect(),this)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_70);var $i_71=$i_54.extend({classId:"$i_71",init:function(){this._super(),this._min=0,this._max=100,this._progress=0,this._barBackColor="#000000",this._barColor="#fff600",this._barBorderColor="#ffffff",this._barText={pre:"",post:"",color:""}},barBackColor:function(t){return t!==void 0?(this._barBackColor=t,this):this._barBackColor},barColor:function(t){return t!==void 0?(this._barColor=t,this):this._barColor},barBorderColor:function(t){return t!==void 0?(this._barBorderColor=t,this):this._barBorderColor},barText:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._barText={pre:t,post:e,color:i},this):this._barText},max:function(t){return t!==void 0?(this._max=t,this):this._max},min:function(t){return t!==void 0?(this._min=t,this):this._min},progress:function(t){return t!==void 0?(this._progress=t,this):this._progress},render:function(t){var e=this._min,i=this._max,s=this._progress,n=this.geometry.x/(i-e),r=(s-e)*n;s>i&&(s=i),e>s&&(s=e),this._barBackColor&&(t.fillStyle=this._barBackColor,t.fillRect(-this.geometry.x2,-this.geometry.y2,this.geometry.x,this.geometry.y)),this._barColor&&(t.fillStyle=this._barColor,t.fillRect(-this.geometry.x2,-this.geometry.y2,r,this.geometry.y)),this._barBorderColor&&(t.strokeStyle=this._barBorderColor,t.strokeRect(-this.geometry.x2,-this.geometry.y2,this.geometry.x,this.geometry.y)),this._barText&&(this._barText.pre||this._barText.post)&&(t.textAlign="center",t.textBaseline="middle",t.fillStyle=this._barText.color,t.fillText(this._barText.pre+(s+"")+this._barText.post,0,0))},tick:function(t){this._transformContext(t),this.render(t),this._super(t,!0)}}),$i_72=$i_54.extend({classId:"$i_72",init:function(){this._super();var t=this;this._hasFocus=!1,this._value="",this._fontEntity=new $i_55,this._fontEntity.width(this.width()),this._fontEntity.height(this.height()),this._fontEntity.left(5),this._fontEntity.middle(0),this._fontEntity.textAlignX(0),this._fontEntity.textAlignY(0),this._fontEntity.mount(this),ige.input.on("keyDown",function(e){t._keyDown(e)})},value:function(t){return t!==void 0?(this._value=t,this._fontEntity.text(this._value),this):this._value},focus:function(t){return t!==void 0?(this._hasFocus=t,this):this._hasFocus},fontSheet:function(t){return t!==void 0?(this._fontSheet=t,this._fontEntity.texture(this._fontSheet),this):this._fontSheet},_keyDown:function(t){if(this._hasFocus)switch(t.preventDefault(),t.stopPropagation(),t.returnValue=!1,t.keyCode){case 8:this._value.length>0&&this.value(this._value.substr(0,this._value.length-1));break;case 13:break;default:this.value(this._value+String.fromCharCode(t.keyCode))}}}),$i_73=$i_54.extend({classId:"$i_73",menuData:function(t){return t!==void 0?(this._menuData=t,this.destroyChildren(),this._buildMenu(this._menuData,this),this):this._menuData},menuMode:function(t){return t!==void 0?(this._menuMode=t,this):this._menuMode},fontSheet:function(t){return t!==void 0?(this._fontSheet=t,this):this._fontSheet},addItem:function(t){},_buildMenu:function(t,e){var i,s,n,r=t.length,o=0,a=0;for(i=0;r>i;i++)s=t[i],this._menuMode&&(a+=this.height()),n=(new $i_73Item).backgroundColor("#666666").left(o).middle(a).height(this.height()).fontSheet(this._fontSheet).menuData(s).mount(e),this._menuMode||(o+=s.width)}}),$i_73Item=$i_54.extend({classId:"$i_73Item",menuData:function(t){return t!==void 0?(this._menuData=t,t.width&&this.width(t.width),t.id&&this.id(t.id),t.mouseUp&&this.mouseUp(t.mouseUp),t.mouseOver&&this.mouseOver(t.mouseOver),t.mouseOut&&this.mouseOut(t.mouseOut),this._labelEntity=(new $i_55).id(this.id()+"_label").texture(this._fontSheet).left(5).middle(0).width(t.width).height(this.height()).textAlignX(0).textAlignY(1).text(t.text).mount(this),this):this._menuData},fontSheet:function(t){return t!==void 0?(this._fontSheet=t,this):this._fontSheet},open:function(){this._menuData.items&&(this._childMenu=(new $i_73).id(this.id()+"_childMenu").depth(this.depth()+1).fontSheet(this._fontSheet).left(0).top(this.height()).width(100).height(30).menuMode(1).menuData(this._menuData.items).mount(this))},close:function(){this._childMenu&&this._childMenu.destroy()}}),$i_74={};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_74),$i_74.tmpCanvas=document.createElement("canvas"),$i_74.tmpCtx=$i_74.tmpCanvas.getContext("2d"),$i_74.createImageData=function(t,e){return $i_74.tmpCtx.createImageData(t,e)},$i_74._convolute=function(t,e,i){for(var s=Math.round(Math.sqrt(e.length)),n=Math.floor(s/2),r=t.data,o=t.width,a=t.height,h=o,u=a,l=$i_74.createImageData(h,u),d=l.data,c=i?1:0,_=0;u>_;_++)for(var g=0;h>g;g++){for(var p=_,f=g,m=(_*h+g)*4,y=0,v=0,x=0,w=0,b=0;s>b;b++)for(var I=0;s>I;I++){var T=p+b-n,C=f+I-n;if(T>=0&&a>T&&C>=0&&o>C){var M=(T*o+C)*4,S=e[b*s+I];y+=r[M]*S,v+=r[M+1]*S,x+=r[M+2]*S,w+=r[M+3]*S}}d[m]=y,d[m+1]=v,d[m+2]=x,d[m+3]=w+c*(255-w)}return l};var $i_88=$i_53.extend({classId:"$i_88",init:function(){this._alwaysInView=!0,this._super(),this._id="ige",this.basePath="",this.isServer=typeof module!="undefined"&&module.exports!==void 0,ige=this,console.log("------------------------------------------------------------------------------"),console.log("* Powered by the Isogenic Game Engine "+igeVersion+"                                  *"),console.log("* (C)opyright 2012 Irrelon Software Limited                                  *"),console.log("* http://www.isogenicengine.com                                              *"),console.log("------------------------------------------------------------------------------"),this._super(),this.isServer||this.addComponent($i_39),this.ClassStore={},this.TextureStore=[],this._idCounter=(new Date).getTime(),this.addComponent($i_14),this.addComponent($i_12),this._renderModes=["2d","$i_86"],this._renderContext="2d",this._renderMode=this._renderModes[this._renderContext],this._tickTime="NA",this.tickDelta=0,this._fpsRate=60,this._state=0,this._textureImageStore={},this._texturesLoading=0,this._texturesTotal=0,this._dependencyQueue=[],this._drawCount=0,this._dps=0,this._frames=0,this._fps=0,this._clientNetDiff=0,this._frameAlternator=!1,this._viewportDepth=!1,this._mousePos=new $i_5(0,0,0),this._currentViewport=null,this._currentCamera=null,this._register={ige:this},this._postTick=[],this._tsit={},this._tslt={},this._ctx=$i_44,this._headless=!0,this.dependencyTimeout(3e4),this._dependencyQueue.push(this.texturesLoaded),setInterval(this._secondTick,1e3)},$:function(t){return typeof t=="string"?this._register[t]:typeof t=="object"?t:this},$$:function(){},register:function(t){return t!==void 0?this._register[t.id()]?(t._registered=!1,this.log('Cannot add object id "'+t.id()+'" to scenegraph because there is already another object in the graph with the same ID!',"error"),!1):(this._register[t.id()]=t,t._registered=!0,this):this._register},unRegister:function(t){return t!==void 0&&this._register[t.id()]&&(delete this._register[t.id()],t._registered=!1),this},setFps:function(t){t!==void 0&&(this.isServer?requestAnimFrame=function(e){setTimeout(function(){e((new Date).getTime())},1e3/t)}:window.requestAnimFrame=function(e){setTimeout(function(){e((new Date).getTime())},1e3/t)})},showStats:function(t){if(t!==void 0){switch(t){case 0:this._removeStatsDiv();break;case 1:this._createStatsDiv()}return this._showStats=t,this}return this._showStats},_createStatsDiv:function(){if(!ige.isServer&&!document.getElementById("igeStats")){var t=document.createElement("div");t.style.fontFamily="Verdana, Tahoma",t.style.fontSize="12px",t.style.position="absolute",t.style.color="#ffffff",t.style.textShadow="1px 1px 3px #000000",t.style.bottom="10px",t.style.left="10px",t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.MozkitUserSelect="none",t.style.zIndex=1e5,t.innerHTML="Please wait...",window.addEventListener("load",function(){document.body.appendChild(t)}),window.addEventListener("unload",function(){}),this._statsDiv=t}},_removeStatsDiv:function(){document.body.removeChild(this._statsDiv),delete this._statsDiv},defineClass:function(t,e){ige.ClassStore[t]=e},getClass:function(t){return ige.ClassStore[t]},newClassInstance:function(t,e){return new ige.ClassStore[t](e)},dependencyCheck:function(){var t=this._dependencyQueue,e=t.length;while(e--)if(!this._dependencyQueue[e]())return!1;return!0},viewportDepth:function(t){return t!==void 0?(this._viewportDepth=t,this):this._viewportDepth},dependencyTimeout:function(t){this._dependencyCheckTimeout=t},textureLoadStart:function(t,e){this._texturesLoading++,this._texturesTotal++,this.emit("textureLoadStart",e)},textureLoadEnd:function(t,e){e._destroyed||this.TextureStore.push(e),this._texturesLoading--,this.emit("textureLoadEnd",e),this._texturesLoading===0&&this._allTexturesLoaded()},textureFromUrl:function(t){var e,i=this.TextureStore,s=i.length;while(s--)if(e=i[s],e._url===t)return e},texturesLoaded:function(){return ige._texturesLoading===0},_allTexturesLoaded:function(){this._loggedATL||(this._loggedATL=!0,this.log("All textures have loaded")),this.emit("texturesLoaded")},canvasReady:function(){return ige._canvas!==void 0||ige.isServer},newId:function(){return this._idCounter++,this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))+""},newIdHex:function(){return this._idCounter++,(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16)},start:function(t){if(!ige._state)if(ige.dependencyCheck())ige.log("Starting engine..."),ige._state=1,requestAnimFrame(ige.tick),ige.log("Engine started"),typeof t=="function"&&t(!0);else{var e=(new Date).getTime();ige._dependencyCheckStart||(ige._dependencyCheckStart=e),e-ige._dependencyCheckStart>this._dependencyCheckTimeout?(this.log("Engine start failed because the dependency check timed out after "+this._dependencyCheckTimeout/1e3+" seconds","error"),typeof t=="function"&&t(!1)):setTimeout(function(){ige.start(t)},200)}},stop:function(){return this._state?(this.log("Stopping engine..."),this._state=0,!0):!1},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},pixelRatioScaling:function(t){return t!==void 0?(this._pixelRatioScaling=t,this):this._pixelRatioScaling},renderContext:function(t){return t!==void 0?(this._renderContext=t,this._renderMode=this._renderModes[t],this.log("Rendering mode set to: "+t),this):this._renderContext},createFrontBuffer:function(t,e){this.isServer||this._canvas||(this._createdFrontBuffer=!0,this._pixelRatioScaling=!e,this._frontBufferSetup(t,e))},_frontBufferSetup:function(t){var e,i=document.createElement("canvas");this._pixelRatioScaling?(e=i.getContext(ige._renderContext),this._devicePixelRatio=window.devicePixelRatio||1,this._backingStoreRatio=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,this._deviceFinalDrawRatio=this._devicePixelRatio/this._backingStoreRatio):(this._devicePixelRatio=1,this._backingStoreRatio=1,this._deviceFinalDrawRatio=1),i.id="igeFrontBuffer",this.canvas(i,t),document.body.appendChild(i)},canvas:function(t,e){this._canvas||(this._canvas=t,e&&(this._autoSize=e,window.addEventListener("resize",this._resizeEvent)),this._resizeEvent(),this._ctx=this._canvas.getContext(this._renderContext),this._headless=!1,this.input.setupListeners(this._canvas))},clearCanvas:function(){this._ctx&&this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},removeCanvas:function(){this.input&&this.input.destroyListeners(),this._autoSize&&window.removeEventListener("resize",this._resizeEvent),this._createdFrontBuffer&&document.body.removeChild(this._canvas),delete this._canvas,delete this._ctx,this._ctx=$i_44,this._headless=!0},openUrl:function(t){t!==void 0&&(ige.cocoonJs&&ige.cocoonJs.detected?ige.cocoonJs.openUrl(t):window.open(t))},showWebView:function(t){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.showWebView(t);else{var e=document.getElementById("igeOverlay");e||(e=document.createElement("iframe"),e.id="igeOverlay",e.style.position="absolute",e.style.border="none",e.style.left="0px",e.style.top="0px",e.style.width="100%",e.style.height="100%",document.body.appendChild(e)),t!==void 0&&(e.src=t),e.style.display="block"}return this},hideWebView:function(){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.hideWebView();else{var t=document.getElementById("igeOverlay");t&&(t.style.display="none")}return this},layerCall:function(js){js!==void 0&&eval(js)},mousePos:function(){return this._mousePos},_resizeEvent:function(t){if(ige._autoSize){var e=window.innerWidth,i=window.innerHeight,s=ige._children,n=s.length;ige._canvas&&(e%2&&e--,i%2&&i--,ige._canvas.width=e*ige._deviceFinalDrawRatio,ige._canvas.height=i*ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio!==1&&(ige._canvas.style.width=e+"px",ige._canvas.style.height=i+"px",ige._ctx.scale(ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio))),ige.geometry=new $i_5(e,i,0);while(n--)s[n]._resizeEvent(t)}ige._resized=!0},_secondTick:function(){var t=ige;if(t._fps=t._frames,t._dps=t._dpt*t._fps,t._frames=0,t._drawCount=0,t._showStats)switch(t._showStats){case 1:t._statsDiv.innerHTML='<span class="met" title="Frames Per Second">fps: '+t._fps+'</span> <span class="met" title="Draws Per Second">dps: '+t._dps+'</span> <span class="met" title="Draws Per Tick">dpt: '+t._dpt+'</span> <span class="met" title="Time Spent Processing Tick">tps: '+t._tickTime+"ms</span>",t.network&&(t._statsDiv.innerHTML+=' <span class="met" title="Network Latency (Time From Server to This Client)">lat: '+t.network._latency+"ms</span>")}},tick:function(t,e){var i,s,n,r=ige,o=r._postTick,a=o.length;if(igeDebug.timing&&(i=(new Date).getTime()),r._state){for(e===void 0&&(e=r._ctx),requestAnimFrame(r.tick),r._frameAlternator=!r._frameAlternator,r.tickStart=t,r.tickStart-=r._clientNetDiff,r.lastTick?r.tickDelta=r.tickStart-r.lastTick:(r.lastTick=0,r.tickDelta=0),r._processBehaviours(e),r.render(e),n=0;a>n;n++)o[n]();r.lastTick=r.tickStart,r._frames++,r._dpt=r._drawCount,r._drawCount=0,r.input.tick()}r._resized=!1,igeDebug.timing&&(s=(new Date).getTime(),ige._tickTime=s-i)},fps:function(){return this._fps},dpt:function(){return this._dpt},dps:function(){return this._dps},render:function(t){var e,i;this._viewportDepth&&(igeDebug.timing?(e=(new Date).getTime(),this.depthSortChildren(),i=(new Date).getTime()-e,ige._tslt[this.id()]||(ige._tslt[this.id()]={}),ige._tslt[this.id()].depthSortChildren=i):this.depthSortChildren()),t.save(),t.translate(this.geometry.x2,this.geometry.y2);var s,n=this._children;if(n)if(s=n.length,igeDebug.timing)while(s--)t.save(),e=(new Date).getTime(),n[s].tick(t),i=(new Date).getTime()-e,n[s]&&(ige._tsit[n[s].id()]||(ige._tsit[n[s].id()]=0),ige._tslt[n[s].id()]||(ige._tslt[n[s].id()]={}),ige._tsit[n[s].id()]+=i,ige._tslt[n[s].id()].tick=i),t.restore();else while(s--)t.save(),n[s].tick(t),t.restore();t.restore()},analyseTiming:function(){igeDebug.timing||this.log("Cannot analyse timing because the igeDebug.timing flag is not enabled so no timing data has been recorded!","warning")},sceneGraph:function(t,e){var i,s,n,r,o="";for(e===void 0&&(e=0),t||(t=ige),i=0;e>i;i++)o+="----";if(igeDebug.timing?(s="",s+="T: "+ige._tsit[t.id()],ige._tslt[t.id()]&&(typeof ige._tslt[t.id()].tick=="number"&&(s+=" | LastTick: "+ige._tslt[t.id()].tick),typeof ige._tslt[t.id()].depthSortChildren=="number"&&(s+=" | ChildDepthSort: "+ige._tslt[t.id()].depthSortChildren)),console.log(o+t.id()+" ("+t._classId+") : "+t._inView+" Timing("+s+")")):console.log(o+t.id()+" ("+t._classId+") : "+t._inView),e++,t===ige){if(n=t._children){r=n.length;while(r--)n[r]._scene._shouldRender&&(igeDebug.timing?(s="",s+="T: "+ige._tsit[n[r].id()],ige._tslt[n[r].id()]&&(typeof ige._tslt[n[r].id()].tick=="number"&&(s+=" | LastTick: "+ige._tslt[n[r].id()].tick),typeof ige._tslt[n[r].id()].depthSortChildren=="number"&&(s+=" | ChildDepthSort: "+ige._tslt[n[r].id()].depthSortChildren)),console.log(o+"----"+n[r].id()+" ("+n[r]._classId+") : "+n[r]._inView+" Timing("+s+")")):console.log(o+"----"+n[r].id()+" ("+n[r]._classId+") : "+n[r]._inView),this.sceneGraph(n[r]._scene,e+1))}}else if(n=t._children){r=n.length;while(r--)this.sceneGraph(n[r],e)}},getSceneGraphData:function(t){var e,i,s,n,r,o=[];if(t||(t=ige),e={text:t.id()+" ("+t._classId+")",parent:t._parent,id:t.id()},t===ige){if(n=t._children){r=n.length;while(r--)i={text:n[r].id()+" ("+n[r]._classId+")",parent:n[r]._parent,id:n[r].id()},n[r]._scene&&(s=this.getSceneGraphData(n[r]._scene),i.items=[s]),o.push(i)}}else if(n=t._children){r=n.length;while(r--)i=this.getSceneGraphData(n[r]),o.push(i)}return o.length>0&&(e.items=o),e},destroy:function(){this.stop(),this.isServer||this.removeCanvas(),this._super(),this.log("Engine destroy complete.")}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_88)