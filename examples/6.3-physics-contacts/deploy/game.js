function printStackTrace(t){t=t||{guess:!0};for(var i=t.e||null,e=!!t.guess,o=new printStackTrace.implementation,n=o.run(i),s=e?o.guessAnonymousFunctions(n):n,r=0;4>r;r++)s.shift();return s}printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(t){t=t||this.createException();var i=this.mode(t);return i==="other"?this.other(arguments.callee):this[i](t)},createException:function(){try{return this.undef(),null}catch(t){return t}},mode:function(t){return this._mode=t.arguments&&t.stack?"chrome":t.message&&typeof window!="undefined"&&window.opera?t.stacktrace?"opera10":"opera":t.stack?"firefox":"other"},instrumentFunction:function(t,i,e){t=t||window;var o=t[i];t[i]=function(){return e.call(this,printStackTrace().slice(4)),t[i]._instrumented.apply(this,arguments)},t[i]._instrumented=o},deinstrumentFunction:function(t,i){t[i].constructor===Function&&t[i]._instrumented&&t[i]._instrumented.constructor===Function&&(t[i]=t[i]._instrumented)},chrome:function(t){var i=(t.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return i.pop(),i},firefox:function(t){return t.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera10:function(t){var i,e,o,n=t.stacktrace,s=n.split("\n"),r="{anonymous}",a=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i;for(i=2,e=0,o=s.length;o-2>i;i++)if(a.test(s[i])){var l=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2,h=RegExp.$3;h=h.replace(/<anonymous function\:?\s?(\S+)?>/g,r),s[e++]=h+"@"+l}return s.splice(e,s.length-e),s},opera:function(t){var i,e,o,n=t.message.split("\n"),s="{anonymous}",r=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i;for(i=4,e=0,o=n.length;o>i;i+=2)r.test(n[i])&&(n[e++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:s+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+n[i+1].replace(/^\s+/,""));return n.splice(e,n.length-e),n},other:function(t){var i,e,o="{anonymous}",n=/function\s*([\w\-$]+)?\s*\(/i,s=[],r=10;while(t&&r>s.length)i=n.test(t+"")?RegExp.$1||o:o,e=Array.prototype.slice.call(t.arguments||[]),s[s.length]=i+"("+this.stringifyArguments(e)+")",t=t.caller;return s},stringifyArguments:function(t){for(var i=Array.prototype.slice,e=0;t.length>e;++e){var o=t[e];o===void 0?t[e]="undefined":o===null?t[e]="null":o.constructor&&(o.constructor===Array?t[e]=3>o.length?"["+this.stringifyArguments(o)+"]":"["+this.stringifyArguments(i.call(o,0,1))+"..."+this.stringifyArguments(i.call(o,-1))+"]":o.constructor===Object?t[e]="#object":o.constructor===Function?t[e]="#function":o.constructor===String&&(t[e]='"'+o+'"'))}return t.join(",")},sourceCache:{},ajax:function(t){var i=this.createXMLHTTPObject();if(i)return i.open("GET",t,!1),i.send(""),i.responseText},createXMLHTTPObject:function(){for(var t,i=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],e=0;i.length>e;e++)try{return t=i[e](),this.createXMLHTTPObject=i[e],t}catch(o){}},isSameDomain:function(t){return t.indexOf(location.hostname)!==-1},getSource:function(t){return t in this.sourceCache||(this.sourceCache[t]=this.ajax(t).split("\n")),this.sourceCache[t]},guessAnonymousFunctions:function(t){for(var i=0;t.length>i;++i){var e=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/,o=t[i],n=e.exec(o);if(n){var s=n[1],r=n[4],a=n[7]||0;if(s&&this.isSameDomain(s)&&r){var l=this.guessAnonymousFunction(s,r,a);t[i]=o.replace("{anonymous}",l)}}}return t},guessAnonymousFunction:function(t,i){var e;try{e=this.findFunctionName(this.getSource(t),i)}catch(o){e="getSource failed with url: "+t+", exception: "+(o+"")}return e},findFunctionName:function(t,i){for(var e,o,n=/function\s+([^(]*?)\s*\(([^)]*)\)/,s=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,r=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,a="",l=10,h=0;l>h;++h)if(e=t[i-h]){if(a=e+a,o=s.exec(a),o&&o[1])return o[1];if(o=n.exec(a),o&&o[1])return o[1];if(o=r.exec(a),o&&o[1])return o[1]}return"(?)"}},ige=null,igeVersion="1.1.0",igeClassStore={},igeDebug={node:typeof module!="undefined"&&module.exports!==void 0,level:["log","warning","error"],stacks:!0,throwErrors:!0,timing:!0},igeDebug.node&&(igeDebug.util=require("util")),Object.defineProperty(Object.prototype,"tween",{enumerable:!1,writable:!0,configurable:!0}),Object.prototype.tween=function(t,i,e){var o=(new $i_47).targetObj(this).properties(t).duration(i);return e&&(e.beforeTween&&o.beforeTween(e.beforeTween),e.afterTween&&o.afterTween(e.afterTween),e.easing&&o.easing(e.easing),e.startTime&&o.startTime(e.startTime)),o},Object.defineProperty(Array.prototype,"clone",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.clone=function(){var t,i=[];for(t in this)this.hasOwnProperty(t)&&(i[t]=this[t]instanceof Array?this[t].clone():this[t]);return i},Object.defineProperty(Array.prototype,"pull",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.pull=function(t){var i=this.indexOf(t);return i>-1?(this.splice(i,1),i):-1},Object.defineProperty(Array.prototype,"each",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.each=function(t){var i,e=this.length;for(i=0;e>i;i++)t(this[i])},Object.defineProperty(Array.prototype,"eachReverse",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachReverse=function(t){var i,e=this.length;for(i=e-1;i>=0;i--)t(this[i])},Object.defineProperty(Array.prototype,"eachIsolated",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachIsolated=function(t){var i,e=[],o=e.length;for(i=0;o>i;i++)e[i]=this[i];for(i=0;o>i;i++)t(e[i])},Object.defineProperty(Math,"PI180",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180=Math.PI/180,Object.defineProperty(Math,"PI180R",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180R=180/Math.PI,Object.defineProperty(Math,"radians",{enumerable:!1,writable:!0,configurable:!0}),Math.radians=function(t){return t*Math.PI180},Object.defineProperty(Math,"degrees",{enumerable:!1,writable:!0,configurable:!0}),Math.degrees=function(t){return t*Math.PI180R},Object.defineProperty(Math,"distance",{enumerable:!1,writable:!0,configurable:!0}),Math.distance=function(t,i,e,o){return Math.sqrt((t-e)*(t-e)+(i-o)*(i-o))};var disableContextMenu=function(t){t!==null&&(t.oncontextmenu=function(){return!1})};Array.prototype.indexOf||(Object.defineProperty(Array.prototype,"indexOf",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.indexOf=function(t){var i,e=this.length;for(i=0;e>i;i++)if(this[i]===t)return i;return-1}),requestAnimFrame=typeof window!="undefined"?function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(function(){t((new Date).getTime())},1e3/60)}}():function(){return function(t){setTimeout(function(){t((new Date).getTime())},1e3/60)}}(),typeof console=="object"?typeof console.log=="function"&&(console.info===void 0&&(console.info=console.log),console.warn===void 0&&(console.warn=console.log)):console={log:function(){},warn:function(){},info:function(){},error:function(){}},typeof JSON.decycle!="function"&&(JSON.decycle=function decycle(t){"use strict";var i=[],e=[];return function o(t,n){var s,r,a;switch(typeof t){case"object":if(!t)return null;for(s=0;i.length>s;s+=1)if(i[s]===t)return{$ref:e[s]};if(i.push(t),e.push(n),Object.prototype.toString.apply(t)==="[object Array]")for(a=[],s=0;t.length>s;s+=1)a[s]=o(t[s],n+"["+s+"]");else{a={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(a[r]=o(t[r],n+"["+JSON.stringify(r)+"]"))}return a;case"number":case"string":case"boolean":return t}}(t,"$")}),typeof JSON.retrocycle!="function"&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return function rez(value){var i,item,name,path;if(value&&typeof value=="object")if(Object.prototype.toString.apply(value)==="[object Array]")for(i=0;value.length>i;i+=1)item=value[i],item&&typeof item=="object"&&(path=item.$ref,typeof path=="string"&&px.test(path)?value[i]=eval(path):rez(item));else for(name in value)typeof value[name]=="object"&&(item=value[name],item&&(path=item.$ref,typeof path=="string"&&px.test(path)?value[name]=eval(path):rez(item)))}($),$});var $i_2=function(){var t=!1,i=/xyz/.test(function(){})?/\b_super\b/:/.*/,e=function(){},o=function(t,i,e){var o,n="";if(i=i||"log",e!==void 0&&console.warn(e),(i==="warning"||i==="error")&&igeDebug.stacks&&(igeDebug.node?(o=Error().stack,console.log("Stack:",o)):typeof printStackTrace=="function"&&console.log("Stack:",printStackTrace().join("\n ---- "))),i==="error"){if(igeDebug.throwErrors)throw n+"IGE *"+i+"* ["+(this._classId||this.prototype._classId)+"] : "+t;console.log(n+"IGE *"+i+"* ["+(this._classId||this.prototype._classId)+"] : "+t)}else console.log(n+"IGE *"+i+"* ["+(this._classId||this.prototype._classId)+"] : "+t);return this},n=function(){return this._classId},s=function(t,i){var e=new t(this,i);return this[e.componentId]=e,this._components.push(e),this},r=function(t){return this[t]&&this[t].destroy&&this[t].destroy(),this._components&&this._components.pull(this[t]),delete this[t],this},a=function(t,i){var e,o=t.prototype||t;for(e in o)o.hasOwnProperty(e)&&(i||this[e]===void 0)&&(this[e]=o[e]);return this},l=function(t,i){return t!==void 0?i!==void 0?(this._data[t]=i,this):this._data[t]:void 0};return e.extend=function(){function e(){this._data={},!t&&this.init&&(this._components=[],typeof ige!="undefined"&&(this.ige=ige),this.init.apply(this,arguments))}var h,m,c,_,u,p,y,d=this.prototype,x=arguments[arguments.length-1],f=arguments[0];if(!x.classId)throw console.log(x),"Cannot create a new class without giving the class a classId property!";if(igeClassStore[x.classId])throw'Cannot create class with classId "'+x.classId+'" because a class with that ID has already been created!';t=!0,m=new this,t=!1;for(h in x)typeof x[h]=="function"&&typeof d[h]=="function"&&i.test(x[h])?(m["__"+h]=x[h],m[h]=function(t,i){return function(){var e,o=this._super;return this._super=d[t],e=i["__"+t].apply(this,arguments),this._super=o,e}}(h,m)):m[h]=x[h];if(arguments.length>1&&f&&f.length)for(u=0;f.length>u;u++){c=f[u],y=c.extension.prototype||c.extension,_=c.overwrite;for(p in y)y.hasOwnProperty(p)&&(_||m[p]===void 0)&&(m[p]=y[p])}return e.prototype=m,e.prototype.constructor=e,e.extend=arguments.callee,e.prototype.log=o,e.prototype.data=l,e.prototype.classId=n,e.prototype._classId=x.classId||"$i_2",e.prototype.addComponent=s,e.prototype.removeComponent=r,e.prototype.implement=a,igeClassStore[x.classId]=e,e},e}();typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_2);var $i_3=$i_2.extend({classId:"$i_3",on:function(t,i,e,o,n){var s,r,a,l,h,m,c,_,u,p=this;if(this._eventListeners=this._eventListeners||{},typeof i=="function"){if(typeof t=="string")return s={call:i,context:e,oneShot:o,sendEventName:n},l=this._eventListeners[t]=this._eventListeners[t]||[],r=!0,a=l.indexOf(s),a>-1&&(r=!1),r&&l.push(s),s;if(t.length){h=[],h[0]=0,h[1]=0,h[3]=function(){h[1]++,h[0]===h[1]&&i.apply(e||p)};for(m in t)t.hasOwnProperty(m)&&(c=t[m],_=c[0],u=c[1],h[0]++,_.on(u,h[3],null,!0,!0))}}else typeof t!="string"&&(t="*Multi-Event*"),this.log('Cannot register event listener for event "'+t+'" because the passed callback is not a function!',"error")},emit:function(t,i){if(this._eventListeners&&this._eventListeners[t]){var e,o,n,s,r,a,l=this._eventListeners[t].length,h=this._eventListeners[t].length-1;if(l){if(e=[],typeof i=="object"&&i!==null&&i[0]!==null&&i[0]!==void 0)for(o in i)i.hasOwnProperty(o)&&(e[o]=i[o]);else e=[i];n=!1,this._eventListeners._processing=!0;while(l--)s=h-l,r=this._eventListeners[t][s],r.sendEventName&&(e=[t]),a=r.call.apply(r.context||this,e),a===!0&&(n=!0),r.oneShot&&(this.off(t,r),h--);if(this._eventListeners._processing=!1,this._processRemovals(),n)return 1}}},_processRemovals:function(){if(this._eventListeners){var t,i,e,o=this._eventListeners._removeQueue;if(o){t=o.length;while(t--)i=o[t],e=this.off(i[0],i[1]),o[2]&&o[2](e)}delete this._eventListeners._removeQueue}},off:function(t,i,e){if(this._eventListeners){if(this._eventListeners._processing)return this._eventListeners._removeQueue=this._eventListeners._removeQueue||[],this._eventListeners._removeQueue.push([t,i,e]),-1;if(this._eventListeners[t]){var o=this._eventListeners[t].indexOf(i);if(o>-1)return this._eventListeners[t].splice(o,1),e&&e(!0),!0;this.log('Failed to cancel event listener for event named "'+t+'" !',"warning",i)}else this.log("Failed to cancel event listener!")}return e&&e(!1),!1},eventList:function(){return this._eventListeners}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_3);var $i_5=function(t,i,e,o){return o===void 0?this._floor=!0:this.floor(o),this.x=t=t!==void 0?t:0,this.y=i=i!==void 0?i:0,this.z=e=e!==void 0?e:0,this._floor?(this.x2=Math.floor(t/2),this.y2=Math.floor(i/2),this.z2=Math.floor(e/2)):(this.x2=t/2,this.y2=i/2,this.z2=e/2),this};$i_5.prototype.floor=function(t){return t!==void 0?(this._floor=t,this):this._floor},$i_5.prototype.compare=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},$i_5.prototype.toIso=function(){var t=this.x-this.y,i=-this.z*1.2247+(this.x+this.y)*.5;return{x:t,y:i}},$i_5.prototype.thisToIso=function(){var t=this.toIso();return this.x=t.x,this.y=t.y,this.z=0,this},$i_5.prototype.to2d=function(){var t=this.y+this.x/2,i=this.y-this.x/2;return{x:t,y:i}},$i_5.prototype.thisTo2d=function(){var t=this.to2d();return this.x=t.x,this.y=t.y,this.z=0,this},$i_5.prototype.addPoint=function(t){return new $i_5(this.x+t.x,this.y+t.y,this.z+t.z)},$i_5.prototype.thisAddPoint=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},$i_5.prototype.minusPoint=function(t){return new $i_5(this.x-t.x,this.y-t.y,this.z-t.z)},$i_5.prototype.thisMinusPoint=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},$i_5.prototype.multiply=function(t,i,e){return new $i_5(this.x*t,this.y*i,this.z*e)},$i_5.prototype.thisMultiply=function(t,i,e){return this.x*=t,this.y*=i,this.z*=e,this},$i_5.prototype.divide=function(t,i,e){return new $i_5(this.x/t,this.y/i,this.z/e)},$i_5.prototype.thisDivide=function(t,i,e){return this.x/=t,this.y/=i,this.z/=e,this},$i_5.prototype.clone=function(){return new $i_5(this.x,this.y,this.z)},$i_5.prototype.interpolate=function(t,i,e,o){var n=t.x-this.x,s=t.y-this.y,r=t.z-this.z,a=o-i,l=a-(e-i),h=l/a;return new $i_5(t.x-n*h,t.y-s*h,t.z-r*h)},$i_5.prototype.toString=function(t){return t===void 0&&(t=2),this.x.toFixed(t)+","+this.y.toFixed(t)+","+this.z.toFixed(t)},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_5);var $i_6=$i_2.extend({classId:"$i_6",init:function(){this._poly=[],this._scale=new $i_5(1,1,1)},scale:function(t,i){return t!==void 0&&i!==void 0?(this._scale.x=t,this._scale.y=i,this):this._scale},addPoint:function(t,i){return this._poly.push(new $i_5(t,i,0)),this},length:function(){return this._poly.length},pointInPoly:function(t){var i,e=this._poly,o=e.length,n=o-1,s=0;for(i=0;o>i;n=i++)e[i].y>t.y!=e[n].y>t.y&&(e[n].x-e[i].x)*(t.y-e[i].y)/(e[n].y-e[i].y)+e[i].x>t.x&&(s=!s);return s},render:function(t){var e=this._poly,o=e.length,n=this._scale.x,s=this._scale.y;for(t.beginPath(),t.moveTo(e[0].x*n,e[0].y*s),i=1;o>i;i++)t.lineTo(e[i].x*n,e[i].y*s);return t.lineTo(e[0].x*n,e[0].y*s),t.stroke(),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_6);var $i_7=function(t,i,e,o){return this.x=t=t!==void 0?t:0,this.y=i=i!==void 0?i:0,this.width=e=e!==void 0?e:0,this.height=o=o!==void 0?o:0,this};$i_7.prototype.compare=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},$i_7.prototype.xyInside=function(t,i){return t>=this.x&&i>this.y&&this.x+this.width>=t&&this.y+this.height>=i},$i_7.prototype.pointInside=function(t){return x>=this.x&&t.y>this.y&&this.x+this.width>=t.x&&this.y+this.height>=t.y},$i_7.prototype.rectIntersect=function(t){if(t){var i=this.x,e=this.y,o=this.width,n=this.height,s=t.x,r=t.y,a=t.width,l=t.height,h=i+o,m=e+n,c=s+a,_=r+l;if(c>i&&h>s&&_>e&&m>r)return!0}return!1},$i_7.prototype.toString=function(t){return t===void 0&&(t=2),this.x.toFixed(t)+","+this.y.toFixed(t)+","+this.width.toFixed(t)+","+this.height.toFixed(t)},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_7);var $i_8=function(){this.matrix=[1,0,0,0,1,0,0,0,1],this._rotateOrigin=new $i_5(0,0,0),this._scaleOrigin=new $i_5(0,0,0)};$i_8.prototype={matrix:null,transformCoord:function(t){var i=t.x,e=t.y,o=this.matrix;return t.x=i*o[0]+e*o[1]+o[2],t.y=i*o[3]+e*o[4]+o[5],t},transformCoordInverse:function(t){var i=t.x,e=t.y,o=this.matrix;return t.x=i*o[0]+e*o[1]-o[2],t.y=i*o[3]+e*o[4]-o[5],t},transform:function(t){var i,e=t.length;for(i=0;e>i;i++)this.transformCoord(t[i]);return t},_newRotate:function(t){var i=new $i_8;return i.rotateTo(t),i},rotateBy:function(t){var i=new $i_8;return i.translateBy(this._rotateOrigin.x,this._rotateOrigin.y),i.rotateTo(t),i.translateBy(-this._rotateOrigin.x,-this._rotateOrigin.y),this.multiply(i),this},rotateTo:function(t){var i=this.matrix,e=Math.cos(t),o=Math.sin(t);return i[0]=e,i[1]=-o,i[3]=o,i[4]=e,this},_newScale:function(t,i){var e=new $i_8;return e.matrix[0]=t,e.matrix[4]=i,e},scaleBy:function(t,i){var e=new $i_8;return e.matrix[0]=t,e.matrix[4]=i,this.multiply(e),this},scaleTo:function(t,i){return this.matrix[0]=t,this.matrix[4]=i,this},_newTranslate:function(t,i){var e=new $i_8;return e.matrix[2]=t,e.matrix[5]=i,e},translateBy:function(t,i){var e=new $i_8;return e.matrix[2]=t,e.matrix[5]=i,this.multiply(e),this},translateTo:function(t,i){return this.matrix[2]=t,this.matrix[5]=i,this},copy:function(t){t=t.matrix;var i=this.matrix;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],this},identity:function(){var t=this.matrix;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},multiply:function(t){var i=this.matrix,e=t.matrix,o=i[0],n=i[1],s=i[2],r=i[3],a=i[4],l=i[5],h=i[6],m=i[7],c=i[8],_=e[0],u=e[1],p=e[2],y=e[3],d=e[4],x=e[5],f=e[6],g=e[7],v=e[8];return i[0]=o*_+n*y+s*f,i[1]=o*u+n*d+s*g,i[2]=o*p+n*x+s*v,i[3]=r*_+a*y+l*f,i[4]=r*u+a*d+l*g,i[5]=r*p+a*x+l*v,i[6]=h*_+m*y+c*f,i[7]=h*u+m*d+c*g,i[8]=h*p+m*x+c*v,this},premultiply:function(t){var i=t.matrix[0]*this.matrix[0]+t.matrix[1]*this.matrix[3]+t.matrix[2]*this.matrix[6],e=t.matrix[0]*this.matrix[1]+t.matrix[1]*this.matrix[4]+t.matrix[2]*this.matrix[7],o=t.matrix[0]*this.matrix[2]+t.matrix[1]*this.matrix[5]+t.matrix[2]*this.matrix[8],n=t.matrix[3]*this.matrix[0]+t.matrix[4]*this.matrix[3]+t.matrix[5]*this.matrix[6],s=t.matrix[3]*this.matrix[1]+t.matrix[4]*this.matrix[4]+t.matrix[5]*this.matrix[7],r=t.matrix[3]*this.matrix[2]+t.matrix[4]*this.matrix[5]+t.matrix[5]*this.matrix[8],a=t.matrix[6]*this.matrix[0]+t.matrix[7]*this.matrix[3]+t.matrix[8]*this.matrix[6],l=t.matrix[6]*this.matrix[1]+t.matrix[7]*this.matrix[4]+t.matrix[8]*this.matrix[7],h=t.matrix[6]*this.matrix[2]+t.matrix[7]*this.matrix[5]+t.matrix[8]*this.matrix[8];return this.matrix[0]=i,this.matrix[1]=e,this.matrix[2]=o,this.matrix[3]=n,this.matrix[4]=s,this.matrix[5]=r,this.matrix[6]=a,this.matrix[7]=l,this.matrix[8]=h,this},getInverse:function(){var t=this.matrix,i=t[0],e=t[1],o=t[2],n=t[3],s=t[4],r=t[5],a=t[6],l=t[7],h=t[8],m=new $i_8,c=i*(s*h-l*r)-n*(e*h-l*o)+a*(e*r-s*o);if(c===0)return null;var _=m.matrix;return _[0]=s*h-r*l,_[1]=o*l-e*h,_[2]=e*r-o*s,_[3]=r*a-n*h,_[4]=i*h-o*a,_[5]=o*n-i*r,_[6]=n*l-s*a,_[7]=e*a-i*l,_[8]=i*s-e*n,m.multiplyScalar(1/c),m},multiplyScalar:function(t){var i;for(i=0;9>i;i++)this.matrix[i]*=t;return this},transformRenderingContextSet:function(t){var i=this.matrix;return t.setTransform(i[0],i[3],i[1],i[4],i[2],i[5]),this},transformRenderingContext:function(t){var i=this.matrix;return t.transform(i[0],i[3],i[1],i[4],i[2],i[5]),this}},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_8);var $i_10=$i_3.extend({classId:"$i_10",componentId:"animation",init:function(t){this._entity=t,this._anims={},t.addBehaviour("tween",this._behaviour)},_behaviour:function(t){this.animation.tick(t)},define:function(t,i,e,o,n){if(i&&i.length){var s,r;if(this._anims.length=this._anims.length||0,n===void 0&&(n=!0),n)for(s=0;i.length>s;s++)if(r=i[s],typeof r=="string"){if(!this._entity._texture){this.log("You can increase the performance of id-based cell animations by specifying the animation.define AFTER you have assigned your sprite sheet to the entity on entity with ID: "+this._entity.id(),"warning");break}r=this._entity._texture.cellIdToIndex(r)}var a=1e3/e|0;this._anims[t]={frames:i,frameTime:a,loop:o!==void 0?o:-1,frameCount:i.length,totalTime:i.length*a,currentDelta:0,currentLoop:0},this._anims.length++}else this.log("Cannot define an animation without a frame array!","error");return this._entity},start:function(t){if(this._anims){var i=this._anims[t];i?(i.currentDelta=0,i.currentLoop=0,i.startTime=(new Date).getTime(),this._anim=i,this._animId=t,this.emit("started",i)):this.log('Cannot set animation to "'+t+'" because the animation does not exist!',"warning")}else this.log('Cannot set animation to "'+t+'" because no animations have been defined with defineAnim(...);',"warning");return this._entity},select:function(t){return this._animId!==t&&this.start(t),this._entity},stop:function(){return this.emit("stopped",this._anim),delete this._anim,delete this._animId,this._entity},tick:function(){if(this._anim){var t,i,e,o=ige.tickDelta,n=this._anim;n.currentDelta+=o,n.currentDelta>n.totalTime&&(n.loop?n.loop===-1?(t=n.currentDelta/n.totalTime,Math.abs(t)>1&&(n.currentDelta-=(t|0)*n.totalTime),this.emit("loopComplete",n)):(n.currentLoop++,n.loop>0&&n.loop>=n.currentLoop?(t=n.currentDelta/n.totalTime,Math.abs(t)>1&&(n.currentDelta-=(t|0)*n.totalTime),this.emit("loopComplete",n)):(this.emit("complete",n),this.stop())):(this.emit("complete",n),this.stop())),e=n.currentDelta/n.frameTime|0,n.frameCount>e||(e=n.frameCount-1),i=n.frames[e],typeof i=="string"?this._entity.cellById(i):this._entity.cell(i)}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_10);var $i_11=$i_2.extend({classId:"$i_11",componentId:"velocity",init:function(t){this._entity=t,this._velocity=new $i_5(0,0,0),this._friction=new $i_5(1,1,1),t.addBehaviour("velocity",this._behaviour)},_behaviour:function(t){this.velocity.tick(t)},byAngleAndPower:function(t,i,e){var o=this._velocity,n=Math.cos(t)*i,s=Math.sin(t)*i,r=0;return e?(o.x+=n,o.y+=s,o.z+=r):(o.x=n,o.y=s,o.z=r),this._entity},xyz:function(t,i,e,o){var n=this._velocity;return o?(n.x+=t,n.y+=i,n.z+=e):(n.x=t,n.y=i,n.z=e),this._entity},x:function(t,i){var e=this._velocity;return i?e.x+=t:e.x=t,this._entity},y:function(t,i){var e=this._velocity;return i?e.y+=t:e.y=t,this._entity},z:function(t,i){var e=this._velocity;return i?e.z+=t:e.z=y,this._entity},vector3:function(t,i){typeof t.scale!="number"&&(t.scale=1);var e=this._velocity,o=t.x,n=t.y,s=t.z;return i?(e.x+=o,e.y+=n,e.z+=s):(e.x=o,e.y=n,e.z=s),this._entity},friction:function(t){var i=1-t;return 0>i&&(i=0),this._friction=new $i_5(i,i,i),this._entity},linearForce:function(t,i){i/=1e3;var e=t*Math.PI/180,o=Math.cos(e)*i,n=Math.sin(e)*i,s=o*n;return this._linearForce=new $i_5(o,n,s),this._entity},linearForceXYZ:function(t,i,e){return this._linearForce=new $i_5(t,i,e),this._entity},linearForceVector3:function(t,i,e){var o=this._linearForce=this._linearForce||new $i_5(0,0,0),n=t.x/1e3,s=t.y/1e3,r=t.z/1e3;return e?(o.x+=n||0,o.y+=s||0,o.z+=r||0):(o.x=n||0,o.y=s||0,o.z=r||0),this._entity},_applyLinearForce:function(t){if(this._linearForce){var i=this._velocity;i.x+=this._linearForce.x*t,i.y+=this._linearForce.y*t,i.z+=this._linearForce.z*t}},_applyFriction:function(){var t=this._velocity,i=this._friction;t.x*=i.x,t.y*=i.y,t.z*=i.z},tick:function(){var t,i,e,o=ige.tickDelta,n=this._velocity;o&&(this._applyLinearForce(o),t=n.x*o,i=n.y*o,e=n.z*o,(t||i||e)&&this._entity.translateBy(t,i,e))}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_11);var $i_12=$i_2.extend({classId:"$i_12",componentId:"tween",init:function(t){this._entity=t,this._transform=t.transform,this._tweens=[],t.addBehaviour("tween",this._behaviour)},_behaviour:function(t){this.tween.tick(t)},start:function(t){var i,e=t._targetObj,o=t._propertyObj,n=[];if(e){t._startTime===void 0&&(t._startTime=(new Date).getTime()),t._durationMs===void 0&&(t._durationMs=0),t._endTime=t._startTime+t._durationMs;for(i in o)o.hasOwnProperty(i)&&n.push({targetObj:e,propName:i,startVal:e[i],endVal:o[i],deltaVal:o[i]-e[i]});return t._targetData=n,t._destTime=t._endTime-t._startTime,this._tweens.push(t),this.enable(),t}return this.log('Cannot start tweening properties of the specified object "'+obj+'" because it does not exist!',"error"),-1},stop:function(t){return this._tweens.pull(t),this._tweens.length||this.disable(),this},stopAll:function(){return this.disable(),delete this._tweens,this._tweens=[],this},enable:function(){return this._tweening||(this._tweening=!0),this},disable:function(){return this._tweening&&(this._tweening=!1),this},tick:function(){if(this._tweens&&this._tweens.length){var t,i,e,o,n,s,r,a=ige.tickStart,l=this._tweens,h=l.length;while(h--)if(t=l[h],t._started||a>=t._startTime)if(t._started||(typeof t._beforeTween=="function"&&(t._beforeTween(t),delete t._beforeTween),t._started=!0),i=a-t._startTime,e=t._destTime,o=t._easing,e>i){s=t._targetData;for(r in s)s.hasOwnProperty(r)&&(n=s[r],n.targetObj[n.propName]=this.easing[o](i,n.startVal,n.deltaVal,e))}else{s=t._targetData;for(r in s)s.hasOwnProperty(r)&&(n=s[r],n.targetObj[n.propName]=n.endVal);t.stop(),typeof t._afterTween=="function"&&(t._afterTween(t),delete t._afterTween)}}},easing:{none:function(t,i,e,o){return e*t/o+i},inQuad:function(t,i,e,o){return e*(t/=o)*t+i},outQuad:function(t,i,e,o){return-e*(t/=o)*(t-2)+i},inOutQuad:function(t,i,e,o){return 1>(t/=o/2)?e/2*t*t+i:-e/2*(--t*(t-2)-1)+i},inCubic:function(t,i,e,o){return e*(t/=o)*t*t+i},outCubic:function(t,i,e,o){return e*((t=t/o-1)*t*t+1)+i},inOutCubic:function(t,i,e,o){return 1>(t/=o/2)?e/2*t*t*t+i:e/2*((t-=2)*t*t+2)+i},outInCubic:function(t,i,e,o){return o/2>t?this.outCubic(t*2,i,e/2,o):this.inCubic(t*2-o,i+e/2,e/2,o)},inQuart:function(t,i,e,o){return e*(t/=o)*t*t*t+i},outQuart:function(t,i,e,o){return-e*((t=t/o-1)*t*t*t-1)+i},inOutQuart:function(t,i,e,o){return 1>(t/=o/2)?e/2*t*t*t*t+i:-e/2*((t-=2)*t*t*t-2)+i},outInQuart:function(t,i,e,o){return o/2>t?this.outQuart(t*2,i,e/2,o):this.inQuart(t*2-o,i+e/2,e/2,o)},inQuint:function(t,i,e,o){return e*(t/=o)*t*t*t*t+i},outQuint:function(t,i,e,o){return e*((t=t/o-1)*t*t*t*t+1)+i},inOutQuint:function(t,i,e,o){return 1>(t/=o/2)?e/2*t*t*t*t*t+i:e/2*((t-=2)*t*t*t*t+2)+i},outInQuint:function(t,i,e,o){return o/2>t?this.outQuint(t*2,i,e/2,o):this.inQuint(t*2-o,i+e/2,e/2,o)},inSine:function(t,i,e,o){return-e*Math.cos(t/o*(Math.PI/2))+e+i},outSine:function(t,i,e,o){return e*Math.sin(t/o*(Math.PI/2))+i},inOutSine:function(t,i,e,o){return-e/2*(Math.cos(Math.PI*t/o)-1)+i},outInSine:function(t,i,e,o){return o/2>t?this.outSine(t*2,i,e/2,o):this.inSine(t*2-o,i+e/2,e/2,o)},inExpo:function(t,i,e,o){return t===0?i:e*Math.pow(2,10*(t/o-1))+i-e*.001},outExpo:function(t,i,e,o){return t===o?i+e:e*1.001*(-Math.pow(2,-10*t/o)+1)+i},inOutExpo:function(t,i,e,o){return t===0?i:t===o?i+e:1>(t/=o/2)?e/2*Math.pow(2,10*(t-1))+i-e*5e-4:e/2*1.0005*(-Math.pow(2,-10*--t)+2)+i},outInExpo:function(t,i,e,o){return o/2>t?this.outExpo(t*2,i,e/2,o):this.inExpo(t*2-o,i+e/2,e/2,o)},inCirc:function(t,i,e,o){return-e*(Math.sqrt(1-(t/=o)*t)-1)+i},outCirc:function(t,i,e,o){return e*Math.sqrt(1-(t=t/o-1)*t)+i},inOutCirc:function(t,i,e,o){return 1>(t/=o/2)?-e/2*(Math.sqrt(1-t*t)-1)+i:e/2*(Math.sqrt(1-(t-=2)*t)+1)+i},outInCirc:function(t,i,e,o){return o/2>t?this.outCirc(t*2,i,e/2,o):this.inCirc(t*2-o,i+e/2,e/2,o)},inElastic:function(t,i,e,o,n,s){var r;return t===0?i:(t/=o)===1?i+e:(s||(s=o*.3),!n||Math.abs(e)>n?(n=e,r=s/4):r=s/(2*Math.PI)*Math.asin(e/n),-(n*Math.pow(2,10*(t-=1))*Math.sin((t*o-r)*2*Math.PI/s))+i)},outElastic:function(t,i,e,o,n,s){var r;return t===0?i:(t/=o)===1?i+e:(s||(s=o*.3),!n||Math.abs(e)>n?(n=e,r=s/4):r=s/(2*Math.PI)*Math.asin(e/n),n*Math.pow(2,-10*t)*Math.sin((t*o-r)*2*Math.PI/s)+e+i)},inOutElastic:function(t,i,e,o,n,s){var r;return t===0?i:(t/=o/2)===2?i+e:(s||(s=o*.3*1.5),!n||Math.abs(e)>n?(n=e,r=s/4):r=s/(2*Math.PI)*Math.asin(e/n),1>t?-.5*n*Math.pow(2,10*(t-=1))*Math.sin((t*o-r)*2*Math.PI/s)+i:n*Math.pow(2,-10*(t-=1))*Math.sin((t*o-r)*2*Math.PI/s)*.5+e+i)},outInElastic:function(t,i,e,o,n,s){return o/2>t?this.outElastic(t*2,i,e/2,o,n,s):this.inElastic(t*2-o,i+e/2,e/2,o,n,s)},inBack:function(t,i,e,o,n){return n===void 0&&(n=1.70158),e*(t/=o)*t*((n+1)*t-n)+i},outBack:function(t,i,e,o,n){return n===void 0&&(n=1.70158),e*((t=t/o-1)*t*((n+1)*t+n)+1)+i},inOutBack:function(t,i,e,o,n){return n===void 0&&(n=1.70158),1>(t/=o/2)?e/2*t*t*(((n*=1.525)+1)*t-n)+i:e/2*((t-=2)*t*(((n*=1.525)+1)*t+n)+2)+i},outInBack:function(t,i,e,o,n){return o/2>t?this.outBack(t*2,i,e/2,o,n):this.inBack(t*2-o,i+e/2,e/2,o,n)},inBounce:function(t,i,e,o){return e-this.outBounce(o-t,0,e,o)+i},outBounce:function(t,i,e,o){return 1/2.75>(t/=o)?e*7.5625*t*t+i:2/2.75>t?e*(7.5625*(t-=1.5/2.75)*t+.75)+i:2.5/2.75>t?e*(7.5625*(t-=2.25/2.75)*t+.9375)+i:e*(7.5625*(t-=2.625/2.75)*t+.984375)+i},inOutBounce:function(t,i,e,o){return o/2>t?this.inBounce(t*2,0,e,o)*.5+i:this.outBounce(t*2-o,0,e,o)*.5+e*.5+i},outInBounce:function(t,i,e,o){return o/2>t?this.outBounce(t*2,i,e/2,o):this.inBounce(t*2-o,i+e/2,e/2,o)}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_12);var $i_14=$i_3.extend({classId:"$i_14",componentId:"input",init:function(){this._eventQueue=[],this._eventControl={_cancelled:!1,stopPropagation:function(){this._cancelled=!0}},this.tick(),this.mouse={dblClick:-302,down:-301,up:-300,move:-259,wheel:-258,wheelUp:-257,wheelDown:-256,x:-255,y:-254,button1:-253,button2:-252,button3:-251},this.pad1={button1:-250,button2:-249,button3:-248,button4:-247,button5:-246,button6:-245,button7:-244,button8:-243,button9:-242,button10:-241,button11:-240,button12:-239,button13:-238,button14:-237,button15:-236,button16:-235,button17:-234,button18:-233,button19:-232,button20:-231,stick1:-230,stick2:-229,stick1Up:-228,stick1Down:-227,stick1Left:-226,stick1Right:-225,stick2Up:-224,stick2Down:-223,stick2Left:-222,stick2Right:-221},this.pad2={button1:-220,button2:-219,button3:-218,button4:-217,button5:-216,button6:-215,button7:-214,button8:-213,button9:-212,button10:-211,button11:-210,button12:-209,button13:-208,button14:-207,button15:-206,button16:-205,button17:-204,button18:-203,button19:-202,button20:-201,stick1:-200,stick2:-199,stick1Up:-198,stick1Down:-197,stick1Left:-196,stick1Right:-195,stick2Up:-194,stick2Down:-193,stick2Left:-192,stick2Right:-191},this.key={shift:-3,ctrl:-2,alt:-1,backspace:8,tab:9,enter:13,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90},this._controlMap=[],this._state=[],this._state[this.mouse.x]=0,this._state[this.mouse.y]=0
},debug:function(t){return t!==void 0?(this._debug=t,this):this._debug},_rationalise:function(t,i){if(t.igeType==="key"&&t.keyCode===8){var e=t.srcElement||t.target;e.tagName.toLowerCase()==="body"&&t.preventDefault()}t.igeType==="touch"&&t.preventDefault(),i?(t.button=0,t.changedTouches&&t.changedTouches.length&&(t.igePageX=t.changedTouches[0].pageX,t.igePageY=t.changedTouches[0].pageY)):(t.igePageX=t.pageX,t.igePageY=t.pageY),t.igeX=t.igePageX-this._canvas.offsetLeft,t.igeY=t.igePageY-this._canvas.offsetTop},setupListeners:function(t){this.log("Setting up input event listeners..."),this._canvas=t;var i=this;this._evRef={mousedown:function(t){t.igeType="mouse",i._rationalise(t),i._mouseDown(t)},mouseup:function(t){t.igeType="mouse",i._rationalise(t),i._mouseUp(t)},mousemove:function(t){t.igeType="mouse",i._rationalise(t),i._mouseMove(t)},mousewheel:function(t){t.igeType="mouse",i._rationalise(t),i._mouseWheel(t)},touchmove:function(t){t.igeType="touch",i._rationalise(t,!0),i._mouseMove(t)},touchstart:function(t){t.igeType="touch",i._rationalise(t,!0),i._mouseDown(t)},touchend:function(t){t.igeType="touch",i._rationalise(t,!0),i._mouseUp(t)},contextmenu:function(t){t.preventDefault()},keydown:function(t){t.igeType="key",i._rationalise(t),i._keyDown(t)},keyup:function(t){t.igeType="key",i._rationalise(t),i._keyUp(t)}},t.addEventListener("mousedown",this._evRef.mousedown,!1),t.addEventListener("mouseup",this._evRef.mouseup,!1),t.addEventListener("mousemove",this._evRef.mousemove,!1),t.addEventListener("mousewheel",this._evRef.mousewheel,!1),t.addEventListener("touchmove",this._evRef.touchmove,!1),t.addEventListener("touchstart",this._evRef.touchstart,!1),t.addEventListener("touchend",this._evRef.touchend,!1),t.addEventListener("contextmenu",this._evRef.contextmenu,!1),window.addEventListener("keydown",this._evRef.keydown,!1),window.addEventListener("keyup",this._evRef.keyup,!1)},destroyListeners:function(){this.log("Removing input event listeners...");var t=this._canvas;t.removeEventListener("mousedown",this._evRef.mousedown,!1),t.removeEventListener("mouseup",this._evRef.mouseup,!1),t.removeEventListener("mousemove",this._evRef.mousemove,!1),t.removeEventListener("mousewheel",this._evRef.mousewheel,!1),t.removeEventListener("touchmove",this._evRef.touchmove,!1),t.removeEventListener("touchstart",this._evRef.touchstart,!1),t.removeEventListener("touchend",this._evRef.touchend,!1),t.removeEventListener("contextmenu",this._evRef.contextmenu,!1),window.removeEventListener("keydown",this._evRef.keydown,!1),window.removeEventListener("keyup",this._evRef.keyup,!1)},_mouseDown:function(t){this._debug&&console.log("Mouse Down",t),this._updateMouseData(t);var i=t.igeX-ige.geometry.x2,e=t.igeY-ige.geometry.y2,o=this;t.igeBaseX=i,t.igeBaseY=e,t.button===0&&(this._state[this.mouse.button1]=!0),t.button===1&&(this._state[this.mouse.button2]=!0),t.button===2&&(this._state[this.mouse.button3]=!0),this.mouseDown=t,this.queueEvent(this,function(){o.emit("mouseDown",[t,i,e,t.button+1])})},_mouseUp:function(t){this._debug&&console.log("Mouse Up",t),this._updateMouseData(t);var i=t.igeX-ige.geometry.x2,e=t.igeY-ige.geometry.y2,o=this;t.igeBaseX=i,t.igeBaseY=e,t.button===0&&(this._state[this.mouse.button1]=!1),t.button===1&&(this._state[this.mouse.button2]=!1),t.button===2&&(this._state[this.mouse.button3]=!1),this.mouseUp=t,this.queueEvent(this,function(){o.emit("mouseUp",[t,i,e,t.button+1])})},_mouseMove:function(t){ige._mouseOverVp=this._updateMouseData(t);var i=t.igeX-ige.geometry.x2,e=t.igeY-ige.geometry.y2,o=this;t.igeBaseX=i,t.igeBaseY=e,this._state[this.mouse.x]=i,this._state[this.mouse.y]=e,this.mouseMove=t,this.queueEvent(this,function(){o.emit("mouseMove",[t,i,e,t.button+1])})},_mouseWheel:function(t){this._updateMouseData(t);var i=t.igeX-ige.geometry.x2,e=t.igeY-ige.geometry.y2,o=this;t.igeBaseX=i,t.igeBaseY=e,this._state[this.mouse.wheel]=t.wheelDelta,t.wheelDelta>0?this._state[this.mouse.wheelUp]=!0:this._state[this.mouse.wheelDown]=!0,this.mouseWheel=t,this.queueEvent(this,function(){o.emit("mouseWheel",[t,i,e,t.button+1])})},_keyDown:function(t){var i=this;this._state[t.keyCode]=!0,this.queueEvent(this,function(){i.emit("keyDown",[t,t.keyCode])})},_keyUp:function(t){var i=this;this._state[t.keyCode]=!1,this.queueEvent(this,function(){i.emit("keyUp",[t,t.keyCode])})},_updateMouseData:function(t){var i,e,o=ige._children,n=o.length,s=t.igeX-ige.geometry.x/2,r=t.igeY-ige.geometry.y/2;ige._mousePos.x=s,ige._mousePos.y=r;while(n--)if(i=o[o.length-(n+1)],s>i._translate.x-i.geometry.x/2&&i._translate.x+i.geometry.x/2>s&&r>i._translate.y-i.geometry.y/2&&i._translate.y+i.geometry.y/2>r){i._mousePos=new $i_5(Math.floor((s-i._translate.x)/i.camera._scale.x+i.camera._translate.x),Math.floor((r-i._translate.y)/i.camera._scale.y+i.camera._translate.y),0),e=i;break}return e},mapAction:function(t,i){this._controlMap[t]=i},actionVal:function(t){return this._state[this._controlMap[t]]},actionState:function(t){var i=this._state[this._controlMap[t]];return!!i},val:function(t){return this._state[t]},state:function(t){return!!this._state[t]},stopPropagation:function(){return this._eventControl._cancelled=!0,this},queueEvent:function(t,i){return i!==void 0&&this._eventQueue.push([t,i]),this},tick:function(){var t=this._eventQueue,i=t.length,e=this._eventControl;while(i--)if(t[i][1].apply(t[i][0],[e]),e._cancelled)break;this._eventQueue=[],this._eventControl._cancelled=!1,this.dblClick=!1,this.mouseMove=!1,this.mouseDown=!1,this.mouseUp=!1,this.mouseWheel=!1},emit:function(t,i){if(this._eventListeners&&this._eventListeners[t]){var e,o,n,s,r,a,l=this._eventListeners[t].length,h=this._eventListeners[t].length-1,m=this._eventControl;if(l){if(e=[],typeof i=="object"&&i!==null&&i[0]!==null)for(o in i)i.hasOwnProperty(o)&&(e[o]=i[o]);else e=[i];n=!1,this._eventListeners._processing=!0;while(l--){if(m._cancelled)break;s=h-l,r=this._eventListeners[t][s],r.sendEventName&&(e=[t]),a=r.call.apply(r.context||this,e),(a===!0||this._eventControl._cancelled===!0)&&(n=!0),r.oneShot&&this.off(t,r)}if(this._eventListeners._processing=!1,this._processRemovals(),n)return 1}}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_14);var $i_19={};(function(t,i){function e(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(t,i,e){e.get instanceof Function&&t.__defineGetter__(i,e.get),e.set instanceof Function&&t.__defineSetter__(i,e.set)}),t.inherit=function(t,i){var o=t;e.prototype=i.prototype,t.prototype=new e,t.prototype.constructor=o},t.generateCallback=function(t,i){return function(){i.apply(t,arguments)}},t.NVector=function(t){t===i&&(t=0);for(var e=Array(t||0),o=0;t>o;++o)e[o]=0;return e},t.is=function(t,e){return t===null?!1:e instanceof Function&&t instanceof e?!0:t.constructor.__implements!=i&&t.constructor.__implements[e]?!0:!1},t.parseUInt=function(t){return Math.abs(parseInt(t))}})($i_19);var Vector=Array,Vector_a2j_Number=$i_19.NVector;$i_19===void 0&&($i_19={}),$i_19.Collision===void 0&&($i_19.Collision={}),$i_19.Collision.Shapes===void 0&&($i_19.Collision.Shapes={}),$i_19.Common===void 0&&($i_19.Common={}),$i_19.Common.Math===void 0&&($i_19.Common.Math={}),$i_19.Dynamics===void 0&&($i_19.Dynamics={}),$i_19.Dynamics.Contacts===void 0&&($i_19.Dynamics.Contacts={}),$i_19.Dynamics.Controllers===void 0&&($i_19.Dynamics.Controllers={}),$i_19.Dynamics.Joints===void 0&&($i_19.Dynamics.Joints={}),function(){function t(){t.b2AABB.apply(this,arguments)}function i(){i.b2Bound.apply(this,arguments)}function e(){e.b2BoundValues.apply(this,arguments),this.constructor===e&&this.b2BoundValues.apply(this,arguments)}function o(){o.b2Collision.apply(this,arguments)}function n(){n.b2ContactID.apply(this,arguments),this.constructor===n&&this.b2ContactID.apply(this,arguments)}function s(){s.b2ContactPoint.apply(this,arguments)}function r(){r.b2Distance.apply(this,arguments)}function a(){a.b2DistanceInput.apply(this,arguments)}function l(){l.b2DistanceOutput.apply(this,arguments)}function h(){h.b2DistanceProxy.apply(this,arguments)}function m(){m.b2DynamicTree.apply(this,arguments),this.constructor===m&&this.b2DynamicTree.apply(this,arguments)}function c(){c.b2DynamicTreeBroadPhase.apply(this,arguments)}function _(){_.b2DynamicTreeNode.apply(this,arguments)}function u(){u.b2DynamicTreePair.apply(this,arguments)}function p(){p.b2Manifold.apply(this,arguments),this.constructor===p&&this.b2Manifold.apply(this,arguments)}function y(){y.b2ManifoldPoint.apply(this,arguments),this.constructor===y&&this.b2ManifoldPoint.apply(this,arguments)}function d(){d.b2Point.apply(this,arguments)}function x(){x.b2RayCastInput.apply(this,arguments),this.constructor===x&&this.b2RayCastInput.apply(this,arguments)}function f(){f.b2RayCastOutput.apply(this,arguments)}function g(){g.b2Segment.apply(this,arguments)}function v(){v.b2SeparationFunction.apply(this,arguments)}function b(){b.b2Simplex.apply(this,arguments),this.constructor===b&&this.b2Simplex.apply(this,arguments)}function w(){w.b2SimplexCache.apply(this,arguments)}function D(){D.b2SimplexVertex.apply(this,arguments)}function C(){C.b2TimeOfImpact.apply(this,arguments)}function B(){B.b2TOIInput.apply(this,arguments)}function S(){S.b2WorldManifold.apply(this,arguments),this.constructor===S&&this.b2WorldManifold.apply(this,arguments)}function A(){A.ClipVertex.apply(this,arguments)}function M(){M.Features.apply(this,arguments)}function I(){I.b2CircleShape.apply(this,arguments),this.constructor===I&&this.b2CircleShape.apply(this,arguments)}function V(){V.b2EdgeChainDef.apply(this,arguments),this.constructor===V&&this.b2EdgeChainDef.apply(this,arguments)}function T(){T.b2EdgeShape.apply(this,arguments),this.constructor===T&&this.b2EdgeShape.apply(this,arguments)}function P(){P.b2MassData.apply(this,arguments)}function L(){L.b2PolygonShape.apply(this,arguments),this.constructor===L&&this.b2PolygonShape.apply(this,arguments)}function k(){k.b2Shape.apply(this,arguments),this.constructor===k&&this.b2Shape.apply(this,arguments)}function R(){R.b2Color.apply(this,arguments),this.constructor===R&&this.b2Color.apply(this,arguments)}function G(){G.b2Settings.apply(this,arguments)}function F(){F.b2Mat22.apply(this,arguments),this.constructor===F&&this.b2Mat22.apply(this,arguments)}function J(){J.b2Mat33.apply(this,arguments),this.constructor===J&&this.b2Mat33.apply(this,arguments)}function z(){z.b2Math.apply(this,arguments)}function E(){E.b2Sweep.apply(this,arguments)}function O(){O.b2Transform.apply(this,arguments),this.constructor===O&&this.b2Transform.apply(this,arguments)}function N(){N.b2Vec2.apply(this,arguments),this.constructor===N&&this.b2Vec2.apply(this,arguments)}function j(){j.b2Vec3.apply(this,arguments),this.constructor===j&&this.b2Vec3.apply(this,arguments)}function U(){U.b2Body.apply(this,arguments),this.constructor===U&&this.b2Body.apply(this,arguments)}function W(){W.b2BodyDef.apply(this,arguments),this.constructor===W&&this.b2BodyDef.apply(this,arguments)}function q(){q.b2ContactFilter.apply(this,arguments)}function X(){X.b2ContactImpulse.apply(this,arguments)}function K(){K.b2ContactListener.apply(this,arguments)}function Y(){Y.b2ContactManager.apply(this,arguments),this.constructor===Y&&this.b2ContactManager.apply(this,arguments)}function H(){H.b2DebugDraw.apply(this,arguments),this.constructor===H&&this.b2DebugDraw.apply(this,arguments)}function Z(){Z.b2DestructionListener.apply(this,arguments)}function Q(){Q.b2FilterData.apply(this,arguments)}function $(){$.b2Fixture.apply(this,arguments),this.constructor===$&&this.b2Fixture.apply(this,arguments)}function ti(){ti.b2FixtureDef.apply(this,arguments),this.constructor===ti&&this.b2FixtureDef.apply(this,arguments)}function ii(){ii.b2Island.apply(this,arguments),this.constructor===ii&&this.b2Island.apply(this,arguments)}function ei(){ei.b2TimeStep.apply(this,arguments)}function oi(){oi.b2World.apply(this,arguments),this.constructor===oi&&this.b2World.apply(this,arguments)}function ni(){ni.b2CircleContact.apply(this,arguments)}function si(){si.b2Contact.apply(this,arguments),this.constructor===si&&this.b2Contact.apply(this,arguments)}function ri(){ri.b2ContactConstraint.apply(this,arguments),this.constructor===ri&&this.b2ContactConstraint.apply(this,arguments)}function ai(){ai.b2ContactConstraintPoint.apply(this,arguments)}function li(){li.b2ContactEdge.apply(this,arguments)}function hi(){hi.b2ContactFactory.apply(this,arguments),this.constructor===hi&&this.b2ContactFactory.apply(this,arguments)}function mi(){mi.b2ContactRegister.apply(this,arguments)}function ci(){ci.b2ContactResult.apply(this,arguments)}function _i(){_i.b2ContactSolver.apply(this,arguments),this.constructor===_i&&this.b2ContactSolver.apply(this,arguments)}function ui(){ui.b2EdgeAndCircleContact.apply(this,arguments)}function pi(){pi.b2NullContact.apply(this,arguments),this.constructor===pi&&this.b2NullContact.apply(this,arguments)}function yi(){yi.b2PolyAndCircleContact.apply(this,arguments)}function di(){di.b2PolyAndEdgeContact.apply(this,arguments)}function xi(){xi.b2PolygonContact.apply(this,arguments)}function fi(){fi.b2PositionSolverManifold.apply(this,arguments),this.constructor===fi&&this.b2PositionSolverManifold.apply(this,arguments)}function gi(){gi.b2BuoyancyController.apply(this,arguments)}function vi(){vi.b2ConstantAccelController.apply(this,arguments)}function bi(){bi.b2ConstantForceController.apply(this,arguments)}function wi(){wi.b2Controller.apply(this,arguments)}function Di(){Di.b2ControllerEdge.apply(this,arguments)}function Ci(){Ci.b2GravityController.apply(this,arguments)}function Bi(){Bi.b2TensorDampingController.apply(this,arguments)}function Si(){Si.b2DistanceJoint.apply(this,arguments),this.constructor===Si&&this.b2DistanceJoint.apply(this,arguments)}function Ai(){Ai.b2DistanceJointDef.apply(this,arguments),this.constructor===Ai&&this.b2DistanceJointDef.apply(this,arguments)}function Mi(){Mi.b2FrictionJoint.apply(this,arguments),this.constructor===Mi&&this.b2FrictionJoint.apply(this,arguments)}function Ii(){Ii.b2FrictionJointDef.apply(this,arguments),this.constructor===Ii&&this.b2FrictionJointDef.apply(this,arguments)}function Vi(){Vi.b2GearJoint.apply(this,arguments),this.constructor===Vi&&this.b2GearJoint.apply(this,arguments)}function Ti(){Ti.b2GearJointDef.apply(this,arguments),this.constructor===Ti&&this.b2GearJointDef.apply(this,arguments)}function Pi(){Pi.b2Jacobian.apply(this,arguments)}function Li(){Li.b2Joint.apply(this,arguments),this.constructor===Li&&this.b2Joint.apply(this,arguments)}function ki(){ki.b2JointDef.apply(this,arguments),this.constructor===ki&&this.b2JointDef.apply(this,arguments)}function Ri(){Ri.b2JointEdge.apply(this,arguments)}function Gi(){Gi.b2LineJoint.apply(this,arguments),this.constructor===Gi&&this.b2LineJoint.apply(this,arguments)}function Fi(){Fi.b2LineJointDef.apply(this,arguments),this.constructor===Fi&&this.b2LineJointDef.apply(this,arguments)}function Ji(){Ji.b2MouseJoint.apply(this,arguments),this.constructor===Ji&&this.b2MouseJoint.apply(this,arguments)}function zi(){zi.b2MouseJointDef.apply(this,arguments),this.constructor===zi&&this.b2MouseJointDef.apply(this,arguments)}function Ei(){Ei.b2PrismaticJoint.apply(this,arguments),this.constructor===Ei&&this.b2PrismaticJoint.apply(this,arguments)}function Oi(){Oi.b2PrismaticJointDef.apply(this,arguments),this.constructor===Oi&&this.b2PrismaticJointDef.apply(this,arguments)}function Ni(){Ni.b2PulleyJoint.apply(this,arguments),this.constructor===Ni&&this.b2PulleyJoint.apply(this,arguments)}function ji(){ji.b2PulleyJointDef.apply(this,arguments),this.constructor===ji&&this.b2PulleyJointDef.apply(this,arguments)}function Ui(){Ui.b2RevoluteJoint.apply(this,arguments),this.constructor===Ui&&this.b2RevoluteJoint.apply(this,arguments)}function Wi(){Wi.b2RevoluteJointDef.apply(this,arguments),this.constructor===Wi&&this.b2RevoluteJointDef.apply(this,arguments)}function qi(){qi.b2WeldJoint.apply(this,arguments),this.constructor===qi&&this.b2WeldJoint.apply(this,arguments)}function Xi(){Xi.b2WeldJointDef.apply(this,arguments),this.constructor===Xi&&this.b2WeldJointDef.apply(this,arguments)}$i_19.Collision.IBroadPhase="$i_19.Collision.IBroadPhase",$i_19.Collision.b2AABB=t,$i_19.Collision.b2Bound=i,$i_19.Collision.b2BoundValues=e,$i_19.Collision.b2Collision=o,$i_19.Collision.b2ContactID=n,$i_19.Collision.b2ContactPoint=s,$i_19.Collision.b2Distance=r,$i_19.Collision.b2DistanceInput=a,$i_19.Collision.b2DistanceOutput=l,$i_19.Collision.b2DistanceProxy=h,$i_19.Collision.b2DynamicTree=m,$i_19.Collision.b2DynamicTreeBroadPhase=c,$i_19.Collision.b2DynamicTreeNode=_,$i_19.Collision.b2DynamicTreePair=u,$i_19.Collision.b2Manifold=p,$i_19.Collision.b2ManifoldPoint=y,$i_19.Collision.b2Point=d,$i_19.Collision.b2RayCastInput=x,$i_19.Collision.b2RayCastOutput=f,$i_19.Collision.b2Segment=g,$i_19.Collision.b2SeparationFunction=v,$i_19.Collision.b2Simplex=b,$i_19.Collision.b2SimplexCache=w,$i_19.Collision.b2SimplexVertex=D,$i_19.Collision.b2TimeOfImpact=C,$i_19.Collision.b2TOIInput=B,$i_19.Collision.b2WorldManifold=S,$i_19.Collision.ClipVertex=A,$i_19.Collision.Features=M,$i_19.Collision.Shapes.b2CircleShape=I,$i_19.Collision.Shapes.b2EdgeChainDef=V,$i_19.Collision.Shapes.b2EdgeShape=T,$i_19.Collision.Shapes.b2MassData=P,$i_19.Collision.Shapes.b2PolygonShape=L,$i_19.Collision.Shapes.b2Shape=k,$i_19.Common.b2internal="$i_19.Common.b2internal",$i_19.Common.b2Color=R,$i_19.Common.b2Settings=G,$i_19.Common.Math.b2Mat22=F,$i_19.Common.Math.b2Mat33=J,$i_19.Common.Math.b2Math=z,$i_19.Common.Math.b2Sweep=E,$i_19.Common.Math.b2Transform=O,$i_19.Common.Math.b2Vec2=N,$i_19.Common.Math.b2Vec3=j,$i_19.Dynamics.b2Body=U,$i_19.Dynamics.b2BodyDef=W,$i_19.Dynamics.b2ContactFilter=q,$i_19.Dynamics.b2ContactImpulse=X,$i_19.Dynamics.b2ContactListener=K,$i_19.Dynamics.b2ContactManager=Y,$i_19.Dynamics.b2DebugDraw=H,$i_19.Dynamics.b2DestructionListener=Z,$i_19.Dynamics.b2FilterData=Q,$i_19.Dynamics.b2Fixture=$,$i_19.Dynamics.b2FixtureDef=ti,$i_19.Dynamics.b2Island=ii,$i_19.Dynamics.b2TimeStep=ei,$i_19.Dynamics.b2World=oi,$i_19.Dynamics.Contacts.b2CircleContact=ni,$i_19.Dynamics.Contacts.b2Contact=si,$i_19.Dynamics.Contacts.b2ContactConstraint=ri,$i_19.Dynamics.Contacts.b2ContactConstraintPoint=ai,$i_19.Dynamics.Contacts.b2ContactEdge=li,$i_19.Dynamics.Contacts.b2ContactFactory=hi,$i_19.Dynamics.Contacts.b2ContactRegister=mi,$i_19.Dynamics.Contacts.b2ContactResult=ci,$i_19.Dynamics.Contacts.b2ContactSolver=_i,$i_19.Dynamics.Contacts.b2EdgeAndCircleContact=ui,$i_19.Dynamics.Contacts.b2NullContact=pi,$i_19.Dynamics.Contacts.b2PolyAndCircleContact=yi,$i_19.Dynamics.Contacts.b2PolyAndEdgeContact=di,$i_19.Dynamics.Contacts.b2PolygonContact=xi,$i_19.Dynamics.Contacts.b2PositionSolverManifold=fi,$i_19.Dynamics.Controllers.b2BuoyancyController=gi,$i_19.Dynamics.Controllers.b2ConstantAccelController=vi,$i_19.Dynamics.Controllers.b2ConstantForceController=bi,$i_19.Dynamics.Controllers.b2Controller=wi,$i_19.Dynamics.Controllers.b2ControllerEdge=Di,$i_19.Dynamics.Controllers.b2GravityController=Ci,$i_19.Dynamics.Controllers.b2TensorDampingController=Bi,$i_19.Dynamics.Joints.b2DistanceJoint=Si,$i_19.Dynamics.Joints.b2DistanceJointDef=Ai,$i_19.Dynamics.Joints.b2FrictionJoint=Mi,$i_19.Dynamics.Joints.b2FrictionJointDef=Ii,$i_19.Dynamics.Joints.b2GearJoint=Vi,$i_19.Dynamics.Joints.b2GearJointDef=Ti,$i_19.Dynamics.Joints.b2Jacobian=Pi,$i_19.Dynamics.Joints.b2Joint=Li,$i_19.Dynamics.Joints.b2JointDef=ki,$i_19.Dynamics.Joints.b2JointEdge=Ri,$i_19.Dynamics.Joints.b2LineJoint=Gi,$i_19.Dynamics.Joints.b2LineJointDef=Fi,$i_19.Dynamics.Joints.b2MouseJoint=Ji,$i_19.Dynamics.Joints.b2MouseJointDef=zi,$i_19.Dynamics.Joints.b2PrismaticJoint=Ei,$i_19.Dynamics.Joints.b2PrismaticJointDef=Oi,$i_19.Dynamics.Joints.b2PulleyJoint=Ni,$i_19.Dynamics.Joints.b2PulleyJointDef=ji,$i_19.Dynamics.Joints.b2RevoluteJoint=Ui,$i_19.Dynamics.Joints.b2RevoluteJointDef=Wi,$i_19.Dynamics.Joints.b2WeldJoint=qi,$i_19.Dynamics.Joints.b2WeldJointDef=Xi}(),$i_19.postDefs=[],function(){var t=$i_19.Collision.Shapes.b2CircleShape,i=($i_19.Collision.Shapes.b2EdgeChainDef,$i_19.Collision.Shapes.b2EdgeShape,$i_19.Collision.Shapes.b2MassData,$i_19.Collision.Shapes.b2PolygonShape),e=$i_19.Collision.Shapes.b2Shape,o=($i_19.Common.b2Color,$i_19.Common.b2internal,$i_19.Common.b2Settings),n=($i_19.Common.Math.b2Mat22,$i_19.Common.Math.b2Mat33,$i_19.Common.Math.b2Math),s=$i_19.Common.Math.b2Sweep,r=$i_19.Common.Math.b2Transform,a=$i_19.Common.Math.b2Vec2,l=($i_19.Common.Math.b2Vec3,$i_19.Collision.b2AABB),h=$i_19.Collision.b2Bound,m=$i_19.Collision.b2BoundValues,c=$i_19.Collision.b2Collision,_=$i_19.Collision.b2ContactID,u=$i_19.Collision.b2ContactPoint,p=$i_19.Collision.b2Distance,y=$i_19.Collision.b2DistanceInput,d=$i_19.Collision.b2DistanceOutput,x=$i_19.Collision.b2DistanceProxy,f=$i_19.Collision.b2DynamicTree,g=$i_19.Collision.b2DynamicTreeBroadPhase,v=$i_19.Collision.b2DynamicTreeNode,b=$i_19.Collision.b2DynamicTreePair,w=$i_19.Collision.b2Manifold,D=$i_19.Collision.b2ManifoldPoint,C=$i_19.Collision.b2Point,B=$i_19.Collision.b2RayCastInput,S=$i_19.Collision.b2RayCastOutput,A=$i_19.Collision.b2Segment,M=$i_19.Collision.b2SeparationFunction,I=$i_19.Collision.b2Simplex,V=$i_19.Collision.b2SimplexCache,T=$i_19.Collision.b2SimplexVertex,P=$i_19.Collision.b2TimeOfImpact,L=$i_19.Collision.b2TOIInput,k=$i_19.Collision.b2WorldManifold,R=$i_19.Collision.ClipVertex,G=$i_19.Collision.Features,F=$i_19.Collision.IBroadPhase;l.b2AABB=function(){this.lowerBound=new a,this.upperBound=new a},l.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,i=this.upperBound.y-this.lowerBound.y,e=t>=0&&i>=0;return e=e&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},l.prototype.GetCenter=function(){return new a((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},l.prototype.GetExtents=function(){return new a((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},l.prototype.Contains=function(t){var i=!0;return i=i&&t.lowerBound.x>=this.lowerBound.x,i=i&&t.lowerBound.y>=this.lowerBound.y,i=i&&this.upperBound.x>=t.upperBound.x,i=i&&this.upperBound.y>=t.upperBound.y},l.prototype.RayCast=function(t,i){var e=-Number.MAX_VALUE,o=Number.MAX_VALUE,n=i.p1.x,s=i.p1.y,r=i.p2.x-i.p1.x,a=i.p2.y-i.p1.y,l=Math.abs(r),h=Math.abs(a),m=t.normal,c=0,_=0,u=0,p=0,y=0;if(Number.MIN_VALUE>l){if(this.lowerBound.x>n||n>this.upperBound.x)return!1}else if(c=1/r,_=(this.lowerBound.x-n)*c,u=(this.upperBound.x-n)*c,y=-1,_>u&&(p=_,_=u,u=p,y=1),_>e&&(m.x=y,m.y=0,e=_),o=Math.min(o,u),e>o)return!1;if(Number.MIN_VALUE>h){if(this.lowerBound.y>s||s>this.upperBound.y)return!1}else if(c=1/a,_=(this.lowerBound.y-s)*c,u=(this.upperBound.y-s)*c,y=-1,_>u&&(p=_,_=u,u=p,y=1),_>e&&(m.y=y,m.x=0,e=_),o=Math.min(o,u),e>o)return!1;return t.fraction=e,!0},l.prototype.TestOverlap=function(t){var i=t.lowerBound.x-this.upperBound.x,e=t.lowerBound.y-this.upperBound.y,o=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return i>0||e>0?!1:o>0||n>0?!1:!0},l.Combine=function(t,i){var e=new l;return e.Combine(t,i),e},l.prototype.Combine=function(t,i){this.lowerBound.x=Math.min(t.lowerBound.x,i.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,i.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,i.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,i.upperBound.y)},h.b2Bound=function(){},h.prototype.IsLower=function(){return(this.value&1)==0},h.prototype.IsUpper=function(){return(this.value&1)==1},h.prototype.Swap=function(t){var i=this.value,e=this.proxy,o=this.stabbingCount;this.value=t.value,this.proxy=t.proxy,this.stabbingCount=t.stabbingCount,t.value=i,t.proxy=e,t.stabbingCount=o},m.b2BoundValues=function(){},m.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},c.b2Collision=function(){},c.ClipSegmentToLine=function(t,i,e,o){o===void 0&&(o=0);var n,s=0;n=i[0];var r=n.v;n=i[1];var a=n.v,l=e.x*r.x+e.y*r.y-o,h=e.x*a.x+e.y*a.y-o;if(l>0||t[s++].Set(i[0]),h>0||t[s++].Set(i[1]),0>l*h){var m=l/(l-h);n=t[s];var c=n.v;c.x=r.x+m*(a.x-r.x),c.y=r.y+m*(a.y-r.y),n=t[s];var _;l>0?(_=i[0],n.id=_.id):(_=i[1],n.id=_.id),++s}return s},c.EdgeSeparation=function(t,i,e,o,n){e===void 0&&(e=0),parseInt(t.m_vertexCount);var s,r,a=t.m_vertices,l=t.m_normals,h=parseInt(o.m_vertexCount),m=o.m_vertices;s=i.R,r=l[e];var c=s.col1.x*r.x+s.col2.x*r.y,_=s.col1.y*r.x+s.col2.y*r.y;s=n.R;for(var u=s.col1.x*c+s.col1.y*_,p=s.col2.x*c+s.col2.y*_,y=0,d=Number.MAX_VALUE,x=0;h>x;++x){r=m[x];var f=r.x*u+r.y*p;d>f&&(d=f,y=x)}r=a[e],s=i.R;var g=i.position.x+(s.col1.x*r.x+s.col2.x*r.y),v=i.position.y+(s.col1.y*r.x+s.col2.y*r.y);r=m[y],s=n.R;var b=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),w=n.position.y+(s.col1.y*r.x+s.col2.y*r.y);b-=g,w-=v;var D=b*c+w*_;return D},c.FindMaxSeparation=function(t,i,e,o,n){var s,r,a=parseInt(i.m_vertexCount),l=i.m_normals;r=n.R,s=o.m_centroid;var h=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),m=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);r=e.R,s=i.m_centroid,h-=e.position.x+(r.col1.x*s.x+r.col2.x*s.y),m-=e.position.y+(r.col1.y*s.x+r.col2.y*s.y);for(var _=h*e.R.col1.x+m*e.R.col1.y,u=h*e.R.col2.x+m*e.R.col2.y,p=0,y=-Number.MAX_VALUE,d=0;a>d;++d){s=l[d];var x=s.x*_+s.y*u;x>y&&(y=x,p=d)}var f=c.EdgeSeparation(i,e,p,o,n),g=parseInt(0>p-1?a-1:p-1),v=c.EdgeSeparation(i,e,g,o,n),b=parseInt(a>p+1?p+1:0),w=c.EdgeSeparation(i,e,b,o,n),D=0,C=0,B=0;if(v>f&&v>w)B=-1,D=g,C=v;else{if(f>=w)return t[0]=p,f;B=1,D=b,C=w}for(;;){if(p=B==-1?0>D-1?a-1:D-1:a>D+1?D+1:0,f=c.EdgeSeparation(i,e,p,o,n),C>=f)break;D=p,C=f}return t[0]=D,C},c.FindIncidentEdge=function(t,i,e,o,n,s){o===void 0&&(o=0),parseInt(i.m_vertexCount);var r,a,l=i.m_normals,h=parseInt(n.m_vertexCount),m=n.m_vertices,c=n.m_normals;r=e.R,a=l[o];var _=r.col1.x*a.x+r.col2.x*a.y,u=r.col1.y*a.x+r.col2.y*a.y;r=s.R;var p=r.col1.x*_+r.col1.y*u;u=r.col2.x*_+r.col2.y*u,_=p;for(var y=0,d=Number.MAX_VALUE,x=0;h>x;++x){a=c[x];var f=_*a.x+u*a.y;d>f&&(d=f,y=x)}var g,v=parseInt(y),b=parseInt(h>v+1?v+1:0);g=t[0],a=m[v],r=s.R,g.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y),g.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y),g.id.features.referenceEdge=o,g.id.features.incidentEdge=v,g.id.features.incidentVertex=0,g=t[1],a=m[b],r=s.R,g.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y),g.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y),g.id.features.referenceEdge=o,g.id.features.incidentEdge=b,g.id.features.incidentVertex=1},c.MakeClipPointVector=function(){var t=new Vector(2);return t[0]=new R,t[1]=new R,t},c.CollidePolygons=function(t,i,e,n,s){var r;t.m_pointCount=0;var a=i.m_radius+n.m_radius,l=0;c.s_edgeAO[0]=l;var h=c.FindMaxSeparation(c.s_edgeAO,i,e,n,s);if(l=c.s_edgeAO[0],a>=h){var m=0;c.s_edgeBO[0]=m;var _=c.FindMaxSeparation(c.s_edgeBO,n,s,i,e);if(m=c.s_edgeBO[0],a>=_){var u,p,y,d,x,f=0,g=0,v=.98,b=.001;_>v*h+b?(u=n,p=i,y=s,d=e,f=m,t.m_type=w.e_faceB,g=1):(u=i,p=n,y=e,d=s,f=l,t.m_type=w.e_faceA,g=0);var D=c.s_incidentEdge;c.FindIncidentEdge(D,u,y,f,p,d);var C,B=parseInt(u.m_vertexCount),S=u.m_vertices,A=S[f];C=B>f+1?S[parseInt(f+1)]:S[0];var M=c.s_localTangent;M.Set(C.x-A.x,C.y-A.y),M.Normalize();var I=c.s_localNormal;I.x=M.y,I.y=-M.x;var V=c.s_planePoint;V.Set(.5*(A.x+C.x),.5*(A.y+C.y));var T=c.s_tangent;x=y.R,T.x=x.col1.x*M.x+x.col2.x*M.y,T.y=x.col1.y*M.x+x.col2.y*M.y;var P=c.s_tangent2;P.x=-T.x,P.y=-T.y;var L=c.s_normal;L.x=T.y,L.y=-T.x;var k=c.s_v11,R=c.s_v12;k.x=y.position.x+(x.col1.x*A.x+x.col2.x*A.y),k.y=y.position.y+(x.col1.y*A.x+x.col2.y*A.y),R.x=y.position.x+(x.col1.x*C.x+x.col2.x*C.y),R.y=y.position.y+(x.col1.y*C.x+x.col2.y*C.y);var G=L.x*k.x+L.y*k.y,F=-T.x*k.x-T.y*k.y+a,J=T.x*R.x+T.y*R.y+a,z=c.s_clipPoints1,E=c.s_clipPoints2,O=0;if(O=c.ClipSegmentToLine(z,D,P,F),O>=2&&(O=c.ClipSegmentToLine(E,z,T,J),O>=2)){t.m_localPlaneNormal.SetV(I),t.m_localPoint.SetV(V);for(var N=0,j=0;o.b2_maxManifoldPoints>j;++j){r=E[j];var U=L.x*r.v.x+L.y*r.v.y-G;if(a>=U){var W=t.m_points[N];x=d.R;var q=r.v.x-d.position.x,X=r.v.y-d.position.y;W.m_localPoint.x=q*x.col1.x+X*x.col1.y,W.m_localPoint.y=q*x.col2.x+X*x.col2.y,W.m_id.Set(r.id),W.m_id.features.flip=g,++N}}t.m_pointCount=N}}}},c.CollideCircles=function(t,i,e,o,n){t.m_pointCount=0;var s,r;s=e.R,r=i.m_p;var a=e.position.x+(s.col1.x*r.x+s.col2.x*r.y),l=e.position.y+(s.col1.y*r.x+s.col2.y*r.y);s=n.R,r=o.m_p;var h=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),m=n.position.y+(s.col1.y*r.x+s.col2.y*r.y),c=h-a,_=m-l,u=c*c+_*_,p=i.m_radius+o.m_radius;u>p*p||(t.m_type=w.e_circles,t.m_localPoint.SetV(i.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0)},c.CollidePolygonAndCircle=function(t,i,e,o,n){t.m_pointCount=0;var s,r,a=0,l=0;r=n.R,s=o.m_p;var h=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),m=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);a=h-e.position.x,l=m-e.position.y,r=e.R;for(var c=a*r.col1.x+l*r.col1.y,_=a*r.col2.x+l*r.col2.y,u=0,p=-Number.MAX_VALUE,y=i.m_radius+o.m_radius,d=parseInt(i.m_vertexCount),x=i.m_vertices,f=i.m_normals,g=0;d>g;++g){s=x[g],a=c-s.x,l=_-s.y,s=f[g];var v=s.x*a+s.y*l;if(v>y)return;v>p&&(p=v,u=g)}var b=parseInt(u),D=parseInt(d>b+1?b+1:0),C=x[b],B=x[D];if(Number.MIN_VALUE>p)return t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.SetV(f[u]),t.m_localPoint.x=.5*(C.x+B.x),t.m_localPoint.y=.5*(C.y+B.y),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0,void 0;var S=(c-C.x)*(B.x-C.x)+(_-C.y)*(B.y-C.y),A=(c-B.x)*(C.x-B.x)+(_-B.y)*(C.y-B.y);if(0<S)if(0<A){var M=.5*(C.x+B.x),I=.5*(C.y+B.y);if(p=(c-M)*f[b].x+(_-I)*f[b].y,p>y)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=f[b].x,t.m_localPlaneNormal.y=f[b].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(M,I),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0}else{if((c-B.x)*(c-B.x)+(_-B.y)*(_-B.y)>y*y)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=c-B.x,t.m_localPlaneNormal.y=_-B.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(B),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0}else{if((c-C.x)*(c-C.x)+(_-C.y)*(_-C.y)>y*y)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=c-C.x,t.m_localPlaneNormal.y=_-C.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(C),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0}},c.TestOverlap=function(t,i){var e=i.lowerBound,o=t.upperBound,n=e.x-o.x,s=e.y-o.y;e=t.lowerBound,o=i.upperBound;var r=e.x-o.x,a=e.y-o.y;return n>0||s>0?!1:r>0||a>0?!1:!0},$i_19.postDefs.push(function(){$i_19.Collision.b2Collision.s_incidentEdge=c.MakeClipPointVector(),$i_19.Collision.b2Collision.s_clipPoints1=c.MakeClipPointVector(),$i_19.Collision.b2Collision.s_clipPoints2=c.MakeClipPointVector(),$i_19.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),$i_19.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),$i_19.Collision.b2Collision.s_localTangent=new a,$i_19.Collision.b2Collision.s_localNormal=new a,$i_19.Collision.b2Collision.s_planePoint=new a,$i_19.Collision.b2Collision.s_normal=new a,$i_19.Collision.b2Collision.s_tangent=new a,$i_19.Collision.b2Collision.s_tangent2=new a,$i_19.Collision.b2Collision.s_v11=new a,$i_19.Collision.b2Collision.s_v12=new a,$i_19.Collision.b2Collision.b2CollidePolyTempVec=new a,$i_19.Collision.b2Collision.b2_nullFeature=255}),_.b2ContactID=function(){this.features=new G},_.prototype.b2ContactID=function(){this.features._m_id=this},_.prototype.Set=function(t){this.key=t._key},_.prototype.Copy=function(){var t=new _;return t.key=this.key,t},Object.defineProperty(_.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(_.prototype,"key",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._key=t,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255
}}),u.b2ContactPoint=function(){this.position=new a,this.velocity=new a,this.normal=new a,this.id=new _},p.b2Distance=function(){},p.Distance=function(t,i,e){++p.b2_gjkCalls;var s=e.proxyA,r=e.proxyB,l=e.transformA,h=e.transformB,m=p.s_simplex;m.ReadCache(i,s,l,r,h);var c,_=m.m_vertices,u=20,y=p.s_saveA,d=p.s_saveB,x=0,f=m.GetClosestPoint(),g=f.LengthSquared(),v=g,b=0,w=0;while(u>w){for(x=m.m_count,b=0;x>b;b++)y[b]=_[b].indexA,d[b]=_[b].indexB;switch(m.m_count){case 1:break;case 2:m.Solve2();break;case 3:m.Solve3();break;default:o.b2Assert(!1)}if(m.m_count==3)break;c=m.GetClosestPoint(),v=c.LengthSquared(),g=v;var D=m.GetSearchDirection();if(Number.MIN_VALUE*Number.MIN_VALUE>D.LengthSquared())break;var C=_[m.m_count];C.indexA=s.GetSupport(n.MulTMV(l.R,D.GetNegative())),C.wA=n.MulX(l,s.GetVertex(C.indexA)),C.indexB=r.GetSupport(n.MulTMV(h.R,D)),C.wB=n.MulX(h,r.GetVertex(C.indexB)),C.w=n.SubtractVV(C.wB,C.wA),++w,++p.b2_gjkIters;var B=!1;for(b=0;x>b;b++)if(C.indexA==y[b]&&C.indexB==d[b]){B=!0;break}if(B)break;++m.m_count}if(p.b2_gjkMaxIters=n.Max(p.b2_gjkMaxIters,w),m.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.SubtractVV(t.pointA,t.pointB).Length(),t.iterations=w,m.WriteCache(i),e.useRadii){var S=s.m_radius,A=r.m_radius;if(t.distance>S+A&&t.distance>Number.MIN_VALUE){t.distance-=S+A;var M=n.SubtractVV(t.pointB,t.pointA);M.Normalize(),t.pointA.x+=S*M.x,t.pointA.y+=S*M.y,t.pointB.x-=A*M.x,t.pointB.y-=A*M.y}else c=new a,c.x=.5*(t.pointA.x+t.pointB.x),c.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=c.x,t.pointA.y=t.pointB.y=c.y,t.distance=0}},$i_19.postDefs.push(function(){$i_19.Collision.b2Distance.s_simplex=new I,$i_19.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),$i_19.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),y.b2DistanceInput=function(){},d.b2DistanceOutput=function(){this.pointA=new a,this.pointB=new a},x.b2DistanceProxy=function(){},x.prototype.Set=function(n){switch(n.GetType()){case e.e_circleShape:var s=n instanceof t?n:null;this.m_vertices=new Vector(1,!0),this.m_vertices[0]=s.m_p,this.m_count=1,this.m_radius=s.m_radius;break;case e.e_polygonShape:var r=n instanceof i?n:null;this.m_vertices=r.m_vertices,this.m_count=r.m_vertexCount,this.m_radius=r.m_radius;break;default:o.b2Assert(!1)}},x.prototype.GetSupport=function(t){for(var i=0,e=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;this.m_count>o;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>e&&(i=o,e=n)}return i},x.prototype.GetSupportVertex=function(t){for(var i=0,e=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;this.m_count>o;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>e&&(i=o,e=n)}return this.m_vertices[i]},x.prototype.GetVertexCount=function(){return this.m_count},x.prototype.GetVertex=function(t){return t===void 0&&(t=0),o.b2Assert(t>=0&&this.m_count>t),this.m_vertices[t]},f.b2DynamicTree=function(){},f.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},f.prototype.CreateProxy=function(t,i){var e=this.AllocateNode(),n=o.b2_aabbExtension,s=o.b2_aabbExtension;return e.aabb.lowerBound.x=t.lowerBound.x-n,e.aabb.lowerBound.y=t.lowerBound.y-s,e.aabb.upperBound.x=t.upperBound.x+n,e.aabb.upperBound.y=t.upperBound.y+s,e.userData=i,this.InsertLeaf(e),e},f.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},f.prototype.MoveProxy=function(t,i,e){if(o.b2Assert(t.IsLeaf()),t.aabb.Contains(i))return!1;this.RemoveLeaf(t);var n=o.b2_aabbExtension+o.b2_aabbMultiplier*(e.x>0?e.x:-e.x),s=o.b2_aabbExtension+o.b2_aabbMultiplier*(e.y>0?e.y:-e.y);return t.aabb.lowerBound.x=i.lowerBound.x-n,t.aabb.lowerBound.y=i.lowerBound.y-s,t.aabb.upperBound.x=i.upperBound.x+n,t.aabb.upperBound.y=i.upperBound.y+s,this.InsertLeaf(t),!0},f.prototype.Rebalance=function(t){if(t===void 0&&(t=0),this.m_root!=null)for(var i=0;t>i;i++){var e=this.m_root,o=0;while(e.IsLeaf()==0)e=this.m_path>>o&1?e.child2:e.child1,o=o+1&31;++this.m_path,this.RemoveLeaf(e),this.InsertLeaf(e)}},f.prototype.GetFatAABB=function(t){return t.aabb},f.prototype.GetUserData=function(t){return t.userData},f.prototype.Query=function(t,i){if(this.m_root!=null){var e=new Vector,o=0;e[o++]=this.m_root;while(o>0){var n=e[--o];if(n.aabb.TestOverlap(i))if(n.IsLeaf()){var s=t(n);if(!s)return}else e[o++]=n.child1,e[o++]=n.child2}}},f.prototype.RayCast=function(t,i){if(this.m_root!=null){var e=i.p1,o=i.p2,s=n.SubtractVV(e,o);s.Normalize();var r=n.CrossFV(1,s),a=n.AbsV(r),h=i.maxFraction,m=new l,c=0,_=0;c=e.x+h*(o.x-e.x),_=e.y+h*(o.y-e.y),m.lowerBound.x=Math.min(e.x,c),m.lowerBound.y=Math.min(e.y,_),m.upperBound.x=Math.max(e.x,c),m.upperBound.y=Math.max(e.y,_);var u=new Vector,p=0;u[p++]=this.m_root;while(p>0){var y=u[--p];if(y.aabb.TestOverlap(m)!=0){var d=y.aabb.GetCenter(),x=y.aabb.GetExtents(),f=Math.abs(r.x*(e.x-d.x)+r.y*(e.y-d.y))-a.x*x.x-a.y*x.y;if(0>=f)if(y.IsLeaf()){var g=new B;if(g.p1=i.p1,g.p2=i.p2,g.maxFraction=i.maxFraction,h=t(g,y),h==0)return;h>0&&(c=e.x+h*(o.x-e.x),_=e.y+h*(o.y-e.y),m.lowerBound.x=Math.min(e.x,c),m.lowerBound.y=Math.min(e.y,_),m.upperBound.x=Math.max(e.x,c),m.upperBound.y=Math.max(e.y,_))}else u[p++]=y.child1,u[p++]=y.child2}}}},f.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t}return new v},f.prototype.FreeNode=function(t){t.parent=this.m_freeList,this.m_freeList=t},f.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,this.m_root==null)return this.m_root=t,this.m_root.parent=null,void 0;var i=t.aabb.GetCenter(),e=this.m_root;if(e.IsLeaf()==0)do{var o=e.child1,n=e.child2,s=Math.abs((o.aabb.lowerBound.x+o.aabb.upperBound.x)/2-i.x)+Math.abs((o.aabb.lowerBound.y+o.aabb.upperBound.y)/2-i.y),r=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-i.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-i.y);e=r>s?o:n}while(e.IsLeaf()==0);var a=e.parent,l=this.AllocateNode();if(l.parent=a,l.userData=null,l.aabb.Combine(t.aabb,e.aabb),a){e.parent.child1==e?a.child1=l:a.child2=l,l.child1=e,l.child2=t,e.parent=l,t.parent=l;do{if(a.aabb.Contains(l.aabb))break;a.aabb.Combine(a.child1.aabb,a.child2.aabb),l=a,a=a.parent}while(a)}else l.child1=e,l.child2=t,e.parent=l,t.parent=l,this.m_root=l},f.prototype.RemoveLeaf=function(t){if(t==this.m_root)return this.m_root=null,void 0;var i,e=t.parent,o=e.parent;if(i=e.child1==t?e.child2:e.child1,o){o.child1==e?o.child1=i:o.child2=i,i.parent=o,this.FreeNode(e);while(o){var n=o.aabb;if(o.aabb=l.Combine(o.child1.aabb,o.child2.aabb),n.Contains(o.aabb))break;o=o.parent}}else this.m_root=i,i.parent=null,this.FreeNode(e)},g.b2DynamicTreeBroadPhase=function(){this.m_tree=new f,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},g.prototype.CreateProxy=function(t,i){var e=this.m_tree.CreateProxy(t,i);return++this.m_proxyCount,this.BufferMove(e),e},g.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},g.prototype.MoveProxy=function(t,i,e){var o=this.m_tree.MoveProxy(t,i,e);o&&this.BufferMove(t)},g.prototype.TestOverlap=function(t,i){var e=this.m_tree.GetFatAABB(t),o=this.m_tree.GetFatAABB(i);return e.TestOverlap(o)},g.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},g.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},g.prototype.GetProxyCount=function(){return this.m_proxyCount},g.prototype.UpdatePairs=function(t){function i(t){if(t==o)return!0;e.m_pairCount==e.m_pairBuffer.length&&(e.m_pairBuffer[e.m_pairCount]=new b);var i=e.m_pairBuffer[e.m_pairCount];return i.proxyA=o>t?t:o,i.proxyB=o>t?o:t,++e.m_pairCount,!0}var e=this;e.m_pairCount=0;var o,n=0;for(n=0;e.m_moveBuffer.length>n;++n){o=e.m_moveBuffer[n];var s=e.m_tree.GetFatAABB(o);e.m_tree.Query(i,s)}e.m_moveBuffer.length=0;for(var n=0;e.m_pairCount>n;){var r=e.m_pairBuffer[n],a=e.m_tree.GetUserData(r.proxyA),l=e.m_tree.GetUserData(r.proxyB);t(a,l),++n;while(e.m_pairCount>n){var h=e.m_pairBuffer[n];if(h.proxyA!=r.proxyA||h.proxyB!=r.proxyB)break;++n}}},g.prototype.Query=function(t,i){this.m_tree.Query(t,i)},g.prototype.RayCast=function(t,i){this.m_tree.RayCast(t,i)},g.prototype.Validate=function(){},g.prototype.Rebalance=function(t){t===void 0&&(t=0),this.m_tree.Rebalance(t)},g.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t},g.prototype.UnBufferMove=function(t){var i=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(i,1)},g.prototype.ComparePairs=function(){return 0},g.__implements={},g.__implements[F]=!0,v.b2DynamicTreeNode=function(){this.aabb=new l},v.prototype.IsLeaf=function(){return this.child1==null},b.b2DynamicTreePair=function(){},w.b2Manifold=function(){this.m_pointCount=0},w.prototype.b2Manifold=function(){this.m_points=new Vector(o.b2_maxManifoldPoints);for(var t=0;o.b2_maxManifoldPoints>t;t++)this.m_points[t]=new D;this.m_localPlaneNormal=new a,this.m_localPoint=new a},w.prototype.Reset=function(){for(var t=0;o.b2_maxManifoldPoints>t;t++)(this.m_points[t]instanceof D?this.m_points[t]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},w.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var i=0;o.b2_maxManifoldPoints>i;i++)(this.m_points[i]instanceof D?this.m_points[i]:null).Set(t.m_points[i]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},w.prototype.Copy=function(){var t=new w;return t.Set(this),t},$i_19.postDefs.push(function(){$i_19.Collision.b2Manifold.e_circles=1,$i_19.Collision.b2Manifold.e_faceA=2,$i_19.Collision.b2Manifold.e_faceB=4}),D.b2ManifoldPoint=function(){this.m_localPoint=new a,this.m_id=new _},D.prototype.b2ManifoldPoint=function(){this.Reset()},D.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},D.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},C.b2Point=function(){this.p=new a},C.prototype.Support=function(t,i,e){return i===void 0&&(i=0),e===void 0&&(e=0),this.p},C.prototype.GetFirstVertex=function(){return this.p},B.b2RayCastInput=function(){this.p1=new a,this.p2=new a},B.prototype.b2RayCastInput=function(t,i,e){t===void 0&&(t=null),i===void 0&&(i=null),e===void 0&&(e=1),t&&this.p1.SetV(t),i&&this.p2.SetV(i),this.maxFraction=e},S.b2RayCastOutput=function(){this.normal=new a},A.b2Segment=function(){this.p1=new a,this.p2=new a},A.prototype.TestSegment=function(t,i,e,o){o===void 0&&(o=0);var n=e.p1,s=e.p2.x-n.x,r=e.p2.y-n.y,a=this.p2.x-this.p1.x,l=this.p2.y-this.p1.y,h=l,m=-a,c=100*Number.MIN_VALUE,_=-(s*h+r*m);if(_>c){var u=n.x-this.p1.x,p=n.y-this.p1.y,y=u*h+p*m;if(y>=0&&o*_>=y){var d=-s*p+r*u;if(d>=-c*_&&_*(1+c)>=d){y/=_;var x=Math.sqrt(h*h+m*m);return h/=x,m/=x,t[0]=y,i.Set(h,m),!0}}}return!1},A.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},A.prototype.ExtendForward=function(t){var i=this.p2.x-this.p1.x,e=this.p2.y-this.p1.y,o=Math.min(i>0?(t.upperBound.x-this.p1.x)/i:0>i?(t.lowerBound.x-this.p1.x)/i:Number.POSITIVE_INFINITY,e>0?(t.upperBound.y-this.p1.y)/e:0>e?(t.lowerBound.y-this.p1.y)/e:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+i*o,this.p2.y=this.p1.y+e*o},A.prototype.ExtendBackward=function(t){var i=-this.p2.x+this.p1.x,e=-this.p2.y+this.p1.y,o=Math.min(i>0?(t.upperBound.x-this.p2.x)/i:0>i?(t.lowerBound.x-this.p2.x)/i:Number.POSITIVE_INFINITY,e>0?(t.upperBound.y-this.p2.y)/e:0>e?(t.lowerBound.y-this.p2.y)/e:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+i*o,this.p1.y=this.p2.y+e*o},M.b2SeparationFunction=function(){this.m_localPoint=new a,this.m_axis=new a},M.prototype.Initialize=function(t,i,e,s,r){this.m_proxyA=i,this.m_proxyB=s;var l=parseInt(t.count);o.b2Assert(l>0&&3>l);var h,m,c,_,u,p,y,d,x=0,f=0,g=0,v=0,b=0,w=0,D=0,C=0;if(l==1)this.m_type=M.e_points,h=this.m_proxyA.GetVertex(t.indexA[0]),_=this.m_proxyB.GetVertex(t.indexB[0]),d=h,y=e.R,x=e.position.x+(y.col1.x*d.x+y.col2.x*d.y),f=e.position.y+(y.col1.y*d.x+y.col2.y*d.y),d=_,y=r.R,g=r.position.x+(y.col1.x*d.x+y.col2.x*d.y),v=r.position.y+(y.col1.y*d.x+y.col2.y*d.y),this.m_axis.x=g-x,this.m_axis.y=v-f,this.m_axis.Normalize();else if(t.indexB[0]==t.indexB[1])this.m_type=M.e_faceA,m=this.m_proxyA.GetVertex(t.indexA[0]),c=this.m_proxyA.GetVertex(t.indexA[1]),_=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(m.x+c.x),this.m_localPoint.y=.5*(m.y+c.y),this.m_axis=n.CrossVF(n.SubtractVV(c,m),1),this.m_axis.Normalize(),d=this.m_axis,y=e.R,b=y.col1.x*d.x+y.col2.x*d.y,w=y.col1.y*d.x+y.col2.y*d.y,d=this.m_localPoint,y=e.R,x=e.position.x+(y.col1.x*d.x+y.col2.x*d.y),f=e.position.y+(y.col1.y*d.x+y.col2.y*d.y),d=_,y=r.R,g=r.position.x+(y.col1.x*d.x+y.col2.x*d.y),v=r.position.y+(y.col1.y*d.x+y.col2.y*d.y),D=(g-x)*b+(v-f)*w,0>D&&this.m_axis.NegativeSelf();else if(t.indexA[0]==t.indexA[0])this.m_type=M.e_faceB,u=this.m_proxyB.GetVertex(t.indexB[0]),p=this.m_proxyB.GetVertex(t.indexB[1]),h=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(u.x+p.x),this.m_localPoint.y=.5*(u.y+p.y),this.m_axis=n.CrossVF(n.SubtractVV(p,u),1),this.m_axis.Normalize(),d=this.m_axis,y=r.R,b=y.col1.x*d.x+y.col2.x*d.y,w=y.col1.y*d.x+y.col2.y*d.y,d=this.m_localPoint,y=r.R,g=r.position.x+(y.col1.x*d.x+y.col2.x*d.y),v=r.position.y+(y.col1.y*d.x+y.col2.y*d.y),d=h,y=e.R,x=e.position.x+(y.col1.x*d.x+y.col2.x*d.y),f=e.position.y+(y.col1.y*d.x+y.col2.y*d.y),D=(x-g)*b+(f-v)*w,0>D&&this.m_axis.NegativeSelf();else{m=this.m_proxyA.GetVertex(t.indexA[0]),c=this.m_proxyA.GetVertex(t.indexA[1]),u=this.m_proxyB.GetVertex(t.indexB[0]),p=this.m_proxyB.GetVertex(t.indexB[1]),n.MulX(e,h);var B=n.MulMV(e.R,n.SubtractVV(c,m));n.MulX(r,_);var S=n.MulMV(r.R,n.SubtractVV(p,u)),A=B.x*B.x+B.y*B.y,I=S.x*S.x+S.y*S.y,V=n.SubtractVV(S,B),T=B.x*V.x+B.y*V.y,P=S.x*V.x+S.y*V.y,L=B.x*S.x+B.y*S.y,k=A*I-L*L;D=0,k!=0&&(D=n.Clamp((L*P-T*I)/k,0,1));var R=(L*D+P)/I;0>R&&(R=0,D=n.Clamp((L-T)/A,0,1)),h=new a,h.x=m.x+D*(c.x-m.x),h.y=m.y+D*(c.y-m.y),_=new a,_.x=u.x+D*(p.x-u.x),_.y=u.y+D*(p.y-u.y),D==0||D==1?(this.m_type=M.e_faceB,this.m_axis=n.CrossVF(n.SubtractVV(p,u),1),this.m_axis.Normalize(),this.m_localPoint=_,d=this.m_axis,y=r.R,b=y.col1.x*d.x+y.col2.x*d.y,w=y.col1.y*d.x+y.col2.y*d.y,d=this.m_localPoint,y=r.R,g=r.position.x+(y.col1.x*d.x+y.col2.x*d.y),v=r.position.y+(y.col1.y*d.x+y.col2.y*d.y),d=h,y=e.R,x=e.position.x+(y.col1.x*d.x+y.col2.x*d.y),f=e.position.y+(y.col1.y*d.x+y.col2.y*d.y),C=(x-g)*b+(f-v)*w,0>D&&this.m_axis.NegativeSelf()):(this.m_type=M.e_faceA,this.m_axis=n.CrossVF(n.SubtractVV(c,m),1),this.m_localPoint=h,d=this.m_axis,y=e.R,b=y.col1.x*d.x+y.col2.x*d.y,w=y.col1.y*d.x+y.col2.y*d.y,d=this.m_localPoint,y=e.R,x=e.position.x+(y.col1.x*d.x+y.col2.x*d.y),f=e.position.y+(y.col1.y*d.x+y.col2.y*d.y),d=_,y=r.R,g=r.position.x+(y.col1.x*d.x+y.col2.x*d.y),v=r.position.y+(y.col1.y*d.x+y.col2.y*d.y),C=(g-x)*b+(v-f)*w,0>D&&this.m_axis.NegativeSelf())}},M.prototype.Evaluate=function(t,i){var e,s,r,a,l,h,m,c=0;switch(this.m_type){case M.e_points:return e=n.MulTMV(t.R,this.m_axis),s=n.MulTMV(i.R,this.m_axis.GetNegative()),r=this.m_proxyA.GetSupportVertex(e),a=this.m_proxyB.GetSupportVertex(s),l=n.MulX(t,r),h=n.MulX(i,a),c=(h.x-l.x)*this.m_axis.x+(h.y-l.y)*this.m_axis.y;case M.e_faceA:return m=n.MulMV(t.R,this.m_axis),l=n.MulX(t,this.m_localPoint),s=n.MulTMV(i.R,m.GetNegative()),a=this.m_proxyB.GetSupportVertex(s),h=n.MulX(i,a),c=(h.x-l.x)*m.x+(h.y-l.y)*m.y;case M.e_faceB:return m=n.MulMV(i.R,this.m_axis),h=n.MulX(i,this.m_localPoint),e=n.MulTMV(t.R,m.GetNegative()),r=this.m_proxyA.GetSupportVertex(e),l=n.MulX(t,r),c=(l.x-h.x)*m.x+(l.y-h.y)*m.y;default:return o.b2Assert(!1),0}},$i_19.postDefs.push(function(){$i_19.Collision.b2SeparationFunction.e_points=1,$i_19.Collision.b2SeparationFunction.e_faceA=2,$i_19.Collision.b2SeparationFunction.e_faceB=4}),I.b2Simplex=function(){this.m_v1=new T,this.m_v2=new T,this.m_v3=new T,this.m_vertices=new Vector(3)},I.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},I.prototype.ReadCache=function(t,i,e,s,r){o.b2Assert(t.count>=0&&3>=t.count);var a,l;this.m_count=t.count;for(var h=this.m_vertices,m=0;this.m_count>m;m++){var c=h[m];c.indexA=t.indexA[m],c.indexB=t.indexB[m],a=i.GetVertex(c.indexA),l=s.GetVertex(c.indexB),c.wA=n.MulX(e,a),c.wB=n.MulX(r,l),c.w=n.SubtractVV(c.wB,c.wA),c.a=0}if(this.m_count>1){var _=t.metric,u=this.GetMetric();(.5*_>u||u>2*_||Number.MIN_VALUE>u)&&(this.m_count=0)}this.m_count==0&&(c=h[0],c.indexA=0,c.indexB=0,a=i.GetVertex(0),l=s.GetVertex(0),c.wA=n.MulX(e,a),c.wB=n.MulX(r,l),c.w=n.SubtractVV(c.wB,c.wA),this.m_count=1)},I.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=$i_19.parseUInt(this.m_count);for(var i=this.m_vertices,e=0;this.m_count>e;e++)t.indexA[e]=$i_19.parseUInt(i[e].indexA),t.indexB[e]=$i_19.parseUInt(i[e].indexB)},I.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=n.SubtractVV(this.m_v2.w,this.m_v1.w),i=n.CrossVV(t,this.m_v1.w.GetNegative());return i>0?n.CrossFV(1,t):n.CrossVF(t,1);default:return o.b2Assert(!1),new a}},I.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return o.b2Assert(!1),new a;case 1:return this.m_v1.w;case 2:return new a(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return o.b2Assert(!1),new a}},I.prototype.GetWitnessPoints=function(t,i){switch(this.m_count){case 0:o.b2Assert(!1);break;case 1:t.SetV(this.m_v1.wA),i.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,i.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,i.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:i.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,i.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:o.b2Assert(!1)}},I.prototype.GetMetric=function(){switch(this.m_count){case 0:return o.b2Assert(!1),0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w));default:return o.b2Assert(!1),0}},I.prototype.Solve2=function(){var t=this.m_v1.w,i=this.m_v2.w,e=n.SubtractVV(i,t),o=-(t.x*e.x+t.y*e.y);if(0>=o)return this.m_v1.a=1,this.m_count=1,void 0;var s=i.x*e.x+i.y*e.y;if(0>=s)return this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2),void 0;var r=1/(s+o);this.m_v1.a=s*r,this.m_v2.a=o*r,this.m_count=2},I.prototype.Solve3=function(){var t=this.m_v1.w,i=this.m_v2.w,e=this.m_v3.w,o=n.SubtractVV(i,t),s=n.Dot(t,o),r=n.Dot(i,o),a=r,l=-s,h=n.SubtractVV(e,t),m=n.Dot(t,h),c=n.Dot(e,h),_=c,u=-m,p=n.SubtractVV(e,i),y=n.Dot(i,p),d=n.Dot(e,p),x=d,f=-y,g=n.CrossVV(o,h),v=g*n.CrossVV(i,e),b=g*n.CrossVV(e,t),w=g*n.CrossVV(t,i);if(0>=l&&0>=u)return this.m_v1.a=1,this.m_count=1,void 0;if(a>0&&l>0&&0>=w){var D=1/(a+l);return this.m_v1.a=a*D,this.m_v2.a=l*D,this.m_count=2,void 0}if(_>0&&u>0&&0>=b){var C=1/(_+u);return this.m_v1.a=_*C,this.m_v3.a=u*C,this.m_count=2,this.m_v2.Set(this.m_v3),void 0}if(0>=a&&0>=f)return this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2),void 0;if(0>=_&&0>=x)return this.m_v3.a=1,this.m_count=1,this.m_v1.Set(this.m_v3),void 0;if(x>0&&f>0&&0>=v){var B=1/(x+f);return this.m_v2.a=x*B,this.m_v3.a=f*B,this.m_count=2,this.m_v1.Set(this.m_v3),void 0}var S=1/(v+b+w);this.m_v1.a=v*S,this.m_v2.a=b*S,this.m_v3.a=w*S,this.m_count=3},V.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},T.b2SimplexVertex=function(){},T.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},P.b2TimeOfImpact=function(){},P.TimeOfImpact=function(t){++P.b2_toiCalls;var i=t.proxyA,e=t.proxyB,s=t.sweepA,r=t.sweepB;o.b2Assert(s.t0==r.t0),o.b2Assert(1-s.t0>Number.MIN_VALUE);var a=i.m_radius+e.m_radius,l=t.tolerance,h=0,m=1e3,c=0,_=0;for(P.s_cache.count=0,P.s_distanceInput.useRadii=!1;;){if(s.GetTransform(P.s_xfA,h),r.GetTransform(P.s_xfB,h),P.s_distanceInput.proxyA=i,P.s_distanceInput.proxyB=e,P.s_distanceInput.transformA=P.s_xfA,P.s_distanceInput.transformB=P.s_xfB,p.Distance(P.s_distanceOutput,P.s_cache,P.s_distanceInput),0>=P.s_distanceOutput.distance){h=1;break}P.s_fcn.Initialize(P.s_cache,i,P.s_xfA,e,P.s_xfB);var u=P.s_fcn.Evaluate(P.s_xfA,P.s_xfB);if(0>=u){h=1;break}if(c==0&&(_=u>a?n.Max(a-l,.75*a):n.Max(u-l,.02*a)),.5*l>u-_){if(c==0){h=1;break}break}var y=h,d=h,x=1,f=u;s.GetTransform(P.s_xfA,x),r.GetTransform(P.s_xfB,x);var g=P.s_fcn.Evaluate(P.s_xfA,P.s_xfB);if(g>=_){h=1;break}for(var v=0;;){var b=0;b=v&1?d+(_-f)*(x-d)/(g-f):.5*(d+x),s.GetTransform(P.s_xfA,b),r.GetTransform(P.s_xfB,b);var w=P.s_fcn.Evaluate(P.s_xfA,P.s_xfB);if(.025*l>n.Abs(w-_)){y=b;break}if(w>_?(d=b,f=w):(x=b,g=w),++v,++P.b2_toiRootIters,v==50)break}if(P.b2_toiMaxRootIters=n.Max(P.b2_toiMaxRootIters,v),(1+100*Number.MIN_VALUE)*h>y)break;if(h=y,c++,++P.b2_toiIters,c==m)break}return P.b2_toiMaxIters=n.Max(P.b2_toiMaxIters,c),h},$i_19.postDefs.push(function(){$i_19.Collision.b2TimeOfImpact.b2_toiCalls=0,$i_19.Collision.b2TimeOfImpact.b2_toiIters=0,$i_19.Collision.b2TimeOfImpact.b2_toiMaxIters=0,$i_19.Collision.b2TimeOfImpact.b2_toiRootIters=0,$i_19.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,$i_19.Collision.b2TimeOfImpact.s_cache=new V,$i_19.Collision.b2TimeOfImpact.s_distanceInput=new y,$i_19.Collision.b2TimeOfImpact.s_xfA=new r,$i_19.Collision.b2TimeOfImpact.s_xfB=new r,$i_19.Collision.b2TimeOfImpact.s_fcn=new M,$i_19.Collision.b2TimeOfImpact.s_distanceOutput=new d}),L.b2TOIInput=function(){this.proxyA=new x,this.proxyB=new x,this.sweepA=new s,this.sweepB=new s},k.b2WorldManifold=function(){this.m_normal=new a},k.prototype.b2WorldManifold=function(){this.m_points=new Vector(o.b2_maxManifoldPoints);for(var t=0;o.b2_maxManifoldPoints>t;t++)this.m_points[t]=new a},k.prototype.Initialize=function(t,i,e,o,n){if(e===void 0&&(e=0),n===void 0&&(n=0),t.m_pointCount!=0){var s,r,a=0,l=0,h=0,m=0,c=0,_=0,u=0;switch(t.m_type){case w.e_circles:r=i.R,s=t.m_localPoint;var p=i.position.x+r.col1.x*s.x+r.col2.x*s.y,y=i.position.y+r.col1.y*s.x+r.col2.y*s.y;r=o.R,s=t.m_points[0].m_localPoint;var d=o.position.x+r.col1.x*s.x+r.col2.x*s.y,x=o.position.y+r.col1.y*s.x+r.col2.y*s.y,f=d-p,g=x-y,v=f*f+g*g;if(v>Number.MIN_VALUE*Number.MIN_VALUE){var b=Math.sqrt(v);this.m_normal.x=f/b,this.m_normal.y=g/b}else this.m_normal.x=1,this.m_normal.y=0;var D=p+e*this.m_normal.x,C=y+e*this.m_normal.y,B=d-n*this.m_normal.x,S=x-n*this.m_normal.y;this.m_points[0].x=.5*(D+B),this.m_points[0].y=.5*(C+S);break;case w.e_faceA:for(r=i.R,s=t.m_localPlaneNormal,l=r.col1.x*s.x+r.col2.x*s.y,h=r.col1.y*s.x+r.col2.y*s.y,r=i.R,s=t.m_localPoint,m=i.position.x+r.col1.x*s.x+r.col2.x*s.y,c=i.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_normal.x=l,this.m_normal.y=h,a=0;t.m_pointCount>a;a++)r=o.R,s=t.m_points[a].m_localPoint,_=o.position.x+r.col1.x*s.x+r.col2.x*s.y,u=o.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_points[a].x=_+.5*(e-(_-m)*l-(u-c)*h-n)*l,this.m_points[a].y=u+.5*(e-(_-m)*l-(u-c)*h-n)*h;break;case w.e_faceB:for(r=o.R,s=t.m_localPlaneNormal,l=r.col1.x*s.x+r.col2.x*s.y,h=r.col1.y*s.x+r.col2.y*s.y,r=o.R,s=t.m_localPoint,m=o.position.x+r.col1.x*s.x+r.col2.x*s.y,c=o.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_normal.x=-l,this.m_normal.y=-h,a=0;t.m_pointCount>a;a++)r=i.R,s=t.m_points[a].m_localPoint,_=i.position.x+r.col1.x*s.x+r.col2.x*s.y,u=i.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_points[a].x=_+.5*(n-(_-m)*l-(u-c)*h-e)*l,this.m_points[a].y=u+.5*(n-(_-m)*l-(u-c)*h-e)*h}}},R.ClipVertex=function(){this.v=new a,this.id=new _},R.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},G.Features=function(){},Object.defineProperty(G.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(G.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._referenceEdge=t,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}}),Object.defineProperty(G.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(G.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._incidentEdge=t,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}}),Object.defineProperty(G.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(G.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._incidentVertex=t,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}}),Object.defineProperty(G.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(G.prototype,"flip",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._flip=t,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})}(),function(){var t=($i_19.Common.b2Color,$i_19.Common.b2internal,$i_19.Common.b2Settings),i=$i_19.Collision.Shapes.b2CircleShape,e=$i_19.Collision.Shapes.b2EdgeChainDef,o=$i_19.Collision.Shapes.b2EdgeShape,n=$i_19.Collision.Shapes.b2MassData,s=$i_19.Collision.Shapes.b2PolygonShape,r=$i_19.Collision.Shapes.b2Shape,a=$i_19.Common.Math.b2Mat22,l=($i_19.Common.Math.b2Mat33,$i_19.Common.Math.b2Math),h=($i_19.Common.Math.b2Sweep,$i_19.Common.Math.b2Transform),m=$i_19.Common.Math.b2Vec2,c=($i_19.Common.Math.b2Vec3,$i_19.Dynamics.b2Body,$i_19.Dynamics.b2BodyDef,$i_19.Dynamics.b2ContactFilter,$i_19.Dynamics.b2ContactImpulse,$i_19.Dynamics.b2ContactListener,$i_19.Dynamics.b2ContactManager,$i_19.Dynamics.b2DebugDraw,$i_19.Dynamics.b2DestructionListener,$i_19.Dynamics.b2FilterData,$i_19.Dynamics.b2Fixture,$i_19.Dynamics.b2FixtureDef,$i_19.Dynamics.b2Island,$i_19.Dynamics.b2TimeStep,$i_19.Dynamics.b2World,$i_19.Collision.b2AABB,$i_19.Collision.b2Bound,$i_19.Collision.b2BoundValues,$i_19.Collision.b2Collision,$i_19.Collision.b2ContactID,$i_19.Collision.b2ContactPoint,$i_19.Collision.b2Distance),_=$i_19.Collision.b2DistanceInput,u=$i_19.Collision.b2DistanceOutput,p=$i_19.Collision.b2DistanceProxy,y=($i_19.Collision.b2DynamicTree,$i_19.Collision.b2DynamicTreeBroadPhase,$i_19.Collision.b2DynamicTreeNode,$i_19.Collision.b2DynamicTreePair,$i_19.Collision.b2Manifold,$i_19.Collision.b2ManifoldPoint,$i_19.Collision.b2Point,$i_19.Collision.b2RayCastInput,$i_19.Collision.b2RayCastOutput,$i_19.Collision.b2Segment,$i_19.Collision.b2SeparationFunction,$i_19.Collision.b2Simplex,$i_19.Collision.b2SimplexCache);$i_19.Collision.b2SimplexVertex,$i_19.Collision.b2TimeOfImpact,$i_19.Collision.b2TOIInput,$i_19.Collision.b2WorldManifold,$i_19.Collision.ClipVertex,$i_19.Collision.Features,$i_19.Collision.IBroadPhase,$i_19.inherit(i,$i_19.Collision.Shapes.b2Shape),i.prototype.__super=$i_19.Collision.Shapes.b2Shape.prototype,i.b2CircleShape=function(){$i_19.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new m},i.prototype.Copy=function(){var t=new i;return t.Set(this),t},i.prototype.Set=function(t){if(this.__super.Set.call(this,t),$i_19.is(t,i)){var e=t instanceof i?t:null;this.m_p.SetV(e.m_p)}},i.prototype.TestPoint=function(t,i){var e=t.R,o=t.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),n=t.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y);return o=i.x-o,n=i.y-n,this.m_radius*this.m_radius>=o*o+n*n},i.prototype.RayCast=function(t,i,e){var o=e.R,n=e.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),s=e.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y),r=i.p1.x-n,a=i.p1.y-s,l=r*r+a*a-this.m_radius*this.m_radius,h=i.p2.x-i.p1.x,m=i.p2.y-i.p1.y,c=r*h+a*m,_=h*h+m*m,u=c*c-_*l;if(0>u||Number.MIN_VALUE>_)return!1;var p=-(c+Math.sqrt(u));return 0>p||p>i.maxFraction*_?!1:(p/=_,t.fraction=p,t.normal.x=r+p*h,t.normal.y=a+p*m,t.normal.Normalize(),!0)},i.prototype.ComputeAABB=function(t,i){var e=i.R,o=i.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),n=i.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y);t.lowerBound.Set(o-this.m_radius,n-this.m_radius),t.upperBound.Set(o+this.m_radius,n+this.m_radius)},i.prototype.ComputeMass=function(i,e){e===void 0&&(e=0),i.mass=e*t.b2_pi*this.m_radius*this.m_radius,i.center.SetV(this.m_p),i.I=i.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},i.prototype.ComputeSubmergedArea=function(t,i,e,o){i===void 0&&(i=0);var n=l.MulX(e,this.m_p),s=-(l.Dot(t,n)-i);if(-this.m_radius+Number.MIN_VALUE>s)return 0;if(s>this.m_radius)return o.SetV(n),Math.PI*this.m_radius*this.m_radius;var r=this.m_radius*this.m_radius,a=s*s,h=r*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(r-a),m=-2/3*Math.pow(r-a,1.5)/h;return o.x=n.x+t.x*m,o.y=n.y+t.y*m,h},i.prototype.GetLocalPosition=function(){return this.m_p},i.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},i.prototype.GetRadius=function(){return this.m_radius},i.prototype.SetRadius=function(t){t===void 0&&(t=0),this.m_radius=t},i.prototype.b2CircleShape=function(t){t===void 0&&(t=0),this.__super.b2Shape.call(this),this.m_type=r.e_circleShape,this.m_radius=t},e.b2EdgeChainDef=function(){},e.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},$i_19.inherit(o,$i_19.Collision.Shapes.b2Shape),o.prototype.__super=$i_19.Collision.Shapes.b2Shape.prototype,o.b2EdgeShape=function(){$i_19.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new m,this.m_v1=new m,this.m_v2=new m,this.m_coreV1=new m,this.m_coreV2=new m,this.m_normal=new m,this.m_direction=new m,this.m_cornerDir1=new m,this.m_cornerDir2=new m},o.prototype.TestPoint=function(){return!1},o.prototype.RayCast=function(t,i,e){var o,n=i.p2.x-i.p1.x,s=i.p2.y-i.p1.y;o=e.R;var r=e.position.x+(o.col1.x*this.m_v1.x+o.col2.x*this.m_v1.y),a=e.position.y+(o.col1.y*this.m_v1.x+o.col2.y*this.m_v1.y),l=e.position.y+(o.col1.y*this.m_v2.x+o.col2.y*this.m_v2.y)-a,h=-(e.position.x+(o.col1.x*this.m_v2.x+o.col2.x*this.m_v2.y)-r),m=100*Number.MIN_VALUE,c=-(n*l+s*h);if(c>m){var _=i.p1.x-r,u=i.p1.y-a,p=_*l+u*h;if(p>=0&&i.maxFraction*c>=p){var y=-n*u+s*_;if(y>=-m*c&&c*(1+m)>=y){p/=c,t.fraction=p;var d=Math.sqrt(l*l+h*h);return t.normal.x=l/d,t.normal.y=h/d,!0}}}return!1},o.prototype.ComputeAABB=function(t,i){var e=i.R,o=i.position.x+(e.col1.x*this.m_v1.x+e.col2.x*this.m_v1.y),n=i.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),s=i.position.x+(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y),r=i.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y);s>o?(t.lowerBound.x=o,t.upperBound.x=s):(t.lowerBound.x=s,t.upperBound.x=o),r>n?(t.lowerBound.y=n,t.upperBound.y=r):(t.lowerBound.y=r,t.upperBound.y=n)},o.prototype.ComputeMass=function(t,i){i===void 0&&(i=0),t.mass=0,t.center.SetV(this.m_v1),t.I=0},o.prototype.ComputeSubmergedArea=function(t,i,e,o){i===void 0&&(i=0);var n=new m(t.x*i,t.y*i),s=l.MulX(e,this.m_v1),r=l.MulX(e,this.m_v2),a=l.Dot(t,s)-i,h=l.Dot(t,r)-i;if(a>0){if(h>0)return 0;s.x=-h/(a-h)*s.x+a/(a-h)*r.x,s.y=-h/(a-h)*s.y+a/(a-h)*r.y}else h>0&&(r.x=-h/(a-h)*s.x+a/(a-h)*r.x,r.y=-h/(a-h)*s.y+a/(a-h)*r.y);return o.x=(n.x+s.x+r.x)/3,o.y=(n.y+s.y+r.y)/3,.5*((s.x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x))},o.prototype.GetLength=function(){return this.m_length},o.prototype.GetVertex1=function(){return this.m_v1},o.prototype.GetVertex2=function(){return this.m_v2},o.prototype.GetCoreVertex1=function(){return this.m_coreV1},o.prototype.GetCoreVertex2=function(){return this.m_coreV2},o.prototype.GetNormalVector=function(){return this.m_normal},o.prototype.GetDirectionVector=function(){return this.m_direction},o.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},o.prototype.GetCorner2Vector=function(){return this.m_cornerDir2
},o.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},o.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},o.prototype.GetFirstVertex=function(t){var i=t.R;return new m(t.position.x+(i.col1.x*this.m_coreV1.x+i.col2.x*this.m_coreV1.y),t.position.y+(i.col1.y*this.m_coreV1.x+i.col2.y*this.m_coreV1.y))},o.prototype.GetNextEdge=function(){return this.m_nextEdge},o.prototype.GetPrevEdge=function(){return this.m_prevEdge},o.prototype.Support=function(t,i,e){i===void 0&&(i=0),e===void 0&&(e=0);var o=t.R,n=t.position.x+(o.col1.x*this.m_coreV1.x+o.col2.x*this.m_coreV1.y),s=t.position.y+(o.col1.y*this.m_coreV1.x+o.col2.y*this.m_coreV1.y),r=t.position.x+(o.col1.x*this.m_coreV2.x+o.col2.x*this.m_coreV2.y),a=t.position.y+(o.col1.y*this.m_coreV2.x+o.col2.y*this.m_coreV2.y);return n*i+s*e>r*i+a*e?(this.s_supportVec.x=n,this.s_supportVec.y=s):(this.s_supportVec.x=r,this.s_supportVec.y=a),this.s_supportVec},o.prototype.b2EdgeShape=function(i,e){this.__super.b2Shape.call(this),this.m_type=r.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=i,this.m_v2=e,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-t.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-t.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-t.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-t.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},o.prototype.SetPrevEdge=function(t,i,e,o){this.m_prevEdge=t,this.m_coreV1=i,this.m_cornerDir1=e,this.m_cornerConvex1=o},o.prototype.SetNextEdge=function(t,i,e,o){this.m_nextEdge=t,this.m_coreV2=i,this.m_cornerDir2=e,this.m_cornerConvex2=o},n.b2MassData=function(){this.mass=0,this.center=new m(0,0),this.I=0},$i_19.inherit(s,$i_19.Collision.Shapes.b2Shape),s.prototype.__super=$i_19.Collision.Shapes.b2Shape.prototype,s.b2PolygonShape=function(){$i_19.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},s.prototype.Copy=function(){var t=new s;return t.Set(this),t},s.prototype.Set=function(t){if(this.__super.Set.call(this,t),$i_19.is(t,s)){var i=t instanceof s?t:null;this.m_centroid.SetV(i.m_centroid),this.m_vertexCount=i.m_vertexCount,this.Reserve(this.m_vertexCount);for(var e=0;this.m_vertexCount>e;e++)this.m_vertices[e].SetV(i.m_vertices[e]),this.m_normals[e].SetV(i.m_normals[e])}},s.prototype.SetAsArray=function(t,i){i===void 0&&(i=0);var e,o=new Vector,n=0;for(n=0;t.length>n;++n)e=t[n],o.push(e);this.SetAsVector(o,i)},s.AsArray=function(t,i){i===void 0&&(i=0);var e=new s;return e.SetAsArray(t,i),e},s.prototype.SetAsVector=function(i,e){e===void 0&&(e=0),e==0&&(e=i.length),t.b2Assert(e>=2),this.m_vertexCount=e,this.Reserve(e);var o=0;for(o=0;this.m_vertexCount>o;o++)this.m_vertices[o].SetV(i[o]);for(o=0;this.m_vertexCount>o;++o){var n=parseInt(o),r=parseInt(this.m_vertexCount>o+1?o+1:0),a=l.SubtractVV(this.m_vertices[r],this.m_vertices[n]);t.b2Assert(a.LengthSquared()>Number.MIN_VALUE),this.m_normals[o].SetV(l.CrossVF(a,1)),this.m_normals[o].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)},s.AsVector=function(t,i){i===void 0&&(i=0);var e=new s;return e.SetAsVector(t,i),e},s.prototype.SetAsBox=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-i),this.m_vertices[1].Set(t,-i),this.m_vertices[2].Set(t,i),this.m_vertices[3].Set(-t,i),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},s.AsBox=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0);var e=new s;return e.SetAsBox(t,i),e},s.prototype.SetAsOrientedBox=function(t,i,e,o){t===void 0&&(t=0),i===void 0&&(i=0),e===void 0&&(e=null),o===void 0&&(o=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-i),this.m_vertices[1].Set(t,-i),this.m_vertices[2].Set(t,i),this.m_vertices[3].Set(-t,i),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=e;var n=new h;n.position=e,n.R.Set(o);for(var s=0;this.m_vertexCount>s;++s)this.m_vertices[s]=l.MulX(n,this.m_vertices[s]),this.m_normals[s]=l.MulMV(n.R,this.m_normals[s])},s.AsOrientedBox=function(t,i,e,o){t===void 0&&(t=0),i===void 0&&(i=0),e===void 0&&(e=null),o===void 0&&(o=0);var n=new s;return n.SetAsOrientedBox(t,i,e,o),n},s.prototype.SetAsEdge=function(t,i){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(i),this.m_centroid.x=.5*(t.x+i.x),this.m_centroid.y=.5*(t.y+i.y),this.m_normals[0]=l.CrossVF(l.SubtractVV(i,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},s.AsEdge=function(t,i){var e=new s;return e.SetAsEdge(t,i),e},s.prototype.TestPoint=function(t,i){for(var e,o=t.R,n=i.x-t.position.x,s=i.y-t.position.y,r=n*o.col1.x+s*o.col1.y,a=n*o.col2.x+s*o.col2.y,l=0;this.m_vertexCount>l;++l){e=this.m_vertices[l],n=r-e.x,s=a-e.y,e=this.m_normals[l];var h=e.x*n+e.y*s;if(h>0)return!1}return!0},s.prototype.RayCast=function(t,i,e){var o,n,s=0,r=i.maxFraction,a=0,l=0;a=i.p1.x-e.position.x,l=i.p1.y-e.position.y,o=e.R;var h=a*o.col1.x+l*o.col1.y,m=a*o.col2.x+l*o.col2.y;a=i.p2.x-e.position.x,l=i.p2.y-e.position.y,o=e.R;for(var c=a*o.col1.x+l*o.col1.y,_=a*o.col2.x+l*o.col2.y,u=c-h,p=_-m,y=parseInt(-1),d=0;this.m_vertexCount>d;++d){n=this.m_vertices[d],a=n.x-h,l=n.y-m,n=this.m_normals[d];var x=n.x*a+n.y*l,f=n.x*u+n.y*p;if(f==0){if(0>x)return!1}else 0>f&&s*f>x?(s=x/f,y=d):f>0&&r*f>x&&(r=x/f);if(s-Number.MIN_VALUE>r)return!1}return 0>y?!1:(t.fraction=s,o=e.R,n=this.m_normals[y],t.normal.x=o.col1.x*n.x+o.col2.x*n.y,t.normal.y=o.col1.y*n.x+o.col2.y*n.y,!0)},s.prototype.ComputeAABB=function(t,i){for(var e=i.R,o=this.m_vertices[0],n=i.position.x+(e.col1.x*o.x+e.col2.x*o.y),s=i.position.y+(e.col1.y*o.x+e.col2.y*o.y),r=n,a=s,l=1;this.m_vertexCount>l;++l){o=this.m_vertices[l];var h=i.position.x+(e.col1.x*o.x+e.col2.x*o.y),m=i.position.y+(e.col1.y*o.x+e.col2.y*o.y);n=h>n?n:h,s=m>s?s:m,r=r>h?r:h,a=a>m?a:m}t.lowerBound.x=n-this.m_radius,t.lowerBound.y=s-this.m_radius,t.upperBound.x=r+this.m_radius,t.upperBound.y=a+this.m_radius},s.prototype.ComputeMass=function(t,i){if(i===void 0&&(i=0),this.m_vertexCount==2)return t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,t.I=0,void 0;for(var e=0,o=0,n=0,s=0,r=0,a=0,l=1/3,h=0;this.m_vertexCount>h;++h){var m=this.m_vertices[h],c=this.m_vertexCount>h+1?this.m_vertices[parseInt(h+1)]:this.m_vertices[0],_=m.x-r,u=m.y-a,p=c.x-r,y=c.y-a,d=_*y-u*p,x=.5*d;n+=x,e+=x*l*(r+m.x+c.x),o+=x*l*(a+m.y+c.y);var f=r,g=a,v=_,b=u,w=p,D=y,C=l*(.25*(v*v+w*v+w*w)+(f*v+f*w))+.5*f*f,B=l*(.25*(b*b+D*b+D*D)+(g*b+g*D))+.5*g*g;s+=d*(C+B)}t.mass=i*n,e*=1/n,o*=1/n,t.center.Set(e,o),t.I=i*s},s.prototype.ComputeSubmergedArea=function(t,i,e,o){i===void 0&&(i=0);var s=l.MulTMV(e.R,t),r=i-l.Dot(t,e.position),a=new Vector_a2j_Number,h=0,c=parseInt(-1),_=parseInt(-1),u=!1,p=0;for(p=0;this.m_vertexCount>p;++p){a[p]=l.Dot(s,this.m_vertices[p])-r;var y=-Number.MIN_VALUE>a[p];p>0&&(y?u||(c=p-1,h++):u&&(_=p-1,h++)),u=y}switch(h){case 0:if(u){var d=new n;return this.ComputeMass(d,1),o.SetV(l.MulX(e,d.center)),d.mass}return 0;case 1:c==-1?c=this.m_vertexCount-1:_=this.m_vertexCount-1}var x,f=parseInt((c+1)%this.m_vertexCount),g=parseInt((_+1)%this.m_vertexCount),v=(0-a[c])/(a[f]-a[c]),b=(0-a[_])/(a[g]-a[_]),w=new m(this.m_vertices[c].x*(1-v)+this.m_vertices[f].x*v,this.m_vertices[c].y*(1-v)+this.m_vertices[f].y*v),D=new m(this.m_vertices[_].x*(1-b)+this.m_vertices[g].x*b,this.m_vertices[_].y*(1-b)+this.m_vertices[g].y*b),C=0,B=new m,S=this.m_vertices[f];p=f;while(p!=g){p=(p+1)%this.m_vertexCount,x=p==g?D:this.m_vertices[p];var A=.5*((S.x-w.x)*(x.y-w.y)-(S.y-w.y)*(x.x-w.x));C+=A,B.x+=A*(w.x+S.x+x.x)/3,B.y+=A*(w.y+S.y+x.y)/3,S=x}return B.Multiply(1/C),o.SetV(l.MulX(e,B)),C},s.prototype.GetVertexCount=function(){return this.m_vertexCount},s.prototype.GetVertices=function(){return this.m_vertices},s.prototype.GetNormals=function(){return this.m_normals},s.prototype.GetSupport=function(t){for(var i=0,e=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;this.m_vertexCount>o;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>e&&(i=o,e=n)}return i},s.prototype.GetSupportVertex=function(t){for(var i=0,e=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;this.m_vertexCount>o;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>e&&(i=o,e=n)}return this.m_vertices[i]},s.prototype.Validate=function(){return!1},s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=r.e_polygonShape,this.m_centroid=new m,this.m_vertices=new Vector,this.m_normals=new Vector},s.prototype.Reserve=function(t){t===void 0&&(t=0);for(var i=parseInt(this.m_vertices.length);t>i;i++)this.m_vertices[i]=new m,this.m_normals[i]=new m},s.ComputeCentroid=function(t,i){i===void 0&&(i=0);for(var e=new m,o=0,n=0,s=0,r=1/3,a=0;i>a;++a){var l=t[a],h=i>a+1?t[parseInt(a+1)]:t[0],c=l.x-n,_=l.y-s,u=h.x-n,p=h.y-s,y=c*p-_*u,d=.5*y;o+=d,e.x+=d*r*(n+l.x+h.x),e.y+=d*r*(s+l.y+h.y)}return e.x*=1/o,e.y*=1/o,e},s.ComputeOBB=function(t,i,e){e===void 0&&(e=0);var o=0,n=new Vector(e+1);for(o=0;e>o;++o)n[o]=i[o];n[e]=n[0];var s=Number.MAX_VALUE;for(o=1;e>=o;++o){var r=n[parseInt(o-1)],a=n[o].x-r.x,l=n[o].y-r.y,h=Math.sqrt(a*a+l*l);a/=h,l/=h;for(var m=-l,c=a,_=Number.MAX_VALUE,u=Number.MAX_VALUE,p=-Number.MAX_VALUE,y=-Number.MAX_VALUE,d=0;e>d;++d){var x=n[d].x-r.x,f=n[d].y-r.y,g=a*x+l*f,v=m*x+c*f;_>g&&(_=g),u>v&&(u=v),g>p&&(p=g),v>y&&(y=v)}var b=(p-_)*(y-u);if(.95*s>b){s=b,t.R.col1.x=a,t.R.col1.y=l,t.R.col2.x=m,t.R.col2.y=c;var w=.5*(_+p),D=.5*(u+y),C=t.R;t.center.x=r.x+(C.col1.x*w+C.col2.x*D),t.center.y=r.y+(C.col1.y*w+C.col2.y*D),t.extents.x=.5*(p-_),t.extents.y=.5*(y-u)}}},$i_19.postDefs.push(function(){$i_19.Collision.Shapes.b2PolygonShape.s_mat=new a}),r.b2Shape=function(){},r.prototype.Copy=function(){return null},r.prototype.Set=function(t){this.m_radius=t.m_radius},r.prototype.GetType=function(){return this.m_type},r.prototype.TestPoint=function(){return!1},r.prototype.RayCast=function(){return!1},r.prototype.ComputeAABB=function(){},r.prototype.ComputeMass=function(t,i){i===void 0&&(i=0)},r.prototype.ComputeSubmergedArea=function(t,i){return i===void 0&&(i=0),0},r.TestOverlap=function(t,i,e,o){var n=new _;n.proxyA=new p,n.proxyA.Set(t),n.proxyB=new p,n.proxyB.Set(e),n.transformA=i,n.transformB=o,n.useRadii=!0;var s=new y;s.count=0;var r=new u;return c.Distance(r,s,n),10*Number.MIN_VALUE>r.distance},r.prototype.b2Shape=function(){this.m_type=r.e_unknownShape,this.m_radius=t.b2_linearSlop},$i_19.postDefs.push(function(){$i_19.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),$i_19.Collision.Shapes.b2Shape.e_circleShape=0,$i_19.Collision.Shapes.b2Shape.e_polygonShape=1,$i_19.Collision.Shapes.b2Shape.e_edgeShape=2,$i_19.Collision.Shapes.b2Shape.e_shapeTypeCount=3,$i_19.Collision.Shapes.b2Shape.e_hitCollide=1,$i_19.Collision.Shapes.b2Shape.e_missCollide=0,$i_19.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var t=$i_19.Common.b2Color,i=($i_19.Common.b2internal,$i_19.Common.b2Settings),e=($i_19.Common.Math.b2Mat22,$i_19.Common.Math.b2Mat33,$i_19.Common.Math.b2Math);$i_19.Common.Math.b2Sweep,$i_19.Common.Math.b2Transform,$i_19.Common.Math.b2Vec2,$i_19.Common.Math.b2Vec3,t.b2Color=function(){this._r=0,this._g=0,this._b=0},t.prototype.b2Color=function(t,i,o){t===void 0&&(t=0),i===void 0&&(i=0),o===void 0&&(o=0),this._r=$i_19.parseUInt(255*e.Clamp(t,0,1)),this._g=$i_19.parseUInt(255*e.Clamp(i,0,1)),this._b=$i_19.parseUInt(255*e.Clamp(o,0,1))},t.prototype.Set=function(t,i,o){t===void 0&&(t=0),i===void 0&&(i=0),o===void 0&&(o=0),this._r=$i_19.parseUInt(255*e.Clamp(t,0,1)),this._g=$i_19.parseUInt(255*e.Clamp(i,0,1)),this._b=$i_19.parseUInt(255*e.Clamp(o,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._r=$i_19.parseUInt(255*e.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._g=$i_19.parseUInt(255*e.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._b=$i_19.parseUInt(255*e.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),i.b2Settings=function(){},i.b2MixFriction=function(t,i){return t===void 0&&(t=0),i===void 0&&(i=0),Math.sqrt(t*i)},i.b2MixRestitution=function(t,i){return t===void 0&&(t=0),i===void 0&&(i=0),t>i?t:i},i.b2Assert=function(t){if(!t)throw"Assertion Failed"},$i_19.postDefs.push(function(){$i_19.Common.b2Settings.VERSION="2.1alpha",$i_19.Common.b2Settings.USHRT_MAX=65535,$i_19.Common.b2Settings.b2_pi=Math.PI,$i_19.Common.b2Settings.b2_maxManifoldPoints=2,$i_19.Common.b2Settings.b2_aabbExtension=.1,$i_19.Common.b2Settings.b2_aabbMultiplier=2,$i_19.Common.b2Settings.b2_polygonRadius=2*i.b2_linearSlop,$i_19.Common.b2Settings.b2_linearSlop=.005,$i_19.Common.b2Settings.b2_angularSlop=2/180*i.b2_pi,$i_19.Common.b2Settings.b2_toiSlop=8*i.b2_linearSlop,$i_19.Common.b2Settings.b2_maxTOIContactsPerIsland=32,$i_19.Common.b2Settings.b2_maxTOIJointsPerIsland=32,$i_19.Common.b2Settings.b2_velocityThreshold=1,$i_19.Common.b2Settings.b2_maxLinearCorrection=.2,$i_19.Common.b2Settings.b2_maxAngularCorrection=8/180*i.b2_pi,$i_19.Common.b2Settings.b2_maxTranslation=2,$i_19.Common.b2Settings.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation,$i_19.Common.b2Settings.b2_maxRotation=.5*i.b2_pi,$i_19.Common.b2Settings.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation,$i_19.Common.b2Settings.b2_contactBaumgarte=.2,$i_19.Common.b2Settings.b2_timeToSleep=.5,$i_19.Common.b2Settings.b2_linearSleepTolerance=.01,$i_19.Common.b2Settings.b2_angularSleepTolerance=2/180*i.b2_pi})}(),function(){var t=($i_19.Collision.b2AABB,$i_19.Common.b2Color,$i_19.Common.b2internal,$i_19.Common.b2Settings,$i_19.Common.Math.b2Mat22),i=$i_19.Common.Math.b2Mat33,e=$i_19.Common.Math.b2Math,o=$i_19.Common.Math.b2Sweep,n=$i_19.Common.Math.b2Transform,s=$i_19.Common.Math.b2Vec2,r=$i_19.Common.Math.b2Vec3;t.b2Mat22=function(){this.col1=new s,this.col2=new s},t.prototype.b2Mat22=function(){this.SetIdentity()},t.FromAngle=function(i){i===void 0&&(i=0);var e=new t;return e.Set(i),e},t.FromVV=function(i,e){var o=new t;return o.SetVV(i,e),o},t.prototype.Set=function(t){t===void 0&&(t=0);var i=Math.cos(t),e=Math.sin(t);this.col1.x=i,this.col2.x=-e,this.col1.y=e,this.col2.y=i},t.prototype.SetVV=function(t,i){this.col1.SetV(t),this.col2.SetV(i)},t.prototype.Copy=function(){var i=new t;return i.SetM(this),i},t.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},t.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},t.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},t.prototype.GetInverse=function(t){var i=this.col1.x,e=this.col2.x,o=this.col1.y,n=this.col2.y,s=i*n-e*o;return s!=0&&(s=1/s),t.col1.x=s*n,t.col2.x=-s*e,t.col1.y=-s*o,t.col2.y=s*i,t},t.prototype.Solve=function(t,i,e){i===void 0&&(i=0),e===void 0&&(e=0);var o=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=o*r-n*s;return a!=0&&(a=1/a),t.x=a*(r*i-n*e),t.y=a*(o*e-s*i),t},t.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},i.b2Mat33=function(){this.col1=new r,this.col2=new r,this.col3=new r},i.prototype.b2Mat33=function(t,i,e){t===void 0&&(t=null),i===void 0&&(i=null),e===void 0&&(e=null),t||i||e?(this.col1.SetV(t),this.col2.SetV(i),this.col3.SetV(e)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},i.prototype.SetVVV=function(t,i,e){this.col1.SetV(t),this.col2.SetV(i),this.col3.SetV(e)},i.prototype.Copy=function(){return new i(this.col1,this.col2,this.col3)},i.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},i.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},i.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},i.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},i.prototype.Solve22=function(t,i,e){i===void 0&&(i=0),e===void 0&&(e=0);var o=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=o*r-n*s;return a!=0&&(a=1/a),t.x=a*(r*i-n*e),t.y=a*(o*e-s*i),t},i.prototype.Solve33=function(t,i,e,o){i===void 0&&(i=0),e===void 0&&(e=0),o===void 0&&(o=0);var n=this.col1.x,s=this.col1.y,r=this.col1.z,a=this.col2.x,l=this.col2.y,h=this.col2.z,m=this.col3.x,c=this.col3.y,_=this.col3.z,u=n*(l*_-h*c)+s*(h*m-a*_)+r*(a*c-l*m);return u!=0&&(u=1/u),t.x=u*(i*(l*_-h*c)+e*(h*m-a*_)+o*(a*c-l*m)),t.y=u*(n*(e*_-o*c)+s*(o*m-i*_)+r*(i*c-e*m)),t.z=u*(n*(l*o-h*e)+s*(h*i-a*o)+r*(a*e-l*i)),t},e.b2Math=function(){},e.IsValid=function(t){return t===void 0&&(t=0),isFinite(t)},e.Dot=function(t,i){return t.x*i.x+t.y*i.y},e.CrossVV=function(t,i){return t.x*i.y-t.y*i.x},e.CrossVF=function(t,i){i===void 0&&(i=0);var e=new s(i*t.y,-i*t.x);return e},e.CrossFV=function(t,i){t===void 0&&(t=0);var e=new s(-t*i.y,t*i.x);return e},e.MulMV=function(t,i){var e=new s(t.col1.x*i.x+t.col2.x*i.y,t.col1.y*i.x+t.col2.y*i.y);return e},e.MulTMV=function(t,i){var o=new s(e.Dot(i,t.col1),e.Dot(i,t.col2));return o},e.MulX=function(t,i){var o=e.MulMV(t.R,i);return o.x+=t.position.x,o.y+=t.position.y,o},e.MulXT=function(t,i){var o=e.SubtractVV(i,t.position),n=o.x*t.R.col1.x+o.y*t.R.col1.y;return o.y=o.x*t.R.col2.x+o.y*t.R.col2.y,o.x=n,o},e.AddVV=function(t,i){var e=new s(t.x+i.x,t.y+i.y);return e},e.SubtractVV=function(t,i){var e=new s(t.x-i.x,t.y-i.y);return e},e.Distance=function(t,i){var e=t.x-i.x,o=t.y-i.y;return Math.sqrt(e*e+o*o)},e.DistanceSquared=function(t,i){var e=t.x-i.x,o=t.y-i.y;return e*e+o*o},e.MulFV=function(t,i){t===void 0&&(t=0);var e=new s(t*i.x,t*i.y);return e},e.AddMM=function(i,o){var n=t.FromVV(e.AddVV(i.col1,o.col1),e.AddVV(i.col2,o.col2));return n},e.MulMM=function(i,o){var n=t.FromVV(e.MulMV(i,o.col1),e.MulMV(i,o.col2));return n},e.MulTMM=function(i,o){var n=new s(e.Dot(i.col1,o.col1),e.Dot(i.col2,o.col1)),r=new s(e.Dot(i.col1,o.col2),e.Dot(i.col2,o.col2)),a=t.FromVV(n,r);return a},e.Abs=function(t){return t===void 0&&(t=0),t>0?t:-t},e.AbsV=function(t){var i=new s(e.Abs(t.x),e.Abs(t.y));return i},e.AbsM=function(i){var o=t.FromVV(e.AbsV(i.col1),e.AbsV(i.col2));return o},e.Min=function(t,i){return t===void 0&&(t=0),i===void 0&&(i=0),i>t?t:i},e.MinV=function(t,i){var o=new s(e.Min(t.x,i.x),e.Min(t.y,i.y));return o},e.Max=function(t,i){return t===void 0&&(t=0),i===void 0&&(i=0),t>i?t:i},e.MaxV=function(t,i){var o=new s(e.Max(t.x,i.x),e.Max(t.y,i.y));return o},e.Clamp=function(t,i,e){return t===void 0&&(t=0),i===void 0&&(i=0),e===void 0&&(e=0),i>t?i:t>e?e:t},e.ClampV=function(t,i,o){return e.MaxV(i,e.MinV(t,o))},e.Swap=function(t,i){var e=t[0];t[0]=i[0],i[0]=e},e.Random=function(){return Math.random()*2-1},e.RandomRange=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0);var e=Math.random();return e=(i-t)*e+t},e.NextPowerOfTwo=function(t){return t===void 0&&(t=0),t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,t|=t>>16&65535,t+1},e.IsPowerOfTwo=function(t){t===void 0&&(t=0);var i=t>0&&(t&t-1)==0;return i},$i_19.postDefs.push(function(){$i_19.Common.Math.b2Math.b2Vec2_zero=new s(0,0),$i_19.Common.Math.b2Math.b2Mat22_identity=t.FromVV(new s(1,0),new s(0,1)),$i_19.Common.Math.b2Math.b2Transform_identity=new n(e.b2Vec2_zero,e.b2Mat22_identity)}),o.b2Sweep=function(){this.localCenter=new s,this.c0=new s,this.c=new s},o.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},o.prototype.Copy=function(){var t=new o;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},o.prototype.GetTransform=function(t,i){i===void 0&&(i=0),t.position.x=(1-i)*this.c0.x+i*this.c.x,t.position.y=(1-i)*this.c0.y+i*this.c.y;var e=(1-i)*this.a0+i*this.a;t.R.Set(e);var o=t.R;t.position.x-=o.col1.x*this.localCenter.x+o.col2.x*this.localCenter.y,t.position.y-=o.col1.y*this.localCenter.x+o.col2.y*this.localCenter.y},o.prototype.Advance=function(t){if(t===void 0&&(t=0),t>this.t0&&1-this.t0>Number.MIN_VALUE){var i=(t-this.t0)/(1-this.t0);this.c0.x=(1-i)*this.c0.x+i*this.c.x,this.c0.y=(1-i)*this.c0.y+i*this.c.y,this.a0=(1-i)*this.a0+i*this.a,this.t0=t}},n.b2Transform=function(){this.position=new s,this.R=new t},n.prototype.b2Transform=function(t,i){t===void 0&&(t=null),i===void 0&&(i=null),t&&(this.position.SetV(t),this.R.SetM(i))},n.prototype.Initialize=function(t,i){this.position.SetV(t),this.R.SetM(i)},n.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},n.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},n.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},s.b2Vec2=function(){},s.prototype.b2Vec2=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.x=t,this.y=i},s.prototype.SetZero=function(){this.x=0,this.y=0},s.prototype.Set=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.x=t,this.y=i},s.prototype.SetV=function(t){this.x=t.x,this.y=t.y},s.prototype.GetNegative=function(){return new s(-this.x,-this.y)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},s.Make=function(t,i){return t===void 0&&(t=0),i===void 0&&(i=0),new s(t,i)},s.prototype.Copy=function(){return new s(this.x,this.y)},s.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},s.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},s.prototype.Multiply=function(t){t===void 0&&(t=0),this.x*=t,this.y*=t},s.prototype.MulM=function(t){var i=this.x;this.x=t.col1.x*i+t.col2.x*this.y,this.y=t.col1.y*i+t.col2.y*this.y},s.prototype.MulTM=function(t){var i=e.Dot(this,t.col1);this.y=e.Dot(this,t.col2),this.x=i},s.prototype.CrossVF=function(t){t===void 0&&(t=0);var i=this.x;this.x=t*this.y,this.y=-t*i},s.prototype.CrossFV=function(t){t===void 0&&(t=0);var i=this.x;this.x=-t*this.y,this.y=t*i},s.prototype.MinV=function(t){this.x=t.x>this.x?this.x:t.x,this.y=t.y>this.y?this.y:t.y},s.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x,this.y=this.y>t.y?this.y:t.y},s.prototype.Abs=function(){0>this.x&&(this.x=-this.x),0>this.y&&(this.y=-this.y)},s.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},s.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(Number.MIN_VALUE>t)return 0;var i=1/t;return this.x*=i,this.y*=i,t},s.prototype.IsValid=function(){return e.IsValid(this.x)&&e.IsValid(this.y)},r.b2Vec3=function(){},r.prototype.b2Vec3=function(t,i,e){t===void 0&&(t=0),i===void 0&&(i=0),e===void 0&&(e=0),this.x=t,this.y=i,this.z=e},r.prototype.SetZero=function(){this.x=this.y=this.z=0},r.prototype.Set=function(t,i,e){t===void 0&&(t=0),i===void 0&&(i=0),e===void 0&&(e=0),this.x=t,this.y=i,this.z=e},r.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},r.prototype.GetNegative=function(){return new r(-this.x,-this.y,-this.z)},r.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},r.prototype.Copy=function(){return new r(this.x,this.y,this.z)},r.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},r.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},r.prototype.Multiply=function(t){t===void 0&&(t=0),this.x*=t,this.y*=t,this.z*=t}}(),function(){var t=($i_19.Dynamics.Controllers.b2ControllerEdge,$i_19.Common.Math.b2Mat22,$i_19.Common.Math.b2Mat33,$i_19.Common.Math.b2Math),i=$i_19.Common.Math.b2Sweep,e=$i_19.Common.Math.b2Transform,o=$i_19.Common.Math.b2Vec2,n=($i_19.Common.Math.b2Vec3,$i_19.Common.b2Color),s=($i_19.Common.b2internal,$i_19.Common.b2Settings),r=$i_19.Collision.b2AABB,a=($i_19.Collision.b2Bound,$i_19.Collision.b2BoundValues,$i_19.Collision.b2Collision,$i_19.Collision.b2ContactID,$i_19.Collision.b2ContactPoint),l=($i_19.Collision.b2Distance,$i_19.Collision.b2DistanceInput,$i_19.Collision.b2DistanceOutput,$i_19.Collision.b2DistanceProxy,$i_19.Collision.b2DynamicTree,$i_19.Collision.b2DynamicTreeBroadPhase),h=($i_19.Collision.b2DynamicTreeNode,$i_19.Collision.b2DynamicTreePair,$i_19.Collision.b2Manifold,$i_19.Collision.b2ManifoldPoint,$i_19.Collision.b2Point,$i_19.Collision.b2RayCastInput),m=$i_19.Collision.b2RayCastOutput,c=($i_19.Collision.b2Segment,$i_19.Collision.b2SeparationFunction,$i_19.Collision.b2Simplex,$i_19.Collision.b2SimplexCache,$i_19.Collision.b2SimplexVertex,$i_19.Collision.b2TimeOfImpact,$i_19.Collision.b2TOIInput,$i_19.Collision.b2WorldManifold,$i_19.Collision.ClipVertex,$i_19.Collision.Features,$i_19.Collision.IBroadPhase,$i_19.Collision.Shapes.b2CircleShape),_=($i_19.Collision.Shapes.b2EdgeChainDef,$i_19.Collision.Shapes.b2EdgeShape),u=$i_19.Collision.Shapes.b2MassData,p=$i_19.Collision.Shapes.b2PolygonShape,y=$i_19.Collision.Shapes.b2Shape,d=$i_19.Dynamics.b2Body,x=$i_19.Dynamics.b2BodyDef,f=$i_19.Dynamics.b2ContactFilter,g=$i_19.Dynamics.b2ContactImpulse,v=$i_19.Dynamics.b2ContactListener,b=$i_19.Dynamics.b2ContactManager,w=$i_19.Dynamics.b2DebugDraw,D=$i_19.Dynamics.b2DestructionListener,C=$i_19.Dynamics.b2FilterData,B=$i_19.Dynamics.b2Fixture,S=$i_19.Dynamics.b2FixtureDef,A=$i_19.Dynamics.b2Island,M=$i_19.Dynamics.b2TimeStep,I=$i_19.Dynamics.b2World,V=($i_19.Dynamics.Contacts.b2CircleContact,$i_19.Dynamics.Contacts.b2Contact),T=($i_19.Dynamics.Contacts.b2ContactConstraint,$i_19.Dynamics.Contacts.b2ContactConstraintPoint,$i_19.Dynamics.Contacts.b2ContactEdge,$i_19.Dynamics.Contacts.b2ContactFactory),P=($i_19.Dynamics.Contacts.b2ContactRegister,$i_19.Dynamics.Contacts.b2ContactResult,$i_19.Dynamics.Contacts.b2ContactSolver),L=($i_19.Dynamics.Contacts.b2EdgeAndCircleContact,$i_19.Dynamics.Contacts.b2NullContact,$i_19.Dynamics.Contacts.b2PolyAndCircleContact,$i_19.Dynamics.Contacts.b2PolyAndEdgeContact,$i_19.Dynamics.Contacts.b2PolygonContact,$i_19.Dynamics.Contacts.b2PositionSolverManifold,$i_19.Dynamics.Controllers.b2Controller,$i_19.Dynamics.Joints.b2DistanceJoint,$i_19.Dynamics.Joints.b2DistanceJointDef,$i_19.Dynamics.Joints.b2FrictionJoint,$i_19.Dynamics.Joints.b2FrictionJointDef,$i_19.Dynamics.Joints.b2GearJoint,$i_19.Dynamics.Joints.b2GearJointDef,$i_19.Dynamics.Joints.b2Jacobian,$i_19.Dynamics.Joints.b2Joint),k=($i_19.Dynamics.Joints.b2JointDef,$i_19.Dynamics.Joints.b2JointEdge,$i_19.Dynamics.Joints.b2LineJoint,$i_19.Dynamics.Joints.b2LineJointDef,$i_19.Dynamics.Joints.b2MouseJoint,$i_19.Dynamics.Joints.b2MouseJointDef,$i_19.Dynamics.Joints.b2PrismaticJoint,$i_19.Dynamics.Joints.b2PrismaticJointDef,$i_19.Dynamics.Joints.b2PulleyJoint);$i_19.Dynamics.Joints.b2PulleyJointDef,$i_19.Dynamics.Joints.b2RevoluteJoint,$i_19.Dynamics.Joints.b2RevoluteJointDef,$i_19.Dynamics.Joints.b2WeldJoint,$i_19.Dynamics.Joints.b2WeldJointDef,d.b2Body=function(){this.m_xf=new e,this.m_sweep=new i,this.m_linearVelocity=new o,this.m_force=new o},d.prototype.connectEdges=function(i,e,o){o===void 0&&(o=0);var n=Math.atan2(e.GetDirectionVector().y,e.GetDirectionVector().x),r=Math.tan((n-o)*.5),a=t.MulFV(r,e.GetDirectionVector());a=t.SubtractVV(a,e.GetNormalVector()),a=t.MulFV(s.b2_toiSlop,a),a=t.AddVV(a,e.GetVertex1());var l=t.AddVV(i.GetDirectionVector(),e.GetDirectionVector());l.Normalize();var h=t.Dot(i.GetDirectionVector(),e.GetNormalVector())>0;return i.SetNextEdge(e,a,l,h),e.SetPrevEdge(i,a,l,h),n},d.prototype.CreateFixture=function(t){if(this.m_world.IsLocked()==1)return null;var i=new B;if(i.Create(this,this.m_xf,t),this.m_flags&d.e_activeFlag){var e=this.m_world.m_contactManager.m_broadPhase;i.CreateProxy(e,this.m_xf)}return i.m_next=this.m_fixtureList,this.m_fixtureList=i,++this.m_fixtureCount,i.m_body=this,i.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=I.e_newFixture,i},d.prototype.CreateFixture2=function(t,i){i===void 0&&(i=0);var e=new S;return e.shape=t,e.density=i,this.CreateFixture(e)},d.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked()!=1){var i=this.m_fixtureList,e=null,o=!1;while(i!=null){if(i==t){e?e.m_next=t.m_next:this.m_fixtureList=t.m_next,o=!0;break}e=i,i=i.m_next}var n=this.m_contactList;while(n){var s=n.contact;n=n.next;var r=s.GetFixtureA(),a=s.GetFixtureB();(t==r||t==a)&&this.m_world.m_contactManager.Destroy(s)}if(this.m_flags&d.e_activeFlag){var l=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(l)}t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},d.prototype.SetPositionAndAngle=function(t,i){i===void 0&&(i=0);var e;if(this.m_world.IsLocked()!=1){this.m_xf.R.Set(i),this.m_xf.position.SetV(t);var o=this.m_xf.R,n=this.m_sweep.localCenter;this.m_sweep.c.x=o.col1.x*n.x+o.col2.x*n.y,this.m_sweep.c.y=o.col1.y*n.x+o.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=i;var s=this.m_world.m_contactManager.m_broadPhase;for(e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},d.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},d.prototype.GetTransform=function(){return this.m_xf},d.prototype.GetPosition=function(){return this.m_xf.position},d.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},d.prototype.GetAngle=function(){return this.m_sweep.a},d.prototype.SetAngle=function(t){t===void 0&&(t=0),this.SetPositionAndAngle(this.GetPosition(),t)},d.prototype.GetWorldCenter=function(){return this.m_sweep.c},d.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},d.prototype.SetLinearVelocity=function(t){this.m_type!=d.b2_staticBody&&this.m_linearVelocity.SetV(t)},d.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},d.prototype.SetAngularVelocity=function(t){t===void 0&&(t=0),this.m_type!=d.b2_staticBody&&(this.m_angularVelocity=t)},d.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},d.prototype.GetDefinition=function(){var t=new x;return t.type=this.GetType(),t.allowSleep=(this.m_flags&d.e_allowSleepFlag)==d.e_allowSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&d.e_fixedRotationFlag)==d.e_fixedRotationFlag,t.bullet=(this.m_flags&d.e_bulletFlag)==d.e_bulletFlag,t.awake=(this.m_flags&d.e_awakeFlag)==d.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t.userData=this.GetUserData(),t},d.prototype.ApplyForce=function(t,i){this.m_type==d.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x)},d.prototype.ApplyTorque=function(t){t===void 0&&(t=0),this.m_type==d.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=t)},d.prototype.ApplyImpulse=function(t,i){this.m_type==d.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x))
},d.prototype.Split=function(i){for(var e,o=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),s=this.GetWorldCenter(),r=this,a=this.m_world.CreateBody(this.GetDefinition()),l=r.m_fixtureList;l;)if(i(l)){var h=l.m_next;e?e.m_next=h:r.m_fixtureList=h,r.m_fixtureCount--,l.m_next=a.m_fixtureList,a.m_fixtureList=l,a.m_fixtureCount++,l.m_body=a,l=h}else e=l,l=l.m_next;r.ResetMassData(),a.ResetMassData();var m=r.GetWorldCenter(),c=a.GetWorldCenter(),_=t.AddVV(o,t.CrossFV(n,t.SubtractVV(m,s))),u=t.AddVV(o,t.CrossFV(n,t.SubtractVV(c,s)));return r.SetLinearVelocity(_),a.SetLinearVelocity(u),r.SetAngularVelocity(n),a.SetAngularVelocity(n),r.SynchronizeFixtures(),a.SynchronizeFixtures(),a},d.prototype.Merge=function(t){var i;for(i=t.m_fixtureList;i;){var e=i.m_next;t.m_fixtureCount--,i.m_next=this.m_fixtureList,this.m_fixtureList=i,this.m_fixtureCount++,i.m_body=n,i=e}o.m_fixtureCount=0;var o=this,n=t;o.GetWorldCenter(),n.GetWorldCenter(),o.GetLinearVelocity().Copy(),n.GetLinearVelocity().Copy(),o.GetAngularVelocity(),n.GetAngularVelocity(),o.ResetMassData(),this.SynchronizeFixtures()},d.prototype.GetMass=function(){return this.m_mass},d.prototype.GetInertia=function(){return this.m_I},d.prototype.GetMassData=function(t){t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter)},d.prototype.SetMassData=function(i){if(s.b2Assert(this.m_world.IsLocked()==0),this.m_world.IsLocked()!=1&&this.m_type==d.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=i.mass,this.m_mass>0||(this.m_mass=1),this.m_invMass=1/this.m_mass,i.I>0&&(this.m_flags&d.e_fixedRotationFlag)==0&&(this.m_I=i.I-this.m_mass*(i.center.x*i.center.x+i.center.y*i.center.y),this.m_invI=1/this.m_I);var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(i.center),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)}},d.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=d.b2_staticBody&&this.m_type!=d.b2_kinematicBody){for(var i=o.Make(0,0),e=this.m_fixtureList;e;e=e.m_next)if(e.m_density!=0){var n=e.GetMassData();this.m_mass+=n.mass,i.x+=n.center.x*n.mass,i.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,i.x*=this.m_invMass,i.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&(this.m_flags&d.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(i.x*i.x+i.y*i.y),this.m_I*=this.m_inertiaScale,s.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(i),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)}},d.prototype.GetWorldPoint=function(t){var i=this.m_xf.R,e=new o(i.col1.x*t.x+i.col2.x*t.y,i.col1.y*t.x+i.col2.y*t.y);return e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,e},d.prototype.GetWorldVector=function(i){return t.MulMV(this.m_xf.R,i)},d.prototype.GetLocalPoint=function(i){return t.MulXT(this.m_xf,i)},d.prototype.GetLocalVector=function(i){return t.MulTMV(this.m_xf.R,i)},d.prototype.GetLinearVelocityFromWorldPoint=function(t){return new o(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},d.prototype.GetLinearVelocityFromLocalPoint=function(t){var i=this.m_xf.R,e=new o(i.col1.x*t.x+i.col2.x*t.y,i.col1.y*t.x+i.col2.y*t.y);return e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,new o(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},d.prototype.GetLinearDamping=function(){return this.m_linearDamping},d.prototype.SetLinearDamping=function(t){t===void 0&&(t=0),this.m_linearDamping=t},d.prototype.GetAngularDamping=function(){return this.m_angularDamping},d.prototype.SetAngularDamping=function(t){t===void 0&&(t=0),this.m_angularDamping=t},d.prototype.SetType=function(t){if(t===void 0&&(t=0),this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==d.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var i=this.m_contactList;i;i=i.next)i.contact.FlagForFiltering()}},d.prototype.GetType=function(){return this.m_type},d.prototype.SetBullet=function(t){t?this.m_flags|=d.e_bulletFlag:this.m_flags&=~d.e_bulletFlag},d.prototype.IsBullet=function(){return(this.m_flags&d.e_bulletFlag)==d.e_bulletFlag},d.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=d.e_allowSleepFlag:(this.m_flags&=~d.e_allowSleepFlag,this.SetAwake(!0))},d.prototype.SetAwake=function(t){t?(this.m_flags|=d.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~d.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},d.prototype.IsAwake=function(){return(this.m_flags&d.e_awakeFlag)==d.e_awakeFlag},d.prototype.SetFixedRotation=function(t){t?this.m_flags|=d.e_fixedRotationFlag:this.m_flags&=~d.e_fixedRotationFlag,this.ResetMassData()},d.prototype.IsFixedRotation=function(){return(this.m_flags&d.e_fixedRotationFlag)==d.e_fixedRotationFlag},d.prototype.SetActive=function(t){if(t!=this.IsActive()){var i,e;if(t)for(this.m_flags|=d.e_activeFlag,i=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.CreateProxy(i,this.m_xf);else{for(this.m_flags&=~d.e_activeFlag,i=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxy(i);var o=this.m_contactList;while(o){var n=o;o=o.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}},d.prototype.IsActive=function(){return(this.m_flags&d.e_activeFlag)==d.e_activeFlag},d.prototype.IsSleepingAllowed=function(){return(this.m_flags&d.e_allowSleepFlag)==d.e_allowSleepFlag},d.prototype.GetFixtureList=function(){return this.m_fixtureList},d.prototype.GetJointList=function(){return this.m_jointList},d.prototype.GetControllerList=function(){return this.m_controllerList},d.prototype.GetContactList=function(){return this.m_contactList},d.prototype.GetNext=function(){return this.m_next},d.prototype.GetUserData=function(){return this.m_userData},d.prototype.SetUserData=function(t){this.m_userData=t},d.prototype.GetWorld=function(){return this.m_world},d.prototype.b2Body=function(t,i){this.m_flags=0,t.bullet&&(this.m_flags|=d.e_bulletFlag),t.fixedRotation&&(this.m_flags|=d.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=d.e_allowSleepFlag),t.awake&&(this.m_flags|=d.e_awakeFlag),t.active&&(this.m_flags|=d.e_activeFlag),this.m_world=i,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle;var e=this.m_xf.R,o=this.m_sweep.localCenter;this.m_sweep.c.x=e.col1.x*o.x+e.col2.x*o.y,this.m_sweep.c.y=e.col1.y*o.x+e.col2.y*o.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,this.m_type==d.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=t.inertiaScale,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0},d.prototype.SynchronizeFixtures=function(){var t=d.s_xf1;t.R.Set(this.m_sweep.a0);var i=t.R,e=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(i.col1.x*e.x+i.col2.x*e.y),t.position.y=this.m_sweep.c0.y-(i.col1.y*e.x+i.col2.y*e.y);var o,n=this.m_world.m_contactManager.m_broadPhase;for(o=this.m_fixtureList;o;o=o.m_next)o.Synchronize(n,t,this.m_xf)},d.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,i=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*i.x+t.col2.x*i.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*i.x+t.col2.y*i.y)},d.prototype.ShouldCollide=function(t){if(this.m_type!=d.b2_dynamicBody&&t.m_type!=d.b2_dynamicBody)return!1;for(var i=this.m_jointList;i;i=i.next)if(i.other==t&&i.joint.m_collideConnected==0)return!1;return!0},d.prototype.Advance=function(t){t===void 0&&(t=0),this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},$i_19.postDefs.push(function(){$i_19.Dynamics.b2Body.s_xf1=new e,$i_19.Dynamics.b2Body.e_islandFlag=1,$i_19.Dynamics.b2Body.e_awakeFlag=2,$i_19.Dynamics.b2Body.e_allowSleepFlag=4,$i_19.Dynamics.b2Body.e_bulletFlag=8,$i_19.Dynamics.b2Body.e_fixedRotationFlag=16,$i_19.Dynamics.b2Body.e_activeFlag=32,$i_19.Dynamics.b2Body.b2_staticBody=0,$i_19.Dynamics.b2Body.b2_kinematicBody=1,$i_19.Dynamics.b2Body.b2_dynamicBody=2}),x.b2BodyDef=function(){this.position=new o,this.linearVelocity=new o},x.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=d.b2_staticBody,this.active=!0,this.inertiaScale=1},f.b2ContactFilter=function(){},f.prototype.ShouldCollide=function(t,i){var e=t.GetFilterData(),o=i.GetFilterData();if(e.groupIndex==o.groupIndex&&e.groupIndex!=0)return e.groupIndex>0;var n=(e.maskBits&o.categoryBits)!=0&&(e.categoryBits&o.maskBits)!=0;return n},f.prototype.RayCollide=function(t,i){return t?this.ShouldCollide(t instanceof B?t:null,i):!0},$i_19.postDefs.push(function(){$i_19.Dynamics.b2ContactFilter.b2_defaultFilter=new f}),g.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints)},v.b2ContactListener=function(){},v.prototype.BeginContact=function(){},v.prototype.EndContact=function(){},v.prototype.PreSolve=function(){},v.prototype.PostSolve=function(){},$i_19.postDefs.push(function(){$i_19.Dynamics.b2ContactListener.b2_defaultListener=new v}),b.b2ContactManager=function(){},b.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=f.b2_defaultFilter,this.m_contactListener=v.b2_defaultListener,this.m_contactFactory=new T(this.m_allocator),this.m_broadPhase=new l},b.prototype.AddPair=function(t,i){var e=t instanceof B?t:null,o=i instanceof B?i:null,n=e.GetBody(),s=o.GetBody();if(n!=s){var r=s.GetContactList();while(r){if(r.other==n){var a=r.contact.GetFixtureA(),l=r.contact.GetFixtureB();if(a==e&&l==o)return;if(a==o&&l==e)return}r=r.next}if(s.ShouldCollide(n)!=0&&this.m_contactFilter.ShouldCollide(e,o)!=0){var h=this.m_contactFactory.Create(e,o);e=h.GetFixtureA(),o=h.GetFixtureB(),n=e.m_body,s=o.m_body,h.m_prev=null,h.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=h),this.m_world.m_contactList=h,h.m_nodeA.contact=h,h.m_nodeA.other=s,h.m_nodeA.prev=null,h.m_nodeA.next=n.m_contactList,n.m_contactList!=null&&(n.m_contactList.prev=h.m_nodeA),n.m_contactList=h.m_nodeA,h.m_nodeB.contact=h,h.m_nodeB.other=n,h.m_nodeB.prev=null,h.m_nodeB.next=s.m_contactList,s.m_contactList!=null&&(s.m_contactList.prev=h.m_nodeB),s.m_contactList=h.m_nodeB,++this.m_world.m_contactCount}}},b.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs($i_19.generateCallback(this,this.AddPair))},b.prototype.Destroy=function(t){var i=t.GetFixtureA(),e=t.GetFixtureB(),o=i.GetBody(),n=e.GetBody();t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},b.prototype.Collide=function(){var t=this.m_world.m_contactList;while(t){var i=t.GetFixtureA(),e=t.GetFixtureB(),o=i.GetBody(),n=e.GetBody();if(o.IsAwake()!=0||n.IsAwake()!=0){if(t.m_flags&V.e_filterFlag){if(n.ShouldCollide(o)==0){var s=t;t=s.GetNext(),this.Destroy(s);continue}if(this.m_contactFilter.ShouldCollide(i,e)==0){s=t,t=s.GetNext(),this.Destroy(s);continue}t.m_flags&=~V.e_filterFlag}var r=i.m_proxy,a=e.m_proxy,l=this.m_broadPhase.TestOverlap(r,a);l!=0?(t.Update(this.m_contactListener),t=t.GetNext()):(s=t,t=s.GetNext(),this.Destroy(s))}else t=t.GetNext()}},$i_19.postDefs.push(function(){$i_19.Dynamics.b2ContactManager.s_evalCP=new a}),w.b2DebugDraw=function(){},w.prototype.b2DebugDraw=function(){},w.prototype.SetFlags=function(t){t===void 0&&(t=0)},w.prototype.GetFlags=function(){},w.prototype.AppendFlags=function(t){t===void 0&&(t=0)},w.prototype.ClearFlags=function(t){t===void 0&&(t=0)},w.prototype.SetSprite=function(){},w.prototype.GetSprite=function(){},w.prototype.SetDrawScale=function(t){t===void 0&&(t=0)},w.prototype.GetDrawScale=function(){},w.prototype.SetLineThickness=function(t){t===void 0&&(t=0)},w.prototype.GetLineThickness=function(){},w.prototype.SetAlpha=function(t){t===void 0&&(t=0)},w.prototype.GetAlpha=function(){},w.prototype.SetFillAlpha=function(t){t===void 0&&(t=0)},w.prototype.GetFillAlpha=function(){},w.prototype.SetXFormScale=function(t){t===void 0&&(t=0)},w.prototype.GetXFormScale=function(){},w.prototype.DrawPolygon=function(t,i){i===void 0&&(i=0)},w.prototype.DrawSolidPolygon=function(t,i){i===void 0&&(i=0)},w.prototype.DrawCircle=function(t,i){i===void 0&&(i=0)},w.prototype.DrawSolidCircle=function(t,i){i===void 0&&(i=0)},w.prototype.DrawSegment=function(){},w.prototype.DrawTransform=function(){},$i_19.postDefs.push(function(){$i_19.Dynamics.b2DebugDraw.e_shapeBit=1,$i_19.Dynamics.b2DebugDraw.e_jointBit=2,$i_19.Dynamics.b2DebugDraw.e_aabbBit=4,$i_19.Dynamics.b2DebugDraw.e_pairBit=8,$i_19.Dynamics.b2DebugDraw.e_centerOfMassBit=16,$i_19.Dynamics.b2DebugDraw.e_controllerBit=32}),D.b2DestructionListener=function(){},D.prototype.SayGoodbyeJoint=function(){},D.prototype.SayGoodbyeFixture=function(){},C.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},C.prototype.Copy=function(){var t=new C;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},B.b2Fixture=function(){this.m_filter=new C},B.prototype.GetType=function(){return this.m_shape.GetType()},B.prototype.GetShape=function(){return this.m_shape},B.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,this.m_body!=null)){var i=this.m_body.GetContactList();while(i){var e=i.contact,o=e.GetFixtureA(),n=e.GetFixtureB();(o==this||n==this)&&e.SetSensor(o.IsSensor()||n.IsSensor()),i=i.next}}},B.prototype.IsSensor=function(){return this.m_isSensor},B.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),!this.m_body){var i=this.m_body.GetContactList();while(i){var e=i.contact,o=e.GetFixtureA(),n=e.GetFixtureB();(o==this||n==this)&&e.FlagForFiltering(),i=i.next}}},B.prototype.GetFilterData=function(){return this.m_filter.Copy()},B.prototype.GetBody=function(){return this.m_body},B.prototype.GetNext=function(){return this.m_next},B.prototype.GetUserData=function(){return this.m_userData},B.prototype.SetUserData=function(t){this.m_userData=t},B.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},B.prototype.RayCast=function(t,i){return this.m_shape.RayCast(t,i,this.m_body.GetTransform())},B.prototype.GetMassData=function(t){return t===void 0&&(t=null),t==null&&(t=new u),this.m_shape.ComputeMass(t,this.m_density),t},B.prototype.SetDensity=function(t){t===void 0&&(t=0),this.m_density=t},B.prototype.GetDensity=function(){return this.m_density},B.prototype.GetFriction=function(){return this.m_friction},B.prototype.SetFriction=function(t){t===void 0&&(t=0),this.m_friction=t},B.prototype.GetRestitution=function(){return this.m_restitution},B.prototype.SetRestitution=function(t){t===void 0&&(t=0),this.m_restitution=t},B.prototype.GetAABB=function(){return this.m_aabb},B.prototype.b2Fixture=function(){this.m_aabb=new r,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},B.prototype.Create=function(t,i,e){this.m_userData=e.userData,this.m_friction=e.friction,this.m_restitution=e.restitution,this.m_body=t,this.m_next=null,this.m_filter=e.filter.Copy(),this.m_isSensor=e.isSensor,this.m_shape=e.shape.Copy(),this.m_density=e.density},B.prototype.Destroy=function(){this.m_shape=null},B.prototype.CreateProxy=function(t,i){this.m_shape.ComputeAABB(this.m_aabb,i),this.m_proxy=t.CreateProxy(this.m_aabb,this)},B.prototype.DestroyProxy=function(t){this.m_proxy!=null&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},B.prototype.Synchronize=function(i,e,o){if(this.m_proxy){var n=new r,s=new r;this.m_shape.ComputeAABB(n,e),this.m_shape.ComputeAABB(s,o),this.m_aabb.Combine(n,s);var a=t.SubtractVV(o.position,e.position);i.MoveProxy(this.m_proxy,this.m_aabb,a)}},S.b2FixtureDef=function(){this.filter=new C},S.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},A.b2Island=function(){},A.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},A.prototype.Initialize=function(t,i,e,o,n,s){t===void 0&&(t=0),i===void 0&&(i=0),e===void 0&&(e=0);var r=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=i,this.m_jointCapacity=e,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=o,this.m_listener=n,this.m_contactSolver=s,r=this.m_bodies.length;t>r;r++)this.m_bodies[r]=null;for(r=this.m_contacts.length;i>r;r++)this.m_contacts[r]=null;for(r=this.m_joints.length;e>r;r++)this.m_joints[r]=null},A.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},A.prototype.Solve=function(i,e,o){var n,r,a=0,l=0,h=e.x,m=e.y;for(a=0;this.m_bodyCount>a;++a)n=this.m_bodies[a],n.GetType()==d.b2_dynamicBody&&(n.m_nonGravitic?(n.m_linearVelocity.x+=i.dt*n.m_invMass*n.m_force.x,n.m_linearVelocity.y+=i.dt*n.m_invMass*n.m_force.y):(n.m_linearVelocity.x+=i.dt*(h+n.m_invMass*n.m_force.x),n.m_linearVelocity.y+=i.dt*(m+n.m_invMass*n.m_force.y)),n.m_angularVelocity+=i.dt*n.m_invI*n.m_torque,n.m_linearVelocity.Multiply(t.Clamp(1-i.dt*n.m_linearDamping,0,1)),n.m_angularVelocity*=t.Clamp(1-i.dt*n.m_angularDamping,0,1));this.m_contactSolver.Initialize(i,this.m_contacts,this.m_contactCount,this.m_allocator);var c=this.m_contactSolver;for(c.InitVelocityConstraints(i),a=0;this.m_jointCount>a;++a)r=this.m_joints[a],r.InitVelocityConstraints(i);for(a=0;i.velocityIterations>a;++a){for(l=0;this.m_jointCount>l;++l)r=this.m_joints[l],r.SolveVelocityConstraints(i);c.SolveVelocityConstraints()}for(a=0;this.m_jointCount>a;++a)r=this.m_joints[a],r.FinalizeVelocityConstraints();for(c.FinalizeVelocityConstraints(),a=0;this.m_bodyCount>a;++a)if(n=this.m_bodies[a],n.GetType()!=d.b2_staticBody){var _=i.dt*n.m_linearVelocity.x,u=i.dt*n.m_linearVelocity.y;_*_+u*u>s.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=s.b2_maxTranslation*i.inv_dt,n.m_linearVelocity.y*=s.b2_maxTranslation*i.inv_dt);var p=i.dt*n.m_angularVelocity;p*p>s.b2_maxRotationSquared&&(n.m_angularVelocity=0>n.m_angularVelocity?-s.b2_maxRotation*i.inv_dt:s.b2_maxRotation*i.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=i.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=i.dt*n.m_linearVelocity.y,n.m_sweep.a+=i.dt*n.m_angularVelocity,n.SynchronizeTransform()}for(a=0;i.positionIterations>a;++a){var y=c.SolvePositionConstraints(s.b2_contactBaumgarte),x=!0;for(l=0;this.m_jointCount>l;++l){r=this.m_joints[l];var f=r.SolvePositionConstraints(s.b2_contactBaumgarte);x=x&&f}if(y&&x)break}if(this.Report(c.m_constraints),o){var g=Number.MAX_VALUE,v=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,b=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance;for(a=0;this.m_bodyCount>a;++a)n=this.m_bodies[a],n.GetType()!=d.b2_staticBody&&((n.m_flags&d.e_allowSleepFlag)==0&&(n.m_sleepTime=0,g=0),(n.m_flags&d.e_allowSleepFlag)==0||n.m_angularVelocity*n.m_angularVelocity>b||t.Dot(n.m_linearVelocity,n.m_linearVelocity)>v?(n.m_sleepTime=0,g=0):(n.m_sleepTime+=i.dt,g=t.Min(g,n.m_sleepTime)));if(g>=s.b2_timeToSleep)for(a=0;this.m_bodyCount>a;++a)n=this.m_bodies[a],n.SetAwake(!1)}},A.prototype.SolveTOI=function(t){var i=0,e=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var o=this.m_contactSolver;for(i=0;this.m_jointCount>i;++i)this.m_joints[i].InitVelocityConstraints(t);for(i=0;t.velocityIterations>i;++i)for(o.SolveVelocityConstraints(),e=0;this.m_jointCount>e;++e)this.m_joints[e].SolveVelocityConstraints(t);for(i=0;this.m_bodyCount>i;++i){var n=this.m_bodies[i];if(n.GetType()!=d.b2_staticBody){var r=t.dt*n.m_linearVelocity.x,a=t.dt*n.m_linearVelocity.y;r*r+a*a>s.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=s.b2_maxTranslation*t.inv_dt,n.m_linearVelocity.y*=s.b2_maxTranslation*t.inv_dt);var l=t.dt*n.m_angularVelocity;l*l>s.b2_maxRotationSquared&&(n.m_angularVelocity=0>n.m_angularVelocity?-s.b2_maxRotation*t.inv_dt:s.b2_maxRotation*t.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=t.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=t.dt*n.m_linearVelocity.y,n.m_sweep.a+=t.dt*n.m_angularVelocity,n.SynchronizeTransform()}}var h=.75;for(i=0;t.positionIterations>i;++i){var m=o.SolvePositionConstraints(h),c=!0;for(e=0;this.m_jointCount>e;++e){var _=this.m_joints[e].SolvePositionConstraints(s.b2_contactBaumgarte);c=c&&_}if(m&&c)break}this.Report(o.m_constraints)},A.prototype.Report=function(t){if(this.m_listener!=null)for(var i=0;this.m_contactCount>i;++i){for(var e=this.m_contacts[i],o=t[i],n=0;o.pointCount>n;++n)A.s_impulse.normalImpulses[n]=o.points[n].normalImpulse,A.s_impulse.tangentImpulses[n]=o.points[n].tangentImpulse;this.m_listener.PostSolve(e,A.s_impulse)}},A.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},A.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},A.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},$i_19.postDefs.push(function(){$i_19.Dynamics.b2Island.s_impulse=new g}),M.b2TimeStep=function(){},M.prototype.Set=function(t){this.dt=t.dt,this.inv_dt=t.inv_dt,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting},I.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new b,this.m_contactSolver=new P,this.m_island=new A},I.prototype.b2World=function(t,i){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,I.m_warmStarting=!0,I.m_continuousPhysics=!0,this.m_allowSleep=i,this.m_gravity=t,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var e=new x;this.m_groundBody=this.CreateBody(e)},I.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},I.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},I.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},I.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},I.prototype.SetBroadPhase=function(t){var i=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var e=this.m_bodyList;e;e=e.m_next)for(var o=e.m_fixtureList;o;o=o.m_next)o.m_proxy=t.CreateProxy(i.GetFatAABB(o.m_proxy),o)},I.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},I.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},I.prototype.CreateBody=function(t){if(this.IsLocked()==1)return null;var i=new d(t,this);return i.m_prev=null,i.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=i),this.m_bodyList=i,++this.m_bodyCount,i},I.prototype.DestroyBody=function(t){if(this.IsLocked()!=1){var i=t.m_jointList;while(i){var e=i;i=i.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(e.joint),this.DestroyJoint(e.joint)}var o=t.m_controllerList;while(o){var n=o;o=o.nextController,n.controller.RemoveBody(t)}var s=t.m_contactList;while(s){var r=s;s=s.next,this.m_contactManager.Destroy(r.contact)}t.m_contactList=null;var a=t.m_fixtureList;while(a){var l=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxy(this.m_contactManager.m_broadPhase),l.Destroy()}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},I.prototype.CreateJoint=function(t){var i=L.Create(t,null);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.joint=i,i.m_edgeA.other=i.m_bodyB,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.joint=i,i.m_edgeB.other=i.m_bodyA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var e=t.bodyA,o=t.bodyB;if(t.collideConnected==0){var n=o.GetContactList();while(n)n.other==e&&n.contact.FlagForFiltering(),n=n.next}return i},I.prototype.DestroyJoint=function(t){var i=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,o=t.m_bodyB;if(e.SetAwake(!0),o.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==o.m_jointList&&(o.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,L.Destroy(t,null),--this.m_jointCount,i==0){var n=o.GetContactList();while(n)n.other==e&&n.contact.FlagForFiltering(),n=n.next}},I.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList=t,t.m_world=this,this.m_controllerCount++,t},I.prototype.RemoveController=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),this.m_controllerCount--},I.prototype.CreateController=function(t){if(t.m_world!=this)throw Error("Controller can only be a member of one world");return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t.m_world=this,t},I.prototype.DestroyController=function(t){t.Clear(),t.m_next&&(t.m_next.m_prev=t.m_prev),t.m_prev&&(t.m_prev.m_next=t.m_next),t==this.m_controllerList&&(this.m_controllerList=t.m_next),--this.m_controllerCount},I.prototype.SetWarmStarting=function(t){I.m_warmStarting=t},I.prototype.SetContinuousPhysics=function(t){I.m_continuousPhysics=t},I.prototype.GetBodyCount=function(){return this.m_bodyCount},I.prototype.GetJointCount=function(){return this.m_jointCount},I.prototype.GetContactCount=function(){return this.m_contactCount},I.prototype.SetGravity=function(t){this.m_gravity=t},I.prototype.GetGravity=function(){return this.m_gravity},I.prototype.GetGroundBody=function(){return this.m_groundBody},I.prototype.Step=function(t,i,e){t===void 0&&(t=0),i===void 0&&(i=0),e===void 0&&(e=0),this.m_flags&I.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~I.e_newFixture),this.m_flags|=I.e_locked;var o=I.s_timestep2;o.dt=t,o.velocityIterations=i,o.positionIterations=e,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=I.m_warmStarting,this.m_contactManager.Collide(),o.dt>0&&this.Solve(o),I.m_continuousPhysics&&o.dt>0&&this.SolveTOI(o),o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_flags&=~I.e_locked},I.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},I.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var t,i,e,s,a,l=this.m_debugDraw.GetFlags();new o,new o,new o;var h;new r,new r;var m=[new o,new o,new o,new o],c=new n(0,0,0);if(l&w.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next)for(h=t.m_xf,i=t.GetFixtureList();i;i=i.m_next)e=i.GetShape(),t.IsActive()==0?(c.Set(.5,.5,.3),this.DrawShape(e,h,c)):t.GetType()==d.b2_staticBody?(c.Set(.5,.9,.5),this.DrawShape(e,h,c)):t.GetType()==d.b2_kinematicBody?(c.Set(.5,.5,.9),this.DrawShape(e,h,c)):t.IsAwake()==0?(c.Set(.6,.6,.6),this.DrawShape(e,h,c)):(c.Set(.9,.7,.7),this.DrawShape(e,h,c));if(l&w.e_jointBit)for(s=this.m_jointList;s;s=s.m_next)this.DrawJoint(s);if(l&w.e_controllerBit)for(var _=this.m_controllerList;_;_=_.m_next)_.Draw(this.m_debugDraw);if(l&w.e_pairBit){c.Set(.3,.9,.9);for(var u=this.m_contactManager.m_contactList;u;u=u.GetNext()){var p=u.GetFixtureA(),y=u.GetFixtureB(),x=p.GetAABB().GetCenter(),f=y.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(x,f,c)}}if(l&w.e_aabbBit)for(a=this.m_contactManager.m_broadPhase,m=[new o,new o,new o,new o],t=this.m_bodyList;t;t=t.GetNext())if(t.IsActive()!=0)for(i=t.GetFixtureList();i;i=i.GetNext()){var g=a.GetFatAABB(i.m_proxy);m[0].Set(g.lowerBound.x,g.lowerBound.y),m[1].Set(g.upperBound.x,g.lowerBound.y),m[2].Set(g.upperBound.x,g.upperBound.y),m[3].Set(g.lowerBound.x,g.upperBound.y),this.m_debugDraw.DrawPolygon(m,4,c)}if(l&w.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)h=I.s_xf,h.R=t.m_xf.R,h.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(h)}},I.prototype.QueryAABB=function(t,i){function e(i){return t(n.GetUserData(i))}var o=this,n=o.m_contactManager.m_broadPhase;n.Query(e,i)},I.prototype.QueryShape=function(t,i,o){function n(e){var n=a.GetUserData(e)instanceof B?a.GetUserData(e):null;return y.TestOverlap(i,o,n.GetShape(),n.GetBody().GetTransform())?t(n):!0}var s=this;o===void 0&&(o=null),o==null&&(o=new e,o.SetIdentity());var a=s.m_contactManager.m_broadPhase,l=new r;i.ComputeAABB(l,o),a.Query(n,l)},I.prototype.QueryPoint=function(t,i){function e(e){var o=n.GetUserData(e)instanceof B?n.GetUserData(e):null;return o.TestPoint(i)?t(o):!0}var o=this,n=o.m_contactManager.m_broadPhase,a=new r;a.lowerBound.Set(i.x-s.b2_linearSlop,i.y-s.b2_linearSlop),a.upperBound.Set(i.x+s.b2_linearSlop,i.y+s.b2_linearSlop),n.Query(e,a)},I.prototype.RayCast=function(t,i,e){function n(n,s){var l=r.GetUserData(s),h=l instanceof B?l:null,m=h.RayCast(a,n);if(m){var c=a.fraction,_=new o((1-c)*i.x+c*e.x,(1-c)*i.y+c*e.y);return t(h,_,a.normal,c)}return n.maxFraction}var s=this,r=s.m_contactManager.m_broadPhase,a=new m,l=new h(i,e);r.RayCast(n,l)},I.prototype.RayCastOne=function(t,i){function e(t,i,e,n){return n===void 0&&(n=0),o=t,n}var o,n=this;return n.RayCast(e,t,i),o
},I.prototype.RayCastAll=function(t,i){function e(t,i,e,o){return o===void 0&&(o=0),n[n.length]=t,1}var o=this,n=new Vector;return o.RayCast(e,t,i),n},I.prototype.GetBodyList=function(){return this.m_bodyList},I.prototype.GetJointList=function(){return this.m_jointList},I.prototype.GetContactList=function(){return this.m_contactList},I.prototype.IsLocked=function(){return(this.m_flags&I.e_locked)>0},I.prototype.Solve=function(t){for(var i,e=this.m_controllerList;e;e=e.m_next)e.Step(t);var o=this.m_island;for(o.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~d.e_islandFlag;for(var n=this.m_contactList;n;n=n.m_next)n.m_flags&=~V.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var r=this.s_stack,a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&d.e_islandFlag)&&a.IsAwake()!=0&&a.IsActive()!=0&&a.GetType()!=d.b2_staticBody){o.Clear();var l=0;r[l++]=a,a.m_flags|=d.e_islandFlag;while(l>0)if(i=r[--l],o.AddBody(i),i.IsAwake()==0&&i.SetAwake(!0),i.GetType()!=d.b2_staticBody){for(var h,m=i.m_contactList;m;m=m.next)m.contact.m_flags&V.e_islandFlag||m.contact.IsSensor()!=1&&m.contact.IsEnabled()!=0&&m.contact.IsTouching()!=0&&(o.AddContact(m.contact),m.contact.m_flags|=V.e_islandFlag,h=m.other,h.m_flags&d.e_islandFlag||(r[l++]=h,h.m_flags|=d.e_islandFlag));for(var c=i.m_jointList;c;c=c.next)c.joint.m_islandFlag!=1&&(h=c.other,h.IsActive()!=0&&(o.AddJoint(c.joint),c.joint.m_islandFlag=!0,h.m_flags&d.e_islandFlag||(r[l++]=h,h.m_flags|=d.e_islandFlag)))}o.Solve(t,this.m_gravity,this.m_allowSleep);for(var _=0;o.m_bodyCount>_;++_)i=o.m_bodies[_],i.GetType()==d.b2_staticBody&&(i.m_flags&=~d.e_islandFlag)}for(_=0;r.length>_;++_){if(!r[_])break;r[_]=null}for(i=this.m_bodyList;i;i=i.m_next)i.IsAwake()!=0&&i.IsActive()!=0&&i.GetType()!=d.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},I.prototype.SolveTOI=function(t){var i,e,o,n,r,a,l,h=this.m_island;h.Initialize(this.m_bodyCount,s.b2_maxTOIContactsPerIsland,s.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var m=I.s_queue;for(i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~d.e_islandFlag,i.m_sweep.t0=0;var c;for(c=this.m_contactList;c;c=c.m_next)c.m_flags&=~(V.e_toiFlag|V.e_islandFlag);for(l=this.m_jointList;l;l=l.m_next)l.m_islandFlag=!1;for(;;){var _=null,u=1;for(c=this.m_contactList;c;c=c.m_next)if(c.IsSensor()!=1&&c.IsEnabled()!=0&&c.IsContinuous()!=0){var p=1;if(c.m_flags&V.e_toiFlag)p=c.m_toi;else{if(e=c.m_fixtureA,o=c.m_fixtureB,n=e.m_body,r=o.m_body,!(n.GetType()==d.b2_dynamicBody&&n.IsAwake()!=0||r.GetType()==d.b2_dynamicBody&&r.IsAwake()!=0))continue;var y=n.m_sweep.t0;r.m_sweep.t0>n.m_sweep.t0?(y=r.m_sweep.t0,n.m_sweep.Advance(y)):n.m_sweep.t0>r.m_sweep.t0&&(y=n.m_sweep.t0,r.m_sweep.Advance(y)),p=c.ComputeTOI(n.m_sweep,r.m_sweep),s.b2Assert(p>=0&&1>=p),p>0&&1>p&&(p=(1-p)*y+p,p>1&&(p=1)),c.m_toi=p,c.m_flags|=V.e_toiFlag}p>Number.MIN_VALUE&&u>p&&(_=c,u=p)}if(_==null||u>1-100*Number.MIN_VALUE)break;if(e=_.m_fixtureA,o=_.m_fixtureB,n=e.m_body,r=o.m_body,I.s_backupA.Set(n.m_sweep),I.s_backupB.Set(r.m_sweep),n.Advance(u),r.Advance(u),_.Update(this.m_contactManager.m_contactListener),_.m_flags&=~V.e_toiFlag,_.IsSensor()!=1&&_.IsEnabled()!=0){if(_.IsTouching()!=0){var x=n;x.GetType()!=d.b2_dynamicBody&&(x=r),h.Clear();var f=0,g=0;m[f+g++]=x,x.m_flags|=d.e_islandFlag;while(g>0)if(i=m[f++],--g,h.AddBody(i),i.IsAwake()==0&&i.SetAwake(!0),i.GetType()==d.b2_dynamicBody){for(a=i.m_contactList;a;a=a.next){if(h.m_contactCount==h.m_contactCapacity)break;if(!(a.contact.m_flags&V.e_islandFlag)&&a.contact.IsSensor()!=1&&a.contact.IsEnabled()!=0&&a.contact.IsTouching()!=0){h.AddContact(a.contact),a.contact.m_flags|=V.e_islandFlag;var v=a.other;v.m_flags&d.e_islandFlag||(v.GetType()!=d.b2_staticBody&&(v.Advance(u),v.SetAwake(!0)),m[f+g]=v,++g,v.m_flags|=d.e_islandFlag)}}for(var b=i.m_jointList;b;b=b.next)h.m_jointCount!=h.m_jointCapacity&&b.joint.m_islandFlag!=1&&(v=b.other,v.IsActive()!=0&&(h.AddJoint(b.joint),b.joint.m_islandFlag=!0,v.m_flags&d.e_islandFlag||(v.GetType()!=d.b2_staticBody&&(v.Advance(u),v.SetAwake(!0)),m[f+g]=v,++g,v.m_flags|=d.e_islandFlag)))}var w=I.s_timestep;w.warmStarting=!1,w.dt=(1-u)*t.dt,w.inv_dt=1/w.dt,w.dtRatio=0,w.velocityIterations=t.velocityIterations,w.positionIterations=t.positionIterations,h.SolveTOI(w);var D=0;for(D=0;h.m_bodyCount>D;++D)if(i=h.m_bodies[D],i.m_flags&=~d.e_islandFlag,i.IsAwake()!=0&&i.GetType()==d.b2_dynamicBody)for(i.SynchronizeFixtures(),a=i.m_contactList;a;a=a.next)a.contact.m_flags&=~V.e_toiFlag;for(D=0;h.m_contactCount>D;++D)c=h.m_contacts[D],c.m_flags&=~(V.e_toiFlag|V.e_islandFlag);for(D=0;h.m_jointCount>D;++D)l=h.m_joints[D],l.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else n.m_sweep.Set(I.s_backupA),r.m_sweep.Set(I.s_backupB),n.SynchronizeTransform(),r.SynchronizeTransform()}},I.prototype.DrawJoint=function(t){var i=t.GetBodyA(),e=t.GetBodyB(),o=i.m_xf,n=e.m_xf,s=o.position,r=n.position,a=t.GetAnchorA(),l=t.GetAnchorB(),h=I.s_jointColor;switch(t.m_type){case L.e_distanceJoint:this.m_debugDraw.DrawSegment(a,l,h);break;case L.e_pulleyJoint:var m=t instanceof k?t:null,c=m.GetGroundAnchorA(),_=m.GetGroundAnchorB();this.m_debugDraw.DrawSegment(c,a,h),this.m_debugDraw.DrawSegment(_,l,h),this.m_debugDraw.DrawSegment(c,_,h);break;case L.e_mouseJoint:this.m_debugDraw.DrawSegment(a,l,h);break;default:i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,a,h),this.m_debugDraw.DrawSegment(a,l,h),e!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,l,h)}},I.prototype.DrawShape=function(i,e,o){switch(i.m_type){case y.e_circleShape:var n=i instanceof c?i:null,s=t.MulX(e,n.m_p),r=n.m_radius,a=e.R.col1;this.m_debugDraw.DrawSolidCircle(s,r,a,o);break;case y.e_polygonShape:var l=0,h=i instanceof p?i:null,m=parseInt(h.GetVertexCount()),u=h.GetVertices(),d=new Vector(m);for(l=0;m>l;++l)d[l]=t.MulX(e,u[l]);this.m_debugDraw.DrawSolidPolygon(d,m,o);break;case y.e_edgeShape:var x=i instanceof _?i:null;this.m_debugDraw.DrawSegment(t.MulX(e,x.GetVertex1()),t.MulX(e,x.GetVertex2()),o)}},$i_19.postDefs.push(function(){$i_19.Dynamics.b2World.s_timestep2=new M,$i_19.Dynamics.b2World.s_xf=new e,$i_19.Dynamics.b2World.s_backupA=new i,$i_19.Dynamics.b2World.s_backupB=new i,$i_19.Dynamics.b2World.s_timestep=new M,$i_19.Dynamics.b2World.s_queue=new Vector,$i_19.Dynamics.b2World.s_jointColor=new n(.5,.8,.8),$i_19.Dynamics.b2World.e_newFixture=1,$i_19.Dynamics.b2World.e_locked=2})}(),function(){var t=$i_19.Collision.Shapes.b2CircleShape,i=($i_19.Collision.Shapes.b2EdgeChainDef,$i_19.Collision.Shapes.b2EdgeShape),e=($i_19.Collision.Shapes.b2MassData,$i_19.Collision.Shapes.b2PolygonShape),o=$i_19.Collision.Shapes.b2Shape,n=$i_19.Dynamics.Contacts.b2CircleContact,s=$i_19.Dynamics.Contacts.b2Contact,r=$i_19.Dynamics.Contacts.b2ContactConstraint,a=$i_19.Dynamics.Contacts.b2ContactConstraintPoint,l=$i_19.Dynamics.Contacts.b2ContactEdge,h=$i_19.Dynamics.Contacts.b2ContactFactory,m=$i_19.Dynamics.Contacts.b2ContactRegister,c=$i_19.Dynamics.Contacts.b2ContactResult,_=$i_19.Dynamics.Contacts.b2ContactSolver,u=$i_19.Dynamics.Contacts.b2EdgeAndCircleContact,p=$i_19.Dynamics.Contacts.b2NullContact,y=$i_19.Dynamics.Contacts.b2PolyAndCircleContact,d=$i_19.Dynamics.Contacts.b2PolyAndEdgeContact,x=$i_19.Dynamics.Contacts.b2PolygonContact,f=$i_19.Dynamics.Contacts.b2PositionSolverManifold,g=$i_19.Dynamics.b2Body,v=($i_19.Dynamics.b2BodyDef,$i_19.Dynamics.b2ContactFilter,$i_19.Dynamics.b2ContactImpulse,$i_19.Dynamics.b2ContactListener,$i_19.Dynamics.b2ContactManager,$i_19.Dynamics.b2DebugDraw,$i_19.Dynamics.b2DestructionListener,$i_19.Dynamics.b2FilterData,$i_19.Dynamics.b2Fixture,$i_19.Dynamics.b2FixtureDef,$i_19.Dynamics.b2Island,$i_19.Dynamics.b2TimeStep),b=($i_19.Dynamics.b2World,$i_19.Common.b2Color,$i_19.Common.b2internal,$i_19.Common.b2Settings),w=$i_19.Common.Math.b2Mat22,D=($i_19.Common.Math.b2Mat33,$i_19.Common.Math.b2Math),C=($i_19.Common.Math.b2Sweep,$i_19.Common.Math.b2Transform,$i_19.Common.Math.b2Vec2),B=($i_19.Common.Math.b2Vec3,$i_19.Collision.b2AABB,$i_19.Collision.b2Bound,$i_19.Collision.b2BoundValues,$i_19.Collision.b2Collision),S=$i_19.Collision.b2ContactID,A=($i_19.Collision.b2ContactPoint,$i_19.Collision.b2Distance,$i_19.Collision.b2DistanceInput,$i_19.Collision.b2DistanceOutput,$i_19.Collision.b2DistanceProxy,$i_19.Collision.b2DynamicTree,$i_19.Collision.b2DynamicTreeBroadPhase,$i_19.Collision.b2DynamicTreeNode,$i_19.Collision.b2DynamicTreePair,$i_19.Collision.b2Manifold),M=($i_19.Collision.b2ManifoldPoint,$i_19.Collision.b2Point,$i_19.Collision.b2RayCastInput,$i_19.Collision.b2RayCastOutput,$i_19.Collision.b2Segment,$i_19.Collision.b2SeparationFunction,$i_19.Collision.b2Simplex,$i_19.Collision.b2SimplexCache,$i_19.Collision.b2SimplexVertex,$i_19.Collision.b2TimeOfImpact),I=$i_19.Collision.b2TOIInput,V=$i_19.Collision.b2WorldManifold;$i_19.Collision.ClipVertex,$i_19.Collision.Features,$i_19.Collision.IBroadPhase,$i_19.inherit(n,$i_19.Dynamics.Contacts.b2Contact),n.prototype.__super=$i_19.Dynamics.Contacts.b2Contact.prototype,n.b2CircleContact=function(){$i_19.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},n.Create=function(){return new n},n.Destroy=function(){},n.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)},n.prototype.Evaluate=function(){var i=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();B.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,e.m_xf)},s.b2Contact=function(){this.m_nodeA=new l,this.m_nodeB=new l,this.m_manifold=new A,this.m_oldManifold=new A},s.prototype.GetManifold=function(){return this.m_manifold},s.prototype.GetWorldManifold=function(t){var i=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody(),o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,i.GetTransform(),o.m_radius,e.GetTransform(),n.m_radius)},s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag},s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag},s.prototype.SetSensor=function(t){t?this.m_flags|=s.e_sensorFlag:this.m_flags&=~s.e_sensorFlag},s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag},s.prototype.SetEnabled=function(t){t?this.m_flags|=s.e_enabledFlag:this.m_flags&=~s.e_enabledFlag},s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag},s.prototype.GetNext=function(){return this.m_next},s.prototype.GetFixtureA=function(){return this.m_fixtureA},s.prototype.GetFixtureB=function(){return this.m_fixtureB},s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag},s.prototype.b2Contact=function(){},s.prototype.Reset=function(t,i){if(t===void 0&&(t=null),i===void 0&&(i=null),this.m_flags=s.e_enabledFlag,!t||!i)return this.m_fixtureA=null,this.m_fixtureB=null,void 0;(t.IsSensor()||i.IsSensor())&&(this.m_flags|=s.e_sensorFlag);var e=t.GetBody(),o=i.GetBody();(e.GetType()!=g.b2_dynamicBody||e.IsBullet()||o.GetType()!=g.b2_dynamicBody||o.IsBullet())&&(this.m_flags|=s.e_continuousFlag),this.m_fixtureA=t,this.m_fixtureB=i,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},s.prototype.Update=function(t){var i=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=i,this.m_flags|=s.e_enabledFlag;var e=!1,n=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag,r=this.m_fixtureA.m_body,a=this.m_fixtureB.m_body,l=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag){if(l){var h=this.m_fixtureA.GetShape(),m=this.m_fixtureB.GetShape(),c=r.GetTransform(),_=a.GetTransform();e=o.TestOverlap(h,c,m,_)}this.m_manifold.m_pointCount=0}else{if(r.GetType()!=g.b2_dynamicBody||r.IsBullet()||a.GetType()!=g.b2_dynamicBody||a.IsBullet()?this.m_flags|=s.e_continuousFlag:this.m_flags&=~s.e_continuousFlag,l){this.Evaluate(),e=this.m_manifold.m_pointCount>0;for(var u=0;this.m_manifold.m_pointCount>u;++u){var p=this.m_manifold.m_points[u];p.m_normalImpulse=0,p.m_tangentImpulse=0;for(var y=p.m_id,d=0;this.m_oldManifold.m_pointCount>d;++d){var x=this.m_oldManifold.m_points[d];if(x.m_id.key==y.key){p.m_normalImpulse=x.m_normalImpulse,p.m_tangentImpulse=x.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;e!=n&&(r.SetAwake(!0),a.SetAwake(!0))}e?this.m_flags|=s.e_touchingFlag:this.m_flags&=~s.e_touchingFlag,n==0&&e==1&&t.BeginContact(this),n==1&&e==0&&t.EndContact(this),(this.m_flags&s.e_sensorFlag)==0&&t.PreSolve(this,this.m_oldManifold)},s.prototype.Evaluate=function(){},s.prototype.ComputeTOI=function(t,i){return s.s_input.proxyA.Set(this.m_fixtureA.GetShape()),s.s_input.proxyB.Set(this.m_fixtureB.GetShape()),s.s_input.sweepA=t,s.s_input.sweepB=i,s.s_input.tolerance=b.b2_linearSlop,M.TimeOfImpact(s.s_input)},$i_19.postDefs.push(function(){$i_19.Dynamics.Contacts.b2Contact.e_sensorFlag=1,$i_19.Dynamics.Contacts.b2Contact.e_continuousFlag=2,$i_19.Dynamics.Contacts.b2Contact.e_islandFlag=4,$i_19.Dynamics.Contacts.b2Contact.e_toiFlag=8,$i_19.Dynamics.Contacts.b2Contact.e_touchingFlag=16,$i_19.Dynamics.Contacts.b2Contact.e_enabledFlag=32,$i_19.Dynamics.Contacts.b2Contact.e_filterFlag=64,$i_19.Dynamics.Contacts.b2Contact.s_input=new I}),r.b2ContactConstraint=function(){this.localPlaneNormal=new C,this.localPoint=new C,this.normal=new C,this.normalMass=new w,this.K=new w},r.prototype.b2ContactConstraint=function(){this.points=new Vector(b.b2_maxManifoldPoints);for(var t=0;b.b2_maxManifoldPoints>t;t++)this.points[t]=new a},a.b2ContactConstraintPoint=function(){this.localPoint=new C,this.rA=new C,this.rB=new C},l.b2ContactEdge=function(){},h.b2ContactFactory=function(){},h.prototype.b2ContactFactory=function(t){this.m_allocator=t,this.InitializeRegisters()},h.prototype.AddType=function(t,i,e,o){e===void 0&&(e=0),o===void 0&&(o=0),this.m_registers[e][o].createFcn=t,this.m_registers[e][o].destroyFcn=i,this.m_registers[e][o].primary=!0,e!=o&&(this.m_registers[o][e].createFcn=t,this.m_registers[o][e].destroyFcn=i,this.m_registers[o][e].primary=!1)},h.prototype.InitializeRegisters=function(){this.m_registers=new Vector(o.e_shapeTypeCount);for(var t=0;o.e_shapeTypeCount>t;t++){this.m_registers[t]=new Vector(o.e_shapeTypeCount);for(var i=0;o.e_shapeTypeCount>i;i++)this.m_registers[t][i]=new m}this.AddType(n.Create,n.Destroy,o.e_circleShape,o.e_circleShape),this.AddType(y.Create,y.Destroy,o.e_polygonShape,o.e_circleShape),this.AddType(x.Create,x.Destroy,o.e_polygonShape,o.e_polygonShape),this.AddType(u.Create,u.Destroy,o.e_edgeShape,o.e_circleShape),this.AddType(d.Create,d.Destroy,o.e_polygonShape,o.e_edgeShape)},h.prototype.Create=function(t,i){var e,o=parseInt(t.GetType()),n=parseInt(i.GetType()),s=this.m_registers[o][n];if(s.pool)return e=s.pool,s.pool=e.m_next,s.poolCount--,e.Reset(t,i),e;var r=s.createFcn;return r!=null?s.primary?(e=r(this.m_allocator),e.Reset(t,i),e):(e=r(this.m_allocator),e.Reset(i,t),e):null},h.prototype.Destroy=function(t){t.m_manifold.m_pointCount>0&&(t.m_fixtureA.m_body.SetAwake(!0),t.m_fixtureB.m_body.SetAwake(!0));var i=parseInt(t.m_fixtureA.GetType()),e=parseInt(t.m_fixtureB.GetType()),o=this.m_registers[i][e];o.poolCount++,t.m_next=o.pool,o.pool=t;var n=o.destroyFcn;n(t,this.m_allocator)},m.b2ContactRegister=function(){},c.b2ContactResult=function(){this.position=new C,this.normal=new C,this.id=new S},_.b2ContactSolver=function(){this.m_step=new v,this.m_constraints=new Vector},_.prototype.b2ContactSolver=function(){},_.prototype.Initialize=function(t,i,e,o){e===void 0&&(e=0);var n;this.m_step.Set(t),this.m_allocator=o;var s=0;this.m_constraintCount=e;while(this.m_constraintCount>this.m_constraints.length)this.m_constraints[this.m_constraints.length]=new r;for(s=0;e>s;++s){n=i[s];var a=n.m_fixtureA,l=n.m_fixtureB,h=a.m_shape,m=l.m_shape,c=h.m_radius,u=m.m_radius,p=a.m_body,y=l.m_body,d=n.GetManifold(),x=b.b2MixFriction(a.GetFriction(),l.GetFriction()),f=b.b2MixRestitution(a.GetRestitution(),l.GetRestitution()),g=p.m_linearVelocity.x,v=p.m_linearVelocity.y,w=y.m_linearVelocity.x,D=y.m_linearVelocity.y,C=p.m_angularVelocity,B=y.m_angularVelocity;b.b2Assert(d.m_pointCount>0),_.s_worldManifold.Initialize(d,p.m_xf,c,y.m_xf,u);var S=_.s_worldManifold.m_normal.x,A=_.s_worldManifold.m_normal.y,M=this.m_constraints[s];M.bodyA=p,M.bodyB=y,M.manifold=d,M.normal.x=S,M.normal.y=A,M.pointCount=d.m_pointCount,M.friction=x,M.restitution=f,M.localPlaneNormal.x=d.m_localPlaneNormal.x,M.localPlaneNormal.y=d.m_localPlaneNormal.y,M.localPoint.x=d.m_localPoint.x,M.localPoint.y=d.m_localPoint.y,M.radius=c+u,M.type=d.m_type;for(var I=0;M.pointCount>I;++I){var V=d.m_points[I],T=M.points[I];T.normalImpulse=V.m_normalImpulse,T.tangentImpulse=V.m_tangentImpulse,T.localPoint.SetV(V.m_localPoint);var P=T.rA.x=_.s_worldManifold.m_points[I].x-p.m_sweep.c.x,L=T.rA.y=_.s_worldManifold.m_points[I].y-p.m_sweep.c.y,k=T.rB.x=_.s_worldManifold.m_points[I].x-y.m_sweep.c.x,R=T.rB.y=_.s_worldManifold.m_points[I].y-y.m_sweep.c.y,G=P*A-L*S,F=k*A-R*S;G*=G,F*=F;var J=p.m_invMass+y.m_invMass+p.m_invI*G+y.m_invI*F;T.normalMass=1/J;var z=p.m_mass*p.m_invMass+y.m_mass*y.m_invMass;z+=p.m_mass*p.m_invI*G+y.m_mass*y.m_invI*F,T.equalizedMass=1/z;var E=A,O=-S,N=P*O-L*E,j=k*O-R*E;N*=N,j*=j;var U=p.m_invMass+y.m_invMass+p.m_invI*N+y.m_invI*j;T.tangentMass=1/U,T.velocityBias=0;var W=w+-B*R-g- -C*L,q=D+B*k-v-C*P,X=M.normal.x*W+M.normal.y*q;-b.b2_velocityThreshold>X&&(T.velocityBias+=-M.restitution*X)}if(M.pointCount==2){var K=M.points[0],Y=M.points[1],H=p.m_invMass,Z=p.m_invI,Q=y.m_invMass,$=y.m_invI,ti=K.rA.x*A-K.rA.y*S,ii=K.rB.x*A-K.rB.y*S,ei=Y.rA.x*A-Y.rA.y*S,oi=Y.rB.x*A-Y.rB.y*S,ni=H+Q+Z*ti*ti+$*ii*ii,si=H+Q+Z*ei*ei+$*oi*oi,ri=H+Q+Z*ti*ei+$*ii*oi,ai=100;ai*(ni*si-ri*ri)>ni*ni?(M.K.col1.Set(ni,ri),M.K.col2.Set(ri,si),M.K.GetInverse(M.normalMass)):M.pointCount=1}}},_.prototype.InitVelocityConstraints=function(t){for(var i=0;this.m_constraintCount>i;++i){var e=this.m_constraints[i],o=e.bodyA,n=e.bodyB,s=o.m_invMass,r=o.m_invI,a=n.m_invMass,l=n.m_invI,h=e.normal.x,m=e.normal.y,c=m,_=-h,u=0,p=0;if(t.warmStarting)for(p=e.pointCount,u=0;p>u;++u){var y=e.points[u];y.normalImpulse*=t.dtRatio,y.tangentImpulse*=t.dtRatio;var d=y.normalImpulse*h+y.tangentImpulse*c,x=y.normalImpulse*m+y.tangentImpulse*_;o.m_angularVelocity-=r*(y.rA.x*x-y.rA.y*d),o.m_linearVelocity.x-=s*d,o.m_linearVelocity.y-=s*x,n.m_angularVelocity+=l*(y.rB.x*x-y.rB.y*d),n.m_linearVelocity.x+=a*d,n.m_linearVelocity.y+=a*x}else for(p=e.pointCount,u=0;p>u;++u){var f=e.points[u];f.normalImpulse=0,f.tangentImpulse=0}}},_.prototype.SolveVelocityConstraints=function(){for(var t,i,e=0,o=0,n=0,s=0,r=0,a=0,l=0,h=0,m=0,c=0,_=0,u=0,p=0,y=0,d=0,x=0,f=0;this.m_constraintCount>f;++f){var g=this.m_constraints[f],v=g.bodyA,b=g.bodyB,w=v.m_angularVelocity,C=b.m_angularVelocity,B=v.m_linearVelocity,S=b.m_linearVelocity,A=v.m_invMass,M=v.m_invI,I=b.m_invMass,V=b.m_invI,T=g.normal.x,P=g.normal.y,L=P,k=-T,R=g.friction;for(e=0;g.pointCount>e;e++)t=g.points[e],o=S.x-C*t.rB.y-B.x+w*t.rA.y,n=S.y+C*t.rB.x-B.y-w*t.rA.x,r=o*L+n*k,a=t.tangentMass*-r,l=R*t.normalImpulse,h=D.Clamp(t.tangentImpulse+a,-l,l),a=h-t.tangentImpulse,m=a*L,c=a*k,B.x-=A*m,B.y-=A*c,w-=M*(t.rA.x*c-t.rA.y*m),S.x+=I*m,S.y+=I*c,C+=V*(t.rB.x*c-t.rB.y*m),t.tangentImpulse=h;if(parseInt(g.pointCount),g.pointCount==1)t=g.points[0],o=S.x+-C*t.rB.y-B.x- -w*t.rA.y,n=S.y+C*t.rB.x-B.y-w*t.rA.x,s=o*T+n*P,a=-t.normalMass*(s-t.velocityBias),h=t.normalImpulse+a,h=h>0?h:0,a=h-t.normalImpulse,m=a*T,c=a*P,B.x-=A*m,B.y-=A*c,w-=M*(t.rA.x*c-t.rA.y*m),S.x+=I*m,S.y+=I*c,C+=V*(t.rB.x*c-t.rB.y*m),t.normalImpulse=h;else{var G=g.points[0],F=g.points[1],J=G.normalImpulse,z=F.normalImpulse,E=S.x-C*G.rB.y-B.x+w*G.rA.y,O=S.y+C*G.rB.x-B.y-w*G.rA.x,N=S.x-C*F.rB.y-B.x+w*F.rA.y,j=S.y+C*F.rB.x-B.y-w*F.rA.x,U=E*T+O*P,W=N*T+j*P,q=U-G.velocityBias,X=W-F.velocityBias;for(i=g.K,q-=i.col1.x*J+i.col2.x*z,X-=i.col1.y*J+i.col2.y*z;;){i=g.normalMass;var K=-(i.col1.x*q+i.col2.x*X),Y=-(i.col1.y*q+i.col2.y*X);if(K>=0&&Y>=0){_=K-J,u=Y-z,p=_*T,y=_*P,d=u*T,x=u*P,B.x-=A*(p+d),B.y-=A*(y+x),w-=M*(G.rA.x*y-G.rA.y*p+F.rA.x*x-F.rA.y*d),S.x+=I*(p+d),S.y+=I*(y+x),C+=V*(G.rB.x*y-G.rB.y*p+F.rB.x*x-F.rB.y*d),G.normalImpulse=K,F.normalImpulse=Y;break}if(K=-G.normalMass*q,Y=0,U=0,W=g.K.col1.y*K+X,K>=0&&W>=0){_=K-J,u=Y-z,p=_*T,y=_*P,d=u*T,x=u*P,B.x-=A*(p+d),B.y-=A*(y+x),w-=M*(G.rA.x*y-G.rA.y*p+F.rA.x*x-F.rA.y*d),S.x+=I*(p+d),S.y+=I*(y+x),C+=V*(G.rB.x*y-G.rB.y*p+F.rB.x*x-F.rB.y*d),G.normalImpulse=K,F.normalImpulse=Y;break}if(K=0,Y=-F.normalMass*X,U=g.K.col2.x*Y+q,W=0,Y>=0&&U>=0){_=K-J,u=Y-z,p=_*T,y=_*P,d=u*T,x=u*P,B.x-=A*(p+d),B.y-=A*(y+x),w-=M*(G.rA.x*y-G.rA.y*p+F.rA.x*x-F.rA.y*d),S.x+=I*(p+d),S.y+=I*(y+x),C+=V*(G.rB.x*y-G.rB.y*p+F.rB.x*x-F.rB.y*d),G.normalImpulse=K,F.normalImpulse=Y;break}if(K=0,Y=0,U=q,W=X,U>=0&&W>=0){_=K-J,u=Y-z,p=_*T,y=_*P,d=u*T,x=u*P,B.x-=A*(p+d),B.y-=A*(y+x),w-=M*(G.rA.x*y-G.rA.y*p+F.rA.x*x-F.rA.y*d),S.x+=I*(p+d),S.y+=I*(y+x),C+=V*(G.rB.x*y-G.rB.y*p+F.rB.x*x-F.rB.y*d),G.normalImpulse=K,F.normalImpulse=Y;break}break}}v.m_angularVelocity=w,b.m_angularVelocity=C}},_.prototype.FinalizeVelocityConstraints=function(){for(var t=0;this.m_constraintCount>t;++t)for(var i=this.m_constraints[t],e=i.manifold,o=0;i.pointCount>o;++o){var n=e.m_points[o],s=i.points[o];n.m_normalImpulse=s.normalImpulse,n.m_tangentImpulse=s.tangentImpulse}},_.prototype.SolvePositionConstraints=function(t){t===void 0&&(t=0);for(var i=0,e=0;this.m_constraintCount>e;e++){var o=this.m_constraints[e],n=o.bodyA,s=o.bodyB,r=n.m_mass*n.m_invMass,a=n.m_mass*n.m_invI,l=s.m_mass*s.m_invMass,h=s.m_mass*s.m_invI;_.s_psm.Initialize(o);for(var m=_.s_psm.m_normal,c=0;o.pointCount>c;c++){var u=o.points[c],p=_.s_psm.m_points[c],y=_.s_psm.m_separations[c],d=p.x-n.m_sweep.c.x,x=p.y-n.m_sweep.c.y,f=p.x-s.m_sweep.c.x,g=p.y-s.m_sweep.c.y;i=y>i?i:y;var v=D.Clamp(t*(y+b.b2_linearSlop),-b.b2_maxLinearCorrection,0),w=-u.equalizedMass*v,C=w*m.x,B=w*m.y;n.m_sweep.c.x-=r*C,n.m_sweep.c.y-=r*B,n.m_sweep.a-=a*(d*B-x*C),n.SynchronizeTransform(),s.m_sweep.c.x+=l*C,s.m_sweep.c.y+=l*B,s.m_sweep.a+=h*(f*B-g*C),s.SynchronizeTransform()}}return i>-1.5*b.b2_linearSlop},$i_19.postDefs.push(function(){$i_19.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new V,$i_19.Dynamics.Contacts.b2ContactSolver.s_psm=new f}),$i_19.inherit(u,$i_19.Dynamics.Contacts.b2Contact),u.prototype.__super=$i_19.Dynamics.Contacts.b2Contact.prototype,u.b2EdgeAndCircleContact=function(){$i_19.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},u.Create=function(){return new u},u.Destroy=function(){},u.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)},u.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,o.m_xf)},u.prototype.b2CollideEdgeAndCircle=function(){},$i_19.inherit(p,$i_19.Dynamics.Contacts.b2Contact),p.prototype.__super=$i_19.Dynamics.Contacts.b2Contact.prototype,p.b2NullContact=function(){$i_19.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},p.prototype.Evaluate=function(){},$i_19.inherit(y,$i_19.Dynamics.Contacts.b2Contact),y.prototype.__super=$i_19.Dynamics.Contacts.b2Contact.prototype,y.b2PolyAndCircleContact=function(){$i_19.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(){return new y},y.Destroy=function(){},y.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i),b.b2Assert(t.GetType()==o.e_polygonShape),b.b2Assert(i.GetType()==o.e_circleShape)},y.prototype.Evaluate=function(){var i=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body;B.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,o.m_xf)},$i_19.inherit(d,$i_19.Dynamics.Contacts.b2Contact),d.prototype.__super=$i_19.Dynamics.Contacts.b2Contact.prototype,d.b2PolyAndEdgeContact=function(){$i_19.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},d.Create=function(){return new d},d.Destroy=function(){},d.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i),b.b2Assert(t.GetType()==o.e_polygonShape),b.b2Assert(i.GetType()==o.e_edgeShape)},d.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,o.m_xf)},d.prototype.b2CollidePolyAndEdge=function(){},$i_19.inherit(x,$i_19.Dynamics.Contacts.b2Contact),x.prototype.__super=$i_19.Dynamics.Contacts.b2Contact.prototype,x.b2PolygonContact=function(){$i_19.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},x.Create=function(){return new x},x.Destroy=function(){},x.prototype.Reset=function(t,i){this.__super.Reset.call(this,t,i)},x.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();B.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,i.m_xf)},f.b2PositionSolverManifold=function(){},f.prototype.b2PositionSolverManifold=function(){this.m_normal=new C,this.m_separations=new Vector_a2j_Number(b.b2_maxManifoldPoints),this.m_points=new Vector(b.b2_maxManifoldPoints);for(var t=0;b.b2_maxManifoldPoints>t;t++)this.m_points[t]=new C},f.prototype.Initialize=function(t){b.b2Assert(t.pointCount>0);var i,e,o=0,n=0,s=0,r=0,a=0;switch(t.type){case A.e_circles:i=t.bodyA.m_xf.R,e=t.localPoint;var l=t.bodyA.m_xf.position.x+(i.col1.x*e.x+i.col2.x*e.y),h=t.bodyA.m_xf.position.y+(i.col1.y*e.x+i.col2.y*e.y);i=t.bodyB.m_xf.R,e=t.points[0].localPoint;var m=t.bodyB.m_xf.position.x+(i.col1.x*e.x+i.col2.x*e.y),c=t.bodyB.m_xf.position.y+(i.col1.y*e.x+i.col2.y*e.y),_=m-l,u=c-h,p=_*_+u*u;if(p>Number.MIN_VALUE*Number.MIN_VALUE){var y=Math.sqrt(p);this.m_normal.x=_/y,this.m_normal.y=u/y}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(l+m),this.m_points[0].y=.5*(h+c),this.m_separations[0]=_*this.m_normal.x+u*this.m_normal.y-t.radius;break;case A.e_faceA:for(i=t.bodyA.m_xf.R,e=t.localPlaneNormal,this.m_normal.x=i.col1.x*e.x+i.col2.x*e.y,this.m_normal.y=i.col1.y*e.x+i.col2.y*e.y,i=t.bodyA.m_xf.R,e=t.localPoint,r=t.bodyA.m_xf.position.x+(i.col1.x*e.x+i.col2.x*e.y),a=t.bodyA.m_xf.position.y+(i.col1.y*e.x+i.col2.y*e.y),i=t.bodyB.m_xf.R,o=0;t.pointCount>o;++o)e=t.points[o].localPoint,n=t.bodyB.m_xf.position.x+(i.col1.x*e.x+i.col2.x*e.y),s=t.bodyB.m_xf.position.y+(i.col1.y*e.x+i.col2.y*e.y),this.m_separations[o]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius,this.m_points[o].x=n,this.m_points[o].y=s;break;case A.e_faceB:for(i=t.bodyB.m_xf.R,e=t.localPlaneNormal,this.m_normal.x=i.col1.x*e.x+i.col2.x*e.y,this.m_normal.y=i.col1.y*e.x+i.col2.y*e.y,i=t.bodyB.m_xf.R,e=t.localPoint,r=t.bodyB.m_xf.position.x+(i.col1.x*e.x+i.col2.x*e.y),a=t.bodyB.m_xf.position.y+(i.col1.y*e.x+i.col2.y*e.y),i=t.bodyA.m_xf.R,o=0;t.pointCount>o;++o)e=t.points[o].localPoint,n=t.bodyA.m_xf.position.x+(i.col1.x*e.x+i.col2.x*e.y),s=t.bodyA.m_xf.position.y+(i.col1.y*e.x+i.col2.y*e.y),this.m_separations[o]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius,this.m_points[o].Set(n,s);this.m_normal.x*=-1,this.m_normal.y*=-1}},$i_19.postDefs.push(function(){$i_19.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new C,$i_19.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new C})}(),function(){var t=($i_19.Dynamics.b2Body,$i_19.Dynamics.b2BodyDef,$i_19.Dynamics.b2ContactFilter,$i_19.Dynamics.b2ContactImpulse,$i_19.Dynamics.b2ContactListener,$i_19.Dynamics.b2ContactManager,$i_19.Dynamics.b2DebugDraw,$i_19.Dynamics.b2DestructionListener,$i_19.Dynamics.b2FilterData,$i_19.Dynamics.b2Fixture,$i_19.Dynamics.b2FixtureDef,$i_19.Dynamics.b2Island,$i_19.Dynamics.b2TimeStep,$i_19.Dynamics.b2World,$i_19.Common.Math.b2Mat22),i=($i_19.Common.Math.b2Mat33,$i_19.Common.Math.b2Math),e=($i_19.Common.Math.b2Sweep,$i_19.Common.Math.b2Transform,$i_19.Common.Math.b2Vec2),o=($i_19.Common.Math.b2Vec3,$i_19.Common.b2Color),n=($i_19.Common.b2internal,$i_19.Common.b2Settings,$i_19.Collision.Shapes.b2CircleShape,$i_19.Collision.Shapes.b2EdgeChainDef,$i_19.Collision.Shapes.b2EdgeShape,$i_19.Collision.Shapes.b2MassData,$i_19.Collision.Shapes.b2PolygonShape,$i_19.Collision.Shapes.b2Shape,$i_19.Dynamics.Controllers.b2BuoyancyController),s=$i_19.Dynamics.Controllers.b2ConstantAccelController,r=$i_19.Dynamics.Controllers.b2ConstantForceController,a=$i_19.Dynamics.Controllers.b2Controller,l=$i_19.Dynamics.Controllers.b2ControllerEdge,h=$i_19.Dynamics.Controllers.b2GravityController,m=$i_19.Dynamics.Controllers.b2TensorDampingController;$i_19.inherit(n,$i_19.Dynamics.Controllers.b2Controller),n.prototype.__super=$i_19.Dynamics.Controllers.b2Controller.prototype,n.b2BuoyancyController=function(){$i_19.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new e(0,-1),this.offset=0,this.density=0,this.velocity=new e(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},n.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var t=this.m_bodyList;t;t=t.nextBody){var i=t.body;if(i.IsAwake()!=0){for(var o=new e,n=new e,s=0,r=0,a=i.GetFixtureList();a;a=a.GetNext()){var l=new e,h=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),l);s+=h,o.x+=h*l.x,o.y+=h*l.y;var m=0;m=this.useDensity?1:1,r+=h*m,n.x+=h*l.x*m,n.y+=h*l.y*m}if(o.x/=s,o.y/=s,n.x/=r,n.y/=r,s>=Number.MIN_VALUE){var c=this.gravity.GetNegative();c.Multiply(this.density*s),i.ApplyForce(c,n);var _=i.GetLinearVelocityFromWorldPoint(o);_.Subtract(this.velocity),_.Multiply(-this.linearDrag*s),i.ApplyForce(_,o),i.ApplyTorque(-i.GetInertia()/i.GetMass()*s*i.GetAngularVelocity()*this.angularDrag)}}}}},n.prototype.Draw=function(t){var i=1e3,n=new e,s=new e;n.x=this.normal.x*this.offset+this.normal.y*i,n.y=this.normal.y*this.offset-this.normal.x*i,s.x=this.normal.x*this.offset-this.normal.y*i,s.y=this.normal.y*this.offset+this.normal.x*i;var r=new o(0,0,1);t.DrawSegment(n,s,r)},$i_19.inherit(s,$i_19.Dynamics.Controllers.b2Controller),s.prototype.__super=$i_19.Dynamics.Controllers.b2Controller.prototype,s.b2ConstantAccelController=function(){$i_19.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new e(0,0)},s.prototype.Step=function(t){for(var i=new e(this.A.x*t.dt,this.A.y*t.dt),o=this.m_bodyList;o;o=o.nextBody){var n=o.body;n.IsAwake()&&n.SetLinearVelocity(new e(n.GetLinearVelocity().x+i.x,n.GetLinearVelocity().y+i.y))}},$i_19.inherit(r,$i_19.Dynamics.Controllers.b2Controller),r.prototype.__super=$i_19.Dynamics.Controllers.b2Controller.prototype,r.b2ConstantForceController=function(){$i_19.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new e(0,0)},r.prototype.Step=function(){for(var t=this.m_bodyList;t;t=t.nextBody){var i=t.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter())}},a.b2Controller=function(){},a.prototype.Step=function(){},a.prototype.Draw=function(){},a.prototype.AddBody=function(t){var i=new l;i.controller=this,i.body=t,i.nextBody=this.m_bodyList,i.prevBody=null,this.m_bodyList=i,i.nextBody&&(i.nextBody.prevBody=i),this.m_bodyCount++,i.nextController=t.m_controllerList,i.prevController=null,t.m_controllerList=i,i.nextController&&(i.nextController.prevController=i),t.m_controllerCount++
},a.prototype.RemoveBody=function(t){var i=t.m_controllerList;while(i&&i.controller!=this)i=i.nextController;i.prevBody&&(i.prevBody.nextBody=i.nextBody),i.nextBody&&(i.nextBody.prevBody=i.prevBody),i.nextController&&(i.nextController.prevController=i.prevController),i.prevController&&(i.prevController.nextController=i.nextController),this.m_bodyList==i&&(this.m_bodyList=i.nextBody),t.m_controllerList==i&&(t.m_controllerList=i.nextController),t.m_controllerCount--,this.m_bodyCount--},a.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)},a.prototype.GetNext=function(){return this.m_next},a.prototype.GetWorld=function(){return this.m_world},a.prototype.GetBodyList=function(){return this.m_bodyList},l.b2ControllerEdge=function(){},$i_19.inherit(h,$i_19.Dynamics.Controllers.b2Controller),h.prototype.__super=$i_19.Dynamics.Controllers.b2Controller.prototype,h.b2GravityController=function(){$i_19.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},h.prototype.Step=function(){var t=null,i=null,o=null,n=0,s=null,r=null,a=null,l=0,h=0,m=0,c=null;if(this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody)for(i=t.body,o=i.GetWorldCenter(),n=i.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody)r=s.body,a=r.GetWorldCenter(),l=a.x-o.x,h=a.y-o.y,m=l*l+h*h,Number.MIN_VALUE>m||(c=new e(l,h),c.Multiply(this.G/m/Math.sqrt(m)*n*r.GetMass()),i.IsAwake()&&i.ApplyForce(c,o),c.Multiply(-1),r.IsAwake()&&r.ApplyForce(c,a));else for(t=this.m_bodyList;t;t=t.nextBody)for(i=t.body,o=i.GetWorldCenter(),n=i.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody)r=s.body,a=r.GetWorldCenter(),l=a.x-o.x,h=a.y-o.y,m=l*l+h*h,Number.MIN_VALUE>m||(c=new e(l,h),c.Multiply(this.G/m*n*r.GetMass()),i.IsAwake()&&i.ApplyForce(c,o),c.Multiply(-1),r.IsAwake()&&r.ApplyForce(c,a))},$i_19.inherit(m,$i_19.Dynamics.Controllers.b2Controller),m.prototype.__super=$i_19.Dynamics.Controllers.b2Controller.prototype,m.b2TensorDampingController=function(){$i_19.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new t,this.maxTimestep=0},m.prototype.SetAxisAligned=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-i,this.maxTimestep=t>0||i>0?1/Math.max(t,i):0},m.prototype.Step=function(t){var o=t.dt;if(o>Number.MIN_VALUE){o>this.maxTimestep&&this.maxTimestep>0&&(o=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var s=n.body;if(s.IsAwake()){var r=s.GetWorldVector(i.MulMV(this.T,s.GetLocalVector(s.GetLinearVelocity())));s.SetLinearVelocity(new e(s.GetLinearVelocity().x+r.x*o,s.GetLinearVelocity().y+r.y*o))}}}}}(),function(){var t=($i_19.Common.b2Color,$i_19.Common.b2internal,$i_19.Common.b2Settings),i=$i_19.Common.Math.b2Mat22,e=$i_19.Common.Math.b2Mat33,o=$i_19.Common.Math.b2Math,n=($i_19.Common.Math.b2Sweep,$i_19.Common.Math.b2Transform,$i_19.Common.Math.b2Vec2),s=$i_19.Common.Math.b2Vec3,r=$i_19.Dynamics.Joints.b2DistanceJoint,a=$i_19.Dynamics.Joints.b2DistanceJointDef,l=$i_19.Dynamics.Joints.b2FrictionJoint,h=$i_19.Dynamics.Joints.b2FrictionJointDef,m=$i_19.Dynamics.Joints.b2GearJoint,c=$i_19.Dynamics.Joints.b2GearJointDef,_=$i_19.Dynamics.Joints.b2Jacobian,u=$i_19.Dynamics.Joints.b2Joint,p=$i_19.Dynamics.Joints.b2JointDef,y=$i_19.Dynamics.Joints.b2JointEdge,d=$i_19.Dynamics.Joints.b2LineJoint,x=$i_19.Dynamics.Joints.b2LineJointDef,f=$i_19.Dynamics.Joints.b2MouseJoint,g=$i_19.Dynamics.Joints.b2MouseJointDef,v=$i_19.Dynamics.Joints.b2PrismaticJoint,b=$i_19.Dynamics.Joints.b2PrismaticJointDef,w=$i_19.Dynamics.Joints.b2PulleyJoint,D=$i_19.Dynamics.Joints.b2PulleyJointDef,C=$i_19.Dynamics.Joints.b2RevoluteJoint,B=$i_19.Dynamics.Joints.b2RevoluteJointDef,S=$i_19.Dynamics.Joints.b2WeldJoint,A=$i_19.Dynamics.Joints.b2WeldJointDef;$i_19.Dynamics.b2Body,$i_19.Dynamics.b2BodyDef,$i_19.Dynamics.b2ContactFilter,$i_19.Dynamics.b2ContactImpulse,$i_19.Dynamics.b2ContactListener,$i_19.Dynamics.b2ContactManager,$i_19.Dynamics.b2DebugDraw,$i_19.Dynamics.b2DestructionListener,$i_19.Dynamics.b2FilterData,$i_19.Dynamics.b2Fixture,$i_19.Dynamics.b2FixtureDef,$i_19.Dynamics.b2Island,$i_19.Dynamics.b2TimeStep,$i_19.Dynamics.b2World,$i_19.inherit(r,$i_19.Dynamics.Joints.b2Joint),r.prototype.__super=$i_19.Dynamics.Joints.b2Joint.prototype,r.b2DistanceJoint=function(){$i_19.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u=new n},r.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},r.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},r.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},r.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),0},r.prototype.GetLength=function(){return this.m_length},r.prototype.SetLength=function(t){t===void 0&&(t=0),this.m_length=t},r.prototype.GetFrequency=function(){return this.m_frequencyHz},r.prototype.SetFrequency=function(t){t===void 0&&(t=0),this.m_frequencyHz=t},r.prototype.GetDampingRatio=function(){return this.m_dampingRatio},r.prototype.SetDampingRatio=function(t){t===void 0&&(t=0),this.m_dampingRatio=t},r.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},r.prototype.InitVelocityConstraints=function(i){var e,o=0,n=this.m_bodyA,s=this.m_bodyB;e=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;o=e.col1.x*r+e.col2.x*a,a=e.col1.y*r+e.col2.y*a,r=o,e=s.m_xf.R;var l=this.m_localAnchor2.x-s.m_sweep.localCenter.x,h=this.m_localAnchor2.y-s.m_sweep.localCenter.y;o=e.col1.x*l+e.col2.x*h,h=e.col1.y*l+e.col2.y*h,l=o,this.m_u.x=s.m_sweep.c.x+l-n.m_sweep.c.x-r,this.m_u.y=s.m_sweep.c.y+h-n.m_sweep.c.y-a;var m=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);m>t.b2_linearSlop?this.m_u.Multiply(1/m):this.m_u.SetZero();var c=r*this.m_u.y-a*this.m_u.x,_=l*this.m_u.y-h*this.m_u.x,u=n.m_invMass+n.m_invI*c*c+s.m_invMass+s.m_invI*_*_;if(this.m_mass=u!=0?1/u:0,this.m_frequencyHz>0){var p=m-this.m_length,y=2*Math.PI*this.m_frequencyHz,d=2*this.m_mass*this.m_dampingRatio*y,x=this.m_mass*y*y;this.m_gamma=i.dt*(d+i.dt*x),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=p*i.dt*x*this.m_gamma,this.m_mass=u+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(i.warmStarting){this.m_impulse*=i.dtRatio;var f=this.m_impulse*this.m_u.x,g=this.m_impulse*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*f,n.m_linearVelocity.y-=n.m_invMass*g,n.m_angularVelocity-=n.m_invI*(r*g-a*f),s.m_linearVelocity.x+=s.m_invMass*f,s.m_linearVelocity.y+=s.m_invMass*g,s.m_angularVelocity+=s.m_invI*(l*g-h*f)}else this.m_impulse=0},r.prototype.SolveVelocityConstraints=function(){var t,i=this.m_bodyA,e=this.m_bodyB;t=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*n;n=t.col1.y*o+t.col2.y*n,o=s,t=e.m_xf.R;var r=this.m_localAnchor2.x-e.m_sweep.localCenter.x,a=this.m_localAnchor2.y-e.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var l=i.m_linearVelocity.x+-i.m_angularVelocity*n,h=i.m_linearVelocity.y+i.m_angularVelocity*o,m=e.m_linearVelocity.x+-e.m_angularVelocity*a,c=e.m_linearVelocity.y+e.m_angularVelocity*r,_=this.m_u.x*(m-l)+this.m_u.y*(c-h),u=-this.m_mass*(_+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var p=u*this.m_u.x,y=u*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*p,i.m_linearVelocity.y-=i.m_invMass*y,i.m_angularVelocity-=i.m_invI*(o*y-n*p),e.m_linearVelocity.x+=e.m_invMass*p,e.m_linearVelocity.y+=e.m_invMass*y,e.m_angularVelocity+=e.m_invI*(r*y-a*p)},r.prototype.SolvePositionConstraints=function(i){i===void 0&&(i=0);var e;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,s=this.m_bodyB;e=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y,l=e.col1.x*r+e.col2.x*a;a=e.col1.y*r+e.col2.y*a,r=l,e=s.m_xf.R;var h=this.m_localAnchor2.x-s.m_sweep.localCenter.x,m=this.m_localAnchor2.y-s.m_sweep.localCenter.y;l=e.col1.x*h+e.col2.x*m,m=e.col1.y*h+e.col2.y*m,h=l;var c=s.m_sweep.c.x+h-n.m_sweep.c.x-r,_=s.m_sweep.c.y+m-n.m_sweep.c.y-a,u=Math.sqrt(c*c+_*_);c/=u,_/=u;var p=u-this.m_length;p=o.Clamp(p,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var y=-this.m_mass*p;this.m_u.Set(c,_);var d=y*this.m_u.x,x=y*this.m_u.y;return n.m_sweep.c.x-=n.m_invMass*d,n.m_sweep.c.y-=n.m_invMass*x,n.m_sweep.a-=n.m_invI*(r*x-a*d),s.m_sweep.c.x+=s.m_invMass*d,s.m_sweep.c.y+=s.m_invMass*x,s.m_sweep.a+=s.m_invI*(h*x-m*d),n.SynchronizeTransform(),s.SynchronizeTransform(),t.b2_linearSlop>o.Abs(p)},$i_19.inherit(a,$i_19.Dynamics.Joints.b2JointDef),a.prototype.__super=$i_19.Dynamics.Joints.b2JointDef.prototype,a.b2DistanceJointDef=function(){$i_19.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},a.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},a.prototype.Initialize=function(t,i,e,o){this.bodyA=t,this.bodyB=i,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(e)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o));var n=o.x-e.x,s=o.y-e.y;this.length=Math.sqrt(n*n+s*s),this.frequencyHz=0,this.dampingRatio=0},$i_19.inherit(l,$i_19.Dynamics.Joints.b2Joint),l.prototype.__super=$i_19.Dynamics.Joints.b2Joint.prototype,l.b2FrictionJoint=function(){$i_19.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_linearMass=new i,this.m_linearImpulse=new n},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},l.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},l.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_angularImpulse},l.prototype.SetMaxForce=function(t){t===void 0&&(t=0),this.m_maxForce=t},l.prototype.GetMaxForce=function(){return this.m_maxForce},l.prototype.SetMaxTorque=function(t){t===void 0&&(t=0),this.m_maxTorque=t},l.prototype.GetMaxTorque=function(){return this.m_maxTorque},l.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},l.prototype.InitVelocityConstraints=function(t){var e,o=0,n=this.m_bodyA,s=this.m_bodyB;e=n.m_xf.R;var r=this.m_localAnchorA.x-n.m_sweep.localCenter.x,a=this.m_localAnchorA.y-n.m_sweep.localCenter.y;o=e.col1.x*r+e.col2.x*a,a=e.col1.y*r+e.col2.y*a,r=o,e=s.m_xf.R;var l=this.m_localAnchorB.x-s.m_sweep.localCenter.x,h=this.m_localAnchorB.y-s.m_sweep.localCenter.y;o=e.col1.x*l+e.col2.x*h,h=e.col1.y*l+e.col2.y*h,l=o;var m=n.m_invMass,c=s.m_invMass,_=n.m_invI,u=s.m_invI,p=new i;if(p.col1.x=m+c,p.col2.x=0,p.col1.y=0,p.col2.y=m+c,p.col1.x+=_*a*a,p.col2.x+=-_*r*a,p.col1.y+=-_*r*a,p.col2.y+=_*r*r,p.col1.x+=u*h*h,p.col2.x+=-u*l*h,p.col1.y+=-u*l*h,p.col2.y+=u*l*l,p.GetInverse(this.m_linearMass),this.m_angularMass=_+u,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio;var y=this.m_linearImpulse;n.m_linearVelocity.x-=m*y.x,n.m_linearVelocity.y-=m*y.y,n.m_angularVelocity-=_*(r*y.y-a*y.x+this.m_angularImpulse),s.m_linearVelocity.x+=c*y.x,s.m_linearVelocity.y+=c*y.y,s.m_angularVelocity+=u*(l*y.y-h*y.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},l.prototype.SolveVelocityConstraints=function(t){var i,e=0,s=this.m_bodyA,r=this.m_bodyB,a=s.m_linearVelocity,l=s.m_angularVelocity,h=r.m_linearVelocity,m=r.m_angularVelocity,c=s.m_invMass,_=r.m_invMass,u=s.m_invI,p=r.m_invI;i=s.m_xf.R;var y=this.m_localAnchorA.x-s.m_sweep.localCenter.x,d=this.m_localAnchorA.y-s.m_sweep.localCenter.y;e=i.col1.x*y+i.col2.x*d,d=i.col1.y*y+i.col2.y*d,y=e,i=r.m_xf.R;var x=this.m_localAnchorB.x-r.m_sweep.localCenter.x,f=this.m_localAnchorB.y-r.m_sweep.localCenter.y;e=i.col1.x*x+i.col2.x*f,f=i.col1.y*x+i.col2.y*f,x=e;var g=0,v=m-l,b=-this.m_angularMass*v,w=this.m_angularImpulse;g=t.dt*this.m_maxTorque,this.m_angularImpulse=o.Clamp(this.m_angularImpulse+b,-g,g),b=this.m_angularImpulse-w,l-=u*b,m+=p*b;var D=h.x-m*f-a.x+l*d,C=h.y+m*x-a.y-l*y,B=o.MulMV(this.m_linearMass,new n(-D,-C)),S=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(B),g=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>g*g&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(g)),B=o.SubtractVV(this.m_linearImpulse,S),a.x-=c*B.x,a.y-=c*B.y,l-=u*(y*B.y-d*B.x),h.x+=_*B.x,h.y+=_*B.y,m+=p*(x*B.y-f*B.x),s.m_angularVelocity=l,r.m_angularVelocity=m},l.prototype.SolvePositionConstraints=function(t){return t===void 0&&(t=0),!0},$i_19.inherit(h,$i_19.Dynamics.Joints.b2JointDef),h.prototype.__super=$i_19.Dynamics.Joints.b2JointDef.prototype,h.b2FrictionJointDef=function(){$i_19.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},h.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_frictionJoint,this.maxForce=0,this.maxTorque=0},h.prototype.Initialize=function(t,i,e){this.bodyA=t,this.bodyB=i,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(e)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e))},$i_19.inherit(m,$i_19.Dynamics.Joints.b2Joint),m.prototype.__super=$i_19.Dynamics.Joints.b2Joint.prototype,m.b2GearJoint=function(){$i_19.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_J=new _},m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},m.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},m.prototype.GetReactionTorque=function(t){t===void 0&&(t=0);var i=this.m_bodyB.m_xf.R,e=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,o=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=i.col1.x*e+i.col2.x*o;o=i.col1.y*e+i.col2.y*o,e=n;var s=this.m_impulse*this.m_J.linearB.x,r=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-e*r+o*s)},m.prototype.GetRatio=function(){return this.m_ratio},m.prototype.SetRatio=function(t){t===void 0&&(t=0),this.m_ratio=t},m.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var i=parseInt(t.joint1.m_type),e=parseInt(t.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var o=0,n=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),i==u.e_revoluteJoint?(this.m_revolute1=t.joint1 instanceof C?t.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),o=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1 instanceof v?t.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),o=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),e==u.e_revoluteJoint?(this.m_revolute2=t.joint2 instanceof C?t.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),n=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2 instanceof v?t.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),n=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=o+this.m_ratio*n,this.m_impulse=0},m.prototype.InitVelocityConstraints=function(t){var i,e,o=this.m_ground1,n=this.m_ground2,s=this.m_bodyA,r=this.m_bodyB,a=0,l=0,h=0,m=0,c=0,_=0,u=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,u+=s.m_invI):(i=o.m_xf.R,e=this.m_prismatic1.m_localXAxis1,a=i.col1.x*e.x+i.col2.x*e.y,l=i.col1.y*e.x+i.col2.y*e.y,i=s.m_xf.R,h=this.m_localAnchor1.x-s.m_sweep.localCenter.x,m=this.m_localAnchor1.y-s.m_sweep.localCenter.y,_=i.col1.x*h+i.col2.x*m,m=i.col1.y*h+i.col2.y*m,h=_,c=h*l-m*a,this.m_J.linearA.Set(-a,-l),this.m_J.angularA=-c,u+=s.m_invMass+s.m_invI*c*c),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,u+=this.m_ratio*this.m_ratio*r.m_invI):(i=n.m_xf.R,e=this.m_prismatic2.m_localXAxis1,a=i.col1.x*e.x+i.col2.x*e.y,l=i.col1.y*e.x+i.col2.y*e.y,i=r.m_xf.R,h=this.m_localAnchor2.x-r.m_sweep.localCenter.x,m=this.m_localAnchor2.y-r.m_sweep.localCenter.y,_=i.col1.x*h+i.col2.x*m,m=i.col1.y*h+i.col2.y*m,h=_,c=h*l-m*a,this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*l),this.m_J.angularB=-this.m_ratio*c,u+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*c*c)),this.m_mass=u>0?1/u:0,t.warmStarting?(s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearA.x,s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearA.y,s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},m.prototype.SolveVelocityConstraints=function(){var t=this.m_bodyA,i=this.m_bodyB,e=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity),o=-this.m_mass*e;this.m_impulse+=o,t.m_linearVelocity.x+=t.m_invMass*o*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*o*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*o*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*o*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*o*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*o*this.m_J.angularB},m.prototype.SolvePositionConstraints=function(i){i===void 0&&(i=0);var e=0,o=this.m_bodyA,n=this.m_bodyB,s=0,r=0;s=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),r=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var a=this.m_constant-(s+this.m_ratio*r),l=-this.m_mass*a;return o.m_sweep.c.x+=o.m_invMass*l*this.m_J.linearA.x,o.m_sweep.c.y+=o.m_invMass*l*this.m_J.linearA.y,o.m_sweep.a+=o.m_invI*l*this.m_J.angularA,n.m_sweep.c.x+=n.m_invMass*l*this.m_J.linearB.x,n.m_sweep.c.y+=n.m_invMass*l*this.m_J.linearB.y,n.m_sweep.a+=n.m_invI*l*this.m_J.angularB,o.SynchronizeTransform(),n.SynchronizeTransform(),t.b2_linearSlop>e},$i_19.inherit(c,$i_19.Dynamics.Joints.b2JointDef),c.prototype.__super=$i_19.Dynamics.Joints.b2JointDef.prototype,c.b2GearJointDef=function(){$i_19.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},c.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},_.b2Jacobian=function(){this.linearA=new n,this.linearB=new n},_.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},_.prototype.Set=function(t,i,e,o){i===void 0&&(i=0),o===void 0&&(o=0),this.linearA.SetV(t),this.angularA=i,this.linearB.SetV(e),this.angularB=o},_.prototype.Compute=function(t,i,e,o){return i===void 0&&(i=0),o===void 0&&(o=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*i+(this.linearB.x*e.x+this.linearB.y*e.y)+this.angularB*o},u.b2Joint=function(){this.m_edgeA=new y,this.m_edgeB=new y,this.m_localCenterA=new n,this.m_localCenterB=new n},u.prototype.GetType=function(){return this.m_type},u.prototype.GetAnchorA=function(){return null},u.prototype.GetAnchorB=function(){return null},u.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),null},u.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),0},u.prototype.GetBodyA=function(){return this.m_bodyA},u.prototype.GetBodyB=function(){return this.m_bodyB},u.prototype.GetNext=function(){return this.m_next},u.prototype.GetUserData=function(){return this.m_userData},u.prototype.SetUserData=function(t){this.m_userData=t},u.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},u.Create=function(t){var i=null;switch(t.type){case u.e_distanceJoint:i=new r(t instanceof a?t:null);break;case u.e_mouseJoint:i=new f(t instanceof g?t:null);break;case u.e_prismaticJoint:i=new v(t instanceof b?t:null);break;case u.e_revoluteJoint:i=new C(t instanceof B?t:null);break;case u.e_pulleyJoint:i=new w(t instanceof D?t:null);break;case u.e_gearJoint:i=new m(t instanceof c?t:null);break;case u.e_lineJoint:i=new d(t instanceof x?t:null);break;case u.e_weldJoint:i=new S(t instanceof A?t:null);break;case u.e_frictionJoint:i=new l(t instanceof h?t:null);break;default:}return i},u.Destroy=function(){},u.prototype.b2Joint=function(i){t.b2Assert(i.bodyA!=i.bodyB),this.m_type=i.type,this.m_prev=null,this.m_next=null,this.m_bodyA=i.bodyA,this.m_bodyB=i.bodyB,this.m_collideConnected=i.collideConnected,this.m_islandFlag=!1,this.m_userData=i.userData},u.prototype.InitVelocityConstraints=function(){},u.prototype.SolveVelocityConstraints=function(){},u.prototype.FinalizeVelocityConstraints=function(){},u.prototype.SolvePositionConstraints=function(t){return t===void 0&&(t=0),!1},$i_19.postDefs.push(function(){$i_19.Dynamics.Joints.b2Joint.e_unknownJoint=0,$i_19.Dynamics.Joints.b2Joint.e_revoluteJoint=1,$i_19.Dynamics.Joints.b2Joint.e_prismaticJoint=2,$i_19.Dynamics.Joints.b2Joint.e_distanceJoint=3,$i_19.Dynamics.Joints.b2Joint.e_pulleyJoint=4,$i_19.Dynamics.Joints.b2Joint.e_mouseJoint=5,$i_19.Dynamics.Joints.b2Joint.e_gearJoint=6,$i_19.Dynamics.Joints.b2Joint.e_lineJoint=7,$i_19.Dynamics.Joints.b2Joint.e_weldJoint=8,$i_19.Dynamics.Joints.b2Joint.e_frictionJoint=9,$i_19.Dynamics.Joints.b2Joint.e_inactiveLimit=0,$i_19.Dynamics.Joints.b2Joint.e_atLowerLimit=1,$i_19.Dynamics.Joints.b2Joint.e_atUpperLimit=2,$i_19.Dynamics.Joints.b2Joint.e_equalLimits=3}),p.b2JointDef=function(){},p.prototype.b2JointDef=function(){this.type=u.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},y.b2JointEdge=function(){},$i_19.inherit(d,$i_19.Dynamics.Joints.b2Joint),d.prototype.__super=$i_19.Dynamics.Joints.b2Joint.prototype,d.b2LineJoint=function(){$i_19.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new i,this.m_impulse=new n},d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},d.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},d.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_impulse.y},d.prototype.GetJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,e=t.GetWorldPoint(this.m_localAnchor1),o=i.GetWorldPoint(this.m_localAnchor2),n=o.x-e.x,s=o.y-e.y,r=t.GetWorldVector(this.m_localXAxis1),a=r.x*n+r.y*s;return a},d.prototype.GetJointSpeed=function(){var t,i=this.m_bodyA,e=this.m_bodyB;t=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*n;n=t.col1.y*o+t.col2.y*n,o=s,t=e.m_xf.R;var r=this.m_localAnchor2.x-e.m_sweep.localCenter.x,a=this.m_localAnchor2.y-e.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var l=i.m_sweep.c.x+o,h=i.m_sweep.c.y+n,m=e.m_sweep.c.x+r,c=e.m_sweep.c.y+a,_=m-l,u=c-h,p=i.GetWorldVector(this.m_localXAxis1),y=i.m_linearVelocity,d=e.m_linearVelocity,x=i.m_angularVelocity,f=e.m_angularVelocity,g=_*-x*p.y+u*x*p.x+(p.x*(d.x+-f*a-y.x- -x*n)+p.y*(d.y+f*r-y.y-x*o));return g},d.prototype.IsLimitEnabled=function(){return this.m_enableLimit},d.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},d.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},d.prototype.GetUpperLimit=function(){return this.m_upperTranslation},d.prototype.SetLimits=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=i},d.prototype.IsMotorEnabled=function(){return this.m_enableMotor},d.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},d.prototype.SetMotorSpeed=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},d.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},d.prototype.SetMaxMotorForce=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},d.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},d.prototype.GetMotorForce=function(){return this.m_motorImpulse},d.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=u.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},d.prototype.InitVelocityConstraints=function(i){var e,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(s.GetLocalCenter());var a=n.GetTransform();s.GetTransform(),e=n.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;r=e.col1.x*l+e.col2.x*h,h=e.col1.y*l+e.col2.y*h,l=r,e=s.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;r=e.col1.x*m+e.col2.x*c,c=e.col1.y*m+e.col2.y*c,m=r;var _=s.m_sweep.c.x+m-n.m_sweep.c.x-l,p=s.m_sweep.c.y+c-n.m_sweep.c.y-h;this.m_invMassA=n.m_invMass,this.m_invMassB=s.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=s.m_invI,this.m_axis.SetV(o.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(_+l)*this.m_axis.y-(p+h)*this.m_axis.x,this.m_a2=m*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(o.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(_+l)*this.m_perp.y-(p+h)*this.m_perp.x,this.m_s2=m*this.m_perp.y-c*this.m_perp.x;var y=this.m_invMassA,d=this.m_invMassB,x=this.m_invIA,f=this.m_invIB;if(this.m_K.col1.x=y+d+x*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=x*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=y+d+x*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit){var g=this.m_axis.x*_+this.m_axis.y*p;2*t.b2_linearSlop>o.Abs(this.m_upperTranslation-this.m_lowerTranslation)?this.m_limitState=u.e_equalLimits:g>this.m_lowerTranslation?this.m_upperTranslation>g?(this.m_limitState=u.e_inactiveLimit,this.m_impulse.y=0):this.m_limitState!=u.e_atUpperLimit&&(this.m_limitState=u.e_atUpperLimit,this.m_impulse.y=0):this.m_limitState!=u.e_atLowerLimit&&(this.m_limitState=u.e_atLowerLimit,this.m_impulse.y=0)}else this.m_limitState=u.e_inactiveLimit;if(this.m_enableMotor==0&&(this.m_motorImpulse=0),i.warmStarting){this.m_impulse.x*=i.dtRatio,this.m_impulse.y*=i.dtRatio,this.m_motorImpulse*=i.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,w=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,D=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*v,n.m_linearVelocity.y-=this.m_invMassA*b,n.m_angularVelocity-=this.m_invIA*w,s.m_linearVelocity.x+=this.m_invMassB*v,s.m_linearVelocity.y+=this.m_invMassB*b,s.m_angularVelocity+=this.m_invIB*D}else this.m_impulse.SetZero(),this.m_motorImpulse=0},d.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,e=this.m_bodyB,s=i.m_linearVelocity,r=i.m_angularVelocity,a=e.m_linearVelocity,l=e.m_angularVelocity,h=0,m=0,c=0,_=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var p=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*l-this.m_a1*r,y=this.m_motorMass*(this.m_motorSpeed-p),d=this.m_motorImpulse,x=t.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+y,-x,x),y=this.m_motorImpulse-d,h=y*this.m_axis.x,m=y*this.m_axis.y,c=y*this.m_a1,_=y*this.m_a2,s.x-=this.m_invMassA*h,s.y-=this.m_invMassA*m,r-=this.m_invIA*c,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*m,l+=this.m_invIB*_}var f=this.m_perp.x*(a.x-s.x)+this.m_perp.y*(a.y-s.y)+this.m_s2*l-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var g=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*l-this.m_a1*r,v=this.m_impulse.Copy(),b=this.m_K.Solve(new n,-f,-g);this.m_impulse.Add(b),this.m_limitState==u.e_atLowerLimit?this.m_impulse.y=o.Max(this.m_impulse.y,0):this.m_limitState==u.e_atUpperLimit&&(this.m_impulse.y=o.Min(this.m_impulse.y,0));var w=-f-(this.m_impulse.y-v.y)*this.m_K.col2.x,D=0;D=this.m_K.col1.x!=0?w/this.m_K.col1.x+v.x:v.x,this.m_impulse.x=D,b.x=this.m_impulse.x-v.x,b.y=this.m_impulse.y-v.y,h=b.x*this.m_perp.x+b.y*this.m_axis.x,m=b.x*this.m_perp.y+b.y*this.m_axis.y,c=b.x*this.m_s1+b.y*this.m_a1,_=b.x*this.m_s2+b.y*this.m_a2,s.x-=this.m_invMassA*h,s.y-=this.m_invMassA*m,r-=this.m_invIA*c,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*m,l+=this.m_invIB*_}else{var C=0;C=this.m_K.col1.x!=0?-f/this.m_K.col1.x:0,this.m_impulse.x+=C,h=C*this.m_perp.x,m=C*this.m_perp.y,c=C*this.m_s1,_=C*this.m_s2,s.x-=this.m_invMassA*h,s.y-=this.m_invMassA*m,r-=this.m_invIA*c,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*m,l+=this.m_invIB*_}i.m_linearVelocity.SetV(s),i.m_angularVelocity=r,e.m_linearVelocity.SetV(a),e.m_angularVelocity=l},d.prototype.SolvePositionConstraints=function(e){e===void 0&&(e=0);var s,r=this.m_bodyA,a=this.m_bodyB,l=r.m_sweep.c,h=r.m_sweep.a,m=a.m_sweep.c,c=a.m_sweep.a,_=0,u=0,p=0,y=0,d=0,x=0,f=0,g=!1,v=0,b=i.FromAngle(h),w=i.FromAngle(c);s=b;var D=this.m_localAnchor1.x-this.m_localCenterA.x,C=this.m_localAnchor1.y-this.m_localCenterA.y;_=s.col1.x*D+s.col2.x*C,C=s.col1.y*D+s.col2.y*C,D=_,s=w;var B=this.m_localAnchor2.x-this.m_localCenterB.x,S=this.m_localAnchor2.y-this.m_localCenterB.y;_=s.col1.x*B+s.col2.x*S,S=s.col1.y*B+s.col2.y*S,B=_;var A=m.x+B-l.x-D,M=m.y+S-l.y-C;if(this.m_enableLimit){this.m_axis=o.MulMV(b,this.m_localXAxis1),this.m_a1=(A+D)*this.m_axis.y-(M+C)*this.m_axis.x,this.m_a2=B*this.m_axis.y-S*this.m_axis.x;var I=this.m_axis.x*A+this.m_axis.y*M;2*t.b2_linearSlop>o.Abs(this.m_upperTranslation-this.m_lowerTranslation)?(v=o.Clamp(I,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),x=o.Abs(I),g=!0):I>this.m_lowerTranslation?this.m_upperTranslation>I||(v=o.Clamp(I-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),x=I-this.m_upperTranslation,g=!0):(v=o.Clamp(I-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),x=this.m_lowerTranslation-I,g=!0)
}this.m_perp=o.MulMV(b,this.m_localYAxis1),this.m_s1=(A+D)*this.m_perp.y-(M+C)*this.m_perp.x,this.m_s2=B*this.m_perp.y-S*this.m_perp.x;var V=new n,T=this.m_perp.x*A+this.m_perp.y*M;if(x=o.Max(x,o.Abs(T)),f=0,g)u=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,d=this.m_invIB,this.m_K.col1.x=u+p+y*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1*this.m_a1+d*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+p+y*this.m_a1*this.m_a1+d*this.m_a2*this.m_a2,this.m_K.Solve(V,-T,-v);else{u=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,d=this.m_invIB;var P=u+p+y*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2,L=0;L=P!=0?-T/P:0,V.x=L,V.y=0}var k=V.x*this.m_perp.x+V.y*this.m_axis.x,R=V.x*this.m_perp.y+V.y*this.m_axis.y,G=V.x*this.m_s1+V.y*this.m_a1,F=V.x*this.m_s2+V.y*this.m_a2;return l.x-=this.m_invMassA*k,l.y-=this.m_invMassA*R,h-=this.m_invIA*G,m.x+=this.m_invMassB*k,m.y+=this.m_invMassB*R,c+=this.m_invIB*F,r.m_sweep.a=h,a.m_sweep.a=c,r.SynchronizeTransform(),a.SynchronizeTransform(),t.b2_linearSlop>=x&&t.b2_angularSlop>=f},$i_19.inherit(x,$i_19.Dynamics.Joints.b2JointDef),x.prototype.__super=$i_19.Dynamics.Joints.b2JointDef.prototype,x.b2LineJointDef=function(){$i_19.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},x.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},x.prototype.Initialize=function(t,i,e,o){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(e),this.localAxisA=this.bodyA.GetLocalVector(o)},$i_19.inherit(f,$i_19.Dynamics.Joints.b2Joint),f.prototype.__super=$i_19.Dynamics.Joints.b2Joint.prototype,f.b2MouseJoint=function(){$i_19.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new i,this.K1=new i,this.K2=new i,this.m_localAnchor=new n,this.m_target=new n,this.m_impulse=new n,this.m_mass=new i,this.m_C=new n},f.prototype.GetAnchorA=function(){return this.m_target},f.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},f.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},f.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),0},f.prototype.GetTarget=function(){return this.m_target},f.prototype.SetTarget=function(t){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_target=t},f.prototype.GetMaxForce=function(){return this.m_maxForce},f.prototype.SetMaxForce=function(t){t===void 0&&(t=0),this.m_maxForce=t},f.prototype.GetFrequency=function(){return this.m_frequencyHz},f.prototype.SetFrequency=function(t){t===void 0&&(t=0),this.m_frequencyHz=t},f.prototype.GetDampingRatio=function(){return this.m_dampingRatio},f.prototype.SetDampingRatio=function(t){t===void 0&&(t=0),this.m_dampingRatio=t},f.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t),this.m_target.SetV(t.target);var i=this.m_target.x-this.m_bodyB.m_xf.position.x,e=this.m_target.y-this.m_bodyB.m_xf.position.y,o=this.m_bodyB.m_xf.R;this.m_localAnchor.x=i*o.col1.x+e*o.col1.y,this.m_localAnchor.y=i*o.col2.x+e*o.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0},f.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyB,e=i.GetMass(),o=2*Math.PI*this.m_frequencyHz,n=2*e*this.m_dampingRatio*o,s=e*o*o;this.m_gamma=t.dt*(n+t.dt*s),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=t.dt*s*this.m_gamma;var r;r=i.m_xf.R;var a=this.m_localAnchor.x-i.m_sweep.localCenter.x,l=this.m_localAnchor.y-i.m_sweep.localCenter.y,h=r.col1.x*a+r.col2.x*l;l=r.col1.y*a+r.col2.y*l,a=h;var m=i.m_invMass,c=i.m_invI;this.K1.col1.x=m,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=m,this.K2.col1.x=c*l*l,this.K2.col2.x=-c*a*l,this.K2.col1.y=-c*a*l,this.K2.col2.y=c*a*a,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=i.m_sweep.c.x+a-this.m_target.x,this.m_C.y=i.m_sweep.c.y+l-this.m_target.y,i.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,i.m_linearVelocity.x+=m*this.m_impulse.x,i.m_linearVelocity.y+=m*this.m_impulse.y,i.m_angularVelocity+=c*(a*this.m_impulse.y-l*this.m_impulse.x)},f.prototype.SolveVelocityConstraints=function(t){var i,e=this.m_bodyB,o=0,n=0;i=e.m_xf.R;var s=this.m_localAnchor.x-e.m_sweep.localCenter.x,r=this.m_localAnchor.y-e.m_sweep.localCenter.y;o=i.col1.x*s+i.col2.x*r,r=i.col1.y*s+i.col2.y*r,s=o;var a=e.m_linearVelocity.x+-e.m_angularVelocity*r,l=e.m_linearVelocity.y+e.m_angularVelocity*s;i=this.m_mass,o=a+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,n=l+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var h=-(i.col1.x*o+i.col2.x*n),m=-(i.col1.y*o+i.col2.y*n),c=this.m_impulse.x,_=this.m_impulse.y;this.m_impulse.x+=h,this.m_impulse.y+=m;var u=t.dt*this.m_maxForce;this.m_impulse.LengthSquared()>u*u&&this.m_impulse.Multiply(u/this.m_impulse.Length()),h=this.m_impulse.x-c,m=this.m_impulse.y-_,e.m_linearVelocity.x+=e.m_invMass*h,e.m_linearVelocity.y+=e.m_invMass*m,e.m_angularVelocity+=e.m_invI*(s*m-r*h)},f.prototype.SolvePositionConstraints=function(t){return t===void 0&&(t=0),!0},$i_19.inherit(g,$i_19.Dynamics.Joints.b2JointDef),g.prototype.__super=$i_19.Dynamics.Joints.b2JointDef.prototype,g.b2MouseJointDef=function(){$i_19.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new n},g.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},$i_19.inherit(v,$i_19.Dynamics.Joints.b2Joint),v.prototype.__super=$i_19.Dynamics.Joints.b2Joint.prototype,v.b2PrismaticJoint=function(){$i_19.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new e,this.m_impulse=new s},v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},v.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},v.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_impulse.y},v.prototype.GetJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,e=t.GetWorldPoint(this.m_localAnchor1),o=i.GetWorldPoint(this.m_localAnchor2),n=o.x-e.x,s=o.y-e.y,r=t.GetWorldVector(this.m_localXAxis1),a=r.x*n+r.y*s;return a},v.prototype.GetJointSpeed=function(){var t,i=this.m_bodyA,e=this.m_bodyB;t=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*n;n=t.col1.y*o+t.col2.y*n,o=s,t=e.m_xf.R;var r=this.m_localAnchor2.x-e.m_sweep.localCenter.x,a=this.m_localAnchor2.y-e.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var l=i.m_sweep.c.x+o,h=i.m_sweep.c.y+n,m=e.m_sweep.c.x+r,c=e.m_sweep.c.y+a,_=m-l,u=c-h,p=i.GetWorldVector(this.m_localXAxis1),y=i.m_linearVelocity,d=e.m_linearVelocity,x=i.m_angularVelocity,f=e.m_angularVelocity,g=_*-x*p.y+u*x*p.x+(p.x*(d.x+-f*a-y.x- -x*n)+p.y*(d.y+f*r-y.y-x*o));return g},v.prototype.IsLimitEnabled=function(){return this.m_enableLimit},v.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},v.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},v.prototype.GetUpperLimit=function(){return this.m_upperTranslation},v.prototype.SetLimits=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=i},v.prototype.IsMotorEnabled=function(){return this.m_enableMotor},v.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},v.prototype.SetMotorSpeed=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},v.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},v.prototype.SetMaxMotorForce=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},v.prototype.GetMotorForce=function(){return this.m_motorImpulse},v.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=u.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},v.prototype.InitVelocityConstraints=function(i){var e,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(s.GetLocalCenter());var a=n.GetTransform();s.GetTransform(),e=n.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;r=e.col1.x*l+e.col2.x*h,h=e.col1.y*l+e.col2.y*h,l=r,e=s.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;r=e.col1.x*m+e.col2.x*c,c=e.col1.y*m+e.col2.y*c,m=r;var _=s.m_sweep.c.x+m-n.m_sweep.c.x-l,p=s.m_sweep.c.y+c-n.m_sweep.c.y-h;this.m_invMassA=n.m_invMass,this.m_invMassB=s.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=s.m_invI,this.m_axis.SetV(o.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(_+l)*this.m_axis.y-(p+h)*this.m_axis.x,this.m_a2=m*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(o.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(_+l)*this.m_perp.y-(p+h)*this.m_perp.x,this.m_s2=m*this.m_perp.y-c*this.m_perp.x;var y=this.m_invMassA,d=this.m_invMassB,x=this.m_invIA,f=this.m_invIB;if(this.m_K.col1.x=y+d+x*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=x*this.m_s1+f*this.m_s2,this.m_K.col1.z=x*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=x+f,this.m_K.col2.z=x*this.m_a1+f*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=y+d+x*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit){var g=this.m_axis.x*_+this.m_axis.y*p;2*t.b2_linearSlop>o.Abs(this.m_upperTranslation-this.m_lowerTranslation)?this.m_limitState=u.e_equalLimits:g>this.m_lowerTranslation?this.m_upperTranslation>g?(this.m_limitState=u.e_inactiveLimit,this.m_impulse.z=0):this.m_limitState!=u.e_atUpperLimit&&(this.m_limitState=u.e_atUpperLimit,this.m_impulse.z=0):this.m_limitState!=u.e_atLowerLimit&&(this.m_limitState=u.e_atLowerLimit,this.m_impulse.z=0)}else this.m_limitState=u.e_inactiveLimit;if(this.m_enableMotor==0&&(this.m_motorImpulse=0),i.warmStarting){this.m_impulse.x*=i.dtRatio,this.m_impulse.y*=i.dtRatio,this.m_motorImpulse*=i.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,w=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,D=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*v,n.m_linearVelocity.y-=this.m_invMassA*b,n.m_angularVelocity-=this.m_invIA*w,s.m_linearVelocity.x+=this.m_invMassB*v,s.m_linearVelocity.y+=this.m_invMassB*b,s.m_angularVelocity+=this.m_invIB*D}else this.m_impulse.SetZero(),this.m_motorImpulse=0},v.prototype.SolveVelocityConstraints=function(t){var i=this.m_bodyA,e=this.m_bodyB,r=i.m_linearVelocity,a=i.m_angularVelocity,l=e.m_linearVelocity,h=e.m_angularVelocity,m=0,c=0,_=0,p=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var y=this.m_axis.x*(l.x-r.x)+this.m_axis.y*(l.y-r.y)+this.m_a2*h-this.m_a1*a,d=this.m_motorMass*(this.m_motorSpeed-y),x=this.m_motorImpulse,f=t.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+d,-f,f),d=this.m_motorImpulse-x,m=d*this.m_axis.x,c=d*this.m_axis.y,_=d*this.m_a1,p=d*this.m_a2,r.x-=this.m_invMassA*m,r.y-=this.m_invMassA*c,a-=this.m_invIA*_,l.x+=this.m_invMassB*m,l.y+=this.m_invMassB*c,h+=this.m_invIB*p}var g=this.m_perp.x*(l.x-r.x)+this.m_perp.y*(l.y-r.y)+this.m_s2*h-this.m_s1*a,v=h-a;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var b=this.m_axis.x*(l.x-r.x)+this.m_axis.y*(l.y-r.y)+this.m_a2*h-this.m_a1*a,w=this.m_impulse.Copy(),D=this.m_K.Solve33(new s,-g,-v,-b);this.m_impulse.Add(D),this.m_limitState==u.e_atLowerLimit?this.m_impulse.z=o.Max(this.m_impulse.z,0):this.m_limitState==u.e_atUpperLimit&&(this.m_impulse.z=o.Min(this.m_impulse.z,0));var C=-g-(this.m_impulse.z-w.z)*this.m_K.col3.x,B=-v-(this.m_impulse.z-w.z)*this.m_K.col3.y,S=this.m_K.Solve22(new n,C,B);S.x+=w.x,S.y+=w.y,this.m_impulse.x=S.x,this.m_impulse.y=S.y,D.x=this.m_impulse.x-w.x,D.y=this.m_impulse.y-w.y,D.z=this.m_impulse.z-w.z,m=D.x*this.m_perp.x+D.z*this.m_axis.x,c=D.x*this.m_perp.y+D.z*this.m_axis.y,_=D.x*this.m_s1+D.y+D.z*this.m_a1,p=D.x*this.m_s2+D.y+D.z*this.m_a2,r.x-=this.m_invMassA*m,r.y-=this.m_invMassA*c,a-=this.m_invIA*_,l.x+=this.m_invMassB*m,l.y+=this.m_invMassB*c,h+=this.m_invIB*p}else{var A=this.m_K.Solve22(new n,-g,-v);this.m_impulse.x+=A.x,this.m_impulse.y+=A.y,m=A.x*this.m_perp.x,c=A.x*this.m_perp.y,_=A.x*this.m_s1+A.y,p=A.x*this.m_s2+A.y,r.x-=this.m_invMassA*m,r.y-=this.m_invMassA*c,a-=this.m_invIA*_,l.x+=this.m_invMassB*m,l.y+=this.m_invMassB*c,h+=this.m_invIB*p}i.m_linearVelocity.SetV(r),i.m_angularVelocity=a,e.m_linearVelocity.SetV(l),e.m_angularVelocity=h},v.prototype.SolvePositionConstraints=function(e){e===void 0&&(e=0);var r,a=this.m_bodyA,l=this.m_bodyB,h=a.m_sweep.c,m=a.m_sweep.a,c=l.m_sweep.c,_=l.m_sweep.a,u=0,p=0,y=0,d=0,x=0,f=0,g=0,v=!1,b=0,w=i.FromAngle(m),D=i.FromAngle(_);r=w;var C=this.m_localAnchor1.x-this.m_localCenterA.x,B=this.m_localAnchor1.y-this.m_localCenterA.y;u=r.col1.x*C+r.col2.x*B,B=r.col1.y*C+r.col2.y*B,C=u,r=D;var S=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;u=r.col1.x*S+r.col2.x*A,A=r.col1.y*S+r.col2.y*A,S=u;var M=c.x+S-h.x-C,I=c.y+A-h.y-B;if(this.m_enableLimit){this.m_axis=o.MulMV(w,this.m_localXAxis1),this.m_a1=(M+C)*this.m_axis.y-(I+B)*this.m_axis.x,this.m_a2=S*this.m_axis.y-A*this.m_axis.x;var V=this.m_axis.x*M+this.m_axis.y*I;2*t.b2_linearSlop>o.Abs(this.m_upperTranslation-this.m_lowerTranslation)?(b=o.Clamp(V,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),f=o.Abs(V),v=!0):V>this.m_lowerTranslation?this.m_upperTranslation>V||(b=o.Clamp(V-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),f=V-this.m_upperTranslation,v=!0):(b=o.Clamp(V-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),f=this.m_lowerTranslation-V,v=!0)}this.m_perp=o.MulMV(w,this.m_localYAxis1),this.m_s1=(M+C)*this.m_perp.y-(I+B)*this.m_perp.x,this.m_s2=S*this.m_perp.y-A*this.m_perp.x;var T=new s,P=this.m_perp.x*M+this.m_perp.y*I,L=_-m-this.m_refAngle;if(f=o.Max(f,o.Abs(P)),g=o.Abs(L),v)p=this.m_invMassA,y=this.m_invMassB,d=this.m_invIA,x=this.m_invIB,this.m_K.col1.x=p+y+d*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.col1.y=d*this.m_s1+x*this.m_s2,this.m_K.col1.z=d*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=d+x,this.m_K.col2.z=d*this.m_a1+x*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=p+y+d*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_K.Solve33(T,-P,-L,-b);else{p=this.m_invMassA,y=this.m_invMassB,d=this.m_invIA,x=this.m_invIB;var k=p+y+d*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,R=d*this.m_s1+x*this.m_s2,G=d+x;this.m_K.col1.Set(k,R,0),this.m_K.col2.Set(R,G,0);var F=this.m_K.Solve22(new n,-P,-L);T.x=F.x,T.y=F.y,T.z=0}var J=T.x*this.m_perp.x+T.z*this.m_axis.x,z=T.x*this.m_perp.y+T.z*this.m_axis.y,E=T.x*this.m_s1+T.y+T.z*this.m_a1,O=T.x*this.m_s2+T.y+T.z*this.m_a2;return h.x-=this.m_invMassA*J,h.y-=this.m_invMassA*z,m-=this.m_invIA*E,c.x+=this.m_invMassB*J,c.y+=this.m_invMassB*z,_+=this.m_invIB*O,a.m_sweep.a=m,l.m_sweep.a=_,a.SynchronizeTransform(),l.SynchronizeTransform(),t.b2_linearSlop>=f&&t.b2_angularSlop>=g},$i_19.inherit(b,$i_19.Dynamics.Joints.b2JointDef),b.prototype.__super=$i_19.Dynamics.Joints.b2JointDef.prototype,b.b2PrismaticJointDef=function(){$i_19.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},b.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},b.prototype.Initialize=function(t,i,e,o){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(e),this.localAxisA=this.bodyA.GetLocalVector(o),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},$i_19.inherit(w,$i_19.Dynamics.Joints.b2Joint),w.prototype.__super=$i_19.Dynamics.Joints.b2Joint.prototype,w.b2PulleyJoint=function(){$i_19.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u1=new n,this.m_u2=new n},w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},w.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},w.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),0},w.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},w.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},w.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),i=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,e=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,o=t.x-i,n=t.y-e;return Math.sqrt(o*o+n*n)},w.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),i=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,e=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,o=t.x-i,n=t.y-e;return Math.sqrt(o*o+n*n)},w.prototype.GetRatio=function(){return this.m_ratio},w.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=o.Min(t.maxLengthA,this.m_constant-this.m_ratio*w.b2_minPulleyLength),this.m_maxLength2=o.Min(t.maxLengthB,(this.m_constant-w.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},w.prototype.InitVelocityConstraints=function(i){var e,o=this.m_bodyA,n=this.m_bodyB;e=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,r=this.m_localAnchor1.y-o.m_sweep.localCenter.y,a=e.col1.x*s+e.col2.x*r;r=e.col1.y*s+e.col2.y*r,s=a,e=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=e.col1.x*l+e.col2.x*h,h=e.col1.y*l+e.col2.y*h,l=a;var m=o.m_sweep.c.x+s,c=o.m_sweep.c.y+r,_=n.m_sweep.c.x+l,p=n.m_sweep.c.y+h,y=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,d=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,x=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(m-y,c-d),this.m_u2.Set(_-x,p-f);var g=this.m_u1.Length(),v=this.m_u2.Length();g>t.b2_linearSlop?this.m_u1.Multiply(1/g):this.m_u1.SetZero(),v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero();var b=this.m_constant-g-this.m_ratio*v;b>0?(this.m_state=u.e_inactiveLimit,this.m_impulse=0):this.m_state=u.e_atUpperLimit,this.m_maxLength1>g?(this.m_limitState1=u.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=u.e_atUpperLimit,this.m_maxLength2>v?(this.m_limitState2=u.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=u.e_atUpperLimit;var w=s*this.m_u1.y-r*this.m_u1.x,D=l*this.m_u2.y-h*this.m_u2.x;if(this.m_limitMass1=o.m_invMass+o.m_invI*w*w,this.m_limitMass2=n.m_invMass+n.m_invI*D*D,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,i.warmStarting){this.m_impulse*=i.dtRatio,this.m_limitImpulse1*=i.dtRatio,this.m_limitImpulse2*=i.dtRatio;var C=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,B=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,S=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,A=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;o.m_linearVelocity.x+=o.m_invMass*C,o.m_linearVelocity.y+=o.m_invMass*B,o.m_angularVelocity+=o.m_invI*(s*B-r*C),n.m_linearVelocity.x+=n.m_invMass*S,n.m_linearVelocity.y+=n.m_invMass*A,n.m_angularVelocity+=n.m_invI*(l*A-h*S)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},w.prototype.SolveVelocityConstraints=function(){var t,i=this.m_bodyA,e=this.m_bodyB;t=i.m_xf.R;var n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,s=this.m_localAnchor1.y-i.m_sweep.localCenter.y,r=t.col1.x*n+t.col2.x*s;s=t.col1.y*n+t.col2.y*s,n=r,t=e.m_xf.R;var a=this.m_localAnchor2.x-e.m_sweep.localCenter.x,l=this.m_localAnchor2.y-e.m_sweep.localCenter.y;r=t.col1.x*a+t.col2.x*l,l=t.col1.y*a+t.col2.y*l,a=r;var h=0,m=0,c=0,_=0,p=0,y=0,d=0,x=0,f=0,g=0,v=0;this.m_state==u.e_atUpperLimit&&(h=i.m_linearVelocity.x+-i.m_angularVelocity*s,m=i.m_linearVelocity.y+i.m_angularVelocity*n,c=e.m_linearVelocity.x+-e.m_angularVelocity*l,_=e.m_linearVelocity.y+e.m_angularVelocity*a,f=-(this.m_u1.x*h+this.m_u1.y*m)-this.m_ratio*(this.m_u2.x*c+this.m_u2.y*_),g=this.m_pulleyMass*-f,v=this.m_impulse,this.m_impulse=o.Max(0,this.m_impulse+g),g=this.m_impulse-v,p=-g*this.m_u1.x,y=-g*this.m_u1.y,d=-this.m_ratio*g*this.m_u2.x,x=-this.m_ratio*g*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*p,i.m_linearVelocity.y+=i.m_invMass*y,i.m_angularVelocity+=i.m_invI*(n*y-s*p),e.m_linearVelocity.x+=e.m_invMass*d,e.m_linearVelocity.y+=e.m_invMass*x,e.m_angularVelocity+=e.m_invI*(a*x-l*d)),this.m_limitState1==u.e_atUpperLimit&&(h=i.m_linearVelocity.x+-i.m_angularVelocity*s,m=i.m_linearVelocity.y+i.m_angularVelocity*n,f=-(this.m_u1.x*h+this.m_u1.y*m),g=-this.m_limitMass1*f,v=this.m_limitImpulse1,this.m_limitImpulse1=o.Max(0,this.m_limitImpulse1+g),g=this.m_limitImpulse1-v,p=-g*this.m_u1.x,y=-g*this.m_u1.y,i.m_linearVelocity.x+=i.m_invMass*p,i.m_linearVelocity.y+=i.m_invMass*y,i.m_angularVelocity+=i.m_invI*(n*y-s*p)),this.m_limitState2==u.e_atUpperLimit&&(c=e.m_linearVelocity.x+-e.m_angularVelocity*l,_=e.m_linearVelocity.y+e.m_angularVelocity*a,f=-(this.m_u2.x*c+this.m_u2.y*_),g=-this.m_limitMass2*f,v=this.m_limitImpulse2,this.m_limitImpulse2=o.Max(0,this.m_limitImpulse2+g),g=this.m_limitImpulse2-v,d=-g*this.m_u2.x,x=-g*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*d,e.m_linearVelocity.y+=e.m_invMass*x,e.m_angularVelocity+=e.m_invI*(a*x-l*d))},w.prototype.SolvePositionConstraints=function(i){i===void 0&&(i=0);var e,n=this.m_bodyA,s=this.m_bodyB,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,m=0,c=0,_=0,p=0,y=0,d=0,x=0,f=0,g=0,v=0,b=0,w=0,D=0,C=0;return this.m_state==u.e_atUpperLimit&&(e=n.m_xf.R,m=this.m_localAnchor1.x-n.m_sweep.localCenter.x,c=this.m_localAnchor1.y-n.m_sweep.localCenter.y,D=e.col1.x*m+e.col2.x*c,c=e.col1.y*m+e.col2.y*c,m=D,e=s.m_xf.R,_=this.m_localAnchor2.x-s.m_sweep.localCenter.x,p=this.m_localAnchor2.y-s.m_sweep.localCenter.y,D=e.col1.x*_+e.col2.x*p,p=e.col1.y*_+e.col2.y*p,_=D,y=n.m_sweep.c.x+m,d=n.m_sweep.c.y+c,x=s.m_sweep.c.x+_,f=s.m_sweep.c.y+p,this.m_u1.Set(y-r,d-a),this.m_u2.Set(x-l,f-h),g=this.m_u1.Length(),v=this.m_u2.Length(),g>t.b2_linearSlop?this.m_u1.Multiply(1/g):this.m_u1.SetZero(),v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero(),b=this.m_constant-g-this.m_ratio*v,C=o.Max(C,-b),b=o.Clamp(b+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),w=-this.m_pulleyMass*b,y=-w*this.m_u1.x,d=-w*this.m_u1.y,x=-this.m_ratio*w*this.m_u2.x,f=-this.m_ratio*w*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*y,n.m_sweep.c.y+=n.m_invMass*d,n.m_sweep.a+=n.m_invI*(m*d-c*y),s.m_sweep.c.x+=s.m_invMass*x,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(_*f-p*x),n.SynchronizeTransform(),s.SynchronizeTransform()),this.m_limitState1==u.e_atUpperLimit&&(e=n.m_xf.R,m=this.m_localAnchor1.x-n.m_sweep.localCenter.x,c=this.m_localAnchor1.y-n.m_sweep.localCenter.y,D=e.col1.x*m+e.col2.x*c,c=e.col1.y*m+e.col2.y*c,m=D,y=n.m_sweep.c.x+m,d=n.m_sweep.c.y+c,this.m_u1.Set(y-r,d-a),g=this.m_u1.Length(),g>t.b2_linearSlop?(this.m_u1.x*=1/g,this.m_u1.y*=1/g):this.m_u1.SetZero(),b=this.m_maxLength1-g,C=o.Max(C,-b),b=o.Clamp(b+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),w=-this.m_limitMass1*b,y=-w*this.m_u1.x,d=-w*this.m_u1.y,n.m_sweep.c.x+=n.m_invMass*y,n.m_sweep.c.y+=n.m_invMass*d,n.m_sweep.a+=n.m_invI*(m*d-c*y),n.SynchronizeTransform()),this.m_limitState2==u.e_atUpperLimit&&(e=s.m_xf.R,_=this.m_localAnchor2.x-s.m_sweep.localCenter.x,p=this.m_localAnchor2.y-s.m_sweep.localCenter.y,D=e.col1.x*_+e.col2.x*p,p=e.col1.y*_+e.col2.y*p,_=D,x=s.m_sweep.c.x+_,f=s.m_sweep.c.y+p,this.m_u2.Set(x-l,f-h),v=this.m_u2.Length(),v>t.b2_linearSlop?(this.m_u2.x*=1/v,this.m_u2.y*=1/v):this.m_u2.SetZero(),b=this.m_maxLength2-v,C=o.Max(C,-b),b=o.Clamp(b+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),w=-this.m_limitMass2*b,x=-w*this.m_u2.x,f=-w*this.m_u2.y,s.m_sweep.c.x+=s.m_invMass*x,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(_*f-p*x),s.SynchronizeTransform()),t.b2_linearSlop>C},$i_19.postDefs.push(function(){$i_19.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),$i_19.inherit(D,$i_19.Dynamics.Joints.b2JointDef),D.prototype.__super=$i_19.Dynamics.Joints.b2JointDef.prototype,D.b2PulleyJointDef=function(){$i_19.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new n,this.groundAnchorB=new n,this.localAnchorA=new n,this.localAnchorB=new n},D.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},D.prototype.Initialize=function(t,i,e,o,n,s,r){r===void 0&&(r=0),this.bodyA=t,this.bodyB=i,this.groundAnchorA.SetV(e),this.groundAnchorB.SetV(o),this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(s);var a=n.x-e.x,l=n.y-e.y;this.lengthA=Math.sqrt(a*a+l*l);var h=s.x-o.x,m=s.y-o.y;this.lengthB=Math.sqrt(h*h+m*m),this.ratio=r;var c=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=c-this.ratio*w.b2_minPulleyLength,this.maxLengthB=(c-w.b2_minPulleyLength)/this.ratio},$i_19.inherit(C,$i_19.Dynamics.Joints.b2Joint),C.prototype.__super=$i_19.Dynamics.Joints.b2Joint.prototype,C.b2RevoluteJoint=function(){$i_19.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new i,this.K1=new i,this.K2=new i,this.K3=new i,this.impulse3=new s,this.impulse2=new n,this.reduced=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_impulse=new s,this.m_mass=new e},C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},C.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},C.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_impulse.z},C.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},C.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},C.prototype.IsLimitEnabled=function(){return this.m_enableLimit},C.prototype.EnableLimit=function(t){this.m_enableLimit=t},C.prototype.GetLowerLimit=function(){return this.m_lowerAngle},C.prototype.GetUpperLimit=function(){return this.m_upperAngle},C.prototype.SetLimits=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.m_lowerAngle=t,this.m_upperAngle=i},C.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},C.prototype.EnableMotor=function(t){this.m_enableMotor=t},C.prototype.SetMotorSpeed=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},C.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},C.prototype.SetMaxMotorTorque=function(t){t===void 0&&(t=0),this.m_maxMotorTorque=t},C.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},C.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=u.e_inactiveLimit},C.prototype.InitVelocityConstraints=function(i){var e,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_enableMotor||this.m_enableLimit,e=n.m_xf.R;var a=this.m_localAnchor1.x-n.m_sweep.localCenter.x,l=this.m_localAnchor1.y-n.m_sweep.localCenter.y;r=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=r,e=s.m_xf.R;var h=this.m_localAnchor2.x-s.m_sweep.localCenter.x,m=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=e.col1.x*h+e.col2.x*m,m=e.col1.y*h+e.col2.y*m,h=r;var c=n.m_invMass,_=s.m_invMass,p=n.m_invI,y=s.m_invI;if(this.m_mass.col1.x=c+_+l*l*p+m*m*y,this.m_mass.col2.x=-l*a*p-m*h*y,this.m_mass.col3.x=-l*p-m*y,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+_+a*a*p+h*h*y,this.m_mass.col3.y=a*p+h*y,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=p+y,this.m_motorMass=1/(p+y),this.m_enableMotor==0&&(this.m_motorImpulse=0),this.m_enableLimit){var d=s.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;2*t.b2_angularSlop>o.Abs(this.m_upperAngle-this.m_lowerAngle)?this.m_limitState=u.e_equalLimits:d>this.m_lowerAngle?this.m_upperAngle>d?(this.m_limitState=u.e_inactiveLimit,this.m_impulse.z=0):(this.m_limitState!=u.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=u.e_atUpperLimit):(this.m_limitState!=u.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=u.e_atLowerLimit)
}else this.m_limitState=u.e_inactiveLimit;if(i.warmStarting){this.m_impulse.x*=i.dtRatio,this.m_impulse.y*=i.dtRatio,this.m_motorImpulse*=i.dtRatio;var x=this.m_impulse.x,f=this.m_impulse.y;n.m_linearVelocity.x-=c*x,n.m_linearVelocity.y-=c*f,n.m_angularVelocity-=p*(a*f-l*x+this.m_motorImpulse+this.m_impulse.z),s.m_linearVelocity.x+=_*x,s.m_linearVelocity.y+=_*f,s.m_angularVelocity+=y*(h*f-m*x+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},C.prototype.SolveVelocityConstraints=function(t){var i,e=this.m_bodyA,n=this.m_bodyB,s=0,r=0,a=0,l=0,h=0,m=0,c=e.m_linearVelocity,_=e.m_angularVelocity,p=n.m_linearVelocity,y=n.m_angularVelocity,d=e.m_invMass,x=n.m_invMass,f=e.m_invI,g=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var v=y-_-this.m_motorSpeed,b=this.m_motorMass*-v,w=this.m_motorImpulse,D=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+b,-D,D),b=this.m_motorImpulse-w,_-=f*b,y+=g*b}if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){i=e.m_xf.R,a=this.m_localAnchor1.x-e.m_sweep.localCenter.x,l=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=s,i=n.m_xf.R,h=this.m_localAnchor2.x-n.m_sweep.localCenter.x,m=this.m_localAnchor2.y-n.m_sweep.localCenter.y,s=i.col1.x*h+i.col2.x*m,m=i.col1.y*h+i.col2.y*m,h=s;var C=p.x+-y*m-c.x- -_*l,B=p.y+y*h-c.y-_*a,S=y-_;this.m_mass.Solve33(this.impulse3,-C,-B,-S),this.m_limitState==u.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==u.e_atLowerLimit?(r=this.m_impulse.z+this.impulse3.z,0>r&&(this.m_mass.Solve22(this.reduced,-C,-B),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==u.e_atUpperLimit&&(r=this.m_impulse.z+this.impulse3.z,r>0&&(this.m_mass.Solve22(this.reduced,-C,-B),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),c.x-=d*this.impulse3.x,c.y-=d*this.impulse3.y,_-=f*(a*this.impulse3.y-l*this.impulse3.x+this.impulse3.z),p.x+=x*this.impulse3.x,p.y+=x*this.impulse3.y,y+=g*(h*this.impulse3.y-m*this.impulse3.x+this.impulse3.z)}else{i=e.m_xf.R,a=this.m_localAnchor1.x-e.m_sweep.localCenter.x,l=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=s,i=n.m_xf.R,h=this.m_localAnchor2.x-n.m_sweep.localCenter.x,m=this.m_localAnchor2.y-n.m_sweep.localCenter.y,s=i.col1.x*h+i.col2.x*m,m=i.col1.y*h+i.col2.y*m,h=s;var A=p.x+-y*m-c.x- -_*l,M=p.y+y*h-c.y-_*a;this.m_mass.Solve22(this.impulse2,-A,-M),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,c.x-=d*this.impulse2.x,c.y-=d*this.impulse2.y,_-=f*(a*this.impulse2.y-l*this.impulse2.x),p.x+=x*this.impulse2.x,p.y+=x*this.impulse2.y,y+=g*(h*this.impulse2.y-m*this.impulse2.x)}e.m_linearVelocity.SetV(c),e.m_angularVelocity=_,n.m_linearVelocity.SetV(p),n.m_angularVelocity=y},C.prototype.SolvePositionConstraints=function(i){i===void 0&&(i=0);var e,n=0,s=this.m_bodyA,r=this.m_bodyB,a=0,l=0,h=0,m=0,c=0;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var _=r.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,p=0;this.m_limitState==u.e_equalLimits?(n=o.Clamp(_-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection),p=-this.m_motorMass*n,a=o.Abs(n)):this.m_limitState==u.e_atLowerLimit?(n=_-this.m_lowerAngle,a=-n,n=o.Clamp(n+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),p=-this.m_motorMass*n):this.m_limitState==u.e_atUpperLimit&&(n=_-this.m_upperAngle,a=n,n=o.Clamp(n-t.b2_angularSlop,0,t.b2_maxAngularCorrection),p=-this.m_motorMass*n),s.m_sweep.a-=s.m_invI*p,r.m_sweep.a+=r.m_invI*p,s.SynchronizeTransform(),r.SynchronizeTransform()}e=s.m_xf.R;var y=this.m_localAnchor1.x-s.m_sweep.localCenter.x,d=this.m_localAnchor1.y-s.m_sweep.localCenter.y;h=e.col1.x*y+e.col2.x*d,d=e.col1.y*y+e.col2.y*d,y=h,e=r.m_xf.R;var x=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;h=e.col1.x*x+e.col2.x*f,f=e.col1.y*x+e.col2.y*f,x=h;var g=r.m_sweep.c.x+x-s.m_sweep.c.x-y,v=r.m_sweep.c.y+f-s.m_sweep.c.y-d,b=g*g+v*v,w=Math.sqrt(b);l=w;var D=s.m_invMass,B=r.m_invMass,S=s.m_invI,A=r.m_invI,M=10*t.b2_linearSlop;if(b>M*M){var I=D+B,V=1/I;m=V*-g,c=V*-v;var T=.5;s.m_sweep.c.x-=T*D*m,s.m_sweep.c.y-=T*D*c,r.m_sweep.c.x+=T*B*m,r.m_sweep.c.y+=T*B*c,g=r.m_sweep.c.x+x-s.m_sweep.c.x-y,v=r.m_sweep.c.y+f-s.m_sweep.c.y-d}return this.K1.col1.x=D+B,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=D+B,this.K2.col1.x=S*d*d,this.K2.col2.x=-S*y*d,this.K2.col1.y=-S*y*d,this.K2.col2.y=S*y*y,this.K3.col1.x=A*f*f,this.K3.col2.x=-A*x*f,this.K3.col1.y=-A*x*f,this.K3.col2.y=A*x*x,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(C.tImpulse,-g,-v),m=C.tImpulse.x,c=C.tImpulse.y,s.m_sweep.c.x-=s.m_invMass*m,s.m_sweep.c.y-=s.m_invMass*c,s.m_sweep.a-=s.m_invI*(y*c-d*m),r.m_sweep.c.x+=r.m_invMass*m,r.m_sweep.c.y+=r.m_invMass*c,r.m_sweep.a+=r.m_invI*(x*c-f*m),s.SynchronizeTransform(),r.SynchronizeTransform(),t.b2_linearSlop>=l&&t.b2_angularSlop>=a},$i_19.postDefs.push(function(){$i_19.Dynamics.Joints.b2RevoluteJoint.tImpulse=new n}),$i_19.inherit(B,$i_19.Dynamics.Joints.b2JointDef),B.prototype.__super=$i_19.Dynamics.Joints.b2JointDef.prototype,B.b2RevoluteJointDef=function(){$i_19.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},B.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},B.prototype.Initialize=function(t,i,e){this.bodyA=t,this.bodyB=i,this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(e),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},$i_19.inherit(S,$i_19.Dynamics.Joints.b2Joint),S.prototype.__super=$i_19.Dynamics.Joints.b2Joint.prototype,S.b2WeldJoint=function(){$i_19.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_impulse=new s,this.m_mass=new e},S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},S.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},S.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_impulse.z},S.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new e},S.prototype.InitVelocityConstraints=function(t){var i,e=0,o=this.m_bodyA,n=this.m_bodyB;i=o.m_xf.R;var s=this.m_localAnchorA.x-o.m_sweep.localCenter.x,r=this.m_localAnchorA.y-o.m_sweep.localCenter.y;e=i.col1.x*s+i.col2.x*r,r=i.col1.y*s+i.col2.y*r,s=e,i=n.m_xf.R;var a=this.m_localAnchorB.x-n.m_sweep.localCenter.x,l=this.m_localAnchorB.y-n.m_sweep.localCenter.y;e=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=e;var h=o.m_invMass,m=n.m_invMass,c=o.m_invI,_=n.m_invI;this.m_mass.col1.x=h+m+r*r*c+l*l*_,this.m_mass.col2.x=-r*s*c-l*a*_,this.m_mass.col3.x=-r*c-l*_,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=h+m+s*s*c+a*a*_,this.m_mass.col3.y=s*c+a*_,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+_,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,o.m_linearVelocity.x-=h*this.m_impulse.x,o.m_linearVelocity.y-=h*this.m_impulse.y,o.m_angularVelocity-=c*(s*this.m_impulse.y-r*this.m_impulse.x+this.m_impulse.z),n.m_linearVelocity.x+=m*this.m_impulse.x,n.m_linearVelocity.y+=m*this.m_impulse.y,n.m_angularVelocity+=_*(a*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},S.prototype.SolveVelocityConstraints=function(){var t,i=0,e=this.m_bodyA,o=this.m_bodyB,n=e.m_linearVelocity,r=e.m_angularVelocity,a=o.m_linearVelocity,l=o.m_angularVelocity,h=e.m_invMass,m=o.m_invMass,c=e.m_invI,_=o.m_invI;t=e.m_xf.R;var u=this.m_localAnchorA.x-e.m_sweep.localCenter.x,p=this.m_localAnchorA.y-e.m_sweep.localCenter.y;i=t.col1.x*u+t.col2.x*p,p=t.col1.y*u+t.col2.y*p,u=i,t=o.m_xf.R;var y=this.m_localAnchorB.x-o.m_sweep.localCenter.x,d=this.m_localAnchorB.y-o.m_sweep.localCenter.y;i=t.col1.x*y+t.col2.x*d,d=t.col1.y*y+t.col2.y*d,y=i;var x=a.x-l*d-n.x+r*p,f=a.y+l*y-n.y-r*u,g=l-r,v=new s;this.m_mass.Solve33(v,-x,-f,-g),this.m_impulse.Add(v),n.x-=h*v.x,n.y-=h*v.y,r-=c*(u*v.y-p*v.x+v.z),a.x+=m*v.x,a.y+=m*v.y,l+=_*(y*v.y-d*v.x+v.z),e.m_angularVelocity=r,o.m_angularVelocity=l},S.prototype.SolvePositionConstraints=function(i){i===void 0&&(i=0);var e,n=0,r=this.m_bodyA,a=this.m_bodyB;e=r.m_xf.R;var l=this.m_localAnchorA.x-r.m_sweep.localCenter.x,h=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=e.col1.x*l+e.col2.x*h,h=e.col1.y*l+e.col2.y*h,l=n,e=a.m_xf.R;var m=this.m_localAnchorB.x-a.m_sweep.localCenter.x,c=this.m_localAnchorB.y-a.m_sweep.localCenter.y;n=e.col1.x*m+e.col2.x*c,c=e.col1.y*m+e.col2.y*c,m=n;var _=r.m_invMass,u=a.m_invMass,p=r.m_invI,y=a.m_invI,d=a.m_sweep.c.x+m-r.m_sweep.c.x-l,x=a.m_sweep.c.y+c-r.m_sweep.c.y-h,f=a.m_sweep.a-r.m_sweep.a-this.m_referenceAngle,g=10*t.b2_linearSlop,v=Math.sqrt(d*d+x*x),b=o.Abs(f);v>g&&(p*=1,y*=1),this.m_mass.col1.x=_+u+h*h*p+c*c*y,this.m_mass.col2.x=-h*l*p-c*m*y,this.m_mass.col3.x=-h*p-c*y,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=_+u+l*l*p+m*m*y,this.m_mass.col3.y=l*p+m*y,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=p+y;var w=new s;return this.m_mass.Solve33(w,-d,-x,-f),r.m_sweep.c.x-=_*w.x,r.m_sweep.c.y-=_*w.y,r.m_sweep.a-=p*(l*w.y-h*w.x+w.z),a.m_sweep.c.x+=u*w.x,a.m_sweep.c.y+=u*w.y,a.m_sweep.a+=y*(m*w.y-c*w.x+w.z),r.SynchronizeTransform(),a.SynchronizeTransform(),t.b2_linearSlop>=v&&t.b2_angularSlop>=b},$i_19.inherit(A,$i_19.Dynamics.Joints.b2JointDef),A.prototype.__super=$i_19.Dynamics.Joints.b2JointDef.prototype,A.b2WeldJointDef=function(){$i_19.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},A.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_weldJoint,this.referenceAngle=0},A.prototype.Initialize=function(t,i,e){this.bodyA=t,this.bodyB=i,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(e)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var t=$i_19.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){},setTranslation:function(i,e){t.m_ctx.translate(i,e)}}}},t.prototype._color=function(t,i){return"rgba("+((t&16711680)>>16)+","+((t&65280)>>8)+","+(t&255)+","+i+")"},t.prototype.b2DebugDraw=function(){this.m_drawFlags=0},t.prototype.SetFlags=function(t){t===void 0&&(t=0),this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){t===void 0&&(t=0),this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){t===void 0&&(t=0),this.m_drawFlags&=~t},t.prototype.SetSprite=function(t){this.m_ctx=t},t.prototype.GetSprite=function(){return this.m_ctx},t.prototype.SetDrawScale=function(t){t===void 0&&(t=0),this.m_drawScale=t},t.prototype.GetDrawScale=function(){return this.m_drawScale},t.prototype.SetLineThickness=function(t){t===void 0&&(t=0),this.m_lineThickness=t,this.m_ctx.strokeWidth=t},t.prototype.GetLineThickness=function(){return this.m_lineThickness},t.prototype.SetAlpha=function(t){t===void 0&&(t=0),this.m_alpha=t},t.prototype.GetAlpha=function(){return this.m_alpha},t.prototype.SetFillAlpha=function(t){t===void 0&&(t=0),this.m_fillAlpha=t},t.prototype.GetFillAlpha=function(){return this.m_fillAlpha},t.prototype.SetXFormScale=function(t){t===void 0&&(t=0),this.m_xformScale=t},t.prototype.GetXFormScale=function(){return this.m_xformScale},t.prototype.DrawPolygon=function(t,i,e){if(i){var o=this.m_ctx,n=this.m_drawScale;o.beginPath(),o.strokeStyle=this._color(e.color,this.m_alpha),o.moveTo(t[0].x*n,t[0].y*n);for(var s=1;i>s;s++)o.lineTo(t[s].x*n,t[s].y*n);o.lineTo(t[0].x*n,t[0].y*n),o.closePath(),o.stroke()}},t.prototype.DrawSolidPolygon=function(t,i,e){if(i){var o=this.m_ctx,n=this.m_drawScale;o.beginPath(),o.strokeStyle=this._color(e.color,this.m_alpha),o.fillStyle=this._color(e.color,this.m_fillAlpha),o.moveTo(t[0].x*n,t[0].y*n);for(var s=1;i>s;s++)o.lineTo(t[s].x*n,t[s].y*n);o.lineTo(t[0].x*n,t[0].y*n),o.closePath(),o.fill(),o.stroke()}},t.prototype.DrawCircle=function(t,i,e){if(i){var o=this.m_ctx,n=this.m_drawScale;o.beginPath(),o.strokeStyle=this._color(e.color,this.m_alpha),o.arc(t.x*n,t.y*n,i*n,0,Math.PI*2,!0),o.closePath(),o.stroke()}},t.prototype.DrawSolidCircle=function(t,i,e,o){if(i){var n=this.m_ctx,s=this.m_drawScale,r=t.x*s,a=t.y*s;n.moveTo(0,0),n.beginPath(),n.strokeStyle=this._color(o.color,this.m_alpha),n.fillStyle=this._color(o.color,this.m_fillAlpha),n.arc(r,a,i*s,0,Math.PI*2,!0),n.moveTo(r,a),n.lineTo((t.x+e.x*i)*s,(t.y+e.y*i)*s),n.closePath(),n.fill(),n.stroke()}},t.prototype.DrawSegment=function(t,i,e){var o=this.m_ctx,n=this.m_drawScale;o.strokeStyle=this._color(e.color,this.m_alpha),o.beginPath(),o.moveTo(t.x*n,t.y*n),o.lineTo(i.x*n,i.y*n),o.closePath(),o.stroke()},t.prototype.DrawTransform=function(t){var i=this.m_ctx,e=this.m_drawScale;i.beginPath(),i.strokeStyle=this._color(16711680,this.m_alpha),i.moveTo(t.position.x*e,t.position.y*e),i.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*e,(t.position.y+this.m_xformScale*t.R.col1.y)*e),i.strokeStyle=this._color(65280,this.m_alpha),i.moveTo(t.position.x*e,t.position.y*e),i.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*e,(t.position.y+this.m_xformScale*t.R.col2.y)*e),i.closePath(),i.stroke()}}();var i;for(i=0;$i_19.postDefs.length>i;++i)$i_19.postDefs[i]();delete $i_19.postDefs,typeof window=="undefined"&&(exports.$i_19=$i_19);var $i_39=$i_3.extend({classId:"$i_39",componentId:"cocoonJs",init:function(){this.detected=typeof ext!="undefined"&&ext.IDTK_APP!==void 0,this.detected&&this.log("CocoonJS support enabled!")},showInputDialog:function(t,i,e,o,n,s){this.detected?(t=t||"",i=i||"",e=e||"",o=o||"text",n=n||"Cancel",s=s||"OK",ext.IDTK_APP.makeCall("showTextDialog",t,i,e,o,n,s)):this.log("Cannot open CocoonJS input dialog! CocoonJS is not detected!","error")},showWebView:function(t){this.detected&&(ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('loadPath', '"+t+"')"),ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('show');"))},hideWebView:function(){this.detected&&ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('hide');")}}),$i_40={translateBy:function(t,i,e){return t!==void 0&&i!==void 0&&e!==void 0?(this._translate.x+=t,this._translate.y+=i,this._translate.z+=e):this.log("translateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translateTo:function(t,i,e){return t!==void 0&&i!==void 0&&e!==void 0?(this._translate.x=t,this._translate.y=i,this._translate.z=e):this.log("translateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translate:function(){return this.x=this._translateAccessorX,this.y=this._translateAccessorY,this.z=this._translateAccessorZ,this._entity||this},_translateAccessorTween:function(t,i,e){return new $i_47(this._translate,t,i,e)},_translateAccessorX:function(t){return t!==void 0?(this._translate.x=t,this._entity||this):this._translate.x},_translateAccessorY:function(t){return t!==void 0?(this._translate.y=t,this._entity||this):this._translate.y},_translateAccessorZ:function(t){return t!==void 0?(this._translate.z=t,this._entity||this):this._translate.z},rotateBy:function(t,i,e){return t!==void 0&&i!==void 0&&e!==void 0?(this._rotate.x+=t,this._rotate.y+=i,this._rotate.z+=e):this.log("rotateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotateTo:function(t,i,e){return t!==void 0&&i!==void 0&&e!==void 0?(this._rotate.x=t,this._rotate.y=i,this._rotate.z=e):this.log("rotateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotate:function(){return this.x=this._rotateAccessorX,this.y=this._rotateAccessorY,this.z=this._rotateAccessorZ,this._entity||this},_rotateAccessorTween:function(t,i,e){return new $i_47(this._rotate,t,i,e)},_rotateAccessorX:function(t){return t!==void 0?(this._rotate.x=t,this._entity||this):this._rotate.x},_rotateAccessorY:function(t){return t!==void 0?(this._rotate.y=t,this._entity||this):this._rotate.y},_rotateAccessorZ:function(t){return t!==void 0?(this._rotate.z=t,this._entity||this):this._rotate.z},scaleBy:function(t,i,e){return t!==void 0&&i!==void 0&&e!==void 0?(this._scale.x+=t,this._scale.y+=i,this._scale.z+=e):this.log("scaleBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scaleTo:function(t,i,e){return t!==void 0&&i!==void 0&&e!==void 0?(this._scale.x=t,this._scale.y=i,this._scale.z=e):this.log("scaleTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scale:function(){return this.x=this._scaleAccessorX,this.y=this._scaleAccessorY,this.z=this._scaleAccessorZ,this._entity||this},_scaleAccessorTween:function(t,i,e){return new $i_47(this._scale,t,i,e)},_scaleAccessorX:function(t){return t!==void 0?(this._scale.x=t,this._entity||this):this._scale.x},_scaleAccessorY:function(t){return t!==void 0?(this._scale.y=t,this._entity||this):this._scale.y},_scaleAccessorZ:function(t){return t!==void 0?(this._scale.z=t,this._entity||this):this._scale.z},originBy:function(t,i,e){return t!==void 0&&i!==void 0&&e!==void 0?(this._origin.x+=t,this._origin.y+=i,this._origin.z+=e):this.log("originBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},originTo:function(t,i,e){return t!==void 0&&i!==void 0&&e!==void 0?(this._origin.x=t,this._origin.y=i,this._origin.z=e):this.log("originTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},origin:function(){return this.x=this._originAccessorX,this.y=this._originAccessorY,this.z=this._originAccessorZ,this._entity||this},_originAccessorTween:function(t,i,e){return new $i_47(this._origin,t,i,e)},_originAccessorX:function(t){return t!==void 0?(this._origin.x=t,this._entity||this):this._origin.x},_originAccessorY:function(t){return t!==void 0?(this._origin.y=t,this._entity||this):this._origin.y},_originAccessorZ:function(t){return t!==void 0?(this._origin.z=t,this._entity||this):this._origin.z},_rotatePoint:function(t,i,e){var o=Math.cos(i),n=Math.sin(i);return{x:e.x+(t.x-e.x)*o+(t.y-e.y)*n,y:e.y-(t.x-e.x)*n+(t.y-e.y)*o}},updateTransform:function(){if(this._localMatrix.identity(),this._mode===0&&this._localMatrix.multiply(this._localMatrix._newTranslate(this._translate.x,this._translate.y)),this._mode===1){var t=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this.geometry.z/2).toIso();this._parent&&this._parent.geometry.z&&(t.y+=this._parent.geometry.z/1.6),this._localMatrix.multiply(this._localMatrix._newTranslate(t.x,t.y))}this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z)),this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y)),this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_40);var $i_41={left:function(t){return t!==void 0?(this._uiX=t,this._uiXAlign="left",this._updateUiPosition(),this):this._uiX},center:function(t){return t!==void 0?(this._uiX=t,this._uiXAlign="center",this._updateUiPosition(),this):this._uiX},right:function(t){return t!==void 0?(this._uiX=t,this._uiXAlign="right",this._updateUiPosition(),this):this._uiX},top:function(t){return t!==void 0?(this._uiY=t,this._uiYAlign="top",this._updateUiPosition(),this):this._uiY},middle:function(t){return t!==void 0?(this._uiY=t,this._uiYAlign="middle",this._updateUiPosition(),this):this._uiY},bottom:function(t){return t!==void 0?(this._uiY=t,this._uiYAlign="bottom",this._updateUiPosition(),this):this._uiY},width:function(t,i,e){if(t!==void 0){if(this._width=t,this._widthModifier=i!==void 0?i:0,typeof t=="string")if(this._parent){var o=this._parent.geometry.x,n=parseInt(t,10);this.geometry.x=o/100*n+this._widthModifier|0,this.geometry.x2=Math.floor(this.geometry.x/2)}else{var o=ige.geometry.x,n=parseInt(t,10);this.geometry.x=o/100*n+this._widthModifier|0,this.geometry.x2=Math.floor(this.geometry.x/2)}else this.geometry.x=t,this.geometry.x2=Math.floor(this.geometry.x/2);return e||this._updateUiPosition(),this}return this._width},height:function(t,i,e){if(t!==void 0){if(this._height=t,this._heightModifier=i!==void 0?i:0,typeof t=="string")if(this._parent){var o=this._parent.geometry.y,n=parseInt(t,10);this.geometry.y=o/100*n+this._heightModifier|0,this.geometry.y2=Math.floor(this.geometry.y/2)}else{var o=ige.geometry.y,n=parseInt(t,10);this.geometry.y=o/100*n+this._heightModifier|0,this.geometry.y2=Math.floor(this.geometry.y/2)}else this.geometry.y=t,this.geometry.y2=Math.floor(this.geometry.y/2);return e||this._updateUiPosition(),this}return this._height},_updateUiPosition:function(){if(this._parent){var t=this._parent.geometry,i=this.geometry;this._width&&this.width(this._width,this._widthModifier,!0),this._height&&this.height(this._height,this._heightModifier,!0),this._uiXAlign==="right"?this._translate.x=Math.floor(t.x2-i.x2-this._uiX):this._uiXAlign==="center"?this._translate.x=Math.floor(this._uiX):this._uiXAlign==="left"&&(this._translate.x=Math.floor(this._uiX+i.x2-t.x2)),this._uiYAlign==="bottom"?this._translate.y=Math.floor(t.y2-i.y2-this._uiY):this._uiYAlign==="middle"?this._translate.y=Math.floor(this._uiY):this._uiYAlign==="top"&&(this._translate.y=Math.floor(this._uiY+i.y2-t.y2)),this.dirty(!0)}}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_41);var $i_42={backgroundImage:function(t,i){if(t&&t.image){if(i||(i="no-repeat"),this._patternRepeat=i,this._patternTexture=t,this._backgroundSize?(t.resize(this._backgroundSize.x,this._backgroundSize.y),this._patternWidth=this._backgroundSize.x,this._patternHeight=this._backgroundSize.y):(this._patternWidth=t.image.width,this._patternHeight=t.image.height),this._cell>1){var e=document.createElement("canvas"),o=e.getContext("2d"),n=t._cells[this._cell];e.width=n[2],e.height=n[3],o.drawImage(t.image,n[0],n[1],n[2],n[3],0,0,n[2],n[3]),this._patternFill=ige._ctx.createPattern(e,i)}else this._patternFill=ige._ctx.createPattern(t.image,i);return t.restoreOriginal(),this.dirty(!0),this}return this._patternFill},backgroundSize:function(t,i){return t!==void 0&&i!==void 0?(typeof t=="string"&&(t=this.geometry.x/100*parseInt(t,10)),typeof i=="string"&&(i=this.geometry.y/100*parseInt(i,10)),this._backgroundSize={x:t,y:i},this._patternTexture&&this._patternRepeat&&this.backgroundImage(this._patternTexture,this._patternRepeat),this.dirty(!0),this):this._backgroundSize},backgroundColor:function(t){return t!==void 0?(this._backgroundColor=t,this.dirty(!0),this):this._backgroundColor},backgroundPosition:function(t,i){return t!==void 0&&i!==void 0?(this._backgroundPosition={x:t,y:i},this.dirty(!0),this):this._backgroundPosition},borderColor:function(t){return t!==void 0?(this._borderColor=t,this._borderLeftColor=t,this._borderTopColor=t,this._borderRightColor=t,this._borderBottomColor=t,this.dirty(!0),this):this._borderColor},borderLeftColor:function(t){return t!==void 0?(this._borderLeftColor=t,this.dirty(!0),this):this._borderLeftColor},borderTopColor:function(t){return t!==void 0?(this._borderTopColor=t,this.dirty(!0),this):this._borderTopColor},borderRightColor:function(t){return t!==void 0?(this._borderRightColor=t,this.dirty(!0),this):this._borderRightColor},borderBottomColor:function(t){return t!==void 0?(this._borderBottomColor=t,this.dirty(!0),this):this._borderBottomColor},borderWidth:function(t){return t!==void 0?(this._borderWidth=t,this._borderLeftWidth=t,this._borderTopWidth=t,this._borderRightWidth=t,this._borderBottomWidth=t,this.dirty(!0),this):this._borderWidth},borderLeftWidth:function(t){return t!==void 0?(this._borderLeftWidth=t,this.dirty(!0),this):this._borderLeftWidth},borderTopWidth:function(t){return t!==void 0?(this._borderTopWidth=t,this.dirty(!0),this):this._borderTopWidth},borderRightWidth:function(t){return t!==void 0?(this._borderRightWidth=t,this.dirty(!0),this):this._borderRightWidth},borderBottomWidth:function(t){return t!==void 0?(this._borderBottomWidth=t,this.dirty(!0),this):this._borderBottomWidth},borderRadius:function(t){return t!==void 0?(this._borderRadius=t,this._borderTopLeftRadius=t,this._borderTopRightRadius=t,this._borderBottomRightRadius=t,this._borderBottomLeftRadius=t,this.dirty(!0),this):this._borderRadius},padding:function(t,i,e,o){return this._paddingLeft=t,this._paddingTop=i,this._paddingRight=e,this._paddingBottom=o,this.dirty(!0),this},paddingLeft:function(t){return t!==void 0?(this._paddingLeft=t,this.dirty(!0),this):this._paddingLeft},paddingTop:function(t){return t!==void 0?(this._paddingTop=t,this.dirty(!0),this):this._paddingTop},paddingRight:function(t){return t!==void 0?(this._paddingRight=t,this.dirty(!0),this):this._paddingRight},paddingBottom:function(t){return t!==void 0?(this._paddingBottom=t,this.dirty(!0),this):this._paddingBottom}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_42);var $i_43={mouseMove:function(t){return t?(this._mouseMove=t,this._mouseEventsActive=!0,this):this._mouseMove},mouseMoveOff:function(){delete this._mouseMove},mouseOver:function(t){return t?(this._mouseOver=t,this._mouseEventsActive=!0,this):this._mouseOver},mouseOverOff:function(){delete this._mouseOver},mouseOut:function(t){return t?(this._mouseOut=t,this._mouseEventsActive=!0,this):this._mouseOut},mouseOutOff:function(){delete this._mouseOut},mouseUp:function(t){return t?(this._mouseUp=t,this._mouseEventsActive=!0,this):this._mouseUp},mouseUpOff:function(){delete this._mouseUp},mouseDown:function(t){return t?(this._mouseDown=t,this._mouseEventsActive=!0,this):this._mouseDown},mouseDownOff:function(){delete this._mouseDown},_handleMouseIn:function(t){this._mouseStateOver||(this._mouseStateOver=!0,this._mouseOver&&this._mouseOver(t)),this._mouseMove&&this._mouseMove(t)},_handleMouseOut:function(t){this._mouseStateDown=!1,this._mouseStateOver&&(this._mouseStateOver=!1,this._mouseOut&&this._mouseOut(t))},_handleMouseUp:function(t){this._mouseStateDown=!1,this._mouseUp&&this._mouseUp(t)},_handleMouseDown:function(t){this._mouseStateDown||(this._mouseStateDown=!0,this._mouseDown&&this._mouseDown(t))}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_43);var nullMethod=function(){},$i_44={dummy:!0,save:nullMethod,restore:nullMethod,translate:nullMethod,rotate:nullMethod,scale:nullMethod,drawImage:nullMethod,fillRect:nullMethod,strokeRect:nullMethod,stroke:nullMethod,fill:nullMethod,rect:nullMethod,moveTo:nullMethod,lineTo:nullMethod,arc:nullMethod,clearRect:nullMethod,beginPath:nullMethod,clip:nullMethod,transform:nullMethod,setTransform:nullMethod,fillText:nullMethod};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_44);var $i_47=$i_2.extend({classId:"$i_47",init:function(t,i,e,o){this._targetObj=t,this._propertyObj=i!==void 0?i:{},this._durationMs=e!==void 0?e:0,this._started=!1,o&&o.easing?this.easing(o.easing):this.easing("none"),o&&o.startTime!==void 0&&this.startTime(o.startTime),o&&o.beforeTween!==void 0&&this.beforeTween(o.beforeTween),o&&o.afterTween!==void 0&&this.afterTween(o.afterTween)},targetObj:function(t){return t!==void 0&&(this._targetObj=t),this},properties:function(t){return t!==void 0&&(this._propertyObj=t),this},duration:function(t){return t!==void 0&&(this._durationMs=t),this},beforeTween:function(t){return t!==void 0&&(this._beforeTween=t),this},afterTween:function(t){return t!==void 0&&(this._afterTween=t),this},easing:function(t){return t!==void 0&&(this._easing=t),this},startTime:function(t){return t!==void 0&&(this._startTime=t),this},start:function(){return ige.tween.start(this),this._targetObj._tweenArr=this._targetObj._tweenArr||[],this._targetObj._tweenArr.push(this),this},stop:function(){return ige.tween.stop(this),this._targetObj._tweenArr.pull(this),this},startAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(t){t.start()}),this},stopAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(t){t.stop()}),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_47);var $i_48=$i_3.extend({classId:"$i_48",$i_48:!0,init:function(t){this._cells=[],t&&this.url(t)},id:function(t){if(t!==void 0){if(!ige._register[t])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=t,ige.register(this),this;this.log('Cannot set ID of object to "'+t+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=ige.newIdHex(),ige.register(this)),this._id},url:function(t){return t!==void 0?(this._url=t,t.substr(t.length-2,2)==="js"?this._loadScript(t):this._loadImage(t),this):this._url},_loadImage:function(t){var i,e=this;ige.isServer||(ige.textureLoadStart(t,this),ige._textureImageStore[t]?(i=this.image=this._originalImage=ige._textureImageStore[t],i._igeTextures.push(this),i._loaded&&(e._mode=0,e.sizeX(i.width),e.sizeY(i.height),e._cells[1]=[0,0,e._sizeX,e._sizeY],e._loaded=!0,setTimeout(function(){e.emit("loaded"),ige.textureLoadEnd(t,e)},1))):(i=ige._textureImageStore[t]=this.image=this._originalImage=new Image,i._igeTextures=i._igeTextures||[],i._igeTextures.push(this),i.onload=function(){this._loaded=!0,ige.log('Texture image "'+t+'" loaded successfully');var o,n,s=this._igeTextures,r=s.length;for(o=0;r>o;o++)n=s[o],n._mode=0,n.sizeX(i.width),n.sizeY(i.height),n._cells[1]=[0,0,n._sizeX,n._sizeY],n._loaded=!0,n.emit("loaded"),ige.textureLoadEnd(t,e)},i.src=t))},_loadScript:function(scriptUrl){var textures=ige.textures,rs_sandboxContext,self=this,scriptElem;ige.textureLoadStart(scriptUrl,this),ige.isServer||(scriptElem=document.createElement("script"),scriptElem.onload=function(data){self.log('Texture script "'+scriptUrl+'" loaded successfully'),eval(data),self._mode=1,self.script=image,typeof image.init=="function"&&image.init.apply(image,[self]),self._loaded=!0,self.emit("loaded"),ige.textureLoadEnd(scriptUrl,self)},scriptElem.addEventListener("error",function(){self.log("Error loading smart texture script file: "+scriptUrl,"error")},!0),scriptElem.src=scriptUrl,document.getElementsByTagName("head")[0].appendChild(scriptElem)),ige.isServer&&(rs_sandboxContext={},textures.fs.readFile(scriptUrl,this.bind(function(t,i){try{if(textures.vm.runInNewContext(i,rs_sandboxContext),typeof rs_sandboxContext.image=="object"){this.log('Texture script "'+scriptUrl+'" loaded successfully');var e=rs_sandboxContext.image;typeof e.init=="function"&&e.init.apply(e,[ige,this]),this.sizeX(e.width),this.sizeY(e.height),this._loaded=!0,self.emit("loaded"),ige.textureLoadEnd(scriptUrl,self)}else this.log("Error reading asset render script data. The script does not contain an image variable!","error",[this.url,rs_sandboxContext])
}catch(o){this.log("Error executing asset render script: ","error",[o,this.url])}})))},sizeX:function(t){this._sizeX=t},sizeY:function(t){this._sizeY=t},resize:function(t,i,e){this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas")),this._textureCanvas.width=t,this._textureCanvas.height=i,this._textureCtx=this._textureCanvas.getContext("2d"),e||this._textureCtx.drawImage(this._originalImage,0,0,this._originalImage.width,this._originalImage.height,0,0,t,i),this.image=this._textureCanvas)},restoreOriginal:function(){this.image=this._originalImage,delete this._textureCtx,delete this._textureCanvas},smoothing:function(t){return t!==void 0?(this._smoothing=t,this):this._smoothing},render:function(t,i){if(i._cell!==null){if(this._smoothing?(ige._ctx.imageSmoothingEnabled=!0,ige._ctx.webkitImageSmoothingEnabled=!0,ige._ctx.mozImageSmoothingEnabled=!0):(ige._ctx.imageSmoothingEnabled=!1,ige._ctx.webkitImageSmoothingEnabled=!1,ige._ctx.mozImageSmoothingEnabled=!1),this._mode===0){var e=this._cells[i._cell],o=i.geometry,n=i._renderPos;e?(this._preFilter&&this._textureCtx&&(this._textureCtx.save(),this._preFilter(this._textureCanvas,this._textureCtx,this._originalImage,this,this._preFilterData),this._textureCtx.restore()),t.drawImage(this.image,e[0],e[1],e[2],e[3],n.x,n.y,o.x,o.y),ige._drawCount++):this.log("Cannot render texture using cell "+i._cell+" because the cell does not exist in the assigned texture!","error")}this._mode===1&&(t.save(),this.script.render(t,i,this),t.restore(),ige._drawCount++)}},preFilter:function(t,i){return t!==void 0?(this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d")),this.image=this._textureCanvas,this._preFilter=t,this._preFilterData=i),this):(this.log("Cannot use pre-filter, no filter method was passed!","warning"),this._preFilter)},applyFilter:function(t,i){return t!==void 0?this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d")),this.image=this._textureCanvas,this._textureCtx.save(),t(this._textureCanvas,this._textureCtx,this._originalImage,this,i),this._textureCtx.restore()):this.log("Cannot apply filter, no filter method was passed!","warning"),this},stringify:function(){var t="new "+this.classId()+"('"+this._url+"')";return t+=".id('"+this.id()+"')",t+=this._stringify()},destroy:function(){delete this._eventListeners,this.image&&this.image._igeTextures&&this.image._igeTextures.pull(this),ige.TextureStore.pull(this),delete this.image,delete this.script,delete this._textureCanvas,delete this._textureCtx,this._destroyed=!0}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_48);var $i_49=$i_48.extend({classId:"$i_49",$i_50:!0,init:function(t,i,e){var o=this;o.horizontalCells(i||1),o.verticalCells(e||1),this.on("loaded",function(){o.image?(o._sheetImage=this.image,o._applyCells()):o.log("Cannot create cell-sheet because texture has not loaded an image!","error")}),this._super(t)},cellCount:function(){return this.horizontalCells()*this.verticalCells()},horizontalCells:function(t){return t!==void 0?(this._cellColumns=t,this):this._cellColumns},verticalCells:function(t){return t!==void 0?(this._cellRows=t,this):this._cellRows},_applyCells:function(){var t,i,e,o,n,s,r,a,l;if(this.image&&this._cellRows&&this._cellColumns)if(t=this._sizeX,i=this._sizeY,e=this._cellRows,o=this._cellColumns,n=this._cellWidth=t/o,s=this._cellHeight=i/e,n!==parseInt(n,10)&&this.log("Cell width is a floating-point number! (Image Width "+t+" / Number of Columns "+o+" = "+n+")","warning"),s!==parseInt(s,10)&&this.log("Cell height is a floating-point number! (Image Height "+i+" / Number of Rows "+e+" = "+s,"warning"),e>1||o>1)for(r=1;e*o>=r;r++)l=Math.ceil(r/o)-1,a=r-o*l-1,this._cells[r]=[a*n,l*s,n,s];else this._cells[1]=[0,0,this._sizeX,this._sizeY]},stringify:function(){var t="new "+this.classId()+"('"+this.url()+"', "+this.horizontalCells()+", "+this.verticalCells()+")";return t+=".id('"+this.id()+"');"}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_48);var $i_50=$i_48.extend({classId:"$i_50",$i_50:!0,init:function(t,i){var e=this;this.on("loaded",function(){if(e.image){e._sheetImage=this.image;var t;for(t=0;i.length>t;t++)e._cells[t+1]=i[t]}else e.log("Cannot create cell-sheet because texture has not loaded an image!","error")}),this._super(t)},cellCount:function(){return this._cells.length},cellIdToIndex:function(t){var i,e=this._cells;for(i=1;e.length>i;i++)if(e[i][4]===t)return i;return-1},stringify:function(){var t="new "+this.classId()+"('"+this.url()+"', "+(this._cells+"")+")";return t+=".id('"+this.id()+"');"}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_50);var $i_52=$i_3.extend({classId:"$i_52",init:function(){this._alive=!0,this._mode=0,this._mountMode=0,this._parent=null,this._children=[],this._layer=0,this._depth=0,this._dirty=!0,this._depthSortMode=0,this._timeStream=[],this._inView=!0},alive:function(t){return t!==void 0?(this._alive=t,this):this._alive},id:function(t){if(t!==void 0){if(t===this._id)return this;if(!ige._register[t])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=t,ige.register(this),this;ige._register[t]!==this&&this.log('Cannot set ID of object to "'+t+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=ige.newIdHex(),ige.register(this)),this._id},group:function(t){return t!==void 0?(this._group=t,this):this._group},addBehaviour:function(t,i){if(typeof t=="string"){if(typeof i=="function")return this._behaviours=this._behaviours||[],this._behaviours.push({id:t,method:i}),this;this.log("The behaviour you passed is not a function! The second parameter of the call must be a function!","error")}else this.log("Cannot add behaviour to object because the specified behaviour id is not a string. You must provide two parameters with the addBehaviour() call, an id:String and a behaviour:Function. Adding a behaviour with an id allows you to remove it by it's id at a later stage!","error");return!1},removeBehaviour:function(t){if(t!==void 0){var i,e=this._behaviours;if(e){i=e.length;while(i--)if(e[i].id===t)return e.splice(i,1),this}}return!1},drawBounds:function(t){return t!==void 0?(this._drawBounds=t,this):this._drawBounds},drawBoundsData:function(t){return t!==void 0?(this._drawBoundsData=t,this):this._drawBoundsData},drawMouse:function(t){return t!==void 0?(this._drawMouse=t,this):this._drawMouse},parent:function(){return this._parent},children:function(){return this._children},mount:function(t){if(t){if(t._children){if(this.id(),this._parent){if(this._parent===t)return this;this.unMount()}return this._parent=t,t._children.push(this),this._parent._childMounted(this),this.emit("mounted",this._parent),this}return!1}this.log("Cannot mount non-existent object!","error")},unMount:function(){if(this._parent){var t=this._parent._children,i=t.indexOf(this);return i>-1?(t.splice(i,1),this._parent._childUnMounted(this),this._parent=null,this):!1}return!1},clone:function(){},mode:function(t){return t!==void 0?(this._mode=t,this):this._mode},isometric:function(t){return t===!0?(this._mode=1,this):t===!1?(this._mode=0,this):this._mode===1},isometricMounts:function(t){return t===!0?(this._mountMode=1,this):t===!1?(this._mountMode=0,this):this._mountMode===1},indestructible:function(t){return t!==void 0?(this._indestructible=t,this):this._indestructible},layer:function(t){return t!==void 0?(this._layer=t,this):this._layer},depth:function(t){return t!==void 0?(this._depth=t,this):this._depth},destroyChildren:function(){var t,i=this._children;if(i){t=i.length;while(t--)i[t].destroy()}return delete this._children,this},destroyBehaviours:function(){delete this._behaviours},destroyComponents:function(){var t,i=this._components;if(i){t=i.length;while(t--)i[t].destroy&&i[t].destroy()}return delete this._components,this},dirty:function(t){return t!==void 0?(this._dirty=t,this._parent&&this._parent.dirty(t),this):this._dirty},depthSortMode:function(t){return t!==void 0?(this._depthSortMode=t,this):this._depthSortMode},depthSortChildren:function(){var t,i,e,o,n=this._children;if(n&&(t=n.length,t>1))if(this._mountMode===1){if(this._depthSortMode===0){for(i={adj:[],c:[],p:[],order:[],order_ind:t-1},e=0;t>e;++e)for(i.c[e]=0,i.p[e]=-1,o=e+1;t>o;++o)i.adj[e]=i.adj[e]||[],i.adj[o]=i.adj[o]||[],n[e]._inView&&n[o]._inView&&n[e]._projectionOverlap&&n[o]._projectionOverlap&&n[e]._projectionOverlap(n[o])&&(n[e].isBehind(n[o])?i.adj[o].push(e):i.adj[e].push(o));for(e=0;t>e;++e)i.c[e]===0&&this._depthSortVisit(e,i);for(e=0;i.order.length>e;e++)n[i.order[e]].depth(e);this._children.sort(function(t,i){var e=i._layer-t._layer;return e===0?i._depth-t._depth:e})}if(this._depthSortMode===1&&this._children.sort(function(t,i){var e=i._layer-t._layer;return e===0?t.isBehind(i)?-1:1:e}),this._depthSortMode===2){while(t--)i=n[t],o=i._translate,o&&(i._depth=o.x+o.y+o.z);this._children.sort(function(t,i){var e=i._layer-t._layer;return e===0?i._depth-t._depth:e})}}else this._children.sort(function(t,i){var e=i._layer-t._layer;return e===0?i._depth-t._depth:e})},viewChecking:function(t){return t!==void 0?(this._viewChecking=t,this):this._viewChecking},viewCheckChildren:function(){var t,i=this._children,e=i.length,o=ige._currentViewport.viewArea();while(e--)t=i[e],t._inView=t._alwaysInView?!0:t.aabb?o.rectIntersect(t.aabb())?!0:!1:!1},tick:function(t){var i,e,o,n,s,r=this._children;if(this._viewChecking&&this.viewCheckChildren(),r)if(i=r.length,n=i,i&&!ige._headless&&(igeDebug.timing?(ige._tslt[this.id()]||(ige._tslt[this.id()]={}),e=(new Date).getTime(),this.depthSortChildren(),o=(new Date).getTime()-e,ige._tslt[this.id()].depthSortChildren=o):this.depthSortChildren()),s=i,igeDebug.timing)while(i--)t.save(),e=(new Date).getTime(),r[i].tick(t),o=(new Date).getTime()-e,r[i]&&(ige._tsit[r[i].id()]||(ige._tsit[r[i].id()]=0),ige._tslt[r[i].id()]||(ige._tslt[r[i].id()]={}),ige._tsit[r[i].id()]+=o,ige._tslt[r[i].id()].tick=o),t.restore();else while(i--)t.save(),r[i].tick(t),t.restore()},_depthSortVisit:function(t,i){var e,o,n=i.adj[t],s=n.length;for(i.c[t]=1,e=0;s>e;++e)o=n[e],i.c[o]===0&&(i.p[o]=t,this._depthSortVisit(o,i));i.c[t]=2,i.order[i.order_ind]=t,--i.order_ind},_resizeEvent:function(t){var i,e=this._children;if(e){i=e.length;while(i--)e[i]._resizeEvent(t)}},_processBehaviours:function(){if(ige._frameAlternator!==this._behaviourFA){var t,i=this._behaviours;if(i){t=i.length;while(t--)i[t].method.apply(this,arguments);this._behaviourFA=ige._frameAlternator}}},_childMounted:function(){this._resizeEvent(null)},_childUnMounted:function(){},destroy:function(){return this.unMount(),this._children&&this.destroyChildren(),this.destroyComponents(),this.destroyBehaviours(),ige.unRegister(this),this._alive=!1,delete this._eventListeners,this},stringify:function(){var t="new "+this.classId()+"()";return t+=".id('"+this.id()+"')",this.parent()&&(t+=".mount(ige.$('"+this.parent().id()+"'))"),t+=this._stringify()},_stringify:function(){var t,i="";for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_group":i+=".group('"+this.group()+"')";break;case"_drawBounds":i+=".drawBounds('"+this.drawBounds()+"')";break;case"_drawBoundsData":i+=".drawBoundsData('"+this.drawBoundsData()+"')";break;case"_drawMouse":i+=".drawMouse('"+this.drawMouse()+"')";break;case"_mode":i+=".mode('"+this.mode()+"')";break;case"_isometricMounts":i+=".isometricMounts('"+this.isometricMounts()+"')";break;case"_indestructible":i+=".indestructible('"+this.indestructible()+"')";break;case"_layer":i+=".layer('"+this.layer()+"')";break;case"_depth":i+=".depth('"+this.depth()+"')"}return i}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_52);var $i_53=$i_52.extend([{extension:$i_40,overwrite:!1},{extension:$i_43,overwrite:!0}],{classId:"$i_53",init:function(){this._super(),this._width=void 0,this._height=void 0,this._anchor=new $i_5(0,0,0),this._renderPos={x:0,y:0},this._opacity=1,this._cell=1,this._deathTime=void 0,this._oldTranslate=new $i_5(0,0,0),this._translate=new $i_5(0,0,0),this._rotate=new $i_5(0,0,0),this._scale=new $i_5(1,1,1),this._origin=new $i_5(.5,.5,.5),this.geometry=new $i_5(40,40,40),this._highlight=!1,this._mouseEventsActive=!1,this._localMatrix=new $i_8(this),this._worldMatrix=new $i_8(this),this._inView=!0,this.streamSections(["transform"])},mousePos:function(){var t;if(this._parent){if(this._parent.mousePos)return t=this._parent.mousePos(),new $i_5(t.x-this._translate.x,t.y-this._translate.y,0);throw"What happened? This code path should never be reached!"}return new $i_5(0,0,0)},translateToTile:function(t,i,e){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var o;o=e!==void 0?e*this._parent._tileWidth:this._translate.z,this.translateTo(t*this._parent._tileWidth,i*this._parent._tileHeight,o)}else this.log("Cannot translate to tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},widthByTile:function(t,i){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var e,o=this._mode===0?this._parent._tileWidth:this._parent._tileWidth*2;this.width(t*o),i&&(this._texture?(e=this._texture._sizeX/this.geometry.x,this.height(this._texture._sizeY/e)):this.log("Cannot set height based on texture aspect ratio and new width because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set width by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},heightByTile:function(t,i){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var e,o=this._mode===0?this._parent._tileHeight:this._parent._tileHeight*2;this.height(t*o),i&&(this._texture?(e=this._texture._sizeY/this.geometry.y,this.width(this._texture._sizeX/e)):this.log("Cannot set width based on texture aspect ratio and new height because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set height by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},occupyTile:function(){this.log("Cannot occupy a tile because the entity is not currently mounted to a tile sheet.","warning")},overTiles:function(){this.log("Cannot determine which tiles this entity lies over because the entity is not currently mounted to a tile sheet.","warning")},anchor:function(t,i){return t!==void 0&&i!==void 0?(this._anchor=new $i_5(t,i,0),this):this._anchor},width:function(t){return t!==void 0?(this._width=t,this.geometry.x=t,this.geometry.x2=t/2,this):this._width},height:function(t){return t!==void 0?(this._height=t,this.geometry.y=t,this.geometry.y2=t/2,this):this._height},size3d:function(t,i,e){return t!==void 0&&i!==void 0&&e!==void 0?(this.geometry=new $i_5(t,i,e),this):this.geometry},lifeSpan:function(t){return t!==void 0?(this.deathTime((new Date).getTime()+t),this):this.deathTime()-(new Date).getTime()},deathTime:function(t){return t!==void 0?(this._deathTime=t,this):this._deathTime},opacity:function(t){return t!==void 0?(this._opacity=t,this):this._opacity},texture:function(t){return t!==void 0?(this._texture=t,this):this._texture},cell:function(t){return t>0||t===null?(this._cell=t,this):this._cell},cellById:function(t){if(t!==void 0)if(this._texture){var i,e=this._texture,o=e._cells;for(i=1;o.length>i;i++)if(o[i][4]===t)return this.cell(i),this;this.log('Could not find the cell id "'+t+'" in the assigned entity texture '+e.id()+', please check your sprite sheet (texture) cell definition to ensure the cell id "'+t+'" has been assigned to a cell!',"error")}else this.log("Cannot assign cell index from cell ID until an $i_50 has been set as the texture for this entity. Please set the texture before calling cellById().","error");return this._cell},dimensionsFromTexture:function(){return this._texture&&(this.width(this._texture._sizeX),this.height(this._texture._sizeY)),this},dimensionsFromCell:function(){return this._texture&&(this.width(this._texture._cells[this._cell][2]),this.height(this._texture._cells[this._cell][3])),this},highlight:function(t){return t!==void 0?(this._highlight=t,this):this._highlight},localToWorld:function(t){this._worldMatrix.transform(t)},aabb:function(t){if(t||!this._aabb){var i,e,o,n,s,r,a,l,h,m=new $i_6,c=new $i_7(0,0,0,0),_=this._anchor,u=this.geometry,p=u.x,y=u.y,d=u.z,x=u.x2,f=u.y2,g=(u.z2,this._origin),v=g.x-.5,b=g.y-.5,w=g.z-.5;return this._mode===0&&(s=x+_.x,r=f+_.y,a=p*v,l=y*b,m.addPoint(-s+a,-r+l),m.addPoint(s+a,-r+l),m.addPoint(s+a,r+l),m.addPoint(-s+a,r+l),this._renderPos={x:-s+a,y:-r+l},this.localToWorld(m._poly),i=Math.min(m._poly[0].x,m._poly[1].x,m._poly[2].x,m._poly[3].x),e=Math.min(m._poly[0].y,m._poly[1].y,m._poly[2].y,m._poly[3].y),o=Math.max(m._poly[0].x,m._poly[1].x,m._poly[2].x,m._poly[3].x),n=Math.max(m._poly[0].y,m._poly[1].y,m._poly[2].y,m._poly[3].y),c.x=i,c.y=e,c.width=o-i,c.height=n-e),this._mode===1&&(h=new $i_5(-(u.x/2),-(u.y/2),u.z/2).toIso(),s=h.x+u.x+_.x,r=h.y+_.y,a=p*v,l=d*w,m.addPoint(-s+a,-r+l),m.addPoint(s+a,-r+l),m.addPoint(s+a,r+l),m.addPoint(-s+a,r+l),this._renderPos={x:-s+a,y:-r+l},this.localToWorld(m._poly),i=Math.min(m._poly[0].x,m._poly[1].x,m._poly[2].x,m._poly[3].x),e=Math.min(m._poly[0].y,m._poly[1].y,m._poly[2].y,m._poly[3].y),o=Math.max(m._poly[0].x,m._poly[1].x,m._poly[2].x,m._poly[3].x),n=Math.max(m._poly[0].y,m._poly[1].y,m._poly[2].y,m._poly[3].y),c.x=i,c.y=e,c.width=o-i,c.height=n-e),this._aabb=c,c}return this._aabb},_swapVars:function(t,i){return[i,t]},_internalsOverlap:function(t,i,e,o){var n;return t>i&&(n=this._swapVars(t,i),t=n[0],i=n[1]),e>o&&(n=this._swapVars(e,o),e=n[0],o=n[1]),t>e&&(n=this._swapVars(t,e),t=n[0],e=n[1],n=this._swapVars(i,o),i=n[0],o=n[1]),i>e},_projectionOverlap:function(t){var i=this.geometry,e=new $i_5(this._translate.x-i.x/2,this._translate.y-i.y/2,this._translate.z-i.z),o=new $i_5(this._translate.x+i.x/2,this._translate.y+i.y/2,this._translate.z+i.z),n=t.geometry,s=new $i_5(t._translate.x-n.x/2,t._translate.y-n.y/2,t._translate.z-n.z),r=new $i_5(t._translate.x+n.x/2,t._translate.y+n.y/2,t._translate.z+n.z);return this._internalsOverlap(e.x-o.y,o.x-e.y,s.x-r.y,r.x-s.y)&&this._internalsOverlap(e.x-o.z,o.x-e.z,s.x-r.z,r.x-s.z)&&this._internalsOverlap(e.z-o.y,o.z-e.y,s.z-r.y,r.z-s.y)},isBehind:function(t){var i=this.geometry,e=new $i_5(this._translate.x-i.x/2,this._translate.y-i.y/2,this._translate.z),o=new $i_5(this._translate.x+i.x/2,this._translate.y+i.y/2,this._translate.z+i.z),n=t.geometry,s=new $i_5(t._translate.x-n.x/2,t._translate.y-n.y/2,t._translate.z),r=new $i_5(t._translate.x+n.x/2,t._translate.y+n.y/2,t._translate.z+n.z);return o.x>s.x?r.x>e.x?o.y>s.y?r.y>e.y?o.z>s.z?r.z>e.z?this._translate.x+this._translate.y+this._translate.z>t._translate.x+t._translate.y+t._translate.z:!0:!1:!0:!1:!0:!1},mouseEventsActive:function(t){return t!==void 0?(this._mouseEventsActive=t,this):this._mouseEventsActive},tick:function(t,i){if(this._deathTime===void 0||ige.tickStart<this._deathTime){if(delete this._streamDataCache,this._processBehaviours(t),this._timeStream.length&&this._processInterpolate(ige.tickStart-ige.network.stream._renderLatency),this._inView&&(!this._parent||this._parent._inView)){var e,o,n,s,r=(ige._renderMode,this);this._mouseEventsActive&&(e=ige._currentViewport._mousePos,e&&(o=this.aabb(),n=e.x,s=e.y,o&&n>=o.x&&s>=o.y&&o.x+o.width>n&&o.y+o.height>s?ige.input.queueEvent(this,this._mouseInAabb):ige.input.mouseMove&&r._handleMouseOut(ige.input.mouseMove))),i||this._transformContext(t),this._renderEntity(t,i),this._streamMode===1&&this.streamSync()}this._super(t),this._oldTranslate=this._translate.clone()}else this.destroy()},_renderEntity:function(t){var i=this._texture;this._opacity>0&&i&&(i.render(t,this,ige.tickDelta),this._highlight&&(t.globalCompositeOperation="lighter",i.render(t,this)))},_transformContext:function(t){this.updateTransform(),this.aabb(!0),t.globalAlpha=this._parent?this._parent._opacity*this._opacity:this._opacity,this._localMatrix.transformRenderingContext(t)},_transformPoint:function(t){if(this._parent){var i=new $i_8;i.copy(this._parent._worldMatrix),i.multiply(this._localMatrix),i.transformCoord(t)}else this._localMatrix.transformCoord(t);return t},_mouseInAabb:function(t){ige.input.mouseMove&&this._handleMouseIn(ige.input.mouseMove,t),ige.input.mouseDown&&this._handleMouseDown(ige.input.mouseDown,t),ige.input.mouseUp&&this._handleMouseUp(ige.input.mouseUp,t)},_stringify:function(){var t,i=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_opacity":i+=".opacity("+this.opacity()+")";break;case"_texture":i+=".texture(ige.$('"+this.texture().id()+"'))";break;case"_cell":i+=".cell("+this.cell()+")";break;case"_translate":i+=".translateTo("+this._translate.x+", "+this._translate.y+", "+this._translate.z+")";break;case"_rotate":i+=".rotateTo("+this._rotate.x+", "+this._rotate.y+", "+this._rotate.z+")";break;case"_scale":i+=".scaleTo("+this._scale.x+", "+this._scale.y+", "+this._scale.z+")";break;case"_origin":i+=".originTo("+this._origin.x+", "+this._origin.y+", "+this._origin.z+")";break;case"_anchor":i+=".anchor("+this._anchor.x+", "+this._anchor.y+")";break;case"_width":i+=typeof this.width()=="string"?".width('"+this.width()+"')":".width("+this.width()+")";break;case"_height":i+=typeof this.height()=="string"?".height('"+this.height()+"')":".height("+this.height()+")";break;case"geometry":i+=".size3d("+this.geometry.x+", "+this.geometry.y+", "+this.geometry.z+")";break;case"_deathTime":i+=".deathTime('"+this.deathTime()+"')";break;case"_highlight":i+=".highlight('"+this.highlight()+"')"}return i},destroy:function(){this._alive=!1,this.emit("destroyed",this),this._super()},streamSections:function(t){return t!==void 0?(this._streamSections=t,this):this._streamSections},streamSectionData:function(t,i,e){if(t==="transform"){if(!i)return this._translate.toString(this._streamFloatPrecision)+","+this._scale.toString(this._streamFloatPrecision)+","+this._rotate.toString(this._streamFloatPrecision)+",";var o=i.split(",");e?(o[0]&&(this._translate.x=parseFloat(o[0])),o[1]&&(this._translate.y=parseFloat(o[1])),o[2]&&(this._translate.z=parseFloat(o[2])),o[3]&&(this._scale.x=parseFloat(o[3])),o[4]&&(this._scale.y=parseFloat(o[4])),o[5]&&(this._scale.z=parseFloat(o[5])),o[6]&&(this._rotate.x=parseFloat(o[6])),o[7]&&(this._rotate.y=parseFloat(o[7])),o[8]&&(this._rotate.z=parseFloat(o[8]))):(o[0]&&(o[0]=parseFloat(o[0])),o[1]&&(o[1]=parseFloat(o[1])),o[2]&&(o[2]=parseFloat(o[2])),o[3]&&(o[3]=parseFloat(o[3])),o[4]&&(o[4]=parseFloat(o[4])),o[5]&&(o[5]=parseFloat(o[5])),o[6]&&(o[6]=parseFloat(o[6])),o[7]&&(o[7]=parseFloat(o[7])),o[8]&&(o[8]=parseFloat(o[8])),this._timeStream.push([ige.network.stream._streamDataTime+ige.network._latency,o]),this._timeStream.length>10&&this._timeStream.shift())}},interpolateValue:function(t,i,e,o,n){var s=i-t,r=n-e,a=o-e,l=a/r;return 0>l?l=0:l>1&&(l=1),s*l+t},_processInterpolate:function(t,i){i||(i=200);var e,o,n,s,r,a,l,h=this._timeStream,m=[],c=1;while(h[c]){if(h[c][0]>=t){e=h[c-1],o=h[c];break}c++}o||e?h.splice(0,c-1):h.length>2&&t>h[h.length-1][0]&&(e=h[h.length-2],o=h[h.length-1],h.shift(),this.emit("entityInterpolationLag")),o&&e&&(n=o[0]-e[0],s=t-e[0],r=s/n,0>r?r=0:r>1&&(r=1),a=e[1],l=o[1],m[0]=this.interpolateValue(a[0],l[0],e[0],t,o[0]),m[1]=this.interpolateValue(a[1],l[1],e[0],t,o[0]),m[2]=this.interpolateValue(a[2],l[2],e[0],t,o[0]),m[3]=this.interpolateValue(a[3],l[3],e[0],t,o[0]),m[4]=this.interpolateValue(a[4],l[4],e[0],t,o[0]),m[5]=this.interpolateValue(a[5],l[5],e[0],t,o[0]),m[6]=this.interpolateValue(a[6],l[6],e[0],t,o[0]),m[7]=this.interpolateValue(a[7],l[7],e[0],t,o[0]),m[8]=this.interpolateValue(a[8],l[8],e[0],t,o[0]),this.translateTo(parseFloat(m[0]),parseFloat(m[1]),parseFloat(m[2])),this.scaleTo(parseFloat(m[3]),parseFloat(m[4]),parseFloat(m[5])),this.rotateTo(parseFloat(m[6]),parseFloat(m[7]),parseFloat(m[8])),this._lastUpdate=(new Date).getTime())}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_53);var $i_57=$i_2.extend({classId:"$i_57",init:function(t){this._mapData=t||[]},tileData:function(t,i,e){if(t!==void 0&&i!==void 0){if(e!==void 0)return this._mapData[i]=this._mapData[i]||[],this._mapData[i][t]=e,this;if(this._mapData[i])return this._mapData[i][t]}return void 0},clearData:function(t,i){return t!==void 0&&i!==void 0&&this._mapData[i]!==void 0?(delete this._mapData[i][t],!0):!1},collision:function(t,i,e,o){var n,s;if(e===void 0&&(e=1),o===void 0&&(o=1),t!==void 0&&i!==void 0)for(s=0;o>s;s++)for(n=0;e>n;n++)if(this.tileData(t+n,i+s))return!0;return!1},mapData:function(t){return t!==void 0?(this._mapData=t,this):this._mapData},mapDataString:function(){return JSON.stringify(this.mapData())},insertMapData:function(){},rotateData:function(t,i){switch(i){case-90:break;case 180:break;case 90:default:}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_57);var $i_59=$i_53.extend({classId:"$i_59",init:function(t,i){this._alwaysInView=!0,this._super(),this.map=new $i_57,this._tileWidth=t!==void 0?t:40,this._tileHeight=i!==void 0?i:40,this._drawGrid=0},drawGrid:function(t){return t!==void 0?(this._drawGrid=t,this):this._drawGrid},highlightOccupied:function(t){return t!==void 0?(this._highlightOccupied=t,this):this._highlightOccupied},highlightTileRect:function(t){return t!==void 0?(this._highlightTileRect=t,this):this._highlightTileRect},tileWidth:function(t){return t!==void 0?(this._tileWidth=t,this):this._tileWidth},tileHeight:function(t){return t!==void 0?(this._tileHeight=t,this):this._tileHeight},_childMounted:function(t){t.occupyTile=this._objectOccupyTile,t.unOccupyTile=this._objectUnOccupyTile,t.overTiles=this._objectOverTiles,this._super(t)},_objectOccupyTile:function(t,i,e,o){return t!==void 0&&i!==void 0?this._parent.occupyTile(t,i,e,o,this):this.overTiles(),this},_objectUnOccupyTile:function(t,i,e,o){return t!==void 0&&i!==void 0?this._parent.unOccupyTile(t,i,e,o):this.overTiles(),this},_objectOverTiles:function(){if(this._tileWidth&&this._tileHeight){var t,i;for(t=0;this._tileWidth>t;t++)for(i=0;this._tileHeight>i;i++);}else this.log('Cannot calculate which tiles this entity is currently "over" because it has not been assigned either a tileWidth or a tileHeight.',"error")},_resizeEvent:function(t){this.geometry=this._parent.geometry.clone(),this._super(t)},occupyTile:function(t,i,e,o,n){var s,r;if(e===void 0&&(e=1),o===void 0&&(o=1),t=Math.floor(t),i=Math.floor(i),e=Math.floor(e),o=Math.floor(o),t!==void 0&&i!==void 0){for(s=0;e>s;s++)for(r=0;o>r;r++)this.map.tileData(t+s,i+r,n);n._classId&&(n._occupiedRect=new $i_7(t,i,e,o))}return this},unOccupyTile:function(t,i,e,o){var n,s,r;if(e===void 0&&(e=1),o===void 0&&(o=1),t=Math.floor(t),i=Math.floor(i),e=Math.floor(e),o=Math.floor(o),t!==void 0&&i!==void 0)for(n=0;e>n;n++)for(s=0;o>s;s++)r=this.map.tileData(t+n,i+s),r&&r._occupiedRect&&delete r._occupiedRect,this.map.clearData(t+n,i+s);return this},isTileOccupied:function(t,i,e,o){return e===void 0&&(e=1),o===void 0&&(o=1),this.map.collision(t,i,e,o)},mouseDown:function(t){return t!==void 0?(this._tileMapMouseDown=t,this):this._tileMapMouseDown},mouseUp:function(t){return t!==void 0?(this._tileMapMouseUp=t,this):this._tileMapMouseUp},mouseOver:function(t){return t!==void 0?(this._tileMapMouseOver=t,this):this._tileMapMouseOver},pointToTile:function(t){var i,e,o,n=t.x,s=t.y;return this._mountMode===0&&(i=n+this._tileWidth/2,e=s+this._tileHeight/2,o=new $i_5(Math.floor(i/this._tileWidth),Math.floor(e/this._tileWidth))),this._mountMode===1&&(i=n,e=s-this._tileHeight/2,o=new $i_5(i,e,0).to2d(),o=new $i_5(Math.floor(o.x/this._tileWidth)+1,Math.floor(o.y/this._tileHeight)+1)),o},mouseTileWorldXY:function(){return this._mountMode===0?this._mouseTilePos.clone().thisMultiply(this._tileWidth,this._tileHeight,0):this._mountMode===1?this._mouseTilePos.clone().thisMultiply(this._tileWidth,this._tileHeight,0).thisToIso():void 0},mouseToTile:function(){return this.pointToTile(this.mousePos())},scanRects:function(t){var i,e,o=[],n=this.map._mapData.clone();for(e in n)if(n.hasOwnProperty(e))for(i in n[e])n[e].hasOwnProperty(i)&&n[e][i]&&(!t||t&&t(n[e][i],i,e))&&o.push(this._scanRects(n,parseInt(i,10),parseInt(e,10),t));return o},_scanRects:function(t,i,e,o){var n={x:i,y:e,width:1,height:1},s=i+1,r=e+1;t[e][i]=0;while(t[e][s]&&(!o||o&&o(t[e][s],s,e)))n.width++,t[e][s]=0,s++;while(t[r]&&t[r][i]&&(!o||o&&o(t[r][i],i,r))){if(t[r][i-1]&&(!o||o&&o(t[r][i-1],i-1,r))||t[r][i+n.width]&&(!o||o&&o(t[r][i+n.width],i+n.width,r)))return n;for(s=i;i+n.width>s;s++)if(!t[r][s]||o&&!o(t[r][s],s,r))return n;for(s=i;i+n.width>s;s++)t[r][s]=0;n.height++,r++}return n},_calculateMousePosition:function(){this._mouseTilePos=this.pointToTile(this.mousePos())},tick:function(t){var i,e,o,n,s,r,a,l,h=this._tileWidth,m=this._tileHeight;if(this._calculateMousePosition(),ige.input.mouseMove&&this._tileMapMouseOver&&this._tileMapMouseOver(this._mouseTilePos.x,this._mouseTilePos.y),ige.input.mouseDown&&this._tileMapMouseDown&&this._tileMapMouseDown(this._mouseTilePos.x,this._mouseTilePos.y),ige.input.mouseUp&&this._tileMapMouseUp&&this._tileMapMouseUp(this._mouseTilePos.x,this._mouseTilePos.y),this._transformContext(t),this._drawGrid>0){for(t.strokeStyle="#ffffff",gridCount=this._drawGrid,e=-(h/2),o=-(m/2),n=e+h*gridCount,s=o+m*gridCount,i=0;gridCount>=i;i++)r=new $i_5(e,o+m*i,0),a=new $i_5(n,o+m*i,0),this._mountMode===1&&(r=r.toIso(),a=a.toIso()),t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(a.x,a.y),t.stroke();for(i=0;gridCount>=i;i++)r=new $i_5(e+h*i,o,0),a=new $i_5(e+h*i,s,0),this._mountMode===1&&(r=r.toIso(),a=a.toIso()),t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(a.x,a.y),t.stroke()}if(this._highlightOccupied){t.fillStyle="#ff0000";for(o in this.map._mapData)if(this.map._mapData[o])for(e in this.map._mapData[o])this.map._mapData[o][e]&&(l=new $i_5(h*e,m*o,0),this._mountMode===0&&t.fillRect(l.x-h/2,l.y-m/2,h,m),this._mountMode===1&&(l.thisToIso(),t.beginPath(),t.moveTo(l.x,l.y-m/2),t.lineTo(l.x+h,l.y),t.lineTo(l.x,l.y+m/2),t.lineTo(l.x-h,l.y),t.lineTo(l.x,l.y-m/2),t.fill()))}if(this._highlightTileRect)for(t.fillStyle="#e4ff00",o=this._highlightTileRect.y;this._highlightTileRect.y+this._highlightTileRect.height>o;o++)for(e=this._highlightTileRect.x;this._highlightTileRect.x+this._highlightTileRect.width>e;e++)l=new $i_5(h*e,m*o,0),this._mountMode===0&&t.fillRect(l.x-h/2,l.y-m/2,h,m),this._mountMode===1&&(l.thisToIso(),t.beginPath(),t.moveTo(l.x,l.y-m/2),t.lineTo(l.x+h,l.y),t.lineTo(l.x,l.y+m/2),t.lineTo(l.x-h,l.y),t.lineTo(l.x,l.y-m/2),t.fill());this._drawMouse&&(t.fillStyle="#6000ff",this._mountMode===0&&t.fillRect(this._mouseTilePos.x*h-h/2,this._mouseTilePos.y*m-m/2,h,m),this._mountMode===1&&(l=this._mouseTilePos.clone().thisMultiply(h,m,0).thisToIso(),t.beginPath(),t.moveTo(l.x,l.y-m/2),t.lineTo(l.x+h,l.y),t.lineTo(l.x,l.y+m/2),t.lineTo(l.x-h,l.y),t.lineTo(l.x,l.y-m/2),t.fill())),this._super(t,!0)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_59);var $i_48Map=$i_59.extend({classId:"$i_48Map",init:function(t,i){this._super(t,i),this.map=new $i_57,this._textureList=[],this._renderCenter=new $i_5(0,0,0),this._cacheDirty=!0
},caching:function(t){return t!==void 0?(t===0&&(delete this._cache,delete this._cacheCtx),this._caching=t,this._caching>0&&this._renderArea&&this._resizeCacheCanvas(),this):this._caching},cacheForceFrame:function(){this._cacheDirty=!0},negate:function(t){if(t!==void 0){var i,e,o=t.map._mapData,n=this.map._mapData;for(e in o)if(o.hasOwnProperty(e))for(i in o[e])o[e].hasOwnProperty(i)&&n[e]&&n[e][i]&&delete n[e][i]}return this},addTexture:function(t){return this._textureList.push(t),this._textureList.length-1},paintTile:function(t,i,e,o){t!==void 0&&i!==void 0&&e!==void 0&&((o===void 0||1>o)&&(o=1),this.map.tileData(t,i,[e,o]))},clearTile:function(t,i){this.map.clearData(t,i)},_loadMapTextureLoaded:function(){this._loadMapTexturesLoading--,this._loadMapTexturesLoading===0&&this.emit("loadMapAllTexturesLoaded")},loadMap:function(map){if(map.textures){this._textureList=[],this._loadMapTexturesLoading=map.textures.length;var tex=[],i,self=this,_texLoaded=function(){self._loadMapTextureLoaded()};for(this.on("loadMapAllTexturesLoaded",function(){var t;for(t=0;map.textures.length>t;t++)self.addTexture(tex[t]);self.map.mapData(map.data)}),i=0;map.textures.length>i;i++)eval("tex["+i+"] = "+map.textures[0]),tex[i].on("loaded",_texLoaded)}else this.map.mapData(map.data);return this},saveMap:function(){var t,i,e,o=[],n=0,s=0,r=this.map._mapData;for(t=0;this._textureList.length>t;t++)o.push(this._textureList[t].stringify());for(e in r)if(r.hasOwnProperty(e))for(i in r[e])r[e].hasOwnProperty(i)&&(n>i&&(n=i),s>e&&(s=e));return JSON.stringify({textures:o,data:this.map.mapDataString(),dataXY:[n,s]})},tileTextureIndex:function(t,i,e){if(t!==void 0&&i!==void 0){var o=this.map.tileData(t,i);if(e===void 0)return o[0];o[0]=e}},tileTextureCell:function(t,i,e){if(t!==void 0&&i!==void 0){var o=this.map.tileData(t,i);if(e===void 0)return o[1];o[1]=e}},convertOldData:function(t){var i,e,o=[];for(i in t)if(t.hasOwnProperty(i))for(e in t[i])t[i].hasOwnProperty(e)&&(o[e]=o[e]||[],o[e][i]=t[i][e]);console.log(JSON.stringify(o))},renderArea:function(t,i,e,o){var n=!1;return this._renderArea?(t!==void 0&&(this._renderArea[0]=t,n=!0),i!==void 0&&(this._renderArea[1]=i,n=!0),e!==void 0&&(this._renderArea[2]=e,n=!0),o!==void 0&&(this._renderArea[3]=o,n=!0)):t!==void 0&&i!==void 0&&e!==void 0&&o!==void 0&&(this._renderArea=[t,i,e,o],n=!0),n?this:this._renderArea},renderAreaAutoSize:function(t,i){return t!==void 0?(this._renderAreaAutoSize=t,this._renderAreaAutoSizeOptions=i,this):this._renderAreaAutoSize},renderCenter:function(t,i){if(t!==void 0&&i!==void 0){var e;return this._mode===0&&(e=this._translate),this._mode===1&&(e=this._translate.toIso()),t-=e.x,i-=e.y,this._renderCenter&&this._renderCenter.x===t&&this._renderCenter.y===i||(this._renderCenter=new $i_5(t,i,0),this._cacheDirty=!0),this}return this._renderCenter},trackTranslate:function(t){return t!==void 0?(this._trackTranslateTarget=t,this):this._trackTranslateTarget},unTrackTranslate:function(){delete this._trackTranslateTarget},tick:function(t){this._super(t);var i,e,o,n,s,r,a=this.map._mapData,l=this._renderArea,h=this._newTileEntity();if(l)this._trackTranslateTarget&&(n=this._trackTranslateTarget.isometric()===!0?this._trackTranslateTarget._translate.toIso():this._trackTranslateTarget._translate,this.renderCenter(n.x,n.y)),this._caching>0?this._cacheDirty?this._caching===1&&this._cache&&this._cache[0]&&(s=this._cache[0],r=this._cacheCtx[0],this._cacheCtx[0].clearRect(0,0,s.width,s.height),r.save(),r.translate(s.width/2-this._renderCenter.x,s.height/2-this._renderCenter.y),this._renderMap(this._cacheCtx[0],h,a,l),r.restore(),this._renderMapCache(t,0,l),this._cacheDirty=!1):(this._renderMapCache(t,0,l),this._cacheDirty=!1):this._renderMap(t,h,a,l);else for(e in a)if(a.hasOwnProperty(e))for(i in a[e])a[e].hasOwnProperty(i)&&(o=a[e][i],o&&this._renderTile(t,i,e,o,h))},_renderMapCache:function(t,i,e){i===0&&t.drawImage(this._cache[i],-(e[2]/2)+this._renderCenter.x,-(e[3]/2)+this._renderCenter.y)},_renderMap:function(t,i,e,o){var n,s,r,a,l,h=this._renderCenter,m=this.pointToTile(this._renderCenter),c=m.x,_=m.y,u=Math.ceil(o[2]/this._tileWidth),p=Math.ceil(o[3]/this._tileHeight),y=new $i_7(o[0]+h.x,o[1]+h.y,o[2],o[3]);if(this._drawBounds&&(t.strokeStyle="#ff0000",t.strokeRect(y.x,y.y,y.width,y.height)),y.x-=this._tileWidth,y.y-=this._tileHeight/2,y.width+=this._tileWidth*2,y.height+=this._tileHeight,this._mountMode===0)for(s=_-Math.floor(p/2)-1;_+Math.floor(p/2)+1>=s;s++)if(e[s])for(n=c-Math.floor(u/2)-1;c+Math.floor(u/2)+1>=n;n++)r=e[s][n],r&&this._renderTile(t,n,s,r,i,y);if(this._mountMode===1)for(a=Math.abs(u)>Math.abs(p)?u:p,l=1,s=_-Math.floor(a*l);_+Math.floor(a*l)>=s;s++)if(e[s])for(n=c-Math.floor(a*l);c+Math.floor(a*l)>=n;n++)r=e[s][n],r&&this._renderTile(t,n,s,r,i,y)},_renderTile:function(t,i,e,o,n,s){var r,a;this._mountMode===0&&(r=i*this._tileWidth,a=e*this._tileHeight),this._mountMode===1&&(tx=i*this._tileWidth,ty=e*this._tileHeight,sx=tx-ty,sy=(tx+ty)*.5,r=sx,a=sy),(!s||s.xyInside(r,a))&&(t.save(),t.translate(r,a),texture=this._textureList[o[0]],n._cell=o[1],texture.render(t,n,ige.tickDelta),t.restore())},_resizeEvent:function(t){if(this._renderAreaAutoSize){var i=this._parent.geometry,e=0,o=0;this._renderAreaAutoSizeOptions&&(this._renderAreaAutoSizeOptions.bufferMultiple&&(e=i.x*this._renderAreaAutoSizeOptions.bufferMultiple.x-i.x,o=i.y*this._renderAreaAutoSizeOptions.bufferMultiple.y-i.y),this._renderAreaAutoSizeOptions.bufferPixels&&(e=this._renderAreaAutoSizeOptions.bufferPixels.x,o=this._renderAreaAutoSizeOptions.bufferPixels.y)),this.renderArea(-Math.floor((i.x+e)/2),-Math.floor((i.y+o)/2),i.x+e,i.y+o),this._caching>0&&this._resizeCacheCanvas()}this._super(t)},_resizeCacheCanvas:function(){switch(this._caching){case 1:this._cache=[],this._cacheCtx=[],this._cacheDirty=!0,canvas=document.createElement("canvas"),canvas.width=this._renderArea[2],canvas.height=this._renderArea[3],canvas.style.position="absolute",canvas.style.left="0px",canvas.style.top="0px",canvas.style.opacity="0",this._cache.push(canvas),this._cacheCtx.push(canvas.getContext("2d"))}},_newTileEntity:function(){return this._mountMode===0?{_cell:1,geometry:{x:this._tileWidth,y:this._tileHeight},_renderPos:{x:-this._tileWidth/2,y:-this._tileHeight/2}}:this._mountMode===1?{_cell:1,geometry:{x:this._tileWidth*2,y:this._tileHeight},_renderPos:{x:-this._tileWidth,y:-this._tileHeight/2}}:void 0}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_48Map);var $i_62=$i_53.extend({classId:"$i_62",init:function(t){this._super(),this._trackRotateTarget=void 0,this._trackTranslateTarget=void 0,this._trackRotateSmoothing=void 0,this._trackTranslateSmoothing=void 0,this._entity=t},limit:function(t){return t!==void 0?(this._limit=t,this._entity):this._limit},panTo:function(t,i,e){return t!==void 0&&this._translate.tween().properties({x:t.x,y:t.y,z:t.z}).duration(i).easing(e).start(),this._entity},panBy:function(t,i,e){return t!==void 0&&this._translate.tween().properties({x:t.x+this._translate.x,y:t.y+this._translate.y,z:t.z+this._translate.z}).duration(i).easing(e).start(),this._entity},trackTranslate:function(t,i){return t!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking translation target "+t.id()),this._trackTranslateSmoothing=1>i?0:i,this._trackTranslateTarget=t,this._entity):this._trackTranslateTarget},trackTranslateSmoothing:function(t){return t!==void 0?(this._trackTranslateSmoothing=t,this):this._trackTranslateSmoothing},unTrackTranslate:function(){delete this._trackTranslateTarget},trackRotate:function(t,i){return t!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking rotation of target "+t.id()),this._trackRotateSmoothing=1>i?0:i,this._trackRotateTarget=t,this._entity):this._trackRotateTarget},trackRotateSmoothing:function(t){return t!==void 0?(this._trackRotateSmoothing=t,this):this._trackRotateSmoothing},unTrackRotate:function(){delete this._trackRotateTarget},lookAt:function(t){return t!==void 0&&(t.updateTransform(),this._translate.x=t._worldMatrix.matrix[2],this._translate.y=t._worldMatrix.matrix[5],this.updateTransform()),this},tick:function(t){if(this._trackTranslateTarget){var i,e,o,n,s=this._trackTranslateTarget,r=s._worldMatrix.matrix,a=r[2],l=r[5];this._trackTranslateSmoothing?(i=this._translate.x,e=this._translate.y,o=a-i,n=l-e,this._translate.x+=o/this._trackTranslateSmoothing,this._translate.y+=n/this._trackTranslateSmoothing):this.lookAt(this._trackTranslateTarget)}if(this._trackRotateTarget){var h,m,c=this._trackRotateTarget._parent!==void 0?this._trackRotateTarget._parent._rotate.z:0,_=-(c+this._trackRotateTarget._rotate.z);this._trackRotateSmoothing?(h=this._rotate.z,m=_-h,this._rotate.z+=m/this._trackRotateSmoothing):this._rotate.z=_}this.updateTransform(),this._localMatrix.transformRenderingContext(t)},updateTransform:function(){if(this._localMatrix.identity(),this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z)),this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y)),this._mode===0&&this._localMatrix.multiply(this._localMatrix._newTranslate(-this._translate.x,-this._translate.y)),this._mode===1){var t=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this.geometry.z/2).toIso();this._parent&&this._parent.geometry.z&&(t.y+=this._parent.geometry.z/1.6),this._localMatrix.multiply(this._localMatrix._newTranslate(t.x,t.y))}this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix)},_stringify:function(){var t,i=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_trackTranslateTarget":i+=".trackTranslate(ige.$('"+this._trackTranslateTarget.id()+"'), "+this.trackTranslateSmoothing()+")";break;case"_trackRotateTarget":i+=".trackRotate(ige.$('"+this._trackRotateTarget.id()+"'), "+this.trackRotateSmoothing()+")"}return i}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_62);var $i_63=$i_53.extend([{extension:$i_42,overwrite:!0},{extension:$i_41,overwrite:!0}],{classId:"$i_63",init:function(t){this._alwaysInView=!0,this._super(),this._mousePos=new $i_5(0,0,0),this._overflow="",this._uiX=0,this._uiY=0,t===void 0&&(t={left:0,top:0,width:ige.geometry.x,height:ige.geometry.y,autoSize:!0}),this.geometry=new $i_5(t.width||250,t.height||150,0),this.camera=new $i_62(this),this.camera._entity=this},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},scene:function(t){return t!==void 0?(this._scene=t,this):this._scene},mousePos:function(){return this._mousePos},viewArea:function(){var t=this.aabb(),i=this.camera._translate;return new $i_7(t.x+i.x,t.y+i.y,t.width,t.height)},tick:function(t,i){if(this._scene&&(ige._currentCamera=this.camera,ige._currentViewport=this,this._scene._parent=this,this._super(t),t.translate(-(this.geometry.x*this._origin.x)|0,-(this.geometry.y*this._origin.y)|0),t.clearRect(0,0,this.geometry.x,this.geometry.y),(!ige.cocoonJs||ige.cocoonJs&&!ige.cocoonJs.detected)&&(t.beginPath(),t.rect(0,0,this.geometry.x,this.geometry.y),this._borderColor&&(t.strokeStyle=this._borderColor,t.stroke()),t.clip()),t.translate(this.geometry.x/2|0,this.geometry.y/2|0),this.camera.tick(t),t.save(),this._scene.tick(t,i),t.restore(),this._drawBounds&&t===ige._ctx&&this.drawAABBs(t,this._scene,0),this._drawMouse&&t===ige._ctx&&this._mousePos)){t.save(),t.scale(1/this.camera._scale.x,1/this.camera._scale.y);var e,o=Math.floor(this._mousePos.x*this.camera._scale.x),n=Math.floor(this._mousePos.y*this.camera._scale.y);t.fillStyle="#fc00ff",t.fillRect(o-5,n-5,10,10),e=t.measureText("Viewport "+this.id()+" :: "+o+", "+n),t.fillText("Viewport "+this.id()+" :: "+o+", "+n,o-e.width/2,n-15),t.restore()}},drawAABBs:function(t,i,e){var o,n,s,r,a,l,h,m,c,_,u,p,y,d,x,f,g,v,b,w=i._children;if(w){o=w.length;while(o--)n=w[o],e++,n._shouldRender!==!1&&(typeof n.aabb=="function"&&(s=n.aabb(),s&&((n._drawBounds||n._drawBounds===void 0)&&(t.strokeStyle="#00deff",t.strokeRect(s.x,s.y,s.width,s.height),n._parent&&n._parent._mountMode===1&&(t.save(),t.translate(s.x+s.width/2,s.y+s.height/2),a=n.geometry,l=new $i_5(-(a.x/2),0,0).toIso(),h=new $i_5(+(a.x/2),0,0).toIso(),m=new $i_5(0,-(a.y/2),0).toIso(),c=new $i_5(0,+(a.y/2),0).toIso(),_=new $i_5(0,0,-(a.z/2)).toIso(),u=new $i_5(0,0,+(a.z/2)).toIso(),p=new $i_5(-(a.x/2),-(a.y/2),-(a.z/2)).toIso(),y=new $i_5(+(a.x/2),-(a.y/2),-(a.z/2)).toIso(),d=new $i_5(+(a.x/2),+(a.y/2),-(a.z/2)).toIso(),x=new $i_5(-(a.x/2),+(a.y/2),-(a.z/2)).toIso(),f=new $i_5(-(a.x/2),-(a.y/2),a.z/2).toIso(),g=new $i_5(+(a.x/2),-(a.y/2),a.z/2).toIso(),v=new $i_5(+(a.x/2),+(a.y/2),a.z/2).toIso(),b=new $i_5(-(a.x/2),+(a.y/2),a.z/2).toIso(),r=t.globalAlpha,t.globalAlpha=1,t.strokeStyle="#ff0000",t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(h.x,h.y),t.stroke(),t.strokeStyle="#00ff00",t.beginPath(),t.moveTo(m.x,m.y),t.lineTo(c.x,c.y),t.stroke(),t.strokeStyle="#fffc00",t.beginPath(),t.moveTo(_.x,_.y),t.lineTo(u.x,u.y),t.stroke(),t.strokeStyle="#a200ff",t.globalAlpha=.6,t.fillStyle="#545454",t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(x.x,x.y),t.lineTo(b.x,b.y),t.lineTo(v.x,v.y),t.lineTo(d.x,d.y),t.fill(),t.stroke(),t.fillStyle="#282828",t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(y.x,y.y),t.lineTo(g.x,g.y),t.lineTo(v.x,v.y),t.lineTo(d.x,d.y),t.fill(),t.stroke(),t.fillStyle="#676767",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(g.x,g.y),t.lineTo(v.x,v.y),t.lineTo(b.x,b.y),t.lineTo(f.x,f.y),t.fill(),t.stroke(),t.globalAlpha=r,t.restore())),this._drawBoundsData&&(n._drawBounds||n._drawBoundsData===void 0)&&(t.globalAlpha=1,t.fillStyle="#f6ff00",t.fillText("ID: "+n.id()+" "+"("+n.classId()+") "+n.layer()+":"+n.depth().toFixed(0),s.x+s.width+3,s.y+10),t.fillText("X: "+n._translate.x.toFixed(2)+", "+"Y: "+n._translate.y.toFixed(2)+", "+"Z: "+n._translate.z.toFixed(2),s.x+s.width+3,s.y+20)))),this.drawAABBs(t,n,e))}},_resizeEvent:function(t){this._autoSize&&this._parent&&(this.geometry=this._parent.geometry.clone()),this._updateUiPosition(),this._scene&&this._scene._resizeEvent(t)},_stringify:function(){var t,i=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_autoSize":i+=".autoSize("+this._autoSize+")";break;case"_scene":i+=".scene(ige.$('"+this.scene().id()+"'))"}return i}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_63);var $i_64=$i_53.extend({classId:"$i_64",init:function(){this._alwaysInView=!0,this._super(),this._shouldRender=!0,this._autoSize=!0,this.geometry.x=ige.geometry.x,this.geometry.y=ige.geometry.y},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},shouldRender:function(t){return t!==void 0?(this._shouldRender=t,this):this._shouldRender},ignoreCamera:function(t){return t!==void 0?(this._ignoreCamera=t,this):this._ignoreCamera},tick:function(t){if(this._shouldRender){if(this._ignoreCamera){var i=ige._currentCamera;this.translateTo(i._translate.x,i._translate.y,i._translate.z)}this._super(t)}},_resizeEvent:function(t){this._autoSize&&(this.geometry=ige.geometry.clone());var i=this._children,e=i.length;while(e--)i[e]._resizeEvent(t)},_stringify:function(){var t,i=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_shouldRender":i+=".shouldRender("+this.shouldRender()+")";break;case"_autoSize":i+=".autoSize("+this.autoSize()+")"}return i}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_64);var $i_66=$i_3.extend({classId:"$i_66",componentId:"box2d",init:function(t,i){ige._state!==0&&this.log("Cannot add box2d component to the ige instance once the engine has started!","error"),this._entity=t,this._options=i,this.b2Color=$i_19.Common.b2Color,this.b2Vec2=$i_19.Common.Math.b2Vec2,this.b2Math=$i_19.Common.Math.b2Math,this.b2Shape=$i_19.Collision.Shapes.b2Shape,this.b2BodyDef=$i_19.Dynamics.b2BodyDef,this.b2Body=$i_19.Dynamics.b2Body,this.b2FixtureDef=$i_19.Dynamics.b2FixtureDef,this.b2Fixture=$i_19.Dynamics.b2Fixture,this.b2World=$i_19.Dynamics.b2World,this.b2MassData=$i_19.Collision.Shapes.b2MassData,this.b2PolygonShape=$i_19.Collision.Shapes.b2PolygonShape,this.b2CircleShape=$i_19.Collision.Shapes.b2CircleShape,this.b2DebugDraw=$i_19.Dynamics.b2DebugDraw,this.b2ContactListener=$i_19.Dynamics.b2ContactListener,this.b2Distance=$i_19.Collision.b2Distance,this.b2Contact=$i_19.Dynamics.Contacts.b2Contact,this.b2Contact.prototype.igeEntityA=function(){var t=this.m_fixtureA.m_body._entity;return t._box2dOurContactFixture=this.m_fixtureA,t._box2dTheirContactFixture=this.m_fixtureB,t},this.b2Contact.prototype.igeEntityB=function(){var t=this.m_fixtureB.m_body._entity;return t._box2dOurContactFixture=this.m_fixtureB,t._box2dTheirContactFixture=this.m_fixtureA,t},this.b2Contact.prototype.igeEitherId=function(t,i){return i?!(this.m_fixtureA.m_body._entity._id!==t&&this.m_fixtureB.m_body._entity._id!==t||this.m_fixtureA.m_body._entity._id!==i&&this.m_fixtureB.m_body._entity._id!==i):this.m_fixtureA.m_body._entity._id===t||this.m_fixtureB.m_body._entity._id===t},this.b2Contact.prototype.igeEitherGroup=function(t,i){return i?!(this.m_fixtureA.m_body._entity._group!==t&&this.m_fixtureB.m_body._entity._group!==t||this.m_fixtureA.m_body._entity._group!==i&&this.m_fixtureB.m_body._entity._group!==i):this.m_fixtureA.m_body._entity._group===t||this.m_fixtureB.m_body._entity._group===t},this.b2Contact.prototype.igeBothGroups=function(t){return this.m_fixtureA.m_body._entity._group===t&&this.m_fixtureB.m_body._entity._group===t},this.b2Contact.prototype.igeEntityByGroup=function(t){return this.m_fixtureA.m_body._entity._group===t?this.igeEntityA():this.m_fixtureB.m_body._entity._group===t?this.igeEntityB():void 0},this.b2Contact.prototype.igeEntityById=function(t){return this.m_fixtureA.m_body._entity._id===t?this.igeEntityA():this.m_fixtureB.m_body._entity._id===t?this.igeEntityB():void 0},this.b2Contact.prototype.igeEntityByFixtureId=function(t){return this.m_fixtureA.igeId===t?this.igeEntityA():this.m_fixtureB.igeId===t?this.igeEntityB():void 0},this.b2Contact.prototype.igeOtherEntity=function(t){return this.m_fixtureA.m_body._entity===t?this.igeEntityB():this.igeEntityA()},this._active=!0,this._sleep=!0,this._scaleRatio=30,this._gravity=new this.b2Vec2(0,0),this._removeWhenReady=[],ige.addBehaviour("box2dStep",this._behaviour),this.log("Physics component initiated!")},useWorker:function(t){return typeof Worker!="undefined"?t!==void 0?(this._useWorker=t,this._entity):this._useWorker:(this.log("Web workers were not detected on this browser. Cannot access useWorker() method.","warning"),void 0)},sleep:function(t){return t!==void 0?(this._sleep=t,this._entity):this._sleep},scaleRatio:function(t){return t!==void 0?(this._scaleRatio=t,this._entity):this._scaleRatio},gravity:function(t,i){return t!==void 0&&i!==void 0?(this._gravity=new this.b2Vec2(t,i),this._entity):this._gravity},world:function(){return this._world},createWorld:function(){return this._world=new this.b2World(this._gravity,this._sleep),this.log("World created"),this._entity},createFixture:function(t){var i,e=new this.b2FixtureDef;for(i in t)t.hasOwnProperty(i)&&i!=="shape"&&(e[i]=t[i]);return e},createBody:function(t,i){var e,o,n,s,r,a,l,h,m,c,_,u=new this.b2BodyDef;switch(i.type){case"static":u.type=this.b2Body.b2_staticBody;break;case"dynamic":u.type=this.b2Body.b2_dynamicBody}for(e in i)if(i.hasOwnProperty(e))switch(e){case"type":case"gravitic":case"fixedRotation":case"fixtures":break;default:u[e]=i[e]}u.position=new this.b2Vec2(t._translate.x/this._scaleRatio,t._translate.y/this._scaleRatio),o=this._world.CreateBody(u);for(e in i)if(i.hasOwnProperty(e))switch(e){case"gravitic":i.gravitic||(o.m_nonGravitic=!0);break;case"fixedRotation":i.fixedRotation&&o.SetFixedRotation(!0);break;case"fixtures":for(l=0;i.fixtures.length>l;l++)if(n=i.fixtures[l],s=this.createFixture(n),s.igeId=n.igeId,n.shape){switch(n.shape.type){case"circle":a=new this.b2CircleShape,n.shape.data?a.SetRadius(n.shape.data.radius/this._scaleRatio):a.SetRadius(t.geometry.x/this._scaleRatio/2);break;case"polygon":a=new this.b2PolygonShape,a.SetAsArray(n.shape.data._poly,n.shape.data.length());break;case"rectangle":a=new this.b2PolygonShape,n.shape.data?(h=n.shape.data.x!==void 0?n.shape.data.x:0,m=n.shape.data.y!==void 0?n.shape.data.y:0,c=n.shape.data.width!==void 0?n.shape.data.width:t.geometry.x/2,_=n.shape.data.height!==void 0?n.shape.data.height:t.geometry.y/2):(h=0,m=0,c=t.geometry.x/2,_=t.geometry.y/2),a.SetAsOrientedBox(c/this._scaleRatio,_/this._scaleRatio,new this.b2Vec2(h/this._scaleRatio,m/this._scaleRatio),0)}a&&(s.shape=a,r=o.CreateFixture(s),r.igeId=s.igeId)}}return o._entity=t,o},staticsFromMap:function(t,i){if(t.map){var e,o,n,s,r,a=t.tileWidth(),l=t.tileHeight();n=t.scanRects(i),s=n.length;while(s--)r=n[s],e=a*(r.width/2)-a/2,o=l*(r.height/2)-l/2,(new $i_53Box2d).translateTo(r.x*a+e,r.y*l+o,0).width(r.width*a).height(r.height*l).drawBounds(!0).drawBoundsData(!1).box2dBody({type:"static",allowSleep:!0,fixtures:[{shape:{type:"rectangle"}}]})}else this.log("Cannot extract box2d static bodies from map data because passed map does not have a .map property!","error")},contactListener:function(t,i,e,o){var n=new this.b2ContactListener;t!==void 0&&(n.BeginContact=t),i!==void 0&&(n.EndContact=i),e!==void 0&&(n.PreSolve=e),o!==void 0&&(n.PostSolve=o),this._world.SetContactListener(n)},enableDebug:function(t){if(t){var i=new this.b2DebugDraw;this._box2dDebug=!0,i.SetSprite(ige._ctx),i.SetDrawScale(this._scaleRatio),i.SetFillAlpha(.3),i.SetLineThickness(1),i.SetFlags(this.b2DebugDraw.e_controllerBit|this.b2DebugDraw.e_jointBit|this.b2DebugDraw.e_pairBit|this.b2DebugDraw.e_shapeBit),this._world.SetDebugDraw(i),(new igeClassStore.Box2dDebugPainter).depth(4e4).drawBounds(!1).mount(t)}else this.log("Cannot enable box2d debug drawing because the passed argument is not an object on the scenegraph.","error")},destroyBody:function(t){this._removeWhenReady.push(t)},updateCallback:function(t){return t!==void 0?(this._updateCallback=t,this._entity):this._updateCallback},start:function(){this._active||(this._active=!0)},stop:function(){this._active&&(this._active=!1)},_behaviour:function(){var t,i,e,o,n,s,r=ige.box2d;if(r._active&&r._world){if(!r._world.IsLocked()&&(o=r._removeWhenReady,n=o.length)){s=r._world.DestroyBody;while(n--)s.apply(r._world,[o[n]]);r._removeWhenReady=[],o=null}r._world.Step(ige.tickDelta/1e3,8,8),t=r._world.GetBodyList();while(t)t._entity&&(i=t._entity,e=i._box2dBody,t.IsAwake()&&t.m_type!==0?(e.updating=!0,i.translateTo(t.m_xf.position.x*r._scaleRatio,t.m_xf.position.y*r._scaleRatio,i._translate.z),i.rotateTo(i._rotate.x,i._rotate.y,t.GetAngle()),e.updating=!1,e.asleep&&(e.asleep=!1,r.emit("afterAwake",i))):e.asleep||(e.asleep=!0,r.emit("afterAsleep",i))),t=t.GetNext();r._world.ClearForces(),t=null,i=null,typeof r._updateCallback=="function"&&r._updateCallback()}},destroy:function(){ige.removeBehaviour("box2dStep")}}),Box2dDebugPainter=$i_52.extend({classId:"Box2dDebugPainter",tick:function(t){this._parent&&this._parent.isometricMounts()===!0&&(t.scale(1.414,.707),t.rotate(45*Math.PI/180)),ige.box2d._world.DrawDebugData(),this._super(t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_66);var $i_53Box2d=$i_53.extend({classId:"$i_53Box2d",init:function(){this._super(),this._translateToProto=this.translateTo,this._translateByProto=this.translateBy,this._rotateToProto=this.rotateTo,this._rotateByProto=this.rotateBy,this.translateTo=this._translateTo,this.translateBy=this._translateBy,this.rotateTo=this._rotateTo,this.rotateBy=this._rotateBy},box2dBody:function(t){return t!==void 0?(this._box2dBodyDef=t,ige.box2d?this._box2dBody=ige.box2d.createBody(this,t):this.log("You are trying to create a box2d entity but you have not added the box2d component to the ige instance!","error"),this):this._box2dBodyDef},_translateTo:function(t,i,e){var o=this._box2dBody;return this._translateToProto(t,i,e),o&&!o.updating&&(o.SetPosition({x:t/ige.box2d._scaleRatio,y:i/ige.box2d._scaleRatio}),o.SetAwake(!0)),this},_translateBy:function(t,i,e){this._translateTo(this._translate.x+t,this._translate.y+i,this._translate.z+e)},_rotateTo:function(t,i,e){var o=this._box2dBody;return this._rotateToProto(t,i,e),o&&!o.updating&&(o.SetAngle(e),o.SetAwake(!0)),this},_rotateBy:function(t,i,e){this._rotateTo(this._rotate.x+t,this._rotate.y+i,this._rotate.z+e)},destroy:function(){this._box2dBody&&ige.box2d.destroyBody(this._box2dBody),this._super()}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_53Box2d);var $i_88=$i_53.extend({classId:"$i_88",init:function(){this._alwaysInView=!0,this._super(),this._id="ige",this.basePath="",this.isServer=typeof module!="undefined"&&module.exports!==void 0,ige=this,console.log("------------------------------------------------------------------------------"),console.log("* Powered by the Isogenic Game Engine "+igeVersion+"                                  *"),console.log("* (C)opyright 2012 Irrelon Software Limited                                  *"),console.log("* http://www.isogenicengine.com                                              *"),console.log("------------------------------------------------------------------------------"),this._super(),this.isServer||this.addComponent($i_39),this.ClassStore={},this.TextureStore=[],this._idCounter=(new Date).getTime(),this.addComponent($i_14),this.addComponent($i_12),this._renderModes=["2d","three"],this._renderContext="2d",this._renderMode=this._renderModes[this._renderContext],this._tickTime="NA",this.tickDelta=0,this._fpsRate=60,this._state=0,this._textureImageStore={},this._texturesLoading=0,this._texturesTotal=0,this._dependencyQueue=[],this._drawCount=0,this._dps=0,this._frames=0,this._fps=0,this._clientNetDiff=0,this._frameAlternator=!1,this._viewportDepth=!1,this._mousePos=new $i_5(0,0,0),this._currentViewport=null,this._currentCamera=null,this._register={ige:this},this._postTick=[],this._tsit={},this._tslt={},this._ctx=$i_44,this._headless=!0,this.dependencyTimeout(3e4),this._dependencyQueue.push(this.texturesLoaded),setInterval(this._secondTick,1e3)},$:function(t){return typeof t=="string"?this._register[t]:typeof t=="object"?t:this},$$:function(){},register:function(t){return t!==void 0?this._register[t.id()]?(t._registered=!1,this.log('Cannot add object id "'+t.id()+'" to scenegraph because there is already another object in the graph with the same ID!',"error"),!1):(this._register[t.id()]=t,t._registered=!0,this):this._register},unRegister:function(t){return t!==void 0&&this._register[t.id()]&&(delete this._register[t.id()],t._registered=!1),this},setFps:function(t){t!==void 0&&(this.isServer?requestAnimFrame=function(i){setTimeout(function(){i((new Date).getTime())},1e3/t)}:window.requestAnimFrame=function(i){setTimeout(function(){i((new Date).getTime())},1e3/t)})},showStats:function(t){if(t!==void 0){switch(t){case 0:this._removeStatsDiv();break;case 1:this._createStatsDiv()}return this._showStats=t,this}return this._showStats},_createStatsDiv:function(){if(!ige.isServer&&!document.getElementById("igeStats")){var t=document.createElement("div");t.style.fontFamily="Verdana, Tahoma",t.style.fontSize="12px",t.style.position="absolute",t.style.color="#ffffff",t.style.textShadow="1px 1px 3px #000000",t.style.bottom="10px",t.style.left="10px",t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.MozkitUserSelect="none",t.style.zIndex=1e5,t.innerHTML="Please wait...",window.addEventListener("load",function(){document.body.appendChild(t)}),window.addEventListener("unload",function(){}),this._statsDiv=t}},_removeStatsDiv:function(){document.body.removeChild(this._statsDiv),delete this._statsDiv},defineClass:function(t,i){ige.ClassStore[t]=i},getClass:function(t){return ige.ClassStore[t]},newClassInstance:function(t,i){return new ige.ClassStore[t](i)},dependencyCheck:function(){var t=this._dependencyQueue,i=t.length;while(i--)if(!this._dependencyQueue[i]())return!1;return!0},viewportDepth:function(t){return t!==void 0?(this._viewportDepth=t,this):this._viewportDepth},dependencyTimeout:function(t){this._dependencyCheckTimeout=t},textureLoadStart:function(t,i){this._texturesLoading++,this._texturesTotal++,this.emit("textureLoadStart",i)},textureLoadEnd:function(t,i){i._destroyed||this.TextureStore.push(i),this._texturesLoading--,this.emit("textureLoadEnd",i),this._texturesLoading===0&&this._allTexturesLoaded()},textureFromUrl:function(t){var i,e=this.TextureStore,o=e.length;while(o--)if(i=e[o],i._url===t)return i},texturesLoaded:function(){return ige._texturesLoading===0},_allTexturesLoaded:function(){this._loggedATL||(this._loggedATL=!0,this.log("All textures have loaded")),this.emit("texturesLoaded")},canvasReady:function(){return ige._canvas!==void 0||ige.isServer},newId:function(){return this._idCounter++,this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))+""},newIdHex:function(){return this._idCounter++,(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16)},start:function(t){if(!ige._state)if(ige.dependencyCheck())ige.log("Starting engine..."),ige._state=1,requestAnimFrame(ige.tick),ige.log("Engine started"),typeof t=="function"&&t(!0);else{var i=(new Date).getTime();ige._dependencyCheckStart||(ige._dependencyCheckStart=i),i-ige._dependencyCheckStart>this._dependencyCheckTimeout?(this.log("Engine start failed because the dependency check timed out after "+this._dependencyCheckTimeout/1e3+" seconds","error"),typeof t=="function"&&t(!1)):setTimeout(function(){ige.start(t)},200)}},stop:function(){return this._state?(this.log("Stopping engine..."),this._state=0,!0):!1},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},pixelRatioScaling:function(t){return t!==void 0?(this._pixelRatioScaling=t,this):this._pixelRatioScaling},renderContext:function(t){return t!==void 0?(this._renderContext=t,this._renderMode=this._renderModes[t],this.log("Rendering mode set to: "+t),this):this._renderContext},createFrontBuffer:function(t,i){this.isServer||this._canvas||(this._createdFrontBuffer=!0,this._pixelRatioScaling=!i,this._frontBufferSetup(t,i))},_frontBufferSetup:function(t){var i,e=document.createElement("canvas");this._pixelRatioScaling?(i=e.getContext(ige._renderContext),this._devicePixelRatio=window.devicePixelRatio||1,this._backingStoreRatio=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,this._deviceFinalDrawRatio=this._devicePixelRatio/this._backingStoreRatio):(this._devicePixelRatio=1,this._backingStoreRatio=1,this._deviceFinalDrawRatio=1),e.id="igeFrontBuffer",this.canvas(e,t),document.body.appendChild(e)},canvas:function(t,i){this._canvas||(this._canvas=t,i&&(this._autoSize=i,window.addEventListener("resize",this._resizeEvent)),this._resizeEvent(),this._ctx=this._canvas.getContext(this._renderContext),this._headless=!1,this.input.setupListeners(this._canvas))},clearCanvas:function(){this._ctx&&this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},removeCanvas:function(){this.input&&this.input.destroyListeners(),this._autoSize&&window.removeEventListener("resize",this._resizeEvent),this._createdFrontBuffer&&document.body.removeChild(this._canvas),delete this._canvas,delete this._ctx,this._ctx=$i_44,this._headless=!0},openUrl:function(t){t!==void 0&&(ige.cocoonJs&&ige.cocoonJs.detected?ige.cocoonJs.openUrl(t):window.open(t))
},showWebView:function(t){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.showWebView(t);else{var i=document.getElementById("igeOverlay");i||(i=document.createElement("iframe"),i.id="igeOverlay",i.style.position="absolute",i.style.border="none",i.style.left="0px",i.style.top="0px",i.style.width="100%",i.style.height="100%",document.body.appendChild(i)),t!==void 0&&(i.src=t),i.style.display="block"}return this},hideWebView:function(){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.hideWebView();else{var t=document.getElementById("igeOverlay");t&&(t.style.display="none")}return this},layerCall:function(js){js!==void 0&&eval(js)},mousePos:function(){return this._mousePos},_resizeEvent:function(t){if(ige._autoSize){var i=window.innerWidth,e=window.innerHeight,o=ige._children,n=o.length;ige._canvas&&(i%2&&i--,e%2&&e--,ige._canvas.width=i*ige._deviceFinalDrawRatio,ige._canvas.height=e*ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio!==1&&(ige._canvas.style.width=i+"px",ige._canvas.style.height=e+"px",ige._ctx.scale(ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio))),ige.geometry=new $i_5(i,e,0);while(n--)o[n]._resizeEvent(t)}ige._resized=!0},_secondTick:function(){var t=ige;if(t._fps=t._frames,t._dps=t._dpt*t._fps,t._frames=0,t._drawCount=0,t._showStats)switch(t._showStats){case 1:t._statsDiv.innerHTML='<span class="met" title="Frames Per Second">fps: '+t._fps+'</span> <span class="met" title="Draws Per Second">dps: '+t._dps+'</span> <span class="met" title="Draws Per Tick">dpt: '+t._dpt+'</span> <span class="met" title="Time Spent Processing Tick">tps: '+t._tickTime+"ms</span>",t.network&&(t._statsDiv.innerHTML+=' <span class="met" title="Network Latency (Time From Server to This Client)">lat: '+t.network._latency+"ms</span>")}},tick:function(t,i){var e,o,n,s=ige,r=s._postTick,a=r.length;if(igeDebug.timing&&(e=(new Date).getTime()),s._state){for(i===void 0&&(i=s._ctx),requestAnimFrame(s.tick),s._frameAlternator=!s._frameAlternator,s.tickStart=t,s.tickStart-=s._clientNetDiff,s.lastTick?s.tickDelta=s.tickStart-s.lastTick:(s.lastTick=0,s.tickDelta=0),s._processBehaviours(i),s.render(i),n=0;a>n;n++)r[n]();s.lastTick=s.tickStart,s._frames++,s._dpt=s._drawCount,s._drawCount=0,s.input.tick()}s._resized=!1,igeDebug.timing&&(o=(new Date).getTime(),ige._tickTime=o-e)},fps:function(){return this._fps},dpt:function(){return this._dpt},dps:function(){return this._dps},render:function(t){var i,e;this._viewportDepth&&(igeDebug.timing?(i=(new Date).getTime(),this.depthSortChildren(),e=(new Date).getTime()-i,ige._tslt[this.id()]||(ige._tslt[this.id()]={}),ige._tslt[this.id()].depthSortChildren=e):this.depthSortChildren()),t.save(),t.translate(this.geometry.x2,this.geometry.y2);var o,n=this._children;if(n)if(o=n.length,igeDebug.timing)while(o--)t.save(),i=(new Date).getTime(),n[o].tick(t),e=(new Date).getTime()-i,n[o]&&(ige._tsit[n[o].id()]||(ige._tsit[n[o].id()]=0),ige._tslt[n[o].id()]||(ige._tslt[n[o].id()]={}),ige._tsit[n[o].id()]+=e,ige._tslt[n[o].id()].tick=e),t.restore();else while(o--)t.save(),n[o].tick(t),t.restore();t.restore()},analyseTiming:function(){igeDebug.timing||this.log("Cannot analyse timing because the igeDebug.timing flag is not enabled so no timing data has been recorded!","warning")},sceneGraph:function(t,i){var e,o,n,s,r="";for(i===void 0&&(i=0),t||(t=ige),e=0;i>e;e++)r+="----";if(igeDebug.timing?(o="",o+="T: "+ige._tsit[t.id()],ige._tslt[t.id()]&&(typeof ige._tslt[t.id()].tick=="number"&&(o+=" | LastTick: "+ige._tslt[t.id()].tick),typeof ige._tslt[t.id()].depthSortChildren=="number"&&(o+=" | ChildDepthSort: "+ige._tslt[t.id()].depthSortChildren)),console.log(r+t.id()+" ("+t._classId+") : "+t._inView+" Timing("+o+")")):console.log(r+t.id()+" ("+t._classId+") : "+t._inView),i++,t===ige){if(n=t._children){s=n.length;while(s--)n[s]._scene._shouldRender&&(igeDebug.timing?(o="",o+="T: "+ige._tsit[n[s].id()],ige._tslt[n[s].id()]&&(typeof ige._tslt[n[s].id()].tick=="number"&&(o+=" | LastTick: "+ige._tslt[n[s].id()].tick),typeof ige._tslt[n[s].id()].depthSortChildren=="number"&&(o+=" | ChildDepthSort: "+ige._tslt[n[s].id()].depthSortChildren)),console.log(r+"----"+n[s].id()+" ("+n[s]._classId+") : "+n[s]._inView+" Timing("+o+")")):console.log(r+"----"+n[s].id()+" ("+n[s]._classId+") : "+n[s]._inView),this.sceneGraph(n[s]._scene,i+1))}}else if(n=t._children){s=n.length;while(s--)this.sceneGraph(n[s],i)}},getSceneGraphData:function(t){var i,e,o,n,s,r=[];if(t||(t=ige),i={text:t.id()+" ("+t._classId+")",parent:t._parent,id:t.id()},t===ige){if(n=t._children){s=n.length;while(s--)e={text:n[s].id()+" ("+n[s]._classId+")",parent:n[s]._parent,id:n[s].id()},n[s]._scene&&(o=this.getSceneGraphData(n[s]._scene),e.items=[o]),r.push(e)}}else if(n=t._children){s=n.length;while(s--)e=this.getSceneGraphData(n[s]),r.push(e)}return r.length>0&&(i.items=r),i},destroy:function(){this.stop(),this.isServer||this.removeCanvas(),this._super(),this.log("Engine destroy complete.")}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_88);var ClientNetworkEvents={example:function(){}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=ClientNetworkEvents);var Character=$i_53Box2d.extend({classId:"Character",init:function(){var t=this;this._super(),t.addComponent($i_10).addComponent($i_11).depth(1),ige.isServer||(this._characterTexture=new $i_49("../../assets/textures/sprites/vx_chara02_c.png",12,8),this._characterTexture.on("loaded",function(){t.texture(t._characterTexture).dimensionsFromCell()},!1,!0))},setType:function(t){switch(t){case 0:this.animation.define("walkDown",[1,2,3,2],8,-1).animation.define("walkLeft",[13,14,15,14],8,-1).animation.define("walkRight",[25,26,27,26],8,-1).animation.define("walkUp",[37,38,39,38],8,-1).cell(1),this._restCell=1;break;case 1:this.animation.define("walkDown",[4,5,6,5],8,-1).animation.define("walkLeft",[16,17,18,17],8,-1).animation.define("walkRight",[28,29,30,29],8,-1).animation.define("walkUp",[40,41,42,41],8,-1).cell(4),this._restCell=4;break;case 2:this.animation.define("walkDown",[7,8,9,8],8,-1).animation.define("walkLeft",[19,20,21,20],8,-1).animation.define("walkRight",[31,32,33,32],8,-1).animation.define("walkUp",[43,44,45,44],8,-1).cell(7),this._restCell=7;break;case 3:this.animation.define("walkDown",[10,11,12,11],8,-1).animation.define("walkLeft",[22,23,24,23],8,-1).animation.define("walkRight",[34,35,36,35],8,-1).animation.define("walkUp",[46,47,48,47],8,-1).cell(10),this._restCell=10;break;case 4:this.animation.define("walkDown",[49,50,51,50],8,-1).animation.define("walkLeft",[61,62,63,62],8,-1).animation.define("walkRight",[73,74,75,74],8,-1).animation.define("walkUp",[85,86,87,86],8,-1).cell(49),this._restCell=49;break;case 5:this.animation.define("walkDown",[52,53,54,53],8,-1).animation.define("walkLeft",[64,65,66,65],8,-1).animation.define("walkRight",[76,77,78,77],8,-1).animation.define("walkUp",[88,89,90,89],8,-1).cell(52),this._restCell=52;break;case 6:this.animation.define("walkDown",[55,56,57,56],8,-1).animation.define("walkLeft",[67,68,69,68],8,-1).animation.define("walkRight",[79,80,81,80],8,-1).animation.define("walkUp",[91,92,93,92],8,-1).cell(55),this._restCell=55;break;case 7:this.animation.define("walkDown",[58,59,60,59],8,-1).animation.define("walkLeft",[70,71,72,71],8,-1).animation.define("walkRight",[82,83,84,83],8,-1).animation.define("walkUp",[94,95,96,95],8,-1).cell(58),this._restCell=58}return this._characterType=t,this},walkTo:function(t,i){var e=this,o=t-this.translate().x(),n=i-this.translate().y(),s=Math.distance(this.translate().x(),this.translate().y(),t,i),r=.1,a=s/r;return Math.abs(o)>Math.abs(n)?0>o?this.animation.select("walkLeft"):this.animation.select("walkRight"):0>n?this.animation.select("walkUp"):this.animation.select("walkDown"),this._translate.tween().stopAll().properties({x:t,y:i}).duration(a).afterTween(function(){e.animation.stop()}).start(),this},tick:function(t){this.depth(this._translate.y),this._super(t)},destroy:function(){this._characterTexture&&this._characterTexture.destroy(),this._super()}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Character);var PlayerComponent=$i_2.extend({classId:"PlayerComponent",componentId:"player",init:function(t,i){var e=this;this._entity=t,this._options=i,ige.input.mapAction("walkLeft",ige.input.key.left),ige.input.mapAction("walkRight",ige.input.key.right),ige.input.mapAction("walkUp",ige.input.key.up),ige.input.mapAction("walkDown",ige.input.key.down),ige.input.on("keyUp",function(t,i){e._keyUp(t,i)}),this._entity.addBehaviour("playerComponent_behaviour",this._behaviour)},_keyUp:function(t,i){i===ige.input.key.space&&(this._entity._characterType++,this._entity._characterType>7&&(this._entity._characterType=0),this._entity.setType(this._entity._characterType))},_behaviour:function(){var t=6,i="";switch(ige.input.actionState("walkUp")&&(i+="N"),ige.input.actionState("walkDown")&&(i+="S"),ige.input.actionState("walkLeft")&&(i+="W"),ige.input.actionState("walkRight")&&(i+="E"),i){case"N":this._box2dBody.SetLinearVelocity(new $i_5(0,-t,0)),this._box2dBody.SetAwake(!0),this.animation.select("walkUp");break;case"S":this._box2dBody.SetLinearVelocity(new $i_5(0,t,0)),this._box2dBody.SetAwake(!0),this.animation.select("walkDown");break;case"E":this._box2dBody.SetLinearVelocity(new $i_5(t,0,0)),this._box2dBody.SetAwake(!0),this.animation.select("walkRight");break;case"W":this._box2dBody.SetLinearVelocity(new $i_5(-t,0,0)),this._box2dBody.SetAwake(!0),this.animation.select("walkLeft");break;case"NE":this._box2dBody.SetLinearVelocity(new $i_5(t,-t,0)),this._box2dBody.SetAwake(!0),this.animation.select("walkRight");break;case"NW":this._box2dBody.SetLinearVelocity(new $i_5(-t,-t,0)),this._box2dBody.SetAwake(!0),this.animation.select("walkLeft");break;case"SE":this._box2dBody.SetLinearVelocity(new $i_5(t,t,0)),this._box2dBody.SetAwake(!0),this.animation.select("walkRight");break;case"SW":this._box2dBody.SetLinearVelocity(new $i_5(-t,t,0)),this._box2dBody.SetAwake(!0),this.animation.select("walkLeft");break;default:this._box2dBody.SetLinearVelocity(new $i_5(0,0,0)),this.animation.stop()}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=PlayerComponent);var BackgroundLayer1={data:[[[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3]],[[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3]],[[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3]],[[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3],[0,3]],[[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]],[[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]],[[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]],[[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]],[[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]],[[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]],[[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]],[[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]],[[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]]],textures:["new $i_49('../../assets/textures/tiles/vx-xp-181-switch04.png', 3, 4).id('3b9d569741e64a0');"]};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=map1);var StaticObjectLayer1={data:[[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,[0,77],[0,78],null,null,[0,73],null,[0,15],null,null,[0,222],[0,254],[0,222],null,null,[0,16],null,null,null,[0,79],[0,80],null],[null,null,null,null,null,[0,89],null,[0,31],null,[0,253],null,[0,207],null,[0,253],null,[0,32],null,null,null,null,null,null],[[0,99],[0,237],[0,238],[0,99],null,null,null,null,null,null,[0,9],[0,10],[0,11],null,null,null,null,null,null,[0,135],[0,136],null],[[0,115],[0,162],[0,163],[0,115],[0,184],null,null,null,null,null,[0,25],[0,26],[0,27],null,null,null,null,null,[0,154],[0,151],[0,152],[0,138]],[null,[0,178],[0,179],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,[0,255],null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,[0,233],[0,234],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,[0,223],[0,224],null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[0,203],[0,204],null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[0,218],[0,219],[0,219],[0,201],[0,201]]],textures:["new $i_49('../../assets/textures/tiles/tilef.png', 16, 16).id('2ad05afa37c1000');"]};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=map1);var Client=$i_2.extend({classId:"Client",init:function(){ige.showStats(1);var t=this;this.obj=[],ige.createFrontBuffer(!0),ige.addComponent($i_66).box2d.sleep(!0).box2d.gravity(0,10).box2d.createWorld(),ige.start(function(i){i&&(t.scene1=(new $i_64).id("scene1"),t.vp1=(new $i_63).id("vp1").autoSize(!0).scene(t.scene1).drawBounds(!0).mount(ige),t.ball1=(new $i_53Box2d).box2dBody({type:"dynamic",linearDamping:0,angularDamping:.1,allowSleep:!0,bullet:!1,gravitic:!0,fixedRotation:!1,fixtures:[{density:1,friction:.5,restitution:.2,shape:{type:"circle"}}]}).id("ball1").translateTo(4,-300,0).drawBounds(!0).mount(t.scene1),t.ball2=(new $i_53Box2d).box2dBody({type:"dynamic",linearDamping:0,angularDamping:.1,allowSleep:!0,bullet:!1,gravitic:!0,fixedRotation:!1,fixtures:[{density:1,friction:.5,restitution:.2,shape:{type:"circle"}}]}).id("ball2").translateTo(0,-400,0).drawBounds(!0).mount(t.scene1),t.square1=(new $i_53Box2d).box2dBody({type:"dynamic",linearDamping:0,angularDamping:.1,allowSleep:!0,bullet:!1,gravitic:!0,fixedRotation:!1,fixtures:[{density:1,friction:.5,restitution:.2,shape:{type:"rectangle"}}]}).id("square1").translateTo(-40,-470,0).drawBounds(!0).mount(t.scene1),t.square2=(new $i_53Box2d).box2dBody({type:"dynamic",linearDamping:0,angularDamping:.1,allowSleep:!0,bullet:!1,gravitic:!0,fixedRotation:!1,fixtures:[{density:1,friction:.5,restitution:.2,shape:{type:"rectangle"}}]}).id("square2").translateTo(90,-560,0).drawBounds(!0).mount(t.scene1),(new $i_53Box2d).id("floor").translateTo(0,50,0).width(880).height(20).drawBounds(!0).box2dBody({type:"static",allowSleep:!0,fixtures:[{shape:{type:"rectangle"}}]}),ige.box2d.contactListener(function(t){console.log("Contact begins between",t.igeEntityA()._id,"and",t.igeEntityB()._id)},function(t){console.log("Contact ends between",t.igeEntityA()._id,"and",t.igeEntityB()._id)},function(t){t.igeEitherId("ball1")&&t.igeEitherId("square2")&&t.SetEnabled(!1)}),t.vp1.camera.lookAt(t.player1),t.vp1.camera.trackTranslate(t.player1,20),ige.box2d.enableDebug(t.scene1))})}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Client);var Game=$i_2.extend({classId:"Game",init:function(t,i){ige=new $i_88,ige.isServer||(ige.client=new t),ige.isServer&&(ige.server=new t(i))}});if(typeof module!="undefined"&&module.exports!==void 0)module.exports=Game;else var game=new Game(Client)