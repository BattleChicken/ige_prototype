function printStackTrace(t){t=t||{guess:!0};for(var e=t.e||null,i=!!t.guess,n=new printStackTrace.implementation,o=n.run(e),s=i?n.guessAnonymousFunctions(o):o,r=0;4>r;r++)s.shift();return s}printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(t){t=t||this.createException();var e=this.mode(t);return e==="other"?this.other(arguments.callee):this[e](t)},createException:function(){try{return this.undef(),null}catch(t){return t}},mode:function(t){return this._mode=t.arguments&&t.stack?"chrome":t.message&&typeof window!="undefined"&&window.opera?t.stacktrace?"opera10":"opera":t.stack?"firefox":"other"},instrumentFunction:function(t,e,i){t=t||window;var n=t[e];t[e]=function(){return i.call(this,printStackTrace().slice(4)),t[e]._instrumented.apply(this,arguments)},t[e]._instrumented=n},deinstrumentFunction:function(t,e){t[e].constructor===Function&&t[e]._instrumented&&t[e]._instrumented.constructor===Function&&(t[e]=t[e]._instrumented)},chrome:function(t){var e=(t.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return e.pop(),e},firefox:function(t){return t.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera10:function(t){var e,i,n,o=t.stacktrace,s=o.split("\n"),r="{anonymous}",a=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i;for(e=2,i=0,n=s.length;n-2>e;e++)if(a.test(s[e])){var h=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2,u=RegExp.$3;u=u.replace(/<anonymous function\:?\s?(\S+)?>/g,r),s[i++]=u+"@"+h}return s.splice(i,s.length-i),s},opera:function(t){var e,i,n,o=t.message.split("\n"),s="{anonymous}",r=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i;for(e=4,i=0,n=o.length;n>e;e+=2)r.test(o[e])&&(o[i++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:s+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+o[e+1].replace(/^\s+/,""));return o.splice(i,o.length-i),o},other:function(t){var e,i,n="{anonymous}",o=/function\s*([\w\-$]+)?\s*\(/i,s=[],r=10;while(t&&r>s.length)e=o.test(t+"")?RegExp.$1||n:n,i=Array.prototype.slice.call(t.arguments||[]),s[s.length]=e+"("+this.stringifyArguments(i)+")",t=t.caller;return s},stringifyArguments:function(t){for(var e=Array.prototype.slice,i=0;t.length>i;++i){var n=t[i];n===void 0?t[i]="undefined":n===null?t[i]="null":n.constructor&&(n.constructor===Array?t[i]=3>n.length?"["+this.stringifyArguments(n)+"]":"["+this.stringifyArguments(e.call(n,0,1))+"..."+this.stringifyArguments(e.call(n,-1))+"]":n.constructor===Object?t[i]="#object":n.constructor===Function?t[i]="#function":n.constructor===String&&(t[i]='"'+n+'"'))}return t.join(",")},sourceCache:{},ajax:function(t){var e=this.createXMLHTTPObject();if(e)return e.open("GET",t,!1),e.send(""),e.responseText},createXMLHTTPObject:function(){for(var t,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],i=0;e.length>i;i++)try{return t=e[i](),this.createXMLHTTPObject=e[i],t}catch(n){}},isSameDomain:function(t){return t.indexOf(location.hostname)!==-1},getSource:function(t){return t in this.sourceCache||(this.sourceCache[t]=this.ajax(t).split("\n")),this.sourceCache[t]},guessAnonymousFunctions:function(t){for(var e=0;t.length>e;++e){var i=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/,n=t[e],o=i.exec(n);if(o){var s=o[1],r=o[4],a=o[7]||0;if(s&&this.isSameDomain(s)&&r){var h=this.guessAnonymousFunction(s,r,a);t[e]=n.replace("{anonymous}",h)}}}return t},guessAnonymousFunction:function(t,e){var i;try{i=this.findFunctionName(this.getSource(t),e)}catch(n){i="getSource failed with url: "+t+", exception: "+(n+"")}return i},findFunctionName:function(t,e){for(var i,n,o=/function\s+([^(]*?)\s*\(([^)]*)\)/,s=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,r=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,a="",h=10,u=0;h>u;++u)if(i=t[e-u]){if(a=i+a,n=s.exec(a),n&&n[1])return n[1];if(n=o.exec(a),n&&n[1])return n[1];if(n=r.exec(a),n&&n[1])return n[1]}return"(?)"}},ige=null,igeVersion="1.1.0",igeClassStore={},igeDebug={node:typeof module!="undefined"&&module.exports!==void 0,level:["log","warning","error"],stacks:!0,throwErrors:!0,timing:!0},igeDebug.node&&(igeDebug.util=require("util")),Object.defineProperty(Object.prototype,"tween",{enumerable:!1,writable:!0,configurable:!0}),Object.prototype.tween=function(t,e,i){var n=(new $i_47).targetObj(this).properties(t).duration(e);return i&&(i.beforeTween&&n.beforeTween(i.beforeTween),i.afterTween&&n.afterTween(i.afterTween),i.easing&&n.easing(i.easing),i.startTime&&n.startTime(i.startTime)),n},Object.defineProperty(Array.prototype,"clone",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.clone=function(){var t,e=[];for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t]instanceof Array?this[t].clone():this[t]);return e},Object.defineProperty(Array.prototype,"pull",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.pull=function(t){var e=this.indexOf(t);return e>-1?(this.splice(e,1),e):-1},Object.defineProperty(Array.prototype,"each",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.each=function(t){var e,i=this.length;for(e=0;i>e;e++)t(this[e])},Object.defineProperty(Array.prototype,"eachReverse",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachReverse=function(t){var e,i=this.length;for(e=i-1;e>=0;e--)t(this[e])},Object.defineProperty(Array.prototype,"eachIsolated",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachIsolated=function(t){var e,i=[],n=i.length;for(e=0;n>e;e++)i[e]=this[e];for(e=0;n>e;e++)t(i[e])},Object.defineProperty(Math,"PI180",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180=Math.PI/180,Object.defineProperty(Math,"PI180R",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180R=180/Math.PI,Object.defineProperty(Math,"radians",{enumerable:!1,writable:!0,configurable:!0}),Math.radians=function(t){return t*Math.PI180},Object.defineProperty(Math,"degrees",{enumerable:!1,writable:!0,configurable:!0}),Math.degrees=function(t){return t*Math.PI180R},Object.defineProperty(Math,"distance",{enumerable:!1,writable:!0,configurable:!0}),Math.distance=function(t,e,i,n){return Math.sqrt((t-i)*(t-i)+(e-n)*(e-n))};var disableContextMenu=function(t){t!==null&&(t.oncontextmenu=function(){return!1})};Array.prototype.indexOf||(Object.defineProperty(Array.prototype,"indexOf",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.indexOf=function(t){var e,i=this.length;for(e=0;i>e;e++)if(this[e]===t)return e;return-1}),requestAnimFrame=typeof window!="undefined"?function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(function(){t((new Date).getTime())},1e3/60)}}():function(){return function(t){setTimeout(function(){t((new Date).getTime())},1e3/60)}}(),typeof console=="object"?typeof console.log=="function"&&(console.info===void 0&&(console.info=console.log),console.warn===void 0&&(console.warn=console.log)):console={log:function(){},warn:function(){},info:function(){},error:function(){}},typeof JSON.decycle!="function"&&(JSON.decycle=function decycle(t){"use strict";var e=[],i=[];return function n(t,o){var s,r,a;switch(typeof t){case"object":if(!t)return null;for(s=0;e.length>s;s+=1)if(e[s]===t)return{$ref:i[s]};if(e.push(t),i.push(o),Object.prototype.toString.apply(t)==="[object Array]")for(a=[],s=0;t.length>s;s+=1)a[s]=n(t[s],o+"["+s+"]");else{a={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(a[r]=n(t[r],o+"["+JSON.stringify(r)+"]"))}return a;case"number":case"string":case"boolean":return t}}(t,"$")}),typeof JSON.retrocycle!="function"&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return function rez(value){var i,item,name,path;if(value&&typeof value=="object")if(Object.prototype.toString.apply(value)==="[object Array]")for(i=0;value.length>i;i+=1)item=value[i],item&&typeof item=="object"&&(path=item.$ref,typeof path=="string"&&px.test(path)?value[i]=eval(path):rez(item));else for(name in value)typeof value[name]=="object"&&(item=value[name],item&&(path=item.$ref,typeof path=="string"&&px.test(path)?value[name]=eval(path):rez(item)))}($),$});var $i_2=function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/,i=function(){},n=function(t,e,i){var n,o="";if(e=e||"log",i!==void 0&&console.warn(i),(e==="warning"||e==="error")&&igeDebug.stacks&&(igeDebug.node?(n=Error().stack,console.log("Stack:",n)):typeof printStackTrace=="function"&&console.log("Stack:",printStackTrace().join("\n ---- "))),e==="error"){if(igeDebug.throwErrors)throw o+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+"] : "+t;console.log(o+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+"] : "+t)}else console.log(o+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+"] : "+t);return this},o=function(){return this._classId},s=function(t,e){var i=new t(this,e);return this[i.componentId]=i,this._components.push(i),this},r=function(t){return this[t]&&this[t].destroy&&this[t].destroy(),this._components&&this._components.pull(this[t]),delete this[t],this},a=function(t,e){var i,n=t.prototype||t;for(i in n)n.hasOwnProperty(i)&&(e||this[i]===void 0)&&(this[i]=n[i]);return this},h=function(t,e){return t!==void 0?e!==void 0?(this._data[t]=e,this):this._data[t]:void 0};return i.extend=function(){function i(){this._data={},!t&&this.init&&(this._components=[],typeof ige!="undefined"&&(this.ige=ige),this.init.apply(this,arguments))}var u,d,l,c,_,g,m,f=this.prototype,p=arguments[arguments.length-1],y=arguments[0];if(!p.classId)throw console.log(p),"Cannot create a new class without giving the class a classId property!";if(igeClassStore[p.classId])throw'Cannot create class with classId "'+p.classId+'" because a class with that ID has already been created!';t=!0,d=new this,t=!1;for(u in p)typeof p[u]=="function"&&typeof f[u]=="function"&&e.test(p[u])?(d["__"+u]=p[u],d[u]=function(t,e){return function(){var i,n=this._super;return this._super=f[t],i=e["__"+t].apply(this,arguments),this._super=n,i}}(u,d)):d[u]=p[u];if(arguments.length>1&&y&&y.length)for(_=0;y.length>_;_++){l=y[_],m=l.extension.prototype||l.extension,c=l.overwrite;for(g in m)m.hasOwnProperty(g)&&(c||d[g]===void 0)&&(d[g]=m[g])}return i.prototype=d,i.prototype.constructor=i,i.extend=arguments.callee,i.prototype.log=n,i.prototype.data=h,i.prototype.classId=o,i.prototype._classId=p.classId||"$i_2",i.prototype.addComponent=s,i.prototype.removeComponent=r,i.prototype.implement=a,igeClassStore[p.classId]=i,i},i}();typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_2);var $i_3=$i_2.extend({classId:"$i_3",on:function(t,e,i,n,o){var s,r,a,h,u,d,l,c,_,g=this;if(this._eventListeners=this._eventListeners||{},typeof e=="function"){if(typeof t=="string")return s={call:e,context:i,oneShot:n,sendEventName:o},h=this._eventListeners[t]=this._eventListeners[t]||[],r=!0,a=h.indexOf(s),a>-1&&(r=!1),r&&h.push(s),s;if(t.length){u=[],u[0]=0,u[1]=0,u[3]=function(){u[1]++,u[0]===u[1]&&e.apply(i||g)};for(d in t)t.hasOwnProperty(d)&&(l=t[d],c=l[0],_=l[1],u[0]++,c.on(_,u[3],null,!0,!0))}}else typeof t!="string"&&(t="*Multi-Event*"),this.log('Cannot register event listener for event "'+t+'" because the passed callback is not a function!',"error")},emit:function(t,e){if(this._eventListeners&&this._eventListeners[t]){var i,n,o,s,r,a,h=this._eventListeners[t].length,u=this._eventListeners[t].length-1;if(h){if(i=[],typeof e=="object"&&e!==null&&e[0]!==null&&e[0]!==void 0)for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);else i=[e];o=!1,this._eventListeners._processing=!0;while(h--)s=u-h,r=this._eventListeners[t][s],r.sendEventName&&(i=[t]),a=r.call.apply(r.context||this,i),a===!0&&(o=!0),r.oneShot&&(this.off(t,r),u--);if(this._eventListeners._processing=!1,this._processRemovals(),o)return 1}}},_processRemovals:function(){if(this._eventListeners){var t,e,i,n=this._eventListeners._removeQueue;if(n){t=n.length;while(t--)e=n[t],i=this.off(e[0],e[1]),n[2]&&n[2](i)}delete this._eventListeners._removeQueue}},off:function(t,e,i){if(this._eventListeners){if(this._eventListeners._processing)return this._eventListeners._removeQueue=this._eventListeners._removeQueue||[],this._eventListeners._removeQueue.push([t,e,i]),-1;if(this._eventListeners[t]){var n=this._eventListeners[t].indexOf(e);if(n>-1)return this._eventListeners[t].splice(n,1),i&&i(!0),!0;this.log('Failed to cancel event listener for event named "'+t+'" !',"warning",e)}else this.log("Failed to cancel event listener!")}return i&&i(!1),!1},eventList:function(){return this._eventListeners}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_3);var $i_5=function(t,e,i,n){return n===void 0?this._floor=!0:this.floor(n),this.x=t=t!==void 0?t:0,this.y=e=e!==void 0?e:0,this.z=i=i!==void 0?i:0,this._floor?(this.x2=Math.floor(t/2),this.y2=Math.floor(e/2),this.z2=Math.floor(i/2)):(this.x2=t/2,this.y2=e/2,this.z2=i/2),this};$i_5.prototype.floor=function(t){return t!==void 0?(this._floor=t,this):this._floor},$i_5.prototype.compare=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},$i_5.prototype.toIso=function(){var t=this.x-this.y,e=-this.z*1.2247+(this.x+this.y)*.5;return{x:t,y:e}},$i_5.prototype.thisToIso=function(){var t=this.toIso();return this.x=t.x,this.y=t.y,this.z=0,this},$i_5.prototype.to2d=function(){var t=this.y+this.x/2,e=this.y-this.x/2;return{x:t,y:e}},$i_5.prototype.thisTo2d=function(){var t=this.to2d();return this.x=t.x,this.y=t.y,this.z=0,this},$i_5.prototype.addPoint=function(t){return new $i_5(this.x+t.x,this.y+t.y,this.z+t.z)},$i_5.prototype.thisAddPoint=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},$i_5.prototype.minusPoint=function(t){return new $i_5(this.x-t.x,this.y-t.y,this.z-t.z)},$i_5.prototype.thisMinusPoint=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},$i_5.prototype.multiply=function(t,e,i){return new $i_5(this.x*t,this.y*e,this.z*i)},$i_5.prototype.thisMultiply=function(t,e,i){return this.x*=t,this.y*=e,this.z*=i,this},$i_5.prototype.divide=function(t,e,i){return new $i_5(this.x/t,this.y/e,this.z/i)},$i_5.prototype.thisDivide=function(t,e,i){return this.x/=t,this.y/=e,this.z/=i,this},$i_5.prototype.clone=function(){return new $i_5(this.x,this.y,this.z)},$i_5.prototype.interpolate=function(t,e,i,n){var o=t.x-this.x,s=t.y-this.y,r=t.z-this.z,a=n-e,h=a-(i-e),u=h/a;return new $i_5(t.x-o*u,t.y-s*u,t.z-r*u)},$i_5.prototype.toString=function(t){return t===void 0&&(t=2),this.x.toFixed(t)+","+this.y.toFixed(t)+","+this.z.toFixed(t)},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_5);var $i_6=$i_2.extend({classId:"$i_6",init:function(){this._poly=[],this._scale=new $i_5(1,1,1)},scale:function(t,e){return t!==void 0&&e!==void 0?(this._scale.x=t,this._scale.y=e,this):this._scale},addPoint:function(t,e){return this._poly.push(new $i_5(t,e,0)),this},length:function(){return this._poly.length},pointInPoly:function(t){var e,i=this._poly,n=i.length,o=n-1,s=0;for(e=0;n>e;o=e++)i[e].y>t.y!=i[o].y>t.y&&(i[o].x-i[e].x)*(t.y-i[e].y)/(i[o].y-i[e].y)+i[e].x>t.x&&(s=!s);return s},render:function(t){var e=this._poly,n=e.length,o=this._scale.x,s=this._scale.y;for(t.beginPath(),t.moveTo(e[0].x*o,e[0].y*s),i=1;n>i;i++)t.lineTo(e[i].x*o,e[i].y*s);return t.lineTo(e[0].x*o,e[0].y*s),t.stroke(),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_6);var $i_7=function(t,e,i,n){return this.x=t=t!==void 0?t:0,this.y=e=e!==void 0?e:0,this.width=i=i!==void 0?i:0,this.height=n=n!==void 0?n:0,this};$i_7.prototype.compare=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},$i_7.prototype.xyInside=function(t,e){return t>=this.x&&e>this.y&&this.x+this.width>=t&&this.y+this.height>=e},$i_7.prototype.pointInside=function(t){return x>=this.x&&t.y>this.y&&this.x+this.width>=t.x&&this.y+this.height>=t.y},$i_7.prototype.rectIntersect=function(t){if(t){var e=this.x,i=this.y,n=this.width,o=this.height,s=t.x,r=t.y,a=t.width,h=t.height,u=e+n,d=i+o,l=s+a,c=r+h;if(l>e&&u>s&&c>i&&d>r)return!0}return!1},$i_7.prototype.toString=function(t){return t===void 0&&(t=2),this.x.toFixed(t)+","+this.y.toFixed(t)+","+this.width.toFixed(t)+","+this.height.toFixed(t)},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_7);var $i_8=function(){this.matrix=[1,0,0,0,1,0,0,0,1],this._rotateOrigin=new $i_5(0,0,0),this._scaleOrigin=new $i_5(0,0,0)};$i_8.prototype={matrix:null,transformCoord:function(t){var e=t.x,i=t.y,n=this.matrix;return t.x=e*n[0]+i*n[1]+n[2],t.y=e*n[3]+i*n[4]+n[5],t},transformCoordInverse:function(t){var e=t.x,i=t.y,n=this.matrix;return t.x=e*n[0]+i*n[1]-n[2],t.y=e*n[3]+i*n[4]-n[5],t},transform:function(t){var e,i=t.length;for(e=0;i>e;e++)this.transformCoord(t[e]);return t},_newRotate:function(t){var e=new $i_8;return e.rotateTo(t),e},rotateBy:function(t){var e=new $i_8;return e.translateBy(this._rotateOrigin.x,this._rotateOrigin.y),e.rotateTo(t),e.translateBy(-this._rotateOrigin.x,-this._rotateOrigin.y),this.multiply(e),this},rotateTo:function(t){var e=this.matrix,i=Math.cos(t),n=Math.sin(t);return e[0]=i,e[1]=-n,e[3]=n,e[4]=i,this},_newScale:function(t,e){var i=new $i_8;return i.matrix[0]=t,i.matrix[4]=e,i},scaleBy:function(t,e){var i=new $i_8;return i.matrix[0]=t,i.matrix[4]=e,this.multiply(i),this},scaleTo:function(t,e){return this.matrix[0]=t,this.matrix[4]=e,this},_newTranslate:function(t,e){var i=new $i_8;return i.matrix[2]=t,i.matrix[5]=e,i},translateBy:function(t,e){var i=new $i_8;return i.matrix[2]=t,i.matrix[5]=e,this.multiply(i),this},translateTo:function(t,e){return this.matrix[2]=t,this.matrix[5]=e,this},copy:function(t){t=t.matrix;var e=this.matrix;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},identity:function(){var t=this.matrix;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},multiply:function(t){var e=this.matrix,i=t.matrix,n=e[0],o=e[1],s=e[2],r=e[3],a=e[4],h=e[5],u=e[6],d=e[7],l=e[8],c=i[0],_=i[1],g=i[2],m=i[3],f=i[4],p=i[5],y=i[6],v=i[7],x=i[8];return e[0]=n*c+o*m+s*y,e[1]=n*_+o*f+s*v,e[2]=n*g+o*p+s*x,e[3]=r*c+a*m+h*y,e[4]=r*_+a*f+h*v,e[5]=r*g+a*p+h*x,e[6]=u*c+d*m+l*y,e[7]=u*_+d*f+l*v,e[8]=u*g+d*p+l*x,this},premultiply:function(t){var e=t.matrix[0]*this.matrix[0]+t.matrix[1]*this.matrix[3]+t.matrix[2]*this.matrix[6],i=t.matrix[0]*this.matrix[1]+t.matrix[1]*this.matrix[4]+t.matrix[2]*this.matrix[7],n=t.matrix[0]*this.matrix[2]+t.matrix[1]*this.matrix[5]+t.matrix[2]*this.matrix[8],o=t.matrix[3]*this.matrix[0]+t.matrix[4]*this.matrix[3]+t.matrix[5]*this.matrix[6],s=t.matrix[3]*this.matrix[1]+t.matrix[4]*this.matrix[4]+t.matrix[5]*this.matrix[7],r=t.matrix[3]*this.matrix[2]+t.matrix[4]*this.matrix[5]+t.matrix[5]*this.matrix[8],a=t.matrix[6]*this.matrix[0]+t.matrix[7]*this.matrix[3]+t.matrix[8]*this.matrix[6],h=t.matrix[6]*this.matrix[1]+t.matrix[7]*this.matrix[4]+t.matrix[8]*this.matrix[7],u=t.matrix[6]*this.matrix[2]+t.matrix[7]*this.matrix[5]+t.matrix[8]*this.matrix[8];return this.matrix[0]=e,this.matrix[1]=i,this.matrix[2]=n,this.matrix[3]=o,this.matrix[4]=s,this.matrix[5]=r,this.matrix[6]=a,this.matrix[7]=h,this.matrix[8]=u,this},getInverse:function(){var t=this.matrix,e=t[0],i=t[1],n=t[2],o=t[3],s=t[4],r=t[5],a=t[6],h=t[7],u=t[8],d=new $i_8,l=e*(s*u-h*r)-o*(i*u-h*n)+a*(i*r-s*n);if(l===0)return null;var c=d.matrix;return c[0]=s*u-r*h,c[1]=n*h-i*u,c[2]=i*r-n*s,c[3]=r*a-o*u,c[4]=e*u-n*a,c[5]=n*o-e*r,c[6]=o*h-s*a,c[7]=i*a-e*h,c[8]=e*s-i*o,d.multiplyScalar(1/l),d},multiplyScalar:function(t){var e;for(e=0;9>e;e++)this.matrix[e]*=t;return this},transformRenderingContextSet:function(t){var e=this.matrix;return t.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this},transformRenderingContext:function(t){var e=this.matrix;return t.transform(e[0],e[3],e[1],e[4],e[2],e[5]),this}},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_8);var $i_12=$i_2.extend({classId:"$i_12",componentId:"tween",init:function(t){this._entity=t,this._transform=t.transform,this._tweens=[],t.addBehaviour("tween",this._behaviour)},_behaviour:function(t){this.tween.tick(t)},start:function(t){var e,i=t._targetObj,n=t._propertyObj,o=[];if(i){t._startTime===void 0&&(t._startTime=(new Date).getTime()),t._durationMs===void 0&&(t._durationMs=0),t._endTime=t._startTime+t._durationMs;for(e in n)n.hasOwnProperty(e)&&o.push({targetObj:i,propName:e,startVal:i[e],endVal:n[e],deltaVal:n[e]-i[e]});return t._targetData=o,t._destTime=t._endTime-t._startTime,this._tweens.push(t),this.enable(),t}return this.log('Cannot start tweening properties of the specified object "'+obj+'" because it does not exist!',"error"),-1},stop:function(t){return this._tweens.pull(t),this._tweens.length||this.disable(),this},stopAll:function(){return this.disable(),delete this._tweens,this._tweens=[],this},enable:function(){return this._tweening||(this._tweening=!0),this},disable:function(){return this._tweening&&(this._tweening=!1),this},tick:function(){if(this._tweens&&this._tweens.length){var t,e,i,n,o,s,r,a=ige.tickStart,h=this._tweens,u=h.length;while(u--)if(t=h[u],t._started||a>=t._startTime)if(t._started||(typeof t._beforeTween=="function"&&(t._beforeTween(t),delete t._beforeTween),t._started=!0),e=a-t._startTime,i=t._destTime,n=t._easing,i>e){s=t._targetData;for(r in s)s.hasOwnProperty(r)&&(o=s[r],o.targetObj[o.propName]=this.easing[n](e,o.startVal,o.deltaVal,i))}else{s=t._targetData;for(r in s)s.hasOwnProperty(r)&&(o=s[r],o.targetObj[o.propName]=o.endVal);t.stop(),typeof t._afterTween=="function"&&(t._afterTween(t),delete t._afterTween)}}},easing:{none:function(t,e,i,n){return i*t/n+e},inQuad:function(t,e,i,n){return i*(t/=n)*t+e},outQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},inOutQuad:function(t,e,i,n){return 1>(t/=n/2)?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},inCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},outCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},inOutCubic:function(t,e,i,n){return 1>(t/=n/2)?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},outInCubic:function(t,e,i,n){return n/2>t?this.outCubic(t*2,e,i/2,n):this.inCubic(t*2-n,e+i/2,i/2,n)},inQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},outQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},inOutQuart:function(t,e,i,n){return 1>(t/=n/2)?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},outInQuart:function(t,e,i,n){return n/2>t?this.outQuart(t*2,e,i/2,n):this.inQuart(t*2-n,e+i/2,i/2,n)},inQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},outQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},inOutQuint:function(t,e,i,n){return 1>(t/=n/2)?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},outInQuint:function(t,e,i,n){return n/2>t?this.outQuint(t*2,e,i/2,n):this.inQuint(t*2-n,e+i/2,i/2,n)},inSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},outSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},inOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},outInSine:function(t,e,i,n){return n/2>t?this.outSine(t*2,e,i/2,n):this.inSine(t*2-n,e+i/2,i/2,n)},inExpo:function(t,e,i,n){return t===0?e:i*Math.pow(2,10*(t/n-1))+e-i*.001},outExpo:function(t,e,i,n){return t===n?e+i:i*1.001*(-Math.pow(2,-10*t/n)+1)+e},inOutExpo:function(t,e,i,n){return t===0?e:t===n?e+i:1>(t/=n/2)?i/2*Math.pow(2,10*(t-1))+e-i*5e-4:i/2*1.0005*(-Math.pow(2,-10*--t)+2)+e},outInExpo:function(t,e,i,n){return n/2>t?this.outExpo(t*2,e,i/2,n):this.inExpo(t*2-n,e+i/2,i/2,n)},inCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},outCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},inOutCirc:function(t,e,i,n){return 1>(t/=n/2)?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},outInCirc:function(t,e,i,n){return n/2>t?this.outCirc(t*2,e,i/2,n):this.inCirc(t*2-n,e+i/2,i/2,n)},inElastic:function(t,e,i,n,o,s){var r;return t===0?e:(t/=n)===1?e+i:(s||(s=n*.3),!o||Math.abs(i)>o?(o=i,r=s/4):r=s/(2*Math.PI)*Math.asin(i/o),-(o*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*2*Math.PI/s))+e)},outElastic:function(t,e,i,n,o,s){var r;return t===0?e:(t/=n)===1?e+i:(s||(s=n*.3),!o||Math.abs(i)>o?(o=i,r=s/4):r=s/(2*Math.PI)*Math.asin(i/o),o*Math.pow(2,-10*t)*Math.sin((t*n-r)*2*Math.PI/s)+i+e)},inOutElastic:function(t,e,i,n,o,s){var r;return t===0?e:(t/=n/2)===2?e+i:(s||(s=n*.3*1.5),!o||Math.abs(i)>o?(o=i,r=s/4):r=s/(2*Math.PI)*Math.asin(i/o),1>t?-.5*o*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*2*Math.PI/s)+e:o*Math.pow(2,-10*(t-=1))*Math.sin((t*n-r)*2*Math.PI/s)*.5+i+e)},outInElastic:function(t,e,i,n,o,s){return n/2>t?this.outElastic(t*2,e,i/2,n,o,s):this.inElastic(t*2-n,e+i/2,i/2,n,o,s)},inBack:function(t,e,i,n,o){return o===void 0&&(o=1.70158),i*(t/=n)*t*((o+1)*t-o)+e},outBack:function(t,e,i,n,o){return o===void 0&&(o=1.70158),i*((t=t/n-1)*t*((o+1)*t+o)+1)+e},inOutBack:function(t,e,i,n,o){return o===void 0&&(o=1.70158),1>(t/=n/2)?i/2*t*t*(((o*=1.525)+1)*t-o)+e:i/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)+e},outInBack:function(t,e,i,n,o){return n/2>t?this.outBack(t*2,e,i/2,n,o):this.inBack(t*2-n,e+i/2,i/2,n,o)},inBounce:function(t,e,i,n){return i-this.outBounce(n-t,0,i,n)+e},outBounce:function(t,e,i,n){return 1/2.75>(t/=n)?i*7.5625*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},inOutBounce:function(t,e,i,n){return n/2>t?this.inBounce(t*2,0,i,n)*.5+e:this.outBounce(t*2-n,0,i,n)*.5+i*.5+e},outInBounce:function(t,e,i,n){return n/2>t?this.outBounce(t*2,e,i/2,n):this.inBounce(t*2-n,e+i/2,i/2,n)}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_12);var $i_14=$i_3.extend({classId:"$i_14",componentId:"input",init:function(){this._eventQueue=[],this._eventControl={_cancelled:!1,stopPropagation:function(){this._cancelled=!0}},this.tick(),this.mouse={dblClick:-302,down:-301,up:-300,move:-259,wheel:-258,wheelUp:-257,wheelDown:-256,x:-255,y:-254,button1:-253,button2:-252,button3:-251},this.pad1={button1:-250,button2:-249,button3:-248,button4:-247,button5:-246,button6:-245,button7:-244,button8:-243,button9:-242,button10:-241,button11:-240,button12:-239,button13:-238,button14:-237,button15:-236,button16:-235,button17:-234,button18:-233,button19:-232,button20:-231,stick1:-230,stick2:-229,stick1Up:-228,stick1Down:-227,stick1Left:-226,stick1Right:-225,stick2Up:-224,stick2Down:-223,stick2Left:-222,stick2Right:-221},this.pad2={button1:-220,button2:-219,button3:-218,button4:-217,button5:-216,button6:-215,button7:-214,button8:-213,button9:-212,button10:-211,button11:-210,button12:-209,button13:-208,button14:-207,button15:-206,button16:-205,button17:-204,button18:-203,button19:-202,button20:-201,stick1:-200,stick2:-199,stick1Up:-198,stick1Down:-197,stick1Left:-196,stick1Right:-195,stick2Up:-194,stick2Down:-193,stick2Left:-192,stick2Right:-191},this.key={shift:-3,ctrl:-2,alt:-1,backspace:8,tab:9,enter:13,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90},this._controlMap=[],this._state=[],this._state[this.mouse.x]=0,this._state[this.mouse.y]=0},debug:function(t){return t!==void 0?(this._debug=t,this):this._debug},_rationalise:function(t,e){if(t.igeType==="key"&&t.keyCode===8){var i=t.srcElement||t.target;i.tagName.toLowerCase()==="body"&&t.preventDefault()}t.igeType==="touch"&&t.preventDefault(),e?(t.button=0,t.changedTouches&&t.changedTouches.length&&(t.igePageX=t.changedTouches[0].pageX,t.igePageY=t.changedTouches[0].pageY)):(t.igePageX=t.pageX,t.igePageY=t.pageY),t.igeX=t.igePageX-this._canvas.offsetLeft,t.igeY=t.igePageY-this._canvas.offsetTop},setupListeners:function(t){this.log("Setting up input event listeners..."),this._canvas=t;var e=this;this._evRef={mousedown:function(t){t.igeType="mouse",e._rationalise(t),e._mouseDown(t)},mouseup:function(t){t.igeType="mouse",e._rationalise(t),e._mouseUp(t)},mousemove:function(t){t.igeType="mouse",e._rationalise(t),e._mouseMove(t)},mousewheel:function(t){t.igeType="mouse",e._rationalise(t),e._mouseWheel(t)},touchmove:function(t){t.igeType="touch",e._rationalise(t,!0),e._mouseMove(t)},touchstart:function(t){t.igeType="touch",e._rationalise(t,!0),e._mouseDown(t)},touchend:function(t){t.igeType="touch",e._rationalise(t,!0),e._mouseUp(t)},contextmenu:function(t){t.preventDefault()},keydown:function(t){t.igeType="key",e._rationalise(t),e._keyDown(t)},keyup:function(t){t.igeType="key",e._rationalise(t),e._keyUp(t)}},t.addEventListener("mousedown",this._evRef.mousedown,!1),t.addEventListener("mouseup",this._evRef.mouseup,!1),t.addEventListener("mousemove",this._evRef.mousemove,!1),t.addEventListener("mousewheel",this._evRef.mousewheel,!1),t.addEventListener("touchmove",this._evRef.touchmove,!1),t.addEventListener("touchstart",this._evRef.touchstart,!1),t.addEventListener("touchend",this._evRef.touchend,!1),t.addEventListener("contextmenu",this._evRef.contextmenu,!1),window.addEventListener("keydown",this._evRef.keydown,!1),window.addEventListener("keyup",this._evRef.keyup,!1)},destroyListeners:function(){this.log("Removing input event listeners...");var t=this._canvas;t.removeEventListener("mousedown",this._evRef.mousedown,!1),t.removeEventListener("mouseup",this._evRef.mouseup,!1),t.removeEventListener("mousemove",this._evRef.mousemove,!1),t.removeEventListener("mousewheel",this._evRef.mousewheel,!1),t.removeEventListener("touchmove",this._evRef.touchmove,!1),t.removeEventListener("touchstart",this._evRef.touchstart,!1),t.removeEventListener("touchend",this._evRef.touchend,!1),t.removeEventListener("contextmenu",this._evRef.contextmenu,!1),window.removeEventListener("keydown",this._evRef.keydown,!1),window.removeEventListener("keyup",this._evRef.keyup,!1)},_mouseDown:function(t){this._debug&&console.log("Mouse Down",t),this._updateMouseData(t);var e=t.igeX-ige.geometry.x2,i=t.igeY-ige.geometry.y2,n=this;t.igeBaseX=e,t.igeBaseY=i,t.button===0&&(this._state[this.mouse.button1]=!0),t.button===1&&(this._state[this.mouse.button2]=!0),t.button===2&&(this._state[this.mouse.button3]=!0),this.mouseDown=t,this.queueEvent(this,function(){n.emit("mouseDown",[t,e,i,t.button+1])})},_mouseUp:function(t){this._debug&&console.log("Mouse Up",t),this._updateMouseData(t);var e=t.igeX-ige.geometry.x2,i=t.igeY-ige.geometry.y2,n=this;t.igeBaseX=e,t.igeBaseY=i,t.button===0&&(this._state[this.mouse.button1]=!1),t.button===1&&(this._state[this.mouse.button2]=!1),t.button===2&&(this._state[this.mouse.button3]=!1),this.mouseUp=t,this.queueEvent(this,function(){n.emit("mouseUp",[t,e,i,t.button+1])})},_mouseMove:function(t){ige._mouseOverVp=this._updateMouseData(t);var e=t.igeX-ige.geometry.x2,i=t.igeY-ige.geometry.y2,n=this;t.igeBaseX=e,t.igeBaseY=i,this._state[this.mouse.x]=e,this._state[this.mouse.y]=i,this.mouseMove=t,this.queueEvent(this,function(){n.emit("mouseMove",[t,e,i,t.button+1])})},_mouseWheel:function(t){this._updateMouseData(t);var e=t.igeX-ige.geometry.x2,i=t.igeY-ige.geometry.y2,n=this;t.igeBaseX=e,t.igeBaseY=i,this._state[this.mouse.wheel]=t.wheelDelta,t.wheelDelta>0?this._state[this.mouse.wheelUp]=!0:this._state[this.mouse.wheelDown]=!0,this.mouseWheel=t,this.queueEvent(this,function(){n.emit("mouseWheel",[t,e,i,t.button+1])
})},_keyDown:function(t){var e=this;this._state[t.keyCode]=!0,this.queueEvent(this,function(){e.emit("keyDown",[t,t.keyCode])})},_keyUp:function(t){var e=this;this._state[t.keyCode]=!1,this.queueEvent(this,function(){e.emit("keyUp",[t,t.keyCode])})},_updateMouseData:function(t){var e,i,n=ige._children,o=n.length,s=t.igeX-ige.geometry.x/2,r=t.igeY-ige.geometry.y/2;ige._mousePos.x=s,ige._mousePos.y=r;while(o--)if(e=n[n.length-(o+1)],s>e._translate.x-e.geometry.x/2&&e._translate.x+e.geometry.x/2>s&&r>e._translate.y-e.geometry.y/2&&e._translate.y+e.geometry.y/2>r){e._mousePos=new $i_5(Math.floor((s-e._translate.x)/e.camera._scale.x+e.camera._translate.x),Math.floor((r-e._translate.y)/e.camera._scale.y+e.camera._translate.y),0),i=e;break}return i},mapAction:function(t,e){this._controlMap[t]=e},actionVal:function(t){return this._state[this._controlMap[t]]},actionState:function(t){var e=this._state[this._controlMap[t]];return!!e},val:function(t){return this._state[t]},state:function(t){return!!this._state[t]},stopPropagation:function(){return this._eventControl._cancelled=!0,this},queueEvent:function(t,e){return e!==void 0&&this._eventQueue.push([t,e]),this},tick:function(){var t=this._eventQueue,e=t.length,i=this._eventControl;while(e--)if(t[e][1].apply(t[e][0],[i]),i._cancelled)break;this._eventQueue=[],this._eventControl._cancelled=!1,this.dblClick=!1,this.mouseMove=!1,this.mouseDown=!1,this.mouseUp=!1,this.mouseWheel=!1},emit:function(t,e){if(this._eventListeners&&this._eventListeners[t]){var i,n,o,s,r,a,h=this._eventListeners[t].length,u=this._eventListeners[t].length-1,d=this._eventControl;if(h){if(i=[],typeof e=="object"&&e!==null&&e[0]!==null)for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);else i=[e];o=!1,this._eventListeners._processing=!0;while(h--){if(d._cancelled)break;s=u-h,r=this._eventListeners[t][s],r.sendEventName&&(i=[t]),a=r.call.apply(r.context||this,i),(a===!0||this._eventControl._cancelled===!0)&&(o=!0),r.oneShot&&this.off(t,r)}if(this._eventListeners._processing=!1,this._processRemovals(),o)return 1}}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_14);var $i_22={timeSyncInterval:function(t){return t!==void 0?(this._timeSyncInterval=t,this._entity):this._timeSyncInterval},_onTimeSync:function(t,e){var i,n,o=(new Date).getTime();ige.isServer||(o=(new Date).getTime(),i=parseInt(t,10),this._latency=o-i,this._sendTimeSync([t,o])),ige.isServer&&(i=parseInt(t[1],10),n=o-parseInt(t[0],10),this._timeSyncLog[e]=o-i)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_22);var $i_28={};$i_28._debug={node:typeof module!="undefined"&&module.exports!==void 0,level:["log","warning","error"],stacks:!1,throwErrors:!0,trace:{setup:!1,enabled:!1,match:""}},$i_28.Class=function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/,i=function(){},n=function(t,e){var i,n,o="";for($i_28._debug.trace.indentLevel||($i_28._debug.trace.indentLevel=0),i=0;$i_28._debug.trace.indentLevel>i;i++)o+="  ";if(e=e||"log",e==="error"){if($i_28._debug.stacks&&($i_28._debug.node?(n=Error().stack,console.log("Stack:",n)):typeof printStackTrace=="function"&&console.log("Stack:",printStackTrace().join("\n ---- "))),$i_28._debug.throwErrors)throw o+"Net.io *"+e+"* ["+(this._classId||this.prototype._classId)+"] : "+t;console.log(o+"Net.io *"+e+"* ["+(this._classId||this.prototype._classId)+"] : "+t)}else console.log(o+"Net.io *"+e+"* ["+(this._classId||this.prototype._classId)+"] : "+t);return this},o=function(t){return t!==void 0?(this._classId?this._classId=t:this.prototype._classId=t,this):this._classId||this.prototype._classId},s=function(t,e){var i=new t(this,e);return this[i.componentId]=i,this},r=function(t,e){var i,n=t.prototype||t;for(i in n)n.hasOwnProperty(i)&&(e||this[i]===void 0)&&(this[i]=n[i]);return this},a=function(t,e){return t!==void 0?e!==void 0?(this._data[t]=e,this):this._data[t]:void 0};return i.extend=function(){function i(){this._data={},!t&&this.init&&this.init.apply(this,arguments)}var h,u,d,l,c,_,g,m=this.prototype,f=arguments[arguments.length-1],p=arguments[0];t=!0,u=new this,t=!1;for(h in f)typeof f[h]=="function"&&typeof m[h]=="function"&&e.test(f[h])?(u["__"+h]=f[h],u[h]=function(t,e){return function(){var i,n=this._super;return this._super=m[t],i=e["__"+t].apply(this,arguments),this._super=n,i}}(h,u)):u[h]=f[h];if(arguments.length>1&&p&&p.length)for(c=0;p.length>c;c++){d=p[c],g=d.extension.prototype||d.extension,l=d.overwrite;for(_ in g)g.hasOwnProperty(_)&&(l||u[_]===void 0)&&(u[_]=g[_])}return i.prototype=u,i.prototype.constructor=i,i.extend=arguments.callee,i.prototype.log=n,i.prototype.data=a,i.prototype.classId=o,i.prototype._classId=f.classId||"Class",i.prototype.addComponent=s,i.prototype.implement=r,i},i}(),$i_28.EventingClass=$i_28.Class.extend({on:function(t,e,i,n,o){if(this._eventListeners=this._eventListeners||{},typeof e=="function"){if(typeof t=="string"){this._eventListeners[t]=this._eventListeners[t]||[];var s={call:e,context:i,oneShot:n,sendEventName:o},r=!0;for(var a in this._eventListeners[t])if(this._eventListeners[t][a]==s){r=!1;break}return r&&this._eventListeners[t].push(s),s}if(t.length){var h=[];h[0]=0,h[1]=0,h[2]=[],h[3]=this.bind(function(t){h[2].indexOf(t)==-1&&(h[2].push(t),h[1]++,h[0]==h[1]&&e.apply(i||this))});for(var u in t){var d=t[u],l=d[0],c=d[1];h[0]+=c.length;for(var _ in c){var g=c[_];l.on(g,h[3],null,!0,!0)}}}}else typeof t!="string"&&(t="*Multi-Event*"),this.log('Cannot register event listener for event "'+t+'" because the passed callback is not a function!',"error")},emit:function(t,e){if(this._eventListeners&&this._eventListeners[t]){var i=this._eventListeners[t].length,n=this._eventListeners[t].length-1;if(i){var o=[];if(typeof e=="object"&&e!=null&&e[0]!=null)for(var s in e)o[s]=e[s];else o=[e];var r,a=!1;while(i--){r=n-i;var h=this._eventListeners[t][r];h.sendEventName&&(o=[t]);var u=h.call.apply(h.context||this,o);u===!0&&(a=!0),h.oneShot&&this.off(t,h)}if(a)return 1}}},off:function(t,e){if(this._eventListeners)if(this._eventListeners[t]){var i=this._eventListeners[t].indexOf(e);if(i>-1)return this._eventListeners[t].splice(i,1),!0;this.log('Failed to cancel event listener for event named "'+t+'" !',"info",e)}else this.log("Failed to cancel event listener!");return!1},eventList:function(){return this._eventListeners}}),$i_28.Client=$i_28.EventingClass.extend({classId:"Client",init:function(t,e){this.log("Net.io client starting..."),this._options=e||{},this._socket=null,this._state=0,this._debug=!1,this._connectionAttempts=0,this._options.connectionRetry===void 0&&(this._options.connectionRetry=!0),this._options.connectionRetryMax===void 0&&(this._options.connectionRetryMax=10),this._options.reconnect===void 0&&(this._options.reconnect=!0),t!==void 0&&this.connect(t)},debug:function(t){return t!==void 0?(this._debug=t,this):this._debug},connect:function(t){this.log("Connecting to server at "+t);var e=this;this._state=1,t=t.replace("http://","ws://"),this._socket=new WebSocket(t,"netio1"),this._socket.onopen=function(){e._onOpen.apply(e,arguments)},this._socket.onmessage=function(){e._onData.apply(e,arguments)},this._socket.onclose=function(){e._onClose.apply(e,arguments)},this._socket.onerror=function(){e._onError.apply(e,arguments)}},disconnect:function(t){this._socket.close(1e3,t)},send:function(t){this._socket.send(this._encode(t))},_onOpen:function(){this._state=2},_onData:function(t){var e=this._decode(t.data);if(this._debug&&console.log("Incoming data (event, decoded data):",t,e),e._netioCmd)switch(e._netioCmd){case"id":this.id=e.data,this._state=3,this.emit("connect",this.id);break;case"close":this._disconnectReason=e.data}else this.emit("message",[e])},_onClose:function(t,e,i){this._state===3&&(this._state=0,this.emit("disconnect",{reason:this._disconnectReason,wasClean:i,code:t})),this._state===2&&(this._state=0,this.emit("disconnect",{reason:this._disconnectReason,wasClean:i,code:t})),this._state===1&&(this._state=0,this.emit("error",{reason:"Cannot establish connection, is server running?"})),delete this._disconnectReason},_onError:function(){this.log("An error occurred with the net.io socket!","error",arguments),this.emit("error",arguments)},_encode:function(t){return JSON.stringify(t)},_decode:function(t){return JSON.parse(t)}});var Ige$i_28Client={version:"1.0.0",_initDone:!1,_idCounter:0,_requests:{},_state:0,start:function(t,e){if(this._state===3)typeof e=="function"&&e();else{var i=this;i._startCallback=e,t!==void 0&&(this._url=t),this.log('Connecting to net.io server at "'+this._url+'"...'),typeof WebSocket!="undefined"&&(this._io=new $i_28.Client(t),i._state=1,this._io.on("connect",function(){i._state=2,i._onConnectToServer.apply(i,arguments)}),this._io.on("message",function(t){if(i._initDone)i._onMessageFromServer.apply(i,arguments);else{var e,n=0;if(t.cmd==="init"){i._initDone=!0,i._state=3,i._networkCommandsLookup=t.ncmds;for(e in i._networkCommandsLookup)i._networkCommandsLookup.hasOwnProperty(e)&&(i._networkCommandsIndex[i._networkCommandsLookup[e]]=e,n++);i.define("_igeRequest",function(){i._onRequest.apply(i,arguments)}),i.define("_igeResponse",function(){i._onResponse.apply(i,arguments)}),i.define("_igeNetTimeSync",function(){i._onTimeSync.apply(i,arguments)}),i.log("Received network command list with count: "+n),typeof i._startCallback=="function"&&(i._startCallback(),delete i._startCallback)}}}),this._io.on("disconnect",function(){i._state=0,i._onDisconnectFromServer.apply(i,arguments)}),this._io.on("error",function(){i._onError.apply(i,arguments)}))}},stop:function(){self._state===3&&this._io.disconnect("Client requested disconnect")},define:function(t,e){return t!==void 0&&e!==void 0?(this._networkCommandsLookup[t]!==void 0?this._networkCommands[t]=e:this.log('Cannot define network command "'+t+'" because it does not exist on the server. Please edit your server code and define the network command there before trying to define it on the client!',"error"),this._entity):(this.log("Cannot define network command either the commandName or callback parameters were undefined!","error"),void 0)},send:function(t,e){var i,n=this._networkCommandsLookup[t];n!==void 0?(this.debug()&&(console.log('Sending "'+t+'" (index '+n+") with data:",e),this._debugCounter++),i=String.fromCharCode(n),this._io.send([i,e])):this.log('Cannot send network packet with command "'+t+'" because the command has not been defined!',"error")},request:function(t,e,i){var n={id:this.newIdHex(),cmd:t,data:e,callback:i,timestamp:(new Date).getTime()};this._requests[n.id]=n,this.send("_igeRequest",{id:n.id,cmd:t,data:n.data})},response:function(t,e){var i=this._requests[t];i&&(this.send("_igeResponse",{id:t,cmd:i.commandName,data:e}),delete this._requests[t])},newIdHex:function(){return this._idCounter++,(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16)},_onRequest:function(t){this._requests[t.id]=t,this.debug()&&(console.log("onRequest",t),this._debugCounter++),this._networkCommands[t.cmd]&&this._networkCommands[t.cmd](t.id,t.data),this.emit(t.cmd,[t.id,t.data])},_onResponse:function(t){id=t.id,req=this._requests[id],this.debug()&&(console.log("onResponse",t),this._debugCounter++),req&&(req.callback(req.cmd,t.data),delete this._requests[id])},_onConnectToServer:function(){this.log("Connected to server!"),this.emit("connected")},_onMessageFromServer:function(t){var e=t[0].charCodeAt(0),i=this._networkCommandsIndex[e];this._networkCommands[i]&&(this.debug()&&(console.log('Received "'+i+'" (index '+e+") with data:",t[1]),this._debugCounter++),this._networkCommands[i](t[1])),this.emit(i,t[1])},_onDisconnectFromServer:function(t){t==="booted"?this.log("Server rejected our connection because it is not accepting connections at this time!","warning"):this.log("Disconnected from server!"),this.emit("disconnected")},_onError:function(t){this.log("Error with connection: "+t.reason,"error")}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Ige$i_28Client);var Ige$i_28Server={_idCounter:0,_requests:{},start:function(t,e){var i=this;return this._socketById=[],t!==void 0&&(this._port=t),this.log("Starting net.io listener on port "+this._port),this._io=new this._netio(this._port,e),this._io.on("connection",function(){i._onClientConnect.apply(i,arguments)}),this.define("_igeRequest",function(){i._onRequest.apply(i,arguments)}),this.define("_igeResponse",function(){i._onResponse.apply(i,arguments)}),this.define("_igeNetTimeSync",function(){i._onTimeSync.apply(i,arguments)}),this.timeSyncStart(),this._entity},define:function(t,e){if(t!==void 0){this._networkCommands[t]=e;var i=this._networkCommandsIndex.length;return this._networkCommandsIndex[i]=t,this._networkCommandsLookup[t]=i,this._entity}this.log("Cannot define a network command without a commandName parameter!","error")},clients:function(){return this._socketById},socket:function(t){return this._socketById[t]},acceptConnections:function(t){return t!==void 0?(this._acceptConnections=t,t?this.log("Server now accepting connections!"):this.log("Server no longer accepting connections!"),this._entity):this._acceptConnections},send:function(t,e,i){var n,o=this._networkCommandsLookup[t];o!==void 0?(n=String.fromCharCode(o),this._io.send([n,e],i)):this.log('Cannot send network packet with command "'+t+'" because the command has not been defined!',"error")},request:function(t,e,i){var n={id:this.newIdHex(),cmd:t,data:e,callback:i,timestamp:(new Date).getTime()};this._requests[n.id]=n,this.send("_igeRequest",{id:n.id,cmd:t,data:n.data})},response:function(t,e){var i=this._requests[t];i&&(this.send("_igeResponse",{id:t,cmd:i.commandName,data:e},i.clientId),delete this._requests[t])},newIdHex:function(){return this._idCounter++,(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16)},_originIsAllowed:function(){return!0},_onClientConnect:function(t){var e=this;this._acceptConnections?this.emit("connect",t)?t.close():(this.log("Accepted connection with id "+t.id),this._socketById[t.id]=t,t.on("message",function(i){e._onClientMessage.apply(e,[i,t.id])}),t.on("disconnect",function(i){e._onClientDisconnect.apply(e,[i,t.id])}),t.send({cmd:"init",ncmds:this._networkCommandsLookup}),this._sendTimeSync(void 0,t.id)):(this.log("Rejecting connection with id "+t.id+" - we are not accepting connections at the moment!"),t.close())},_onRequest:function(t,e){t.clientId=e,this._requests[t.id]=t,this.debug()&&(console.log("onRequest",t),console.log("emitting",t.cmd,[t.id,t.data]),this._debugCounter++),this._networkCommands[t.cmd]&&this._networkCommands[t.cmd](t.id,t.data,e),this.emit(t.cmd,[t.id,t.data,e])},_onResponse:function(t,e){id=t.id,req=this._requests[id],this.debug()&&(console.log("onResponse",t),this._debugCounter++),req&&(req.callback(req.cmd,[t.data,e]),delete this._requests[id])},_onClientMessage:function(t,e){var i=t[0].charCodeAt(0),n=this._networkCommandsIndex[i];this._networkCommands[n]&&this._networkCommands[n](t[1],e),this.emit(n,[t[1],e])},_onClientDisconnect:function(t,e){this.log("Client disconnected with id "+e),this.emit("disconnect",e),delete this._socketById[e]}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Ige$i_28Server);var Ige$i_28Component=$i_3.extend([{extension:$i_22,overwrite:!1}],{classId:"Ige$i_28Component",componentId:"network",init:function(t,e){this._entity=t,this._options=e,this._networkCommands={},this._networkCommandsIndex=[],this._networkCommandsLookup={},this._port=8e3,this._debug=!1,this._debugCounter=0,this._debugMax=0,this._timeSyncInterval=1e4,this._timeSyncLog={},this._latency=0,ige.isServer||(this._netio=Ige$i_28Client,this.implement(Ige$i_28Client)),this.log("Network component initiated with Net.IO version: "+this._netio.version)},debug:function(t){return t!==void 0?(this._debug=t,this._entity):(this._debugMax>0&&this._debugCounter>=this._debugMax&&(this._debug=!1,this._debugCounter=0),this._debug)},debugMax:function(t){return t!==void 0?(this._debugMax=t,this._entity):this._debugMax}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Ige$i_28Component);var $i_32={joinRoom:function(t){ige.network.send("igeChatJoinRoom",t)},sendToRoom:function(t,e,i){t!==void 0&&e!==void 0&&(msg={roomId:t,text:e,to:i},ige.network.send("igeChatMsg",msg))},_onMessageFromServer:function(t){var e=ige.chat;e.emit("messageFromServer",[t])||console.log('Server sent us a message in the room "'+t.roomId+'" from the user id "'+t.from+'":',t.text)},_onJoinedRoom:function(t){var e=ige.chat;e.emit("joinedRoom",[t])||(t.joined===!0?console.log("Server says we have joined room:",t.roomId):console.log("Server says we failed to join room:",t.roomId))},_onLeftRoom:function(t){var e=ige.chat;e.emit("leftRoom",[t])||console.log("We have left room:",t)},_onServerSentRoomList:function(t){var e=ige.chat;e.emit("roomList",[t])||console.log("Server sent room list:",t)},_onServerSentRoomUserList:function(t){var e=ige.chat;e.emit("roomUserList",[t])||console.log("Server sent room user list:",t)},_onRoomCreated:function(t){var e=ige.chat;e.emit("roomCreated",[t])||console.log("Server told us room was created:",t)},_onRoomRemoved:function(t){var e=ige.chat;e.emit("roomRemoved",[t])||console.log("Server told us room was removed:",t)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_32);var $i_33={createRoom:function(t,e,i){var n=ige.chat,o=i||ige.newIdHex();return n._rooms[i]={id:o,name:t,options:e,users:[]},n._entity.network.send("igeChatRoomCreated",i),i},removeRoom:function(t){var e=ige.chat;return e._rooms[t]?(e._entity.network.send("igeChatRoomRemoved",t),delete e._rooms[t],!0):!1},sendToRoom:function(t,e,i,n){var o=ige.chat;if(o._rooms[t]){var s,r=o._rooms[t];e!==void 0?(s={roomId:t,text:e,from:n,to:i},i?r.users.indexOf(i)>-1?o._entity.network.send("igeChatMsg",s,i):o.log("Cannot send to user because specified user is not in room: "+i):(o.log("Sending to all users..."),o._entity.network.send("igeChatMsg",s,r.users))):o.log("Cannot send message to room with blank message!")}else o.log('Cannot send message to room with id "'+t+'" because it does not exist!')},_onMessageFromClient:function(t,e){var i,n=ige.chat;n.emit("messageFromClient",[t,e])||(console.log("Message from client: ("+e+")",t),t.roomId?(i=n._rooms[t.roomId],i?i.users.indexOf(e)>-1?t.text?(console.log("Sending message to room..."),n.sendToRoom(t.roomId,t.text,t.to,e)):console.log("Cannot send message because message text is empty!",t):console.log("User tried to send message to room they are not joined in!",t):console.log("User tried to send message to room that doesn't exist!",t)):console.log("User tried to send message to room but didn't specify room id!",t))},_onJoinRoomRequestFromClient:function(t,e){var i=ige.chat;if(!i.emit("clientJoinRoomRequest",[t,e])){var n=i._rooms[t];i.log("Client wants to join room: ("+e+")",t),n&&(n.users[e]||(n.users.push(e),ige.network.send("igeChatJoinRoom",{roomId:t,joined:!0},e),console.log('User "'+e+'" joined room '+t)))}},_onLeaveRoomRequestFromClient:function(t,e){self.emit("clientLeaveRoomRequest",[t,e])||console.log("Client wants to leave room: ("+e+")",t)},_onClientWantsRoomList:function(t,e){self.emit("clientRoomListRequest",[t,e])||console.log("Client wants the room list: ("+e+")",t)},_onClientWantsRoomUserList:function(t,e){self.emit("clientRoomUserListRequest",[t,e])||console.log("Client wants the room user list: ("+e+")",t)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_33);var $i_34=$i_3.extend({classId:"$i_34",componentId:"chat",init:function(t,e){this._entity=t,this._options=e,this._rooms={},ige.isServer||(this.implement($i_32),this._entity.network.define("igeChatMsg",this._onMessageFromServer).network.define("igeChatJoinRoom",this._onJoinedRoom).network.define("igeChatLeaveRoom",this._onLeftRoom).network.define("igeChatRoomList",this._onServerSentRoomList).network.define("igeChatRoomUserList",this._onServerSentRoomUserList).network.define("igeChatRoomCreated",this._onRoomCreated).network.define("igeChatRoomRemoved",this._onRoomRemoved)),this.log("Chat component initiated!")}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_34);var $i_39=$i_3.extend({classId:"$i_39",componentId:"cocoonJs",init:function(){this.detected=typeof ext!="undefined"&&ext.IDTK_APP!==void 0,this.detected&&this.log("CocoonJS support enabled!")},showInputDialog:function(t,e,i,n,o,s){this.detected?(t=t||"",e=e||"",i=i||"",n=n||"text",o=o||"Cancel",s=s||"OK",ext.IDTK_APP.makeCall("showTextDialog",t,e,i,n,o,s)):this.log("Cannot open CocoonJS input dialog! CocoonJS is not detected!","error")},showWebView:function(t){this.detected&&(ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('loadPath', '"+t+"')"),ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('show');"))},hideWebView:function(){this.detected&&ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('hide');")}}),$i_40={translateBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._translate.x+=t,this._translate.y+=e,this._translate.z+=i):this.log("translateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translateTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._translate.x=t,this._translate.y=e,this._translate.z=i):this.log("translateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translate:function(){return this.x=this._translateAccessorX,this.y=this._translateAccessorY,this.z=this._translateAccessorZ,this._entity||this},_translateAccessorTween:function(t,e,i){return new $i_47(this._translate,t,e,i)},_translateAccessorX:function(t){return t!==void 0?(this._translate.x=t,this._entity||this):this._translate.x},_translateAccessorY:function(t){return t!==void 0?(this._translate.y=t,this._entity||this):this._translate.y},_translateAccessorZ:function(t){return t!==void 0?(this._translate.z=t,this._entity||this):this._translate.z},rotateBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._rotate.x+=t,this._rotate.y+=e,this._rotate.z+=i):this.log("rotateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotateTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._rotate.x=t,this._rotate.y=e,this._rotate.z=i):this.log("rotateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotate:function(){return this.x=this._rotateAccessorX,this.y=this._rotateAccessorY,this.z=this._rotateAccessorZ,this._entity||this},_rotateAccessorTween:function(t,e,i){return new $i_47(this._rotate,t,e,i)},_rotateAccessorX:function(t){return t!==void 0?(this._rotate.x=t,this._entity||this):this._rotate.x},_rotateAccessorY:function(t){return t!==void 0?(this._rotate.y=t,this._entity||this):this._rotate.y},_rotateAccessorZ:function(t){return t!==void 0?(this._rotate.z=t,this._entity||this):this._rotate.z},scaleBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._scale.x+=t,this._scale.y+=e,this._scale.z+=i):this.log("scaleBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scaleTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._scale.x=t,this._scale.y=e,this._scale.z=i):this.log("scaleTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scale:function(){return this.x=this._scaleAccessorX,this.y=this._scaleAccessorY,this.z=this._scaleAccessorZ,this._entity||this},_scaleAccessorTween:function(t,e,i){return new $i_47(this._scale,t,e,i)},_scaleAccessorX:function(t){return t!==void 0?(this._scale.x=t,this._entity||this):this._scale.x},_scaleAccessorY:function(t){return t!==void 0?(this._scale.y=t,this._entity||this):this._scale.y},_scaleAccessorZ:function(t){return t!==void 0?(this._scale.z=t,this._entity||this):this._scale.z},originBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._origin.x+=t,this._origin.y+=e,this._origin.z+=i):this.log("originBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},originTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._origin.x=t,this._origin.y=e,this._origin.z=i):this.log("originTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},origin:function(){return this.x=this._originAccessorX,this.y=this._originAccessorY,this.z=this._originAccessorZ,this._entity||this},_originAccessorTween:function(t,e,i){return new $i_47(this._origin,t,e,i)},_originAccessorX:function(t){return t!==void 0?(this._origin.x=t,this._entity||this):this._origin.x},_originAccessorY:function(t){return t!==void 0?(this._origin.y=t,this._entity||this):this._origin.y},_originAccessorZ:function(t){return t!==void 0?(this._origin.z=t,this._entity||this):this._origin.z},_rotatePoint:function(t,e,i){var n=Math.cos(e),o=Math.sin(e);return{x:i.x+(t.x-i.x)*n+(t.y-i.y)*o,y:i.y-(t.x-i.x)*o+(t.y-i.y)*n}},updateTransform:function(){if(this._localMatrix.identity(),this._mode===0&&this._localMatrix.multiply(this._localMatrix._newTranslate(this._translate.x,this._translate.y)),this._mode===1){var t=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this.geometry.z/2).toIso();this._parent&&this._parent.geometry.z&&(t.y+=this._parent.geometry.z/1.6),this._localMatrix.multiply(this._localMatrix._newTranslate(t.x,t.y))}this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z)),this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y)),this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_40);var $i_41={left:function(t){return t!==void 0?(this._uiX=t,this._uiXAlign="left",this._updateUiPosition(),this):this._uiX},center:function(t){return t!==void 0?(this._uiX=t,this._uiXAlign="center",this._updateUiPosition(),this):this._uiX},right:function(t){return t!==void 0?(this._uiX=t,this._uiXAlign="right",this._updateUiPosition(),this):this._uiX},top:function(t){return t!==void 0?(this._uiY=t,this._uiYAlign="top",this._updateUiPosition(),this):this._uiY},middle:function(t){return t!==void 0?(this._uiY=t,this._uiYAlign="middle",this._updateUiPosition(),this):this._uiY},bottom:function(t){return t!==void 0?(this._uiY=t,this._uiYAlign="bottom",this._updateUiPosition(),this):this._uiY},width:function(t,e,i){if(t!==void 0){if(this._width=t,this._widthModifier=e!==void 0?e:0,typeof t=="string")if(this._parent){var n=this._parent.geometry.x,o=parseInt(t,10);this.geometry.x=n/100*o+this._widthModifier|0,this.geometry.x2=Math.floor(this.geometry.x/2)}else{var n=ige.geometry.x,o=parseInt(t,10);this.geometry.x=n/100*o+this._widthModifier|0,this.geometry.x2=Math.floor(this.geometry.x/2)}else this.geometry.x=t,this.geometry.x2=Math.floor(this.geometry.x/2);return i||this._updateUiPosition(),this}return this._width},height:function(t,e,i){if(t!==void 0){if(this._height=t,this._heightModifier=e!==void 0?e:0,typeof t=="string")if(this._parent){var n=this._parent.geometry.y,o=parseInt(t,10);this.geometry.y=n/100*o+this._heightModifier|0,this.geometry.y2=Math.floor(this.geometry.y/2)}else{var n=ige.geometry.y,o=parseInt(t,10);this.geometry.y=n/100*o+this._heightModifier|0,this.geometry.y2=Math.floor(this.geometry.y/2)}else this.geometry.y=t,this.geometry.y2=Math.floor(this.geometry.y/2);return i||this._updateUiPosition(),this}return this._height},_updateUiPosition:function(){if(this._parent){var t=this._parent.geometry,e=this.geometry;this._width&&this.width(this._width,this._widthModifier,!0),this._height&&this.height(this._height,this._heightModifier,!0),this._uiXAlign==="right"?this._translate.x=Math.floor(t.x2-e.x2-this._uiX):this._uiXAlign==="center"?this._translate.x=Math.floor(this._uiX):this._uiXAlign==="left"&&(this._translate.x=Math.floor(this._uiX+e.x2-t.x2)),this._uiYAlign==="bottom"?this._translate.y=Math.floor(t.y2-e.y2-this._uiY):this._uiYAlign==="middle"?this._translate.y=Math.floor(this._uiY):this._uiYAlign==="top"&&(this._translate.y=Math.floor(this._uiY+e.y2-t.y2)),this.dirty(!0)}}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_41);var $i_42={backgroundImage:function(t,e){if(t&&t.image){if(e||(e="no-repeat"),this._patternRepeat=e,this._patternTexture=t,this._backgroundSize?(t.resize(this._backgroundSize.x,this._backgroundSize.y),this._patternWidth=this._backgroundSize.x,this._patternHeight=this._backgroundSize.y):(this._patternWidth=t.image.width,this._patternHeight=t.image.height),this._cell>1){var i=document.createElement("canvas"),n=i.getContext("2d"),o=t._cells[this._cell];i.width=o[2],i.height=o[3],n.drawImage(t.image,o[0],o[1],o[2],o[3],0,0,o[2],o[3]),this._patternFill=ige._ctx.createPattern(i,e)}else this._patternFill=ige._ctx.createPattern(t.image,e);return t.restoreOriginal(),this.dirty(!0),this}return this._patternFill},backgroundSize:function(t,e){return t!==void 0&&e!==void 0?(typeof t=="string"&&(t=this.geometry.x/100*parseInt(t,10)),typeof e=="string"&&(e=this.geometry.y/100*parseInt(e,10)),this._backgroundSize={x:t,y:e},this._patternTexture&&this._patternRepeat&&this.backgroundImage(this._patternTexture,this._patternRepeat),this.dirty(!0),this):this._backgroundSize},backgroundColor:function(t){return t!==void 0?(this._backgroundColor=t,this.dirty(!0),this):this._backgroundColor},backgroundPosition:function(t,e){return t!==void 0&&e!==void 0?(this._backgroundPosition={x:t,y:e},this.dirty(!0),this):this._backgroundPosition},borderColor:function(t){return t!==void 0?(this._borderColor=t,this._borderLeftColor=t,this._borderTopColor=t,this._borderRightColor=t,this._borderBottomColor=t,this.dirty(!0),this):this._borderColor},borderLeftColor:function(t){return t!==void 0?(this._borderLeftColor=t,this.dirty(!0),this):this._borderLeftColor},borderTopColor:function(t){return t!==void 0?(this._borderTopColor=t,this.dirty(!0),this):this._borderTopColor},borderRightColor:function(t){return t!==void 0?(this._borderRightColor=t,this.dirty(!0),this):this._borderRightColor},borderBottomColor:function(t){return t!==void 0?(this._borderBottomColor=t,this.dirty(!0),this):this._borderBottomColor},borderWidth:function(t){return t!==void 0?(this._borderWidth=t,this._borderLeftWidth=t,this._borderTopWidth=t,this._borderRightWidth=t,this._borderBottomWidth=t,this.dirty(!0),this):this._borderWidth},borderLeftWidth:function(t){return t!==void 0?(this._borderLeftWidth=t,this.dirty(!0),this):this._borderLeftWidth},borderTopWidth:function(t){return t!==void 0?(this._borderTopWidth=t,this.dirty(!0),this):this._borderTopWidth},borderRightWidth:function(t){return t!==void 0?(this._borderRightWidth=t,this.dirty(!0),this):this._borderRightWidth},borderBottomWidth:function(t){return t!==void 0?(this._borderBottomWidth=t,this.dirty(!0),this):this._borderBottomWidth},borderRadius:function(t){return t!==void 0?(this._borderRadius=t,this._borderTopLeftRadius=t,this._borderTopRightRadius=t,this._borderBottomRightRadius=t,this._borderBottomLeftRadius=t,this.dirty(!0),this):this._borderRadius},padding:function(t,e,i,n){return this._paddingLeft=t,this._paddingTop=e,this._paddingRight=i,this._paddingBottom=n,this.dirty(!0),this},paddingLeft:function(t){return t!==void 0?(this._paddingLeft=t,this.dirty(!0),this):this._paddingLeft},paddingTop:function(t){return t!==void 0?(this._paddingTop=t,this.dirty(!0),this):this._paddingTop
},paddingRight:function(t){return t!==void 0?(this._paddingRight=t,this.dirty(!0),this):this._paddingRight},paddingBottom:function(t){return t!==void 0?(this._paddingBottom=t,this.dirty(!0),this):this._paddingBottom}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_42);var $i_43={mouseMove:function(t){return t?(this._mouseMove=t,this._mouseEventsActive=!0,this):this._mouseMove},mouseMoveOff:function(){delete this._mouseMove},mouseOver:function(t){return t?(this._mouseOver=t,this._mouseEventsActive=!0,this):this._mouseOver},mouseOverOff:function(){delete this._mouseOver},mouseOut:function(t){return t?(this._mouseOut=t,this._mouseEventsActive=!0,this):this._mouseOut},mouseOutOff:function(){delete this._mouseOut},mouseUp:function(t){return t?(this._mouseUp=t,this._mouseEventsActive=!0,this):this._mouseUp},mouseUpOff:function(){delete this._mouseUp},mouseDown:function(t){return t?(this._mouseDown=t,this._mouseEventsActive=!0,this):this._mouseDown},mouseDownOff:function(){delete this._mouseDown},_handleMouseIn:function(t){this._mouseStateOver||(this._mouseStateOver=!0,this._mouseOver&&this._mouseOver(t)),this._mouseMove&&this._mouseMove(t)},_handleMouseOut:function(t){this._mouseStateDown=!1,this._mouseStateOver&&(this._mouseStateOver=!1,this._mouseOut&&this._mouseOut(t))},_handleMouseUp:function(t){this._mouseStateDown=!1,this._mouseUp&&this._mouseUp(t)},_handleMouseDown:function(t){this._mouseStateDown||(this._mouseStateDown=!0,this._mouseDown&&this._mouseDown(t))}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_43);var nullMethod=function(){},$i_44={dummy:!0,save:nullMethod,restore:nullMethod,translate:nullMethod,rotate:nullMethod,scale:nullMethod,drawImage:nullMethod,fillRect:nullMethod,strokeRect:nullMethod,stroke:nullMethod,fill:nullMethod,rect:nullMethod,moveTo:nullMethod,lineTo:nullMethod,arc:nullMethod,clearRect:nullMethod,beginPath:nullMethod,clip:nullMethod,transform:nullMethod,setTransform:nullMethod,fillText:nullMethod};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_44);var $i_47=$i_2.extend({classId:"$i_47",init:function(t,e,i,n){this._targetObj=t,this._propertyObj=e!==void 0?e:{},this._durationMs=i!==void 0?i:0,this._started=!1,n&&n.easing?this.easing(n.easing):this.easing("none"),n&&n.startTime!==void 0&&this.startTime(n.startTime),n&&n.beforeTween!==void 0&&this.beforeTween(n.beforeTween),n&&n.afterTween!==void 0&&this.afterTween(n.afterTween)},targetObj:function(t){return t!==void 0&&(this._targetObj=t),this},properties:function(t){return t!==void 0&&(this._propertyObj=t),this},duration:function(t){return t!==void 0&&(this._durationMs=t),this},beforeTween:function(t){return t!==void 0&&(this._beforeTween=t),this},afterTween:function(t){return t!==void 0&&(this._afterTween=t),this},easing:function(t){return t!==void 0&&(this._easing=t),this},startTime:function(t){return t!==void 0&&(this._startTime=t),this},start:function(){return ige.tween.start(this),this._targetObj._tweenArr=this._targetObj._tweenArr||[],this._targetObj._tweenArr.push(this),this},stop:function(){return ige.tween.stop(this),this._targetObj._tweenArr.pull(this),this},startAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(t){t.start()}),this},stopAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(t){t.stop()}),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_47);var $i_48=$i_3.extend({classId:"$i_48",$i_48:!0,init:function(t){this._cells=[],t&&this.url(t)},id:function(t){if(t!==void 0){if(!ige._register[t])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=t,ige.register(this),this;this.log('Cannot set ID of object to "'+t+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=ige.newIdHex(),ige.register(this)),this._id},url:function(t){return t!==void 0?(this._url=t,t.substr(t.length-2,2)==="js"?this._loadScript(t):this._loadImage(t),this):this._url},_loadImage:function(t){var e,i=this;ige.isServer||(ige.textureLoadStart(t,this),ige._textureImageStore[t]?(e=this.image=this._originalImage=ige._textureImageStore[t],e._igeTextures.push(this),e._loaded&&(i._mode=0,i.sizeX(e.width),i.sizeY(e.height),i._cells[1]=[0,0,i._sizeX,i._sizeY],i._loaded=!0,setTimeout(function(){i.emit("loaded"),ige.textureLoadEnd(t,i)},1))):(e=ige._textureImageStore[t]=this.image=this._originalImage=new Image,e._igeTextures=e._igeTextures||[],e._igeTextures.push(this),e.onload=function(){this._loaded=!0,ige.log('Texture image "'+t+'" loaded successfully');var n,o,s=this._igeTextures,r=s.length;for(n=0;r>n;n++)o=s[n],o._mode=0,o.sizeX(e.width),o.sizeY(e.height),o._cells[1]=[0,0,o._sizeX,o._sizeY],o._loaded=!0,o.emit("loaded"),ige.textureLoadEnd(t,i)},e.src=t))},_loadScript:function(scriptUrl){var textures=ige.textures,rs_sandboxContext,self=this,scriptElem;ige.textureLoadStart(scriptUrl,this),ige.isServer||(scriptElem=document.createElement("script"),scriptElem.onload=function(data){self.log('Texture script "'+scriptUrl+'" loaded successfully'),eval(data),self._mode=1,self.script=image,typeof image.init=="function"&&image.init.apply(image,[self]),self._loaded=!0,self.emit("loaded"),ige.textureLoadEnd(scriptUrl,self)},scriptElem.addEventListener("error",function(){self.log("Error loading smart texture script file: "+scriptUrl,"error")},!0),scriptElem.src=scriptUrl,document.getElementsByTagName("head")[0].appendChild(scriptElem)),ige.isServer&&(rs_sandboxContext={},textures.fs.readFile(scriptUrl,this.bind(function(t,e){try{if(textures.vm.runInNewContext(e,rs_sandboxContext),typeof rs_sandboxContext.image=="object"){this.log('Texture script "'+scriptUrl+'" loaded successfully');var i=rs_sandboxContext.image;typeof i.init=="function"&&i.init.apply(i,[ige,this]),this.sizeX(i.width),this.sizeY(i.height),this._loaded=!0,self.emit("loaded"),ige.textureLoadEnd(scriptUrl,self)}else this.log("Error reading asset render script data. The script does not contain an image variable!","error",[this.url,rs_sandboxContext])}catch(n){this.log("Error executing asset render script: ","error",[n,this.url])}})))},sizeX:function(t){this._sizeX=t},sizeY:function(t){this._sizeY=t},resize:function(t,e,i){this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas")),this._textureCanvas.width=t,this._textureCanvas.height=e,this._textureCtx=this._textureCanvas.getContext("2d"),i||this._textureCtx.drawImage(this._originalImage,0,0,this._originalImage.width,this._originalImage.height,0,0,t,e),this.image=this._textureCanvas)},restoreOriginal:function(){this.image=this._originalImage,delete this._textureCtx,delete this._textureCanvas},smoothing:function(t){return t!==void 0?(this._smoothing=t,this):this._smoothing},render:function(t,e){if(e._cell!==null){if(this._smoothing?(ige._ctx.imageSmoothingEnabled=!0,ige._ctx.webkitImageSmoothingEnabled=!0,ige._ctx.mozImageSmoothingEnabled=!0):(ige._ctx.imageSmoothingEnabled=!1,ige._ctx.webkitImageSmoothingEnabled=!1,ige._ctx.mozImageSmoothingEnabled=!1),this._mode===0){var i=this._cells[e._cell],n=e.geometry,o=e._renderPos;i?(this._preFilter&&this._textureCtx&&(this._textureCtx.save(),this._preFilter(this._textureCanvas,this._textureCtx,this._originalImage,this,this._preFilterData),this._textureCtx.restore()),t.drawImage(this.image,i[0],i[1],i[2],i[3],o.x,o.y,n.x,n.y),ige._drawCount++):this.log("Cannot render texture using cell "+e._cell+" because the cell does not exist in the assigned texture!","error")}this._mode===1&&(t.save(),this.script.render(t,e,this),t.restore(),ige._drawCount++)}},preFilter:function(t,e){return t!==void 0?(this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d")),this.image=this._textureCanvas,this._preFilter=t,this._preFilterData=e),this):(this.log("Cannot use pre-filter, no filter method was passed!","warning"),this._preFilter)},applyFilter:function(t,e){return t!==void 0?this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d")),this.image=this._textureCanvas,this._textureCtx.save(),t(this._textureCanvas,this._textureCtx,this._originalImage,this,e),this._textureCtx.restore()):this.log("Cannot apply filter, no filter method was passed!","warning"),this},stringify:function(){var t="new "+this.classId()+"('"+this._url+"')";return t+=".id('"+this.id()+"')",t+=this._stringify()},destroy:function(){delete this._eventListeners,this.image&&this.image._igeTextures&&this.image._igeTextures.pull(this),ige.TextureStore.pull(this),delete this.image,delete this.script,delete this._textureCanvas,delete this._textureCtx,this._destroyed=!0}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_48);var $i_50=$i_48.extend({classId:"$i_50",$i_50:!0,init:function(t,e){var i=this;this.on("loaded",function(){if(i.image){i._sheetImage=this.image;var t;for(t=0;e.length>t;t++)i._cells[t+1]=e[t]}else i.log("Cannot create cell-sheet because texture has not loaded an image!","error")}),this._super(t)},cellCount:function(){return this._cells.length},cellIdToIndex:function(t){var e,i=this._cells;for(e=1;i.length>e;e++)if(i[e][4]===t)return e;return-1},stringify:function(){var t="new "+this.classId()+"('"+this.url()+"', "+(this._cells+"")+")";return t+=".id('"+this.id()+"');"}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_50);var $i_52=$i_3.extend({classId:"$i_52",init:function(){this._alive=!0,this._mode=0,this._mountMode=0,this._parent=null,this._children=[],this._layer=0,this._depth=0,this._dirty=!0,this._depthSortMode=0,this._timeStream=[],this._inView=!0},alive:function(t){return t!==void 0?(this._alive=t,this):this._alive},id:function(t){if(t!==void 0){if(t===this._id)return this;if(!ige._register[t])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=t,ige.register(this),this;ige._register[t]!==this&&this.log('Cannot set ID of object to "'+t+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=ige.newIdHex(),ige.register(this)),this._id},group:function(t){return t!==void 0?(this._group=t,this):this._group},addBehaviour:function(t,e){if(typeof t=="string"){if(typeof e=="function")return this._behaviours=this._behaviours||[],this._behaviours.push({id:t,method:e}),this;this.log("The behaviour you passed is not a function! The second parameter of the call must be a function!","error")}else this.log("Cannot add behaviour to object because the specified behaviour id is not a string. You must provide two parameters with the addBehaviour() call, an id:String and a behaviour:Function. Adding a behaviour with an id allows you to remove it by it's id at a later stage!","error");return!1},removeBehaviour:function(t){if(t!==void 0){var e,i=this._behaviours;if(i){e=i.length;while(e--)if(i[e].id===t)return i.splice(e,1),this}}return!1},drawBounds:function(t){return t!==void 0?(this._drawBounds=t,this):this._drawBounds},drawBoundsData:function(t){return t!==void 0?(this._drawBoundsData=t,this):this._drawBoundsData},drawMouse:function(t){return t!==void 0?(this._drawMouse=t,this):this._drawMouse},parent:function(){return this._parent},children:function(){return this._children},mount:function(t){if(t){if(t._children){if(this.id(),this._parent){if(this._parent===t)return this;this.unMount()}return this._parent=t,t._children.push(this),this._parent._childMounted(this),this.emit("mounted",this._parent),this}return!1}this.log("Cannot mount non-existent object!","error")},unMount:function(){if(this._parent){var t=this._parent._children,e=t.indexOf(this);return e>-1?(t.splice(e,1),this._parent._childUnMounted(this),this._parent=null,this):!1}return!1},clone:function(){},mode:function(t){return t!==void 0?(this._mode=t,this):this._mode},isometric:function(t){return t===!0?(this._mode=1,this):t===!1?(this._mode=0,this):this._mode===1},isometricMounts:function(t){return t===!0?(this._mountMode=1,this):t===!1?(this._mountMode=0,this):this._mountMode===1},indestructible:function(t){return t!==void 0?(this._indestructible=t,this):this._indestructible},layer:function(t){return t!==void 0?(this._layer=t,this):this._layer},depth:function(t){return t!==void 0?(this._depth=t,this):this._depth},destroyChildren:function(){var t,e=this._children;if(e){t=e.length;while(t--)e[t].destroy()}return delete this._children,this},destroyBehaviours:function(){delete this._behaviours},destroyComponents:function(){var t,e=this._components;if(e){t=e.length;while(t--)e[t].destroy&&e[t].destroy()}return delete this._components,this},dirty:function(t){return t!==void 0?(this._dirty=t,this._parent&&this._parent.dirty(t),this):this._dirty},depthSortMode:function(t){return t!==void 0?(this._depthSortMode=t,this):this._depthSortMode},depthSortChildren:function(){var t,e,i,n,o=this._children;if(o&&(t=o.length,t>1))if(this._mountMode===1){if(this._depthSortMode===0){for(e={adj:[],c:[],p:[],order:[],order_ind:t-1},i=0;t>i;++i)for(e.c[i]=0,e.p[i]=-1,n=i+1;t>n;++n)e.adj[i]=e.adj[i]||[],e.adj[n]=e.adj[n]||[],o[i]._inView&&o[n]._inView&&o[i]._projectionOverlap&&o[n]._projectionOverlap&&o[i]._projectionOverlap(o[n])&&(o[i].isBehind(o[n])?e.adj[n].push(i):e.adj[i].push(n));for(i=0;t>i;++i)e.c[i]===0&&this._depthSortVisit(i,e);for(i=0;e.order.length>i;i++)o[e.order[i]].depth(i);this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?e._depth-t._depth:i})}if(this._depthSortMode===1&&this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?t.isBehind(e)?-1:1:i}),this._depthSortMode===2){while(t--)e=o[t],n=e._translate,n&&(e._depth=n.x+n.y+n.z);this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?e._depth-t._depth:i})}}else this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?e._depth-t._depth:i})},viewChecking:function(t){return t!==void 0?(this._viewChecking=t,this):this._viewChecking},viewCheckChildren:function(){var t,e=this._children,i=e.length,n=ige._currentViewport.viewArea();while(i--)t=e[i],t._inView=t._alwaysInView?!0:t.aabb?n.rectIntersect(t.aabb())?!0:!1:!1},tick:function(t){var e,i,n,o,s,r=this._children;if(this._viewChecking&&this.viewCheckChildren(),r)if(e=r.length,o=e,e&&!ige._headless&&(igeDebug.timing?(ige._tslt[this.id()]||(ige._tslt[this.id()]={}),i=(new Date).getTime(),this.depthSortChildren(),n=(new Date).getTime()-i,ige._tslt[this.id()].depthSortChildren=n):this.depthSortChildren()),s=e,igeDebug.timing)while(e--)t.save(),i=(new Date).getTime(),r[e].tick(t),n=(new Date).getTime()-i,r[e]&&(ige._tsit[r[e].id()]||(ige._tsit[r[e].id()]=0),ige._tslt[r[e].id()]||(ige._tslt[r[e].id()]={}),ige._tsit[r[e].id()]+=n,ige._tslt[r[e].id()].tick=n),t.restore();else while(e--)t.save(),r[e].tick(t),t.restore()},_depthSortVisit:function(t,e){var i,n,o=e.adj[t],s=o.length;for(e.c[t]=1,i=0;s>i;++i)n=o[i],e.c[n]===0&&(e.p[n]=t,this._depthSortVisit(n,e));e.c[t]=2,e.order[e.order_ind]=t,--e.order_ind},_resizeEvent:function(t){var e,i=this._children;if(i){e=i.length;while(e--)i[e]._resizeEvent(t)}},_processBehaviours:function(){if(ige._frameAlternator!==this._behaviourFA){var t,e=this._behaviours;if(e){t=e.length;while(t--)e[t].method.apply(this,arguments);this._behaviourFA=ige._frameAlternator}}},_childMounted:function(){this._resizeEvent(null)},_childUnMounted:function(){},destroy:function(){return this.unMount(),this._children&&this.destroyChildren(),this.destroyComponents(),this.destroyBehaviours(),ige.unRegister(this),this._alive=!1,delete this._eventListeners,this},stringify:function(){var t="new "+this.classId()+"()";return t+=".id('"+this.id()+"')",this.parent()&&(t+=".mount(ige.$('"+this.parent().id()+"'))"),t+=this._stringify()},_stringify:function(){var t,e="";for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_group":e+=".group('"+this.group()+"')";break;case"_drawBounds":e+=".drawBounds('"+this.drawBounds()+"')";break;case"_drawBoundsData":e+=".drawBoundsData('"+this.drawBoundsData()+"')";break;case"_drawMouse":e+=".drawMouse('"+this.drawMouse()+"')";break;case"_mode":e+=".mode('"+this.mode()+"')";break;case"_isometricMounts":e+=".isometricMounts('"+this.isometricMounts()+"')";break;case"_indestructible":e+=".indestructible('"+this.indestructible()+"')";break;case"_layer":e+=".layer('"+this.layer()+"')";break;case"_depth":e+=".depth('"+this.depth()+"')"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_52);var $i_53=$i_52.extend([{extension:$i_40,overwrite:!1},{extension:$i_43,overwrite:!0}],{classId:"$i_53",init:function(){this._super(),this._width=void 0,this._height=void 0,this._anchor=new $i_5(0,0,0),this._renderPos={x:0,y:0},this._opacity=1,this._cell=1,this._deathTime=void 0,this._oldTranslate=new $i_5(0,0,0),this._translate=new $i_5(0,0,0),this._rotate=new $i_5(0,0,0),this._scale=new $i_5(1,1,1),this._origin=new $i_5(.5,.5,.5),this.geometry=new $i_5(40,40,40),this._highlight=!1,this._mouseEventsActive=!1,this._localMatrix=new $i_8(this),this._worldMatrix=new $i_8(this),this._inView=!0,this.streamSections(["transform"])},mousePos:function(){var t;if(this._parent){if(this._parent.mousePos)return t=this._parent.mousePos(),new $i_5(t.x-this._translate.x,t.y-this._translate.y,0);throw"What happened? This code path should never be reached!"}return new $i_5(0,0,0)},translateToTile:function(t,e,i){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var n;n=i!==void 0?i*this._parent._tileWidth:this._translate.z,this.translateTo(t*this._parent._tileWidth,e*this._parent._tileHeight,n)}else this.log("Cannot translate to tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},widthByTile:function(t,e){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var i,n=this._mode===0?this._parent._tileWidth:this._parent._tileWidth*2;this.width(t*n),e&&(this._texture?(i=this._texture._sizeX/this.geometry.x,this.height(this._texture._sizeY/i)):this.log("Cannot set height based on texture aspect ratio and new width because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set width by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},heightByTile:function(t,e){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var i,n=this._mode===0?this._parent._tileHeight:this._parent._tileHeight*2;this.height(t*n),e&&(this._texture?(i=this._texture._sizeY/this.geometry.y,this.width(this._texture._sizeX/i)):this.log("Cannot set width based on texture aspect ratio and new height because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set height by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},occupyTile:function(){this.log("Cannot occupy a tile because the entity is not currently mounted to a tile sheet.","warning")},overTiles:function(){this.log("Cannot determine which tiles this entity lies over because the entity is not currently mounted to a tile sheet.","warning")},anchor:function(t,e){return t!==void 0&&e!==void 0?(this._anchor=new $i_5(t,e,0),this):this._anchor},width:function(t){return t!==void 0?(this._width=t,this.geometry.x=t,this.geometry.x2=t/2,this):this._width},height:function(t){return t!==void 0?(this._height=t,this.geometry.y=t,this.geometry.y2=t/2,this):this._height},size3d:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this.geometry=new $i_5(t,e,i),this):this.geometry},lifeSpan:function(t){return t!==void 0?(this.deathTime((new Date).getTime()+t),this):this.deathTime()-(new Date).getTime()},deathTime:function(t){return t!==void 0?(this._deathTime=t,this):this._deathTime},opacity:function(t){return t!==void 0?(this._opacity=t,this):this._opacity},texture:function(t){return t!==void 0?(this._texture=t,this):this._texture},cell:function(t){return t>0||t===null?(this._cell=t,this):this._cell},cellById:function(t){if(t!==void 0)if(this._texture){var e,i=this._texture,n=i._cells;for(e=1;n.length>e;e++)if(n[e][4]===t)return this.cell(e),this;this.log('Could not find the cell id "'+t+'" in the assigned entity texture '+i.id()+', please check your sprite sheet (texture) cell definition to ensure the cell id "'+t+'" has been assigned to a cell!',"error")}else this.log("Cannot assign cell index from cell ID until an $i_50 has been set as the texture for this entity. Please set the texture before calling cellById().","error");return this._cell},dimensionsFromTexture:function(){return this._texture&&(this.width(this._texture._sizeX),this.height(this._texture._sizeY)),this},dimensionsFromCell:function(){return this._texture&&(this.width(this._texture._cells[this._cell][2]),this.height(this._texture._cells[this._cell][3])),this},highlight:function(t){return t!==void 0?(this._highlight=t,this):this._highlight},localToWorld:function(t){this._worldMatrix.transform(t)},aabb:function(t){if(t||!this._aabb){var e,i,n,o,s,r,a,h,u,d=new $i_6,l=new $i_7(0,0,0,0),c=this._anchor,_=this.geometry,g=_.x,m=_.y,f=_.z,p=_.x2,y=_.y2,v=(_.z2,this._origin),x=v.x-.5,w=v.y-.5,b=v.z-.5;return this._mode===0&&(s=p+c.x,r=y+c.y,a=g*x,h=m*w,d.addPoint(-s+a,-r+h),d.addPoint(s+a,-r+h),d.addPoint(s+a,r+h),d.addPoint(-s+a,r+h),this._renderPos={x:-s+a,y:-r+h},this.localToWorld(d._poly),e=Math.min(d._poly[0].x,d._poly[1].x,d._poly[2].x,d._poly[3].x),i=Math.min(d._poly[0].y,d._poly[1].y,d._poly[2].y,d._poly[3].y),n=Math.max(d._poly[0].x,d._poly[1].x,d._poly[2].x,d._poly[3].x),o=Math.max(d._poly[0].y,d._poly[1].y,d._poly[2].y,d._poly[3].y),l.x=e,l.y=i,l.width=n-e,l.height=o-i),this._mode===1&&(u=new $i_5(-(_.x/2),-(_.y/2),_.z/2).toIso(),s=u.x+_.x+c.x,r=u.y+c.y,a=g*x,h=f*b,d.addPoint(-s+a,-r+h),d.addPoint(s+a,-r+h),d.addPoint(s+a,r+h),d.addPoint(-s+a,r+h),this._renderPos={x:-s+a,y:-r+h},this.localToWorld(d._poly),e=Math.min(d._poly[0].x,d._poly[1].x,d._poly[2].x,d._poly[3].x),i=Math.min(d._poly[0].y,d._poly[1].y,d._poly[2].y,d._poly[3].y),n=Math.max(d._poly[0].x,d._poly[1].x,d._poly[2].x,d._poly[3].x),o=Math.max(d._poly[0].y,d._poly[1].y,d._poly[2].y,d._poly[3].y),l.x=e,l.y=i,l.width=n-e,l.height=o-i),this._aabb=l,l}return this._aabb},_swapVars:function(t,e){return[e,t]},_internalsOverlap:function(t,e,i,n){var o;return t>e&&(o=this._swapVars(t,e),t=o[0],e=o[1]),i>n&&(o=this._swapVars(i,n),i=o[0],n=o[1]),t>i&&(o=this._swapVars(t,i),t=o[0],i=o[1],o=this._swapVars(e,n),e=o[0],n=o[1]),e>i},_projectionOverlap:function(t){var e=this.geometry,i=new $i_5(this._translate.x-e.x/2,this._translate.y-e.y/2,this._translate.z-e.z),n=new $i_5(this._translate.x+e.x/2,this._translate.y+e.y/2,this._translate.z+e.z),o=t.geometry,s=new $i_5(t._translate.x-o.x/2,t._translate.y-o.y/2,t._translate.z-o.z),r=new $i_5(t._translate.x+o.x/2,t._translate.y+o.y/2,t._translate.z+o.z);return this._internalsOverlap(i.x-n.y,n.x-i.y,s.x-r.y,r.x-s.y)&&this._internalsOverlap(i.x-n.z,n.x-i.z,s.x-r.z,r.x-s.z)&&this._internalsOverlap(i.z-n.y,n.z-i.y,s.z-r.y,r.z-s.y)},isBehind:function(t){var e=this.geometry,i=new $i_5(this._translate.x-e.x/2,this._translate.y-e.y/2,this._translate.z),n=new $i_5(this._translate.x+e.x/2,this._translate.y+e.y/2,this._translate.z+e.z),o=t.geometry,s=new $i_5(t._translate.x-o.x/2,t._translate.y-o.y/2,t._translate.z),r=new $i_5(t._translate.x+o.x/2,t._translate.y+o.y/2,t._translate.z+o.z);return n.x>s.x?r.x>i.x?n.y>s.y?r.y>i.y?n.z>s.z?r.z>i.z?this._translate.x+this._translate.y+this._translate.z>t._translate.x+t._translate.y+t._translate.z:!0:!1:!0:!1:!0:!1},mouseEventsActive:function(t){return t!==void 0?(this._mouseEventsActive=t,this):this._mouseEventsActive},tick:function(t,e){if(this._deathTime===void 0||ige.tickStart<this._deathTime){if(delete this._streamDataCache,this._processBehaviours(t),this._timeStream.length&&this._processInterpolate(ige.tickStart-ige.network.stream._renderLatency),this._inView&&(!this._parent||this._parent._inView)){var i,n,o,s,r=(ige._renderMode,this);this._mouseEventsActive&&(i=ige._currentViewport._mousePos,i&&(n=this.aabb(),o=i.x,s=i.y,n&&o>=n.x&&s>=n.y&&n.x+n.width>o&&n.y+n.height>s?ige.input.queueEvent(this,this._mouseInAabb):ige.input.mouseMove&&r._handleMouseOut(ige.input.mouseMove))),e||this._transformContext(t),this._renderEntity(t,e),this._streamMode===1&&this.streamSync()}this._super(t),this._oldTranslate=this._translate.clone()}else this.destroy()},_renderEntity:function(t){var e=this._texture;this._opacity>0&&e&&(e.render(t,this,ige.tickDelta),this._highlight&&(t.globalCompositeOperation="lighter",e.render(t,this)))},_transformContext:function(t){this.updateTransform(),this.aabb(!0),t.globalAlpha=this._parent?this._parent._opacity*this._opacity:this._opacity,this._localMatrix.transformRenderingContext(t)},_transformPoint:function(t){if(this._parent){var e=new $i_8;e.copy(this._parent._worldMatrix),e.multiply(this._localMatrix),e.transformCoord(t)}else this._localMatrix.transformCoord(t);return t},_mouseInAabb:function(t){ige.input.mouseMove&&this._handleMouseIn(ige.input.mouseMove,t),ige.input.mouseDown&&this._handleMouseDown(ige.input.mouseDown,t),ige.input.mouseUp&&this._handleMouseUp(ige.input.mouseUp,t)},_stringify:function(){var t,e=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_opacity":e+=".opacity("+this.opacity()+")";break;case"_texture":e+=".texture(ige.$('"+this.texture().id()+"'))";break;case"_cell":e+=".cell("+this.cell()+")";break;case"_translate":e+=".translateTo("+this._translate.x+", "+this._translate.y+", "+this._translate.z+")";break;case"_rotate":e+=".rotateTo("+this._rotate.x+", "+this._rotate.y+", "+this._rotate.z+")";break;case"_scale":e+=".scaleTo("+this._scale.x+", "+this._scale.y+", "+this._scale.z+")";break;case"_origin":e+=".originTo("+this._origin.x+", "+this._origin.y+", "+this._origin.z+")";break;case"_anchor":e+=".anchor("+this._anchor.x+", "+this._anchor.y+")";break;case"_width":e+=typeof this.width()=="string"?".width('"+this.width()+"')":".width("+this.width()+")";break;case"_height":e+=typeof this.height()=="string"?".height('"+this.height()+"')":".height("+this.height()+")";break;case"geometry":e+=".size3d("+this.geometry.x+", "+this.geometry.y+", "+this.geometry.z+")";break;case"_deathTime":e+=".deathTime('"+this.deathTime()+"')";break;case"_highlight":e+=".highlight('"+this.highlight()+"')"}return e},destroy:function(){this._alive=!1,this.emit("destroyed",this),this._super()},streamSections:function(t){return t!==void 0?(this._streamSections=t,this):this._streamSections},streamSectionData:function(t,e,i){if(t==="transform"){if(!e)return this._translate.toString(this._streamFloatPrecision)+","+this._scale.toString(this._streamFloatPrecision)+","+this._rotate.toString(this._streamFloatPrecision)+",";var n=e.split(",");i?(n[0]&&(this._translate.x=parseFloat(n[0])),n[1]&&(this._translate.y=parseFloat(n[1])),n[2]&&(this._translate.z=parseFloat(n[2])),n[3]&&(this._scale.x=parseFloat(n[3])),n[4]&&(this._scale.y=parseFloat(n[4])),n[5]&&(this._scale.z=parseFloat(n[5])),n[6]&&(this._rotate.x=parseFloat(n[6])),n[7]&&(this._rotate.y=parseFloat(n[7])),n[8]&&(this._rotate.z=parseFloat(n[8]))):(n[0]&&(n[0]=parseFloat(n[0])),n[1]&&(n[1]=parseFloat(n[1])),n[2]&&(n[2]=parseFloat(n[2])),n[3]&&(n[3]=parseFloat(n[3])),n[4]&&(n[4]=parseFloat(n[4])),n[5]&&(n[5]=parseFloat(n[5])),n[6]&&(n[6]=parseFloat(n[6])),n[7]&&(n[7]=parseFloat(n[7])),n[8]&&(n[8]=parseFloat(n[8])),this._timeStream.push([ige.network.stream._streamDataTime+ige.network._latency,n]),this._timeStream.length>10&&this._timeStream.shift())}},interpolateValue:function(t,e,i,n,o){var s=e-t,r=o-i,a=n-i,h=a/r;return 0>h?h=0:h>1&&(h=1),s*h+t},_processInterpolate:function(t,e){e||(e=200);var i,n,o,s,r,a,h,u=this._timeStream,d=[],l=1;while(u[l]){if(u[l][0]>=t){i=u[l-1],n=u[l];break}l++}n||i?u.splice(0,l-1):u.length>2&&t>u[u.length-1][0]&&(i=u[u.length-2],n=u[u.length-1],u.shift(),this.emit("entityInterpolationLag")),n&&i&&(o=n[0]-i[0],s=t-i[0],r=s/o,0>r?r=0:r>1&&(r=1),a=i[1],h=n[1],d[0]=this.interpolateValue(a[0],h[0],i[0],t,n[0]),d[1]=this.interpolateValue(a[1],h[1],i[0],t,n[0]),d[2]=this.interpolateValue(a[2],h[2],i[0],t,n[0]),d[3]=this.interpolateValue(a[3],h[3],i[0],t,n[0]),d[4]=this.interpolateValue(a[4],h[4],i[0],t,n[0]),d[5]=this.interpolateValue(a[5],h[5],i[0],t,n[0]),d[6]=this.interpolateValue(a[6],h[6],i[0],t,n[0]),d[7]=this.interpolateValue(a[7],h[7],i[0],t,n[0]),d[8]=this.interpolateValue(a[8],h[8],i[0],t,n[0]),this.translateTo(parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2])),this.scaleTo(parseFloat(d[3]),parseFloat(d[4]),parseFloat(d[5])),this.rotateTo(parseFloat(d[6]),parseFloat(d[7]),parseFloat(d[8])),this._lastUpdate=(new Date).getTime())}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_53);var $i_62=$i_53.extend({classId:"$i_62",init:function(t){this._super(),this._trackRotateTarget=void 0,this._trackTranslateTarget=void 0,this._trackRotateSmoothing=void 0,this._trackTranslateSmoothing=void 0,this._entity=t},limit:function(t){return t!==void 0?(this._limit=t,this._entity):this._limit},panTo:function(t,e,i){return t!==void 0&&this._translate.tween().properties({x:t.x,y:t.y,z:t.z}).duration(e).easing(i).start(),this._entity},panBy:function(t,e,i){return t!==void 0&&this._translate.tween().properties({x:t.x+this._translate.x,y:t.y+this._translate.y,z:t.z+this._translate.z}).duration(e).easing(i).start(),this._entity},trackTranslate:function(t,e){return t!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking translation target "+t.id()),this._trackTranslateSmoothing=1>e?0:e,this._trackTranslateTarget=t,this._entity):this._trackTranslateTarget},trackTranslateSmoothing:function(t){return t!==void 0?(this._trackTranslateSmoothing=t,this):this._trackTranslateSmoothing},unTrackTranslate:function(){delete this._trackTranslateTarget},trackRotate:function(t,e){return t!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking rotation of target "+t.id()),this._trackRotateSmoothing=1>e?0:e,this._trackRotateTarget=t,this._entity):this._trackRotateTarget},trackRotateSmoothing:function(t){return t!==void 0?(this._trackRotateSmoothing=t,this):this._trackRotateSmoothing},unTrackRotate:function(){delete this._trackRotateTarget},lookAt:function(t){return t!==void 0&&(t.updateTransform(),this._translate.x=t._worldMatrix.matrix[2],this._translate.y=t._worldMatrix.matrix[5],this.updateTransform()),this},tick:function(t){if(this._trackTranslateTarget){var e,i,n,o,s=this._trackTranslateTarget,r=s._worldMatrix.matrix,a=r[2],h=r[5];this._trackTranslateSmoothing?(e=this._translate.x,i=this._translate.y,n=a-e,o=h-i,this._translate.x+=n/this._trackTranslateSmoothing,this._translate.y+=o/this._trackTranslateSmoothing):this.lookAt(this._trackTranslateTarget)}if(this._trackRotateTarget){var u,d,l=this._trackRotateTarget._parent!==void 0?this._trackRotateTarget._parent._rotate.z:0,c=-(l+this._trackRotateTarget._rotate.z);this._trackRotateSmoothing?(u=this._rotate.z,d=c-u,this._rotate.z+=d/this._trackRotateSmoothing):this._rotate.z=c}this.updateTransform(),this._localMatrix.transformRenderingContext(t)
},updateTransform:function(){if(this._localMatrix.identity(),this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z)),this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y)),this._mode===0&&this._localMatrix.multiply(this._localMatrix._newTranslate(-this._translate.x,-this._translate.y)),this._mode===1){var t=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this.geometry.z/2).toIso();this._parent&&this._parent.geometry.z&&(t.y+=this._parent.geometry.z/1.6),this._localMatrix.multiply(this._localMatrix._newTranslate(t.x,t.y))}this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix)},_stringify:function(){var t,e=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_trackTranslateTarget":e+=".trackTranslate(ige.$('"+this._trackTranslateTarget.id()+"'), "+this.trackTranslateSmoothing()+")";break;case"_trackRotateTarget":e+=".trackRotate(ige.$('"+this._trackRotateTarget.id()+"'), "+this.trackRotateSmoothing()+")"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_62);var $i_63=$i_53.extend([{extension:$i_42,overwrite:!0},{extension:$i_41,overwrite:!0}],{classId:"$i_63",init:function(t){this._alwaysInView=!0,this._super(),this._mousePos=new $i_5(0,0,0),this._overflow="",this._uiX=0,this._uiY=0,t===void 0&&(t={left:0,top:0,width:ige.geometry.x,height:ige.geometry.y,autoSize:!0}),this.geometry=new $i_5(t.width||250,t.height||150,0),this.camera=new $i_62(this),this.camera._entity=this},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},scene:function(t){return t!==void 0?(this._scene=t,this):this._scene},mousePos:function(){return this._mousePos},viewArea:function(){var t=this.aabb(),e=this.camera._translate;return new $i_7(t.x+e.x,t.y+e.y,t.width,t.height)},tick:function(t,e){if(this._scene&&(ige._currentCamera=this.camera,ige._currentViewport=this,this._scene._parent=this,this._super(t),t.translate(-(this.geometry.x*this._origin.x)|0,-(this.geometry.y*this._origin.y)|0),t.clearRect(0,0,this.geometry.x,this.geometry.y),(!ige.cocoonJs||ige.cocoonJs&&!ige.cocoonJs.detected)&&(t.beginPath(),t.rect(0,0,this.geometry.x,this.geometry.y),this._borderColor&&(t.strokeStyle=this._borderColor,t.stroke()),t.clip()),t.translate(this.geometry.x/2|0,this.geometry.y/2|0),this.camera.tick(t),t.save(),this._scene.tick(t,e),t.restore(),this._drawBounds&&t===ige._ctx&&this.drawAABBs(t,this._scene,0),this._drawMouse&&t===ige._ctx&&this._mousePos)){t.save(),t.scale(1/this.camera._scale.x,1/this.camera._scale.y);var i,n=Math.floor(this._mousePos.x*this.camera._scale.x),o=Math.floor(this._mousePos.y*this.camera._scale.y);t.fillStyle="#fc00ff",t.fillRect(n-5,o-5,10,10),i=t.measureText("Viewport "+this.id()+" :: "+n+", "+o),t.fillText("Viewport "+this.id()+" :: "+n+", "+o,n-i.width/2,o-15),t.restore()}},drawAABBs:function(t,e,i){var n,o,s,r,a,h,u,d,l,c,_,g,m,f,p,y,v,x,w,b=e._children;if(b){n=b.length;while(n--)o=b[n],i++,o._shouldRender!==!1&&(typeof o.aabb=="function"&&(s=o.aabb(),s&&((o._drawBounds||o._drawBounds===void 0)&&(t.strokeStyle="#00deff",t.strokeRect(s.x,s.y,s.width,s.height),o._parent&&o._parent._mountMode===1&&(t.save(),t.translate(s.x+s.width/2,s.y+s.height/2),a=o.geometry,h=new $i_5(-(a.x/2),0,0).toIso(),u=new $i_5(+(a.x/2),0,0).toIso(),d=new $i_5(0,-(a.y/2),0).toIso(),l=new $i_5(0,+(a.y/2),0).toIso(),c=new $i_5(0,0,-(a.z/2)).toIso(),_=new $i_5(0,0,+(a.z/2)).toIso(),g=new $i_5(-(a.x/2),-(a.y/2),-(a.z/2)).toIso(),m=new $i_5(+(a.x/2),-(a.y/2),-(a.z/2)).toIso(),f=new $i_5(+(a.x/2),+(a.y/2),-(a.z/2)).toIso(),p=new $i_5(-(a.x/2),+(a.y/2),-(a.z/2)).toIso(),y=new $i_5(-(a.x/2),-(a.y/2),a.z/2).toIso(),v=new $i_5(+(a.x/2),-(a.y/2),a.z/2).toIso(),x=new $i_5(+(a.x/2),+(a.y/2),a.z/2).toIso(),w=new $i_5(-(a.x/2),+(a.y/2),a.z/2).toIso(),r=t.globalAlpha,t.globalAlpha=1,t.strokeStyle="#ff0000",t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(u.x,u.y),t.stroke(),t.strokeStyle="#00ff00",t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(l.x,l.y),t.stroke(),t.strokeStyle="#fffc00",t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(_.x,_.y),t.stroke(),t.strokeStyle="#a200ff",t.globalAlpha=.6,t.fillStyle="#545454",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(p.x,p.y),t.lineTo(w.x,w.y),t.lineTo(x.x,x.y),t.lineTo(f.x,f.y),t.fill(),t.stroke(),t.fillStyle="#282828",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(m.x,m.y),t.lineTo(v.x,v.y),t.lineTo(x.x,x.y),t.lineTo(f.x,f.y),t.fill(),t.stroke(),t.fillStyle="#676767",t.beginPath(),t.moveTo(y.x,y.y),t.lineTo(v.x,v.y),t.lineTo(x.x,x.y),t.lineTo(w.x,w.y),t.lineTo(y.x,y.y),t.fill(),t.stroke(),t.globalAlpha=r,t.restore())),this._drawBoundsData&&(o._drawBounds||o._drawBoundsData===void 0)&&(t.globalAlpha=1,t.fillStyle="#f6ff00",t.fillText("ID: "+o.id()+" "+"("+o.classId()+") "+o.layer()+":"+o.depth().toFixed(0),s.x+s.width+3,s.y+10),t.fillText("X: "+o._translate.x.toFixed(2)+", "+"Y: "+o._translate.y.toFixed(2)+", "+"Z: "+o._translate.z.toFixed(2),s.x+s.width+3,s.y+20)))),this.drawAABBs(t,o,i))}},_resizeEvent:function(t){this._autoSize&&this._parent&&(this.geometry=this._parent.geometry.clone()),this._updateUiPosition(),this._scene&&this._scene._resizeEvent(t)},_stringify:function(){var t,e=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_autoSize":e+=".autoSize("+this._autoSize+")";break;case"_scene":e+=".scene(ige.$('"+this.scene().id()+"'))"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_63);var $i_64=$i_53.extend({classId:"$i_64",init:function(){this._alwaysInView=!0,this._super(),this._shouldRender=!0,this._autoSize=!0,this.geometry.x=ige.geometry.x,this.geometry.y=ige.geometry.y},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},shouldRender:function(t){return t!==void 0?(this._shouldRender=t,this):this._shouldRender},ignoreCamera:function(t){return t!==void 0?(this._ignoreCamera=t,this):this._ignoreCamera},tick:function(t){if(this._shouldRender){if(this._ignoreCamera){var e=ige._currentCamera;this.translateTo(e._translate.x,e._translate.y,e._translate.z)}this._super(t)}},_resizeEvent:function(t){this._autoSize&&(this.geometry=ige.geometry.clone());var e=this._children,i=e.length;while(i--)e[i]._resizeEvent(t)},_stringify:function(){var t,e=this._super();for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_shouldRender":e+=".shouldRender("+this.shouldRender()+")";break;case"_autoSize":e+=".autoSize("+this.autoSize()+")"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_64);var $i_88=$i_53.extend({classId:"$i_88",init:function(){this._alwaysInView=!0,this._super(),this._id="ige",this.basePath="",this.isServer=typeof module!="undefined"&&module.exports!==void 0,ige=this,console.log("------------------------------------------------------------------------------"),console.log("* Powered by the Isogenic Game Engine "+igeVersion+"                                  *"),console.log("* (C)opyright 2012 Irrelon Software Limited                                  *"),console.log("* http://www.isogenicengine.com                                              *"),console.log("------------------------------------------------------------------------------"),this._super(),this.isServer||this.addComponent($i_39),this.ClassStore={},this.TextureStore=[],this._idCounter=(new Date).getTime(),this.addComponent($i_14),this.addComponent($i_12),this._renderModes=["2d","three"],this._renderContext="2d",this._renderMode=this._renderModes[this._renderContext],this._tickTime="NA",this.tickDelta=0,this._fpsRate=60,this._state=0,this._textureImageStore={},this._texturesLoading=0,this._texturesTotal=0,this._dependencyQueue=[],this._drawCount=0,this._dps=0,this._frames=0,this._fps=0,this._clientNetDiff=0,this._frameAlternator=!1,this._viewportDepth=!1,this._mousePos=new $i_5(0,0,0),this._currentViewport=null,this._currentCamera=null,this._register={ige:this},this._postTick=[],this._tsit={},this._tslt={},this._ctx=$i_44,this._headless=!0,this.dependencyTimeout(3e4),this._dependencyQueue.push(this.texturesLoaded),setInterval(this._secondTick,1e3)},$:function(t){return typeof t=="string"?this._register[t]:typeof t=="object"?t:this},$$:function(){},register:function(t){return t!==void 0?this._register[t.id()]?(t._registered=!1,this.log('Cannot add object id "'+t.id()+'" to scenegraph because there is already another object in the graph with the same ID!',"error"),!1):(this._register[t.id()]=t,t._registered=!0,this):this._register},unRegister:function(t){return t!==void 0&&this._register[t.id()]&&(delete this._register[t.id()],t._registered=!1),this},setFps:function(t){t!==void 0&&(this.isServer?requestAnimFrame=function(e){setTimeout(function(){e((new Date).getTime())},1e3/t)}:window.requestAnimFrame=function(e){setTimeout(function(){e((new Date).getTime())},1e3/t)})},showStats:function(t){if(t!==void 0){switch(t){case 0:this._removeStatsDiv();break;case 1:this._createStatsDiv()}return this._showStats=t,this}return this._showStats},_createStatsDiv:function(){if(!ige.isServer&&!document.getElementById("igeStats")){var t=document.createElement("div");t.style.fontFamily="Verdana, Tahoma",t.style.fontSize="12px",t.style.position="absolute",t.style.color="#ffffff",t.style.textShadow="1px 1px 3px #000000",t.style.bottom="10px",t.style.left="10px",t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.MozkitUserSelect="none",t.style.zIndex=1e5,t.innerHTML="Please wait...",window.addEventListener("load",function(){document.body.appendChild(t)}),window.addEventListener("unload",function(){}),this._statsDiv=t}},_removeStatsDiv:function(){document.body.removeChild(this._statsDiv),delete this._statsDiv},defineClass:function(t,e){ige.ClassStore[t]=e},getClass:function(t){return ige.ClassStore[t]},newClassInstance:function(t,e){return new ige.ClassStore[t](e)},dependencyCheck:function(){var t=this._dependencyQueue,e=t.length;while(e--)if(!this._dependencyQueue[e]())return!1;return!0},viewportDepth:function(t){return t!==void 0?(this._viewportDepth=t,this):this._viewportDepth},dependencyTimeout:function(t){this._dependencyCheckTimeout=t},textureLoadStart:function(t,e){this._texturesLoading++,this._texturesTotal++,this.emit("textureLoadStart",e)},textureLoadEnd:function(t,e){e._destroyed||this.TextureStore.push(e),this._texturesLoading--,this.emit("textureLoadEnd",e),this._texturesLoading===0&&this._allTexturesLoaded()},textureFromUrl:function(t){var e,i=this.TextureStore,n=i.length;while(n--)if(e=i[n],e._url===t)return e},texturesLoaded:function(){return ige._texturesLoading===0},_allTexturesLoaded:function(){this._loggedATL||(this._loggedATL=!0,this.log("All textures have loaded")),this.emit("texturesLoaded")},canvasReady:function(){return ige._canvas!==void 0||ige.isServer},newId:function(){return this._idCounter++,this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))+""},newIdHex:function(){return this._idCounter++,(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16)},start:function(t){if(!ige._state)if(ige.dependencyCheck())ige.log("Starting engine..."),ige._state=1,requestAnimFrame(ige.tick),ige.log("Engine started"),typeof t=="function"&&t(!0);else{var e=(new Date).getTime();ige._dependencyCheckStart||(ige._dependencyCheckStart=e),e-ige._dependencyCheckStart>this._dependencyCheckTimeout?(this.log("Engine start failed because the dependency check timed out after "+this._dependencyCheckTimeout/1e3+" seconds","error"),typeof t=="function"&&t(!1)):setTimeout(function(){ige.start(t)},200)}},stop:function(){return this._state?(this.log("Stopping engine..."),this._state=0,!0):!1},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},pixelRatioScaling:function(t){return t!==void 0?(this._pixelRatioScaling=t,this):this._pixelRatioScaling},renderContext:function(t){return t!==void 0?(this._renderContext=t,this._renderMode=this._renderModes[t],this.log("Rendering mode set to: "+t),this):this._renderContext},createFrontBuffer:function(t,e){this.isServer||this._canvas||(this._createdFrontBuffer=!0,this._pixelRatioScaling=!e,this._frontBufferSetup(t,e))},_frontBufferSetup:function(t){var e,i=document.createElement("canvas");this._pixelRatioScaling?(e=i.getContext(ige._renderContext),this._devicePixelRatio=window.devicePixelRatio||1,this._backingStoreRatio=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,this._deviceFinalDrawRatio=this._devicePixelRatio/this._backingStoreRatio):(this._devicePixelRatio=1,this._backingStoreRatio=1,this._deviceFinalDrawRatio=1),i.id="igeFrontBuffer",this.canvas(i,t),document.body.appendChild(i)},canvas:function(t,e){this._canvas||(this._canvas=t,e&&(this._autoSize=e,window.addEventListener("resize",this._resizeEvent)),this._resizeEvent(),this._ctx=this._canvas.getContext(this._renderContext),this._headless=!1,this.input.setupListeners(this._canvas))},clearCanvas:function(){this._ctx&&this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},removeCanvas:function(){this.input&&this.input.destroyListeners(),this._autoSize&&window.removeEventListener("resize",this._resizeEvent),this._createdFrontBuffer&&document.body.removeChild(this._canvas),delete this._canvas,delete this._ctx,this._ctx=$i_44,this._headless=!0},openUrl:function(t){t!==void 0&&(ige.cocoonJs&&ige.cocoonJs.detected?ige.cocoonJs.openUrl(t):window.open(t))},showWebView:function(t){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.showWebView(t);else{var e=document.getElementById("igeOverlay");e||(e=document.createElement("iframe"),e.id="igeOverlay",e.style.position="absolute",e.style.border="none",e.style.left="0px",e.style.top="0px",e.style.width="100%",e.style.height="100%",document.body.appendChild(e)),t!==void 0&&(e.src=t),e.style.display="block"}return this},hideWebView:function(){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.hideWebView();else{var t=document.getElementById("igeOverlay");t&&(t.style.display="none")}return this},layerCall:function(js){js!==void 0&&eval(js)},mousePos:function(){return this._mousePos},_resizeEvent:function(t){if(ige._autoSize){var e=window.innerWidth,i=window.innerHeight,n=ige._children,o=n.length;ige._canvas&&(e%2&&e--,i%2&&i--,ige._canvas.width=e*ige._deviceFinalDrawRatio,ige._canvas.height=i*ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio!==1&&(ige._canvas.style.width=e+"px",ige._canvas.style.height=i+"px",ige._ctx.scale(ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio))),ige.geometry=new $i_5(e,i,0);while(o--)n[o]._resizeEvent(t)}ige._resized=!0},_secondTick:function(){var t=ige;if(t._fps=t._frames,t._dps=t._dpt*t._fps,t._frames=0,t._drawCount=0,t._showStats)switch(t._showStats){case 1:t._statsDiv.innerHTML='<span class="met" title="Frames Per Second">fps: '+t._fps+'</span> <span class="met" title="Draws Per Second">dps: '+t._dps+'</span> <span class="met" title="Draws Per Tick">dpt: '+t._dpt+'</span> <span class="met" title="Time Spent Processing Tick">tps: '+t._tickTime+"ms</span>",t.network&&(t._statsDiv.innerHTML+=' <span class="met" title="Network Latency (Time From Server to This Client)">lat: '+t.network._latency+"ms</span>")}},tick:function(t,e){var i,n,o,s=ige,r=s._postTick,a=r.length;if(igeDebug.timing&&(i=(new Date).getTime()),s._state){for(e===void 0&&(e=s._ctx),requestAnimFrame(s.tick),s._frameAlternator=!s._frameAlternator,s.tickStart=t,s.tickStart-=s._clientNetDiff,s.lastTick?s.tickDelta=s.tickStart-s.lastTick:(s.lastTick=0,s.tickDelta=0),s._processBehaviours(e),s.render(e),o=0;a>o;o++)r[o]();s.lastTick=s.tickStart,s._frames++,s._dpt=s._drawCount,s._drawCount=0,s.input.tick()}s._resized=!1,igeDebug.timing&&(n=(new Date).getTime(),ige._tickTime=n-i)},fps:function(){return this._fps},dpt:function(){return this._dpt},dps:function(){return this._dps},render:function(t){var e,i;this._viewportDepth&&(igeDebug.timing?(e=(new Date).getTime(),this.depthSortChildren(),i=(new Date).getTime()-e,ige._tslt[this.id()]||(ige._tslt[this.id()]={}),ige._tslt[this.id()].depthSortChildren=i):this.depthSortChildren()),t.save(),t.translate(this.geometry.x2,this.geometry.y2);var n,o=this._children;if(o)if(n=o.length,igeDebug.timing)while(n--)t.save(),e=(new Date).getTime(),o[n].tick(t),i=(new Date).getTime()-e,o[n]&&(ige._tsit[o[n].id()]||(ige._tsit[o[n].id()]=0),ige._tslt[o[n].id()]||(ige._tslt[o[n].id()]={}),ige._tsit[o[n].id()]+=i,ige._tslt[o[n].id()].tick=i),t.restore();else while(n--)t.save(),o[n].tick(t),t.restore();t.restore()},analyseTiming:function(){igeDebug.timing||this.log("Cannot analyse timing because the igeDebug.timing flag is not enabled so no timing data has been recorded!","warning")},sceneGraph:function(t,e){var i,n,o,s,r="";for(e===void 0&&(e=0),t||(t=ige),i=0;e>i;i++)r+="----";if(igeDebug.timing?(n="",n+="T: "+ige._tsit[t.id()],ige._tslt[t.id()]&&(typeof ige._tslt[t.id()].tick=="number"&&(n+=" | LastTick: "+ige._tslt[t.id()].tick),typeof ige._tslt[t.id()].depthSortChildren=="number"&&(n+=" | ChildDepthSort: "+ige._tslt[t.id()].depthSortChildren)),console.log(r+t.id()+" ("+t._classId+") : "+t._inView+" Timing("+n+")")):console.log(r+t.id()+" ("+t._classId+") : "+t._inView),e++,t===ige){if(o=t._children){s=o.length;while(s--)o[s]._scene._shouldRender&&(igeDebug.timing?(n="",n+="T: "+ige._tsit[o[s].id()],ige._tslt[o[s].id()]&&(typeof ige._tslt[o[s].id()].tick=="number"&&(n+=" | LastTick: "+ige._tslt[o[s].id()].tick),typeof ige._tslt[o[s].id()].depthSortChildren=="number"&&(n+=" | ChildDepthSort: "+ige._tslt[o[s].id()].depthSortChildren)),console.log(r+"----"+o[s].id()+" ("+o[s]._classId+") : "+o[s]._inView+" Timing("+n+")")):console.log(r+"----"+o[s].id()+" ("+o[s]._classId+") : "+o[s]._inView),this.sceneGraph(o[s]._scene,e+1))}}else if(o=t._children){s=o.length;while(s--)this.sceneGraph(o[s],e)}},getSceneGraphData:function(t){var e,i,n,o,s,r=[];if(t||(t=ige),e={text:t.id()+" ("+t._classId+")",parent:t._parent,id:t.id()},t===ige){if(o=t._children){s=o.length;while(s--)i={text:o[s].id()+" ("+o[s]._classId+")",parent:o[s]._parent,id:o[s].id()},o[s]._scene&&(n=this.getSceneGraphData(o[s]._scene),i.items=[n]),r.push(i)}}else if(o=t._children){s=o.length;while(s--)i=this.getSceneGraphData(o[s]),r.push(i)}return r.length>0&&(e.items=r),e},destroy:function(){this.stop(),this.isServer||this.removeCanvas(),this._super(),this.log("Engine destroy complete.")}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_88);var ClientNetworkEvents={_onTest:function(t){console.log("Test command received from server with data:",t)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=ClientNetworkEvents);var Client=$i_2.extend({classId:"Client",init:function(){ige.showStats(1),this.obj=[],this.gameTexture={},ige.addComponent(Ige$i_28Component),this.implement(ClientNetworkEvents),ige.createFrontBuffer(!0),ige.start(function(t){t&&ige.network.start("http://localhost:2000",function(){ige.addComponent($i_34)})})}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Client);var Game=$i_2.extend({classId:"Game",init:function(t,e){ige=new $i_88,ige.isServer||(ige.client=new t),ige.isServer&&(ige.server=new t(e))}});if(typeof module!="undefined"&&module.exports!==void 0)module.exports=Game;else var game=new Game(Client)